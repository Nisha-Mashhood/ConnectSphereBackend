{"version":3,"file":"notification-model.js","sourceRoot":"","sources":["../../src/Models/notification-model.ts"],"names":[],"mappings":";;;;;;AAAA,wDAAgC;AAChC,uCAAyC;AACzC,6DAA8D;AAE9D,kEAA0C;AAE1C,MAAM,qBAAqB,GAAG,IAAI,iBAAM,CAAmB;IACzD,iBAAiB,EAAE;QACjB,IAAI,EAAE,MAAM;QACZ,MAAM,EAAE,IAAI;KACb;IACD,MAAM,EAAE;QACN,IAAI,EAAE,kBAAQ,CAAC,MAAM,CAAC,KAAK,CAAC,QAAQ;QACpC,GAAG,EAAE,MAAM;QACX,QAAQ,EAAE,IAAI;QACd,KAAK,EAAE,IAAI;KACZ;IACD,IAAI,EAAE;QACJ,IAAI,EAAE,MAAM;QACZ,IAAI,EAAE,CAAC,SAAS,EAAE,eAAe,EAAE,aAAa,EAAE,eAAe,EAAE,UAAU,EAAE,YAAY,EAAE,iBAAiB,EAAE,sBAAsB,CAAC;QACvI,QAAQ,EAAE,IAAI;KACf;IACD,OAAO,EAAE;QACP,IAAI,EAAE,MAAM;QACZ,QAAQ,EAAE,IAAI;KACf;IACD,SAAS,EAAE;QACT,IAAI,EAAE,MAAM;QACZ,QAAQ,EAAE,IAAI;KACf;IACD,QAAQ,EAAE;QACR,IAAI,EAAE,kBAAQ,CAAC,MAAM,CAAC,KAAK,CAAC,QAAQ;QACpC,GAAG,EAAE,MAAM;QACX,QAAQ,EAAE,IAAI;KACf;IACD,MAAM,EAAE;QACN,IAAI,EAAE,MAAM;QACZ,IAAI,EAAE,CAAC,QAAQ,EAAE,MAAM,CAAC;QACxB,OAAO,EAAE,QAAQ;KAClB;IACD,MAAM,EAAE;QACN,IAAI,EAAE,MAAM;QACZ,QAAQ,EAAE,KAAK;KAChB;IACD,QAAQ,EAAE;QACR,IAAI,EAAE,MAAM;QACZ,IAAI,EAAE,CAAC,OAAO,EAAE,OAAO,CAAC;QACxB,QAAQ,EAAE,KAAK;KAChB;IACD,gBAAgB,EAAE;QAChB,IAAI,EAAE,IAAI;QACV,QAAQ,EAAE,KAAK;KAChB;IACD,gBAAgB,EAAE;QAChB,IAAI,EAAE,MAAM;QACZ,QAAQ,EAAE,KAAK;KAChB;IACD,SAAS,EAAE;QACT,IAAI,EAAE,IAAI;QACV,OAAO,EAAE,IAAI,CAAC,GAAG;KAClB;IACD,SAAS,EAAE;QACT,IAAI,EAAE,IAAI;QACV,OAAO,EAAE,IAAI,CAAC,GAAG;KAClB;IACD,WAAW,EAAE;QACX,WAAW,EAAE;YACX,IAAI,EAAE,MAAM;YACZ,IAAI,EAAE,CAAC,MAAM,EAAE,OAAO,EAAE,eAAe,EAAE,gBAAgB,CAAC;YAC1D,QAAQ,EAAE,KAAK;SAChB;QACD,SAAS,EAAE;YACT,IAAI,EAAE,MAAM;YACZ,QAAQ,EAAE,KAAK;SAChB;KACF;CACF,CAAC,CAAC;AAEH,qBAAqB,CAAC,KAAK,CAAC,EAAE,MAAM,EAAE,CAAC,EAAE,SAAS,EAAE,CAAC,CAAC,EAAE,CAAC,CAAC;AAE1D,8CAA8C;AAC9C,qBAAqB,CAAC,GAAG,CAAC,MAAM,EAAE,KAAK,WAAW,IAAI;IACpD,IAAI,CAAC,IAAI,CAAC,iBAAiB,EAAE,CAAC;QAC5B,IAAI,CAAC;YACH,IAAI,CAAC,iBAAiB,GAAG,MAAM,IAAA,+BAAgB,EAAC,iBAAiB,EAAE,KAAK,CAAC,CAAC;YAC1E,gBAAM,CAAC,KAAK,CACV,gCAAgC,IAAI,CAAC,iBAAiB,eAAe,IAAI,CAAC,MAAM,EAAE,CACnF,CAAC;QACJ,CAAC;QAAC,OAAO,KAAK,EAAE,CAAC;YACf,gBAAM,CAAC,KAAK,CACV,uCAAuC,IAAI,CAAC,iBAAiB,eAAe,IAAI,CAAC,MAAM,MAAM,KAAK,EAAE,CACrG,CAAC;YACF,OAAO,IAAI,CAAC,KAAc,CAAC,CAAC;QAC9B,CAAC;IACH,CAAC;IACD,IAAI,EAAE,CAAC;AACT,CAAC,CAAC,CAAC;AAEU,QAAA,oBAAoB,GAAG,IAAA,gBAAK,EACvC,iBAAiB,EACjB,qBAAqB,CACtB,CAAC","sourcesContent":["import mongoose from \"mongoose\";\r\nimport { Schema, model } from \"mongoose\";\r\nimport { generateCustomId } from \"../core/utils/id-generator\";\r\nimport { IAppNotification } from \"../Interfaces/Models/i-app-notification\";\r\nimport logger from \"../core/utils/logger\";\r\n\r\nconst AppNotificationSchema = new Schema<IAppNotification>({\r\n  AppNotificationId: {\r\n    type: String,\r\n    unique: true,\r\n  },\r\n  userId: {\r\n    type: mongoose.Schema.Types.ObjectId,\r\n    ref: \"User\",\r\n    required: true,\r\n    index: true,\r\n  },\r\n  type: {\r\n    type: String,\r\n    enum: [\"message\", \"incoming_call\", \"missed_call\", \"task_reminder\", \"new_user\", 'new_mentor', 'mentor_approved', 'collaboration_status'],\r\n    required: true,\r\n  },\r\n  content: {\r\n    type: String,\r\n    required: true,\r\n  },\r\n  relatedId: {\r\n    type: String,\r\n    required: true,\r\n  },\r\n  senderId: {\r\n    type: mongoose.Schema.Types.ObjectId,\r\n    ref: \"User\",\r\n    required: true,\r\n  },\r\n  status: {\r\n    type: String,\r\n    enum: [\"unread\", \"read\"],\r\n    default: \"unread\",\r\n  },\r\n  callId: {\r\n    type: String,\r\n    required: false,\r\n  }, \r\n  callType: { \r\n    type: String, \r\n    enum: [\"audio\", \"video\"], \r\n    required: false \r\n  },\r\n  notificationDate: {\r\n    type: Date,\r\n    required: false,\r\n  },\r\n  notificationTime: {\r\n    type: String,\r\n    required: false,\r\n  },\r\n  createdAt: {\r\n    type: Date,\r\n    default: Date.now,\r\n  },\r\n  updatedAt: {\r\n    type: Date,\r\n    default: Date.now,\r\n  },\r\n  taskContext: {\r\n    contextType: {\r\n      type: String,\r\n      enum: [\"user\", \"group\", \"collaboration\", \"userconnection\"],\r\n      required: false,\r\n    },\r\n    contextId: {\r\n      type: String,\r\n      required: false,\r\n    },\r\n  },\r\n});\r\n\r\nAppNotificationSchema.index({ userId: 1, createdAt: -1 });\r\n\r\n// Pre-save hook to generate AppNotificationId\r\nAppNotificationSchema.pre(\"save\", async function (next) {\r\n  if (!this.AppNotificationId) {\r\n    try {\r\n      this.AppNotificationId = await generateCustomId(\"appNotification\", \"ANF\");\r\n      logger.debug(\r\n        `Generated AppNotificationId: ${this.AppNotificationId} for userId ${this.userId}`\r\n      );\r\n    } catch (error) {\r\n      logger.error(\r\n        `Error generating AppNotificationId: ${this.AppNotificationId} for userId ${this.userId} : ${error}`\r\n      );\r\n      return next(error as Error);\r\n    }\r\n  }\r\n  next();\r\n});\r\n\r\nexport const AppNotificationModel = model<IAppNotification>(\r\n  \"AppNotification\",\r\n  AppNotificationSchema\r\n);"]}