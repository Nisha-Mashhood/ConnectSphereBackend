{"version":3,"file":"admin-dashboard-repository.js","sourceRoot":"","sources":["../../src/Repositories/admin-dashboard-repository.ts"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;AAAA,yCAA+C;AAC/C,0EAAiD;AACjD,wFAA0D;AAC1D,sEAAwC;AACxC,0FAA2D;AAE3D,kEAA0C;AAC1C,+DAA8D;AAS9D,kEAAyD;AAEzD,gEAA6D;AAGtD,IAAM,eAAe,GAArB,MAAM,eAAe;IAG1B,YAA2C,kBAAuC;QAI3E,uBAAkB,GAAG,KAAK,IAAoB,EAAE;YACrD,IAAI,CAAC;gBACH,OAAO,MAAM,oBAAI,CAAC,cAAc,CAAC,EAAE,IAAI,EAAE,MAAM,EAAE,CAAC,CAAC;YACrD,CAAC;YAAC,OAAO,KAAc,EAAE,CAAC;gBACxB,MAAM,GAAG,GAAG,KAAK,YAAY,KAAK,CAAC,CAAC,CAAC,KAAK,CAAC,CAAC,CAAC,IAAI,KAAK,CAAC,MAAM,CAAC,KAAK,CAAC,CAAC,CAAC;gBACtE,gBAAM,CAAC,KAAK,CAAC,6BAA6B,EAAE,GAAG,CAAC,CAAC;gBACjD,MAAM,IAAI,+BAAe,CACvB,+BAAc,CAAC,iCAAiC,EAChD,+BAAW,CAAC,qBAAqB,EACjC,GAAG,CACJ,CAAC;YACJ,CAAC;QACH,CAAC,CAAA;QAEM,yBAAoB,GAAG,KAAK,IAAoB,EAAE;YACvD,IAAI,CAAC;gBACH,OAAO,MAAM,oBAAI,CAAC,cAAc,CAAC,EAAE,IAAI,EAAE,QAAQ,EAAE,CAAC,CAAC;YACvD,CAAC;YAAC,OAAO,KAAc,EAAE,CAAC;gBACxB,MAAM,GAAG,GAAG,KAAK,YAAY,KAAK,CAAC,CAAC,CAAC,KAAK,CAAC,CAAC,CAAC,IAAI,KAAK,CAAC,MAAM,CAAC,KAAK,CAAC,CAAC,CAAC;gBACtE,gBAAM,CAAC,KAAK,CAAC,+BAA+B,EAAE,GAAG,CAAC,CAAC;gBACnD,MAAM,IAAI,+BAAe,CACvB,+BAAc,CAAC,mCAAmC,EAClD,+BAAW,CAAC,qBAAqB,EACjC,GAAG,CACJ,CAAC;YACJ,CAAC;QACH,CAAC,CAAA;QAEM,oBAAe,GAAG,KAAK,IAA0B,EAAE;YACxD,IAAI,CAAC;gBACH,MAAM,MAAM,GAAG,MAAM,6BAAa,CAAC,SAAS,CAAC;oBAC3C,EAAE,MAAM,EAAE,EAAE,OAAO,EAAE,IAAI,EAAE,EAAE;oBAC7B;wBACE,MAAM,EAAE;4BACN,GAAG,EAAE,IAAI;4BACT,YAAY,EAAE,EAAE,IAAI,EAAE,QAAQ,EAAE;yBACjC;qBACF;iBACF,CAAC,CAAC;gBAEH,MAAM,YAAY,GAAG,MAAM,CAAC,MAAM,GAAG,CAAC,CAAC,CAAC,CAAC,MAAM,CAAC,CAAC,CAAC,CAAC,YAAY,CAAC,CAAC,CAAC,CAAC,CAAC;gBACpE,MAAM,cAAc,GAAG,YAAY,GAAG,GAAG,CAAC;gBAE1C,OAAO,EAAE,YAAY,EAAE,cAAc,EAAE,CAAC;YAC1C,CAAC;YAAC,OAAO,KAAc,EAAE,CAAC;gBACxB,MAAM,GAAG,GAAG,KAAK,YAAY,KAAK,CAAC,CAAC,CAAC,KAAK,CAAC,CAAC,CAAC,IAAI,KAAK,CAAC,MAAM,CAAC,KAAK,CAAC,CAAC,CAAC;gBACtE,gBAAM,CAAC,KAAK,CAAC,0BAA0B,EAAE,GAAG,CAAC,CAAC;gBAC9C,MAAM,IAAI,+BAAe,CACvB,+BAAc,CAAC,6BAA6B,EAC5C,+BAAW,CAAC,qBAAqB,EACjC,GAAG,CACJ,CAAC;YACJ,CAAC;QACH,CAAC,CAAA;QAEM,kCAA6B,GAAG,KAAK,IAAoB,EAAE;YAChE,IAAI,CAAC;gBACH,OAAO,MAAM,8BAAa,CAAC,cAAc,CAAC,EAAE,UAAU,EAAE,SAAS,EAAE,CAAC,CAAC;YACvE,CAAC;YAAC,OAAO,KAAc,EAAE,CAAC;gBACxB,MAAM,GAAG,GAAG,KAAK,YAAY,KAAK,CAAC,CAAC,CAAC,KAAK,CAAC,CAAC,CAAC,IAAI,KAAK,CAAC,MAAM,CAAC,KAAK,CAAC,CAAC,CAAC;gBACtE,gBAAM,CAAC,KAAK,CAAC,wCAAwC,EAAE,GAAG,CAAC,CAAC;gBAC5D,MAAM,IAAI,+BAAe,CACvB,+BAAc,CAAC,6CAA6C,EAC5D,+BAAW,CAAC,qBAAqB,EACjC,GAAG,CACJ,CAAC;YACJ,CAAC;QACH,CAAC,CAAA;QAEM,iCAA4B,GAAG,KAAK,IAAoB,EAAE;YAC/D,IAAI,CAAC;gBACH,OAAO,MAAM,6BAAa,CAAC,cAAc,CAAC,EAAE,WAAW,EAAE,KAAK,EAAE,CAAC,CAAC;YACpE,CAAC;YAAC,OAAO,KAAc,EAAE,CAAC;gBACxB,MAAM,GAAG,GAAG,KAAK,YAAY,KAAK,CAAC,CAAC,CAAC,KAAK,CAAC,CAAC,CAAC,IAAI,KAAK,CAAC,MAAM,CAAC,KAAK,CAAC,CAAC,CAAC;gBACtE,gBAAM,CAAC,KAAK,CAAC,uCAAuC,EAAE,GAAG,CAAC,CAAC;gBAC3D,MAAM,IAAI,+BAAe,CACvB,+BAAc,CAAC,2CAA2C,EAC1D,+BAAW,CAAC,qBAAqB,EACjC,GAAG,CACJ,CAAC;YACJ,CAAC;QACH,CAAC,CAAA;QAEM,qBAAgB,GAAG,KAAK,EAC7B,UAAkB,EAClB,IAAY,EACa,EAAE;YAC3B,IAAI,CAAC;gBACH,MAAM,SAAS,GAAG,IAAI,IAAI,EAAE,CAAC;gBAC7B,SAAS,CAAC,OAAO,CAAC,SAAS,CAAC,OAAO,EAAE,GAAG,IAAI,CAAC,CAAC;gBAE9C,MAAM,MAAM,GAAG,MAAM,6BAAa,CAAC,SAAS,CAAC;oBAC3C,EAAE,MAAM,EAAE,EAAE,SAAS,EAAE,EAAE,IAAI,EAAE,SAAS,EAAE,EAAE,OAAO,EAAE,IAAI,EAAE,EAAE;oBAC7D;wBACE,MAAM,EAAE;4BACN,GAAG,EAAE,EAAE,aAAa,EAAE,EAAE,MAAM,EAAE,UAAU,EAAE,IAAI,EAAE,YAAY,EAAE,EAAE;4BAClE,YAAY,EAAE,EAAE,IAAI,EAAE,QAAQ,EAAE;4BAChC,KAAK,EAAE,EAAE,IAAI,EAAE,CAAC,EAAE;yBACnB;qBACF;oBACD,EAAE,KAAK,EAAE,EAAE,GAAG,EAAE,CAAC,EAAE,EAAE;iBACtB,CAAC,CAAC;gBAEH,OAAO,MAAM,CAAC,GAAG,CAAC,CAAC,IAAI,EAAE,EAAE,CAAC,CAAC;oBAC3B,IAAI,EAAE,IAAI,CAAC,GAAG;oBACd,YAAY,EAAE,IAAI,CAAC,YAAY;oBAC/B,eAAe,EAAE,IAAI,CAAC,KAAK,CAAC,IAAI,CAAC,YAAY,GAAG,GAAG,CAAC;oBACpD,aAAa,EAAE,IAAI,CAAC,KAAK,CAAC,IAAI,CAAC,YAAY,GAAG,GAAG,CAAC;iBACnD,CAAC,CAAC,CAAC;YACN,CAAC;YAAC,OAAO,KAAc,EAAE,CAAC;gBACxB,MAAM,GAAG,GAAG,KAAK,YAAY,KAAK,CAAC,CAAC,CAAC,KAAK,CAAC,CAAC,CAAC,IAAI,KAAK,CAAC,MAAM,CAAC,KAAK,CAAC,CAAC,CAAC;gBACtE,gBAAM,CAAC,KAAK,CAAC,2BAA2B,EAAE,GAAG,CAAC,CAAC;gBAC/C,MAAM,IAAI,+BAAe,CACvB,+BAAc,CAAC,2CAA2C,EAC1D,+BAAW,CAAC,qBAAqB,EACjC,GAAG,CACJ,CAAC;YACJ,CAAC;QACH,CAAC,CAAA;QAEM,kBAAa,GAAG,KAAK,EAAC,UAAkB,EAAE,IAAY,EAAyB,EAAE;YACtF,IAAI,CAAC;gBACH,MAAM,SAAS,GAAG,IAAI,IAAI,EAAE,CAAC;gBAC7B,SAAS,CAAC,OAAO,CAAC,SAAS,CAAC,OAAO,EAAE,GAAG,IAAI,CAAC,CAAC;gBAE9C,MAAM,UAAU,GAAG,MAAM,oBAAI,CAAC,SAAS,CAAC;oBACtC,EAAE,MAAM,EAAE,EAAE,SAAS,EAAE,EAAE,IAAI,EAAE,SAAS,EAAE,EAAE,EAAE;oBAC9C;wBACE,MAAM,EAAE;4BACN,GAAG,EAAE;gCACH,IAAI,EAAE;oCACJ,aAAa,EAAE,EAAE,MAAM,EAAE,UAAU,EAAE,IAAI,EAAE,YAAY,EAAE;iCAC1D;gCACD,IAAI,EAAE,OAAO;6BACd;4BACD,KAAK,EAAE,EAAE,IAAI,EAAE,CAAC,EAAE;yBACnB;qBACF;oBACD,EAAE,KAAK,EAAE,EAAE,UAAU,EAAE,CAAC,EAAE,EAAE;iBAC7B,CAAC,CAAC;gBAEH,MAAM,aAAa,GAA+B,EAAE,CAAC;gBACrD,UAAU,CAAC,OAAO,CAAC,CAAC,IAAI,EAAE,EAAE;oBAC1B,IAAI,CAAC,aAAa,CAAC,IAAI,CAAC,GAAG,CAAC,IAAI,CAAC,EAAE,CAAC;wBAClC,aAAa,CAAC,IAAI,CAAC,GAAG,CAAC,IAAI,CAAC,GAAG;4BAC7B,IAAI,EAAE,IAAI,CAAC,GAAG,CAAC,IAAI;4BACnB,KAAK,EAAE,CAAC;4BACR,OAAO,EAAE,CAAC;yBACX,CAAC;oBACJ,CAAC;oBACD,IAAI,IAAI,CAAC,GAAG,CAAC,IAAI,KAAK,MAAM;wBAC1B,aAAa,CAAC,IAAI,CAAC,GAAG,CAAC,IAAI,CAAC,CAAC,KAAK,GAAG,IAAI,CAAC,KAAK,CAAC;oBAClD,IAAI,IAAI,CAAC,GAAG,CAAC,IAAI,KAAK,QAAQ;wBAC5B,aAAa,CAAC,IAAI,CAAC,GAAG,CAAC,IAAI,CAAC,CAAC,OAAO,GAAG,IAAI,CAAC,KAAK,CAAC;gBACtD,CAAC,CAAC,CAAC;gBAEH,OAAO,MAAM,CAAC,MAAM,CAAC,aAAa,CAAC,CAAC;YACtC,CAAC;YAAC,OAAO,KAAc,EAAE,CAAC;gBACxB,MAAM,GAAG,GAAG,KAAK,YAAY,KAAK,CAAC,CAAC,CAAC,KAAK,CAAC,CAAC,CAAC,IAAI,KAAK,CAAC,MAAM,CAAC,KAAK,CAAC,CAAC,CAAC;gBACtE,gBAAM,CAAC,KAAK,CAAC,wBAAwB,EAAE,GAAG,CAAC,CAAC;gBAC5C,MAAM,IAAI,+BAAe,CACvB,+BAAc,CAAC,2BAA2B,EAC1C,+BAAW,CAAC,qBAAqB,EACjC,GAAG,CACJ,CAAC;YACJ,CAAC;QACH,CAAC,CAAA;QAEM,6BAAwB,GAAG,KAAK,EAAC,KAAc,EAAsB,EAAE;YAC5E,IAAI,CAAC;gBACH,MAAM,KAAK,GAAG,sBAAW;qBACtB,IAAI,CAAC,EAAE,UAAU,EAAE,YAAY,EAAE,CAAC;qBAClC,QAAQ,CAAC,QAAQ,EAAE,YAAY,CAAC;qBAChC,IAAI,CAAC,EAAE,SAAS,EAAE,CAAC,CAAC,EAAE,CAAC,CAAC;gBAE3B,IAAI,KAAK;oBAAE,KAAK,CAAC,KAAK,CAAC,KAAK,CAAC,CAAC;gBAE9B,OAAO,MAAM,KAAK,CAAC,IAAI,EAAE,CAAC;YAC5B,CAAC;YAAC,OAAO,KAAc,EAAE,CAAC;gBACxB,MAAM,GAAG,GAAG,KAAK,YAAY,KAAK,CAAC,CAAC,CAAC,KAAK,CAAC,CAAC,CAAC,IAAI,KAAK,CAAC,MAAM,CAAC,KAAK,CAAC,CAAC,CAAC;gBACtE,gBAAM,CAAC,KAAK,CAAC,mCAAmC,EAAE,GAAG,CAAC,CAAC;gBACvD,MAAM,IAAI,+BAAe,CACvB,+BAAc,CAAC,uCAAuC,EACtD,+BAAW,CAAC,qBAAqB,EACjC,GAAG,CACJ,CAAC;YACJ,CAAC;QACH,CAAC,CAAA;QAEM,kBAAa,GAAG,KAAK,EAAC,KAAa,EAAwB,EAAE;YAClE,IAAI,CAAC;gBACH,MAAM,UAAU,GAAG,MAAM,6BAAa,CAAC,SAAS,CAAC;oBAC/C,EAAE,MAAM,EAAE,EAAE,OAAO,EAAE,IAAI,EAAE,WAAW,EAAE,KAAK,EAAE,EAAE;oBACjD;wBACE,MAAM,EAAE;4BACN,GAAG,EAAE,WAAW;4BAChB,aAAa,EAAE,EAAE,IAAI,EAAE,QAAQ,EAAE;4BACjC,kBAAkB,EAAE,EAAE,IAAI,EAAE,CAAC,EAAE;yBAChC;qBACF;oBACD,EAAE,KAAK,EAAE,EAAE,aAAa,EAAE,CAAC,CAAC,EAAE,EAAE;oBAChC,EAAE,MAAM,EAAE,KAAK,EAAE;oBACjB;wBACE,OAAO,EAAE;4BACP,IAAI,EAAE,SAAS;4BACf,UAAU,EAAE,KAAK;4BACjB,YAAY,EAAE,KAAK;4BACnB,EAAE,EAAE,YAAY;yBACjB;qBACF;oBACD,EAAE,OAAO,EAAE,aAAa,EAAE;oBAC1B;wBACE,OAAO,EAAE;4BACP,IAAI,EAAE,OAAO;4BACb,UAAU,EAAE,mBAAmB;4BAC/B,YAAY,EAAE,KAAK;4BACnB,EAAE,EAAE,UAAU;yBACf;qBACF;oBACD,EAAE,OAAO,EAAE,WAAW,EAAE;oBACxB;wBACE,QAAQ,EAAE;4BACR,GAAG,EAAE,iBAAiB;4BACtB,IAAI,EAAE,gBAAgB;4BACtB,KAAK,EAAE,iBAAiB;4BACxB,MAAM,EAAE,eAAe;4BACvB,UAAU,EAAE,sBAAsB;4BAClC,aAAa,EAAE,CAAC;4BAChB,kBAAkB,EAAE,CAAC;yBACtB;qBACF;iBACF,CAAC,CAAC;gBAEH,MAAM,kBAAkB,GAAG,MAAM,OAAO,CAAC,GAAG,CAC1C,UAAU,CAAC,GAAG,CAAC,KAAK,EAAE,MAAM,EAAE,EAAE;oBAC9B,MAAM,SAAS,GAAG,MAAM,IAAI,CAAC,mBAAmB,CAAC,sBAAsB,CACrE,MAAM,CAAC,GAAG,CAAC,QAAQ,EAAE,CACtB,CAAC;oBACF,OAAO;wBACL,GAAG,MAAM;wBACT,MAAM,EACJ,SAAS,GAAG,CAAC,CAAC,CAAC,CAAC,MAAM,CAAC,SAAS,CAAC,OAAO,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,aAAa;qBAC/D,CAAC;gBACJ,CAAC,CAAC,CACH,CAAC;gBAEF,OAAO,kBAAkB,CAAC;YAC5B,CAAC;YAAC,OAAO,KAAc,EAAE,CAAC;gBACxB,MAAM,GAAG,GAAG,KAAK,YAAY,KAAK,CAAC,CAAC,CAAC,KAAK,CAAC,CAAC,CAAC,IAAI,KAAK,CAAC,MAAM,CAAC,KAAK,CAAC,CAAC,CAAC;gBACtE,gBAAM,CAAC,KAAK,CAAC,wBAAwB,EAAE,GAAG,CAAC,CAAC;gBAC5C,MAAM,IAAI,+BAAe,CACvB,+BAAc,CAAC,2BAA2B,EAC1C,+BAAW,CAAC,qBAAqB,EACjC,GAAG,CACJ,CAAC;YACJ,CAAC;QACH,CAAC,CAAA;QAEM,4BAAuB,GAAG,KAAK,EAAC,KAAa,EAA6B,EAAE;YACjF,IAAI,CAAC;gBACH,OAAO,MAAM,6BAAa;qBACvB,IAAI,CAAC,EAAE,WAAW,EAAE,KAAK,EAAE,CAAC;qBAC5B,QAAQ,CAAC,EAAE,IAAI,EAAE,QAAQ,EAAE,MAAM,EAAE,iBAAiB,EAAE,CAAC;qBACvD,QAAQ,CAAC;oBACR,IAAI,EAAE,UAAU;oBAChB,QAAQ,EAAE,EAAE,IAAI,EAAE,QAAQ,EAAE,MAAM,EAAE,iBAAiB,EAAE;iBACxD,CAAC;qBACD,IAAI,CAAC,EAAE,SAAS,EAAE,CAAC,CAAC,EAAE,CAAC;qBACvB,KAAK,CAAC,KAAK,CAAC,CAAC;YAClB,CAAC;YAAC,OAAO,KAAc,EAAE,CAAC;gBACxB,MAAM,GAAG,GAAG,KAAK,YAAY,KAAK,CAAC,CAAC,CAAC,KAAK,CAAC,CAAC,CAAC,IAAI,KAAK,CAAC,MAAM,CAAC,KAAK,CAAC,CAAC,CAAC;gBACtE,gBAAM,CAAC,KAAK,CAAC,kCAAkC,EAAE,GAAG,CAAC,CAAC;gBACtD,MAAM,IAAI,+BAAe,CACvB,+BAAc,CAAC,qCAAqC,EACpD,+BAAW,CAAC,qBAAqB,EACjC,GAAG,CACJ,CAAC;YACJ,CAAC;QACH,CAAC,CAAA;QAzRC,IAAI,CAAC,mBAAmB,GAAG,kBAAkB,CAAC;IAChD,CAAC;CAyRF,CAAA;AA9RY,0CAAe;0BAAf,eAAe;IAD3B,IAAA,sBAAU,GAAE;IAIE,WAAA,IAAA,kBAAM,EAAC,qBAAqB,CAAC,CAAA;;GAH/B,eAAe,CA8R3B","sourcesContent":["import { inject, injectable } from \"inversify\";\r\nimport mentorModel from \"../Models/mentor-model\";\r\nimport collaboration from \"../Models/collaboration-model\";\r\nimport User from \"../Models/user-model\";\r\nimport MentorRequest from \"../Models/mentor-requset-model\";\r\nimport { IAdminRepository } from \"../Interfaces/Repository/i-admin-repositry\";\r\nimport logger from \"../core/utils/logger\";\r\nimport { RepositoryError } from \"../core/utils/error-handler\";\r\nimport {\r\n  RevenueStats,\r\n  RevenueTrend,\r\n  TopMentor,\r\n  UserGrowth,\r\n} from \"../Utils/types/admin-types\";\r\nimport { IMentor } from \"../Interfaces/Models/i-mentor\";\r\nimport { ICollaboration } from \"../Interfaces/Models/i-collaboration\";\r\nimport { StatusCodes } from \"../enums/status-code-enums\";\r\nimport { IFeedbackRepository } from \"../Interfaces/Repository/i-feedback-repositry\";\r\nimport { ERROR_MESSAGES } from \"../constants/error-messages\";\r\n\r\n@injectable()\r\nexport class AdminRepository implements IAdminRepository {\r\n  private _feedbackRepository: IFeedbackRepository;\r\n\r\n  constructor(@inject('IFeedbackRepository') feedbackRepository: IFeedbackRepository) {\r\n    this._feedbackRepository = feedbackRepository;\r\n  }\r\n\r\n  public getTotalUsersCount = async(): Promise<number> => {\r\n    try {\r\n      return await User.countDocuments({ role: \"user\" });\r\n    } catch (error: unknown) {\r\n      const err = error instanceof Error ? error : new Error(String(error));\r\n      logger.error(\"Error in getTotalUsersCount\", err);\r\n      throw new RepositoryError(\r\n        ERROR_MESSAGES.FAILED_TO_FETCH_TOTAL_USERS_COUNT,\r\n        StatusCodes.INTERNAL_SERVER_ERROR,\r\n        err\r\n      );\r\n    }\r\n  }\r\n\r\n  public getTotalMentorsCount = async(): Promise<number> => {\r\n    try {\r\n      return await User.countDocuments({ role: \"mentor\" });\r\n    } catch (error: unknown) {\r\n      const err = error instanceof Error ? error : new Error(String(error));\r\n      logger.error(\"Error in getTotalMentorsCount\", err);\r\n      throw new RepositoryError(\r\n        ERROR_MESSAGES.FAILED_TO_FETCH_TOTAL_MENTORS_COUNT,\r\n        StatusCodes.INTERNAL_SERVER_ERROR,\r\n        err\r\n      );\r\n    }\r\n  }\r\n\r\n  public getTotalRevenue = async(): Promise<RevenueStats> => {\r\n    try {\r\n      const result = await collaboration.aggregate([\r\n        { $match: { payment: true } },\r\n        {\r\n          $group: {\r\n            _id: null,\r\n            totalRevenue: { $sum: \"$price\" },\r\n          },\r\n        },\r\n      ]);\r\n\r\n      const totalRevenue = result.length > 0 ? result[0].totalRevenue : 0;\r\n      const platformProfit = totalRevenue * 0.1;\r\n\r\n      return { totalRevenue, platformProfit };\r\n    } catch (error: unknown) {\r\n      const err = error instanceof Error ? error : new Error(String(error));\r\n      logger.error(\"Error in getTotalRevenue\", err);\r\n      throw new RepositoryError(\r\n        ERROR_MESSAGES.FAILED_TO_FETCH_TOTAL_REVENUE,\r\n        StatusCodes.INTERNAL_SERVER_ERROR,\r\n        err\r\n      );\r\n    }\r\n  }\r\n\r\n  public getPendingMentorRequestsCount = async(): Promise<number> => {\r\n    try {\r\n      return await MentorRequest.countDocuments({ isAccepted: \"Pending\" });\r\n    } catch (error: unknown) {\r\n      const err = error instanceof Error ? error : new Error(String(error));\r\n      logger.error(\"Error in getPendingMentorRequestsCount\", err);\r\n      throw new RepositoryError(\r\n        ERROR_MESSAGES.FAILED_TO_FETCH_PENDING_MENTOR_REQUESTS_COUNT,\r\n        StatusCodes.INTERNAL_SERVER_ERROR,\r\n        err\r\n      );\r\n    }\r\n  }\r\n\r\n  public getActiveCollaborationsCount = async(): Promise<number> => {\r\n    try {\r\n      return await collaboration.countDocuments({ isCancelled: false });\r\n    } catch (error: unknown) {\r\n      const err = error instanceof Error ? error : new Error(String(error));\r\n      logger.error(\"Error in getActiveCollaborationsCount\", err);\r\n      throw new RepositoryError(\r\n        ERROR_MESSAGES.FAILED_TO_FETCH_ACTIVE_COLLABORATIONS_COUNT,\r\n        StatusCodes.INTERNAL_SERVER_ERROR,\r\n        err\r\n      );\r\n    }\r\n  }\r\n\r\n  public getRevenueTrends = async(\r\n    timeFormat: string,\r\n    days: number\r\n  ): Promise<RevenueTrend[]> => {\r\n    try {\r\n      const startDate = new Date();\r\n      startDate.setDate(startDate.getDate() - days);\r\n\r\n      const result = await collaboration.aggregate([\r\n        { $match: { createdAt: { $gte: startDate }, payment: true } },\r\n        {\r\n          $group: {\r\n            _id: { $dateToString: { format: timeFormat, date: \"$createdAt\" } },\r\n            totalRevenue: { $sum: \"$price\" },\r\n            count: { $sum: 1 },\r\n          },\r\n        },\r\n        { $sort: { _id: 1 } },\r\n      ]);\r\n\r\n      return result.map((item) => ({\r\n        name: item._id,\r\n        totalRevenue: item.totalRevenue,\r\n        platformRevenue: Math.round(item.totalRevenue * 0.1),\r\n        mentorRevenue: Math.round(item.totalRevenue * 0.9),\r\n      }));\r\n    } catch (error: unknown) {\r\n      const err = error instanceof Error ? error : new Error(String(error));\r\n      logger.error(\"Error in getRevenueTrends\", err);\r\n      throw new RepositoryError(\r\n        ERROR_MESSAGES.FAILED_TO_FETCH_ACTIVE_COLLABORATIONS_COUNT,\r\n        StatusCodes.INTERNAL_SERVER_ERROR,\r\n        err\r\n      );\r\n    }\r\n  }\r\n\r\n  public getUserGrowth = async(timeFormat: string, days: number): Promise<UserGrowth[]> => {\r\n    try {\r\n      const startDate = new Date();\r\n      startDate.setDate(startDate.getDate() - days);\r\n\r\n      const userGrowth = await User.aggregate([\r\n        { $match: { createdAt: { $gte: startDate } } },\r\n        {\r\n          $group: {\r\n            _id: {\r\n              date: {\r\n                $dateToString: { format: timeFormat, date: \"$createdAt\" },\r\n              },\r\n              role: \"$role\",\r\n            },\r\n            count: { $sum: 1 },\r\n          },\r\n        },\r\n        { $sort: { \"_id.date\": 1 } },\r\n      ]);\r\n\r\n      const groupedByDate: Record<string, UserGrowth> = {};\r\n      userGrowth.forEach((item) => {\r\n        if (!groupedByDate[item._id.date]) {\r\n          groupedByDate[item._id.date] = {\r\n            name: item._id.date,\r\n            users: 0,\r\n            mentors: 0,\r\n          };\r\n        }\r\n        if (item._id.role === \"user\")\r\n          groupedByDate[item._id.date].users = item.count;\r\n        if (item._id.role === \"mentor\")\r\n          groupedByDate[item._id.date].mentors = item.count;\r\n      });\r\n\r\n      return Object.values(groupedByDate);\r\n    } catch (error: unknown) {\r\n      const err = error instanceof Error ? error : new Error(String(error));\r\n      logger.error(\"Error in getUserGrowth\", err);\r\n      throw new RepositoryError(\r\n        ERROR_MESSAGES.FAILED_TO_FETCH_USER_GROWTH,\r\n        StatusCodes.INTERNAL_SERVER_ERROR,\r\n        err\r\n      );\r\n    }\r\n  }\r\n\r\n  public getPendingMentorRequests = async(limit?: number): Promise<IMentor[]> => {\r\n    try {\r\n      const query = mentorModel\r\n        .find({ isApproved: \"Processing\" })\r\n        .populate(\"userId\", \"name email\")\r\n        .sort({ createdAt: -1 });\r\n\r\n      if (limit) query.limit(limit);\r\n\r\n      return await query.exec();\r\n    } catch (error: unknown) {\r\n      const err = error instanceof Error ? error : new Error(String(error));\r\n      logger.error(\"Error in getPendingMentorRequests\", err);\r\n      throw new RepositoryError(\r\n        ERROR_MESSAGES.FAILED_TO_FETCH_PENDING_MENTOR_REQUESTS,\r\n        StatusCodes.INTERNAL_SERVER_ERROR,\r\n        err\r\n      );\r\n    }\r\n  }\r\n\r\n  public getTopMentors = async(limit: number): Promise<TopMentor[]> => {\r\n    try {\r\n      const topMentors = await collaboration.aggregate([\r\n        { $match: { payment: true, isCancelled: false } },\r\n        {\r\n          $group: {\r\n            _id: \"$mentorId\",\r\n            totalEarnings: { $sum: \"$price\" },\r\n            collaborationCount: { $sum: 1 },\r\n          },\r\n        },\r\n        { $sort: { totalEarnings: -1 } },\r\n        { $limit: limit },\r\n        {\r\n          $lookup: {\r\n            from: \"mentors\",\r\n            localField: \"_id\",\r\n            foreignField: \"_id\",\r\n            as: \"mentorInfo\",\r\n          },\r\n        },\r\n        { $unwind: \"$mentorInfo\" },\r\n        {\r\n          $lookup: {\r\n            from: \"users\",\r\n            localField: \"mentorInfo.userId\",\r\n            foreignField: \"_id\",\r\n            as: \"userInfo\",\r\n          },\r\n        },\r\n        { $unwind: \"$userInfo\" },\r\n        {\r\n          $project: {\r\n            _id: \"$mentorInfo._id\",\r\n            name: \"$userInfo.name\",\r\n            email: \"$userInfo.email\",\r\n            userId: \"$userInfo._id\",\r\n            profilePic: \"$userInfo.profilePic\",\r\n            totalEarnings: 1,\r\n            collaborationCount: 1,\r\n          },\r\n        },\r\n      ]);\r\n\r\n      const mentorsWithRatings = await Promise.all(\r\n        topMentors.map(async (mentor) => {\r\n          const avgRating = await this._feedbackRepository.getMentorAverageRating(\r\n            mentor._id.toString()\r\n          );\r\n          return {\r\n            ...mentor,\r\n            rating:\r\n              avgRating > 0 ? Number(avgRating.toFixed(2)) : \"No feedback\",\r\n          };\r\n        })\r\n      );\r\n\r\n      return mentorsWithRatings;\r\n    } catch (error: unknown) {\r\n      const err = error instanceof Error ? error : new Error(String(error));\r\n      logger.error(\"Error in getTopMentors\", err);\r\n      throw new RepositoryError(\r\n        ERROR_MESSAGES.FAILED_TO_FETCH_TOP_MENTORS,\r\n        StatusCodes.INTERNAL_SERVER_ERROR,\r\n        err\r\n      );\r\n    }\r\n  }\r\n\r\n  public getRecentCollaborations = async(limit: number): Promise<ICollaboration[]> => {\r\n    try {\r\n      return await collaboration\r\n        .find({ isCancelled: false })\r\n        .populate({ path: \"userId\", select: \"name profilePic\" })\r\n        .populate({\r\n          path: \"mentorId\",\r\n          populate: { path: \"userId\", select: \"name profilePic\" },\r\n        })\r\n        .sort({ createdAt: -1 })\r\n        .limit(limit);\r\n    } catch (error: unknown) {\r\n      const err = error instanceof Error ? error : new Error(String(error));\r\n      logger.error(\"Error in getRecentCollaborations\", err);\r\n      throw new RepositoryError(\r\n        ERROR_MESSAGES.FAILED_TO_FETCH_RECENT_COLLABORATIONS,\r\n        StatusCodes.INTERNAL_SERVER_ERROR,\r\n        err\r\n      );\r\n    }\r\n  }\r\n}\r\n\r\n"]}