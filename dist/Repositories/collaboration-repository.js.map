{"version":3,"file":"collaboration-repository.js","sourceRoot":"","sources":["../../src/Repositories/collaboration-repository.ts"],"names":[],"mappings":"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","sourcesContent":["import { injectable } from \"inversify\";\r\nimport { Types, Model, PipelineStage, ClientSession } from \"mongoose\";\r\nimport { BaseRepository } from \"../core/repositries/base-repositry\";\r\nimport { RepositoryError } from \"../core/utils/error-handler\";\r\nimport logger from \"../core/utils/logger\";\r\nimport Collaboration from \"../Models/collaboration-model\";\r\nimport MentorRequest from \"../Models/mentor-requset-model\";\r\nimport Mentor from \"../Models/mentor-model\";\r\nimport { ICollaboration } from \"../Interfaces/Models/i-collaboration\";\r\nimport { IMentorRequest } from \"../Interfaces/Models/i-mentor-request\";\r\nimport { IMentor } from \"../Interfaces/Models/i-mentor\";\r\nimport { IUser } from \"../Interfaces/Models/i-user\";\r\nimport { LockedSlot } from \"../Utils/types/collaboration-types\";\r\nimport { StatusCodes } from \"../enums/status-code-enums\";\r\nimport { ICollaborationRepository } from \"../Interfaces/Repository/i-collaboration-repositry\";\r\nimport { CollaborationData, UserIds } from \"../Utils/types/notification-types\";\r\n\r\n@injectable()\r\nexport class CollaborationRepository extends BaseRepository<ICollaboration> implements ICollaborationRepository{\r\n  private _mentorRequestModel: Model<IMentorRequest>;\r\n\r\n  constructor() {\r\n    super(Collaboration as Model<ICollaboration>);\r\n    this._mentorRequestModel = MentorRequest;\r\n  }\r\n\r\n  private toObjectId = (id?: string | Types.ObjectId | IMentor | IUser): Types.ObjectId => {\r\n    if (!id) {\r\n      logger.warn(\"Missing ID when converting to ObjectId\");\r\n      throw new RepositoryError(\"Invalid ID: ID is required\", StatusCodes.BAD_REQUEST);\r\n    }\r\n    let idStr: string;\r\n    if (typeof id === \"string\") {\r\n      idStr = id;\r\n    } else if (id instanceof Types.ObjectId) {\r\n      idStr = id.toString();\r\n    } else if (typeof id === \"object\" && \"_id\" in id) {\r\n      idStr = (id as IUser | IMentor)._id.toString();\r\n    } else {\r\n      logger.warn(`Invalid ID type: ${typeof id}`);\r\n      throw new RepositoryError(\r\n        \"Invalid ID: must be a string, ObjectId, IMentor, or IUser\",\r\n        StatusCodes.BAD_REQUEST\r\n      );\r\n    }\r\n    if (!Types.ObjectId.isValid(idStr)) {\r\n      logger.warn(`Invalid ObjectId format: ${idStr}`);\r\n      throw new RepositoryError(\r\n        \"Invalid ID: must be a 24 character hex string\",\r\n        StatusCodes.BAD_REQUEST\r\n      );\r\n    }\r\n    return new Types.ObjectId(idStr);\r\n  }\r\n\r\n  public createTemporaryRequest = async (data: Partial<IMentorRequest>): Promise<IMentorRequest> => {\r\n    try {\r\n      logger.debug(`Creating temporary request for user: ${data.userId}`);\r\n      const request = await this._mentorRequestModel.create({\r\n        ...data,\r\n        mentorId: data.mentorId ? this.toObjectId(data.mentorId) : undefined,\r\n        userId: data.userId ? this.toObjectId(data.userId) : undefined,\r\n        paymentStatus: \"Pending\",\r\n        isAccepted: \"Pending\",\r\n      });\r\n      logger.info(`Temporary request created: ${request._id}`);\r\n      return request;\r\n    } catch (error: unknown) {\r\n      const err = error instanceof Error ? error : new Error(String(error));\r\n      logger.error(`Error creating temporary request`, err);\r\n      throw new RepositoryError(\r\n        \"Error creating temporary request\",\r\n        StatusCodes.INTERNAL_SERVER_ERROR,\r\n        err\r\n      );\r\n    }\r\n  }\r\n\r\n  public getMentorRequestsByMentorId = async (mentorId: string): Promise<IMentorRequest[]> => {\r\n    try {\r\n      logger.debug(`Fetching mentor requests for mentor: ${mentorId}`);\r\n      const requests = await this._mentorRequestModel\r\n        .find({ mentorId: this.toObjectId(mentorId), isAccepted: \"Pending\" })\r\n        .populate({\r\n          path: \"mentorId\",\r\n          populate: { path: \"userId\", select: \"_id name email profilePic\" },\r\n        })\r\n        .populate(\"userId\", \"_id name email profilePic\")\r\n        .lean()\r\n        .exec();\r\n      logger.info(`Fetched ${requests.length} mentor requests for mentorId: ${mentorId}`);\r\n      return requests;\r\n    } catch (error: unknown) {\r\n      const err = error instanceof Error ? error : new Error(String(error));\r\n      logger.error(`Error fetching mentor requests for mentorId ${mentorId}`, err);\r\n      throw new RepositoryError(\r\n        \"Error fetching mentor requests\",\r\n        StatusCodes.INTERNAL_SERVER_ERROR,\r\n        err\r\n      );\r\n    }\r\n  }\r\n\r\n  public findMentorRequestById = async (id: string): Promise<IMentorRequest | null> => {\r\n    try {\r\n      logger.debug(`Finding mentor request by ID: ${id}`);\r\n      const request = await this._mentorRequestModel.findById(this.toObjectId(id)).exec();\r\n      logger.info(`Mentor request ${request ? \"found\" : \"not found\"}: ${id}`);\r\n      return request;\r\n    } catch (error: unknown) {\r\n      const err = error instanceof Error ? error : new Error(String(error));\r\n      logger.error(`Error finding mentor request by ID ${id}`, err);\r\n      throw new RepositoryError(\r\n        \"Error finding mentor request by ID\",\r\n        StatusCodes.INTERNAL_SERVER_ERROR,\r\n        err\r\n      );\r\n    }\r\n  }\r\n\r\n\r\n  public updateMentorRequestStatus = async (\r\n    id: string,\r\n    status: string | \"Pending\" = \"Pending\"\r\n  ): Promise<IMentorRequest | null> => {\r\n    try {\r\n      logger.debug(`Updating mentor request status for ID: ${id} to ${status}`);\r\n      const request = await this._mentorRequestModel\r\n        .findByIdAndUpdate(this.toObjectId(id), { isAccepted: status }, { new: true })\r\n        .exec();\r\n      logger.info(`Mentor request status updated: ${id} to ${status}`);\r\n      return request;\r\n    } catch (error: unknown) {\r\n      const err = error instanceof Error ? error : new Error(String(error));\r\n      logger.error(`Error updating mentor request status for ID ${id}`, err);\r\n      throw new RepositoryError(\r\n        \"Error updating mentor request status\",\r\n        StatusCodes.INTERNAL_SERVER_ERROR,\r\n        err\r\n      );\r\n    }\r\n  }\r\n\r\n  public getRequestByUserId = async (userId: string): Promise<IMentorRequest[]> => {\r\n    try {\r\n      logger.debug(`Fetching requests for user: ${userId}`);\r\n      const requests = await this._mentorRequestModel\r\n        .find({ userId: this.toObjectId(userId) })\r\n        .populate({\r\n          path: \"mentorId\",\r\n          populate: { path: \"userId\", select: \"_id name email profilePic\" },\r\n        })\r\n        .exec();\r\n      logger.info(`Fetched ${requests.length} mentor requests for userId: ${userId}`);\r\n      return requests;\r\n    } catch (error: unknown) {\r\n      const err = error instanceof Error ? error : new Error(String(error));\r\n      logger.error(`Error fetching requests for userId ${userId}`, err);\r\n      throw new RepositoryError(\r\n        \"Error fetching requests by user ID\",\r\n        StatusCodes.INTERNAL_SERVER_ERROR,\r\n        err\r\n      );\r\n    }\r\n  }\r\n\r\n  public createCollaboration = async (collaborationData: Partial<ICollaboration>, session?: ClientSession): Promise<ICollaboration> => {\r\n    try {\r\n      logger.debug(`Creating collaboration for user: ${collaborationData.userId}`);\r\n      // const collaboration = await this.create({\r\n      //   ...collaborationData,\r\n      //   mentorId: collaborationData.mentorId ? this.toObjectId(collaborationData.mentorId) : undefined,\r\n      //   userId: collaborationData.userId ? this.toObjectId(collaborationData.userId) : undefined,\r\n      // });\r\n      const dataToCreate: Partial<ICollaboration> = {\r\n      ...collaborationData,\r\n      mentorId: collaborationData.mentorId\r\n        ? this.toObjectId(collaborationData.mentorId)\r\n        : undefined,\r\n      userId: collaborationData.userId\r\n        ? this.toObjectId(collaborationData.userId)\r\n        : undefined,\r\n    };\r\n\r\n    let collaboration: ICollaboration;\r\n\r\n    if (session) {\r\n      const [created] = await this.model.create([dataToCreate], { session });\r\n      collaboration = created;\r\n    } else {\r\n      collaboration = await this.create(dataToCreate);\r\n    }\r\n      logger.info(`Collaboration created: ${collaboration._id}`);\r\n      return collaboration;\r\n    } catch (error: unknown) {\r\n      const err = error instanceof Error ? error : new Error(String(error));\r\n      logger.error(`Error creating collaboration`, err);\r\n      throw new RepositoryError(\r\n        \"Error creating collaboration\",\r\n        StatusCodes.INTERNAL_SERVER_ERROR,\r\n        err\r\n      );\r\n    }\r\n  }\r\n\r\n  public deleteMentorRequest = async (requestId: string, session?: ClientSession): Promise<void> => {\r\n    try {\r\n      logger.debug(`Deleting mentor request: ${requestId}`);\r\n      // const result = await this._mentorRequestModel.findByIdAndDelete(this.toObjectId(requestId)).exec();\r\n      const query = this._mentorRequestModel.findByIdAndDelete(this.toObjectId(requestId));\r\n      const result = session ? await query.session(session).exec() : await query.exec();\r\n\r\n      if (!result) {\r\n        logger.warn(`Mentor request not found for deletion: ${requestId}`);\r\n        throw new RepositoryError(\r\n          `Mentor request not found with ID: ${requestId}`,\r\n          StatusCodes.NOT_FOUND\r\n        );\r\n      }\r\n      logger.info(`Mentor request deleted: ${requestId}`);\r\n    } catch (error: unknown) {\r\n      const err = error instanceof Error ? error : new Error(String(error));\r\n      logger.error(`Error deleting mentor request ${requestId}`, err);\r\n      throw new RepositoryError(\r\n        \"Error deleting mentor request\",\r\n        StatusCodes.INTERNAL_SERVER_ERROR,\r\n        err\r\n      );\r\n    }\r\n  }\r\n\r\n  public findCollabById = async (collabId: string): Promise<ICollaboration | null> => {\r\n    try {\r\n      logger.debug(`Finding collaboration by ID: ${collabId}`);\r\n      const collab = await this.model\r\n        .findById(this.toObjectId(collabId))\r\n        .populate({\r\n          path: \"mentorId\",\r\n          model: \"Mentor\",\r\n          populate: { path: \"userId\", model: \"User\" },\r\n        })\r\n        .populate({ path: \"userId\", model: \"User\" })\r\n        .exec();\r\n      logger.info(`Collaboration ${collab ? \"found\" : \"not found\"}: ${collabId}`);\r\n      return collab;\r\n    } catch (error: unknown) {\r\n      const err = error instanceof Error ? error : new Error(String(error));\r\n      logger.error(`Error finding collaboration by ID ${collabId}`, err);\r\n      throw new RepositoryError(\r\n        \"Error finding collaboration by ID\",\r\n        StatusCodes.INTERNAL_SERVER_ERROR,\r\n        err\r\n      );\r\n    }\r\n  }\r\n\r\n  public deleteCollabById = async (collabId: string): Promise<ICollaboration | null> => {\r\n    try {\r\n      logger.debug(`Deleting collaboration: ${collabId}`);\r\n      const collab = await this.findByIdAndDelete(collabId);\r\n      if (!collab) {\r\n        logger.warn(`Collaboration not found for deletion: ${collabId}`);\r\n        throw new RepositoryError(\r\n          `Collaboration not found with ID: ${collabId}`,\r\n          StatusCodes.NOT_FOUND\r\n        );\r\n      }\r\n      logger.info(`Collaboration deleted: ${collabId}`);\r\n      return collab;\r\n    } catch (error: unknown) {\r\n      const err = error instanceof Error ? error : new Error(String(error));\r\n      logger.error(`Error deleting collaboration ${collabId}`, err);\r\n      throw new RepositoryError(\r\n        \"Error deleting collaboration\",\r\n        StatusCodes.INTERNAL_SERVER_ERROR,\r\n        err\r\n      );\r\n    }\r\n  }\r\n\r\n  public markCollabAsCancelled = async (collabId: string): Promise<ICollaboration | null> => {\r\n    try {\r\n      logger.debug(`Marking collaboration as cancelled: ${collabId}`);\r\n      const collab = await this.findByIdAndUpdate(\r\n        collabId,\r\n        { isCancelled: true },\r\n        { new: true }\r\n      );\r\n      if (!collab) {\r\n        logger.warn(`Collaboration not found for cancellation: ${collabId}`);\r\n        throw new RepositoryError(\r\n          `Collaboration not found with ID: ${collabId}`,\r\n          StatusCodes.NOT_FOUND\r\n        );\r\n      }\r\n      logger.info(`Collaboration marked as cancelled: ${collabId}`);\r\n      return collab;\r\n    } catch (error: unknown) {\r\n      const err = error instanceof Error ? error : new Error(String(error));\r\n      logger.error(`Error marking collaboration as cancelled ${collabId}`, err);\r\n      throw new RepositoryError(\r\n        \"Error marking collaboration as cancelled\",\r\n        StatusCodes.INTERNAL_SERVER_ERROR,\r\n        err\r\n      );\r\n    }\r\n  }\r\n\r\n  public updateCollabFeedback = async (collabId: string): Promise<ICollaboration | null> => {\r\n    try {\r\n      logger.debug(`Updating collaboration feedback for ID: ${collabId}`);\r\n      const collab = await this.findByIdAndUpdate(\r\n        collabId,\r\n        { feedbackGiven: true },\r\n        { new: true }\r\n      );\r\n      if (!collab) {\r\n        logger.warn(`Collaboration not found for feedback update: ${collabId}`);\r\n        throw new RepositoryError(\r\n          `Collaboration not found with ID: ${collabId}`,\r\n          StatusCodes.NOT_FOUND\r\n        );\r\n      }\r\n      logger.info(`Collaboration feedback updated: ${collabId}`);\r\n      return collab;\r\n    } catch (error: unknown) {\r\n      const err = error instanceof Error ? error : new Error(String(error));\r\n      logger.error(`Error updating collaboration feedback ${collabId}`, err);\r\n      throw new RepositoryError(\r\n        \"Error updating collaboration feedback\",\r\n        StatusCodes.INTERNAL_SERVER_ERROR,\r\n        err\r\n      );\r\n    }\r\n  }\r\n\r\n  public getCollabDataForUser = async (userId: string): Promise<ICollaboration[]> => {\r\n    try {\r\n      logger.debug(`Fetching collaboration data for user: ${userId}`);\r\n      const collaborations = await this.model\r\n        .find({ userId: this.toObjectId(userId), isCancelled: false })\r\n        .populate({\r\n          path: \"mentorId\",\r\n          populate: { path: \"userId\" },\r\n        })\r\n        .populate(\"userId\")\r\n        .exec();\r\n      logger.info(`Fetched ${collaborations.length} collaborations for userId: ${userId}`);\r\n      return collaborations;\r\n    } catch (error: unknown) {\r\n      const err = error instanceof Error ? error : new Error(String(error));\r\n      logger.error(`Error fetching collaboration data for userId ${userId}`, err);\r\n      throw new RepositoryError(\r\n        \"Error fetching collaboration data for user\",\r\n        StatusCodes.INTERNAL_SERVER_ERROR,\r\n        err\r\n      );\r\n    }\r\n  }\r\n\r\n  public getCollabDataForMentor = async (mentorId: string): Promise<ICollaboration[]> => {\r\n    try {\r\n      logger.debug(`Fetching collaboration data for mentor: ${mentorId}`);\r\n      const mentor = await Mentor.findById(this.toObjectId(mentorId)).select(\"userId\");\r\n      if (!mentor) {\r\n        logger.warn(`Mentor not found: ${mentorId}`);\r\n        throw new RepositoryError(\"Mentor not found\", StatusCodes.NOT_FOUND);\r\n      }\r\n      const userId = this.toObjectId(mentor.userId.toString());\r\n      const collaborations = await this.model\r\n        .find({\r\n          $or: [\r\n            { mentorId: this.toObjectId(mentorId), isCancelled: false },\r\n            { userId, isCancelled: false },\r\n          ],\r\n        })\r\n        .populate({\r\n          path: \"mentorId\",\r\n          populate: { path: \"userId\" },\r\n        })\r\n        .populate(\"userId\")\r\n        .exec();\r\n      logger.info(`Fetched ${collaborations.length} collaborations for mentorId: ${mentorId}`);\r\n      return collaborations;\r\n    } catch (error: unknown) {\r\n      const err = error instanceof Error ? error : new Error(String(error));\r\n      logger.error(`Error fetching collaboration data for mentorId ${mentorId}`, err);\r\n      throw new RepositoryError(\r\n        \"Error fetching collaboration data for mentor\",\r\n        StatusCodes.INTERNAL_SERVER_ERROR,\r\n        err\r\n      );\r\n    }\r\n  }\r\n\r\n  public findByIdAndUpdateWithPopulate = async (\r\n  id: string,\r\n  update: Partial<ICollaboration>,\r\n  options = { new: true }\r\n): Promise<ICollaboration | null> => {\r\n  try {\r\n    const updated = await this.model\r\n      .findByIdAndUpdate(this.toObjectId(id), update, options)\r\n      .populate({\r\n        path: \"mentorId\",\r\n        populate: { path: \"userId\" },\r\n      })\r\n      .populate(\"userId\")\r\n      .exec();\r\n\r\n    return updated;\r\n  } catch (error: unknown) {\r\n    const err = error instanceof Error ? error : new Error(String(error));\r\n    logger.error(`Error updating and populating collaboration ${id}: ${err.message}`);\r\n    throw new RepositoryError(\r\n      \"Error updating and populating collaboration\",\r\n      StatusCodes.INTERNAL_SERVER_ERROR,\r\n      err\r\n    );\r\n  }\r\n};\r\n\r\n\r\n  public findMentorRequest = async ({\r\n  page = 1,\r\n  limit = 10,\r\n  search = \"\",\r\n}: {\r\n  page: number;\r\n  limit: number;\r\n  search: string;\r\n}): Promise<{ requests: IMentorRequest[]; total: number; page: number; pages: number }> => {\r\n\r\n  logger.debug(`MentorRequest page=${page}, limit=${limit}, search=\"${search}\"`);\r\n\r\n  try {\r\n    const matchStage: PipelineStage.Match = search\r\n      ? {\r\n          $match: {\r\n            $or: [\r\n              { \"userId.name\": { $regex: search, $options: \"i\" } },\r\n              { \"userId.email\": { $regex: search, $options: \"i\" } },\r\n              { \"mentorId.userId.name\": { $regex: search, $options: \"i\" } },\r\n              { \"mentorId.userId.email\": { $regex: search, $options: \"i\" } },\r\n              { \"mentorId.specialization\": { $regex: search, $options: \"i\" } },\r\n            ],\r\n          },\r\n        }\r\n      : { $match: {} };\r\n\r\n    const pipeline: PipelineStage[] = [\r\n      {\r\n        $lookup: {\r\n          from: \"mentors\",\r\n          localField: \"mentorId\",\r\n          foreignField: \"_id\",\r\n          as: \"mentorId\",\r\n        },\r\n      },\r\n      { $unwind: { path: \"$mentorId\", preserveNullAndEmptyArrays: true } },\r\n\r\n      {\r\n        $lookup: {\r\n          from: \"users\",\r\n          localField: \"mentorId.userId\",\r\n          foreignField: \"_id\",\r\n          as: \"mentorId.userId\",\r\n        },\r\n      },\r\n      { $unwind: { path: \"$mentorId.userId\", preserveNullAndEmptyArrays: true } },\r\n\r\n      {\r\n        $lookup: {\r\n          from: \"users\",\r\n          localField: \"userId\",\r\n          foreignField: \"_id\",\r\n          as: \"userId\",\r\n        },\r\n      },\r\n      { $unwind: { path: \"$userId\", preserveNullAndEmptyArrays: true } },\r\n\r\n      matchStage,\r\n      { $sort: { createdAt: -1 } },\r\n      { $skip: (page - 1) * limit },\r\n      { $limit: limit },\r\n    ];\r\n\r\n    const data = await this._mentorRequestModel.aggregate(pipeline);\r\n\r\n    const totalPipeline: PipelineStage[] = [\r\n      ...pipeline.slice(0, -2),\r\n      { $count: \"total\" },\r\n    ];\r\n\r\n    const totalResult = await this._mentorRequestModel.aggregate(totalPipeline);\r\n    const total = totalResult[0]?.total || 0;\r\n    const pages = Math.ceil(total / limit) || 1;\r\n\r\n    return { requests: data, total, page, pages };\r\n  } catch (error: unknown) {\r\n    const err = error instanceof Error ? error : new Error(String(error));\r\n    logger.error(`[findMentorRequest] FAILED â†’ ${err.message}\\n${err.stack}`);\r\n    throw new RepositoryError(\r\n      \"Error fetching mentor requests\",\r\n      StatusCodes.INTERNAL_SERVER_ERROR,\r\n      err\r\n    );\r\n  }\r\n};\r\n\r\n\r\n  \r\npublic findCollab = async ({\r\n  page = 1,\r\n  limit = 10,\r\n  search = \"\",\r\n}: {\r\n  page: number;\r\n  limit: number;\r\n  search: string;\r\n}): Promise<{ collabs: ICollaboration[]; total: number; page: number; pages: number }> => {\r\n\r\n  logger.debug(`findCollab page=${page}, limit=${limit}, search=\"${search}\"`);\r\n\r\n  try {\r\n    const matchStage: PipelineStage.Match = search\r\n      ? {\r\n          $match: {\r\n            $or: [\r\n              { \"userId.name\": { $regex: search, $options: \"i\" } },\r\n              { \"userId.email\": { $regex: search, $options: \"i\" } },\r\n              { \"mentorId.userId.name\": { $regex: search, $options: \"i\" } },\r\n              { \"mentorId.userId.email\": { $regex: search, $options: \"i\" } },\r\n              { \"mentorId.specialization\": { $regex: search, $options: \"i\" } },\r\n            ],\r\n          },\r\n        }\r\n      : { $match: {} };\r\n\r\n    const pipeline: PipelineStage[] = [\r\n      {\r\n        $lookup: {\r\n          from: \"mentors\",\r\n          localField: \"mentorId\",\r\n          foreignField: \"_id\",\r\n          as: \"mentorId\",\r\n        },\r\n      },\r\n      { $unwind: { path: \"$mentorId\", preserveNullAndEmptyArrays: true } },\r\n      {\r\n        $lookup: {\r\n          from: \"users\",\r\n          localField: \"mentorId.userId\",\r\n          foreignField: \"_id\",\r\n          as: \"mentorId.userId\",\r\n        },\r\n      },\r\n      { $unwind: { path: \"$mentorId.userId\", preserveNullAndEmptyArrays: true } },\r\n      {\r\n        $lookup: {\r\n          from: \"users\",\r\n          localField: \"userId\",\r\n          foreignField: \"_id\",\r\n          as: \"userId\",\r\n        },\r\n      },\r\n      { $unwind: { path: \"$userId\", preserveNullAndEmptyArrays: true } },\r\n      matchStage,\r\n      { $sort: { createdAt: -1 } },\r\n      { $skip: (page - 1) * limit },\r\n      { $limit: limit },\r\n    ];\r\n\r\n    const data = await this.model.aggregate(pipeline);\r\n  \r\n    const totalPipeline: PipelineStage[] = [\r\n      ...pipeline.slice(0, -2),\r\n      { $count: \"total\" },\r\n    ];\r\n\r\n    const totalResult = await this.model.aggregate(totalPipeline);\r\n    const total = totalResult[0]?.total || 0;\r\n\r\n\r\n    const pages = Math.ceil(total / limit) || 1;\r\n\r\n    return { collabs: data, total, page, pages };\r\n  } catch (error: unknown) {\r\n    const err = error instanceof Error ? error : new Error(String(error));\r\n    logger.error(`[findCollab] FAILED â†’ ${err.message}\\n${err.stack}`);\r\n    throw new RepositoryError(\r\n      \"Error fetching collaborations\",\r\n      StatusCodes.INTERNAL_SERVER_ERROR,\r\n      err\r\n    );\r\n  }\r\n};\r\n\r\n  public fetchMentorRequestDetails = async (requestId: string): Promise<IMentorRequest | null> => {\r\n    try {\r\n      logger.debug(`Fetching mentor request details for ID: ${requestId}`);\r\n      const result = await this._mentorRequestModel\r\n        .findById(this.toObjectId(requestId))\r\n        .populate({\r\n          path: \"mentorId\",\r\n          model: \"Mentor\",\r\n          populate: { path: \"userId\", model: \"User\" },\r\n        })\r\n        .populate({ path: \"userId\", model: \"User\" })\r\n        .exec();\r\n      logger.info(`Mentor request details ${result ? \"found\" : \"not found\"}: ${requestId}`);\r\n      return result;\r\n    } catch (error: unknown) {\r\n      const err = error instanceof Error ? error : new Error(String(error));\r\n      logger.error(`Error fetching mentor request details ${requestId}`, err);\r\n      throw new RepositoryError(\r\n        \"Error fetching mentor request details\",\r\n        StatusCodes.INTERNAL_SERVER_ERROR,\r\n        err\r\n      );\r\n    }\r\n  }\r\n\r\n  public findCollabDetails = async (collabId: string): Promise<ICollaboration | null> => {\r\n    try {\r\n      logger.debug(`Fetching collaboration details for ID: ${collabId}`);\r\n      const collab = await this.findCollabById(collabId);\r\n      logger.info(`Collaboration details ${collab ? \"found\" : \"not found\"}: ${collabId}`);\r\n      return collab;\r\n    } catch (error: unknown) {\r\n      const err = error instanceof Error ? error : new Error(String(error));\r\n      logger.error(`Error fetching collaboration details ${collabId}`, err);\r\n      throw new RepositoryError(\r\n        \"Error fetching collaboration details\",\r\n        StatusCodes.INTERNAL_SERVER_ERROR,\r\n        err\r\n      );\r\n    }\r\n  }\r\n\r\n  public updateUnavailableDays = async (\r\n    collabId: string,\r\n    updateData: {\r\n      datesAndReasons: { date: Date; reason: string }[];\r\n      requestedBy: \"user\" | \"mentor\";\r\n      requesterId: string;\r\n      approvedById: string;\r\n      isApproved: \"pending\" | \"approved\" | \"rejected\";\r\n    }\r\n  ): Promise<ICollaboration | null> => {\r\n    try {\r\n      logger.debug(`Updating unavailable days for collaboration: ${collabId}`);\r\n      const collab = await this.findByIdAndUpdate(\r\n        collabId,\r\n        {\r\n          $push: {\r\n            unavailableDays: {\r\n              datesAndReasons: updateData.datesAndReasons,\r\n              requestedBy: updateData.requestedBy,\r\n              requesterId: this.toObjectId(updateData.requesterId),\r\n              approvedById: this.toObjectId(updateData.approvedById),\r\n              isApproved: updateData.isApproved,\r\n            },\r\n          },\r\n        },\r\n        { new: true }\r\n      );\r\n      if (!collab) {\r\n        logger.warn(`Collaboration not found for unavailable days update: ${collabId}`);\r\n        throw new RepositoryError(\r\n          `Collaboration not found with ID: ${collabId}`,\r\n          StatusCodes.NOT_FOUND\r\n        );\r\n      }\r\n      logger.info(`Unavailable days updated for collaboration: ${collabId}`);\r\n      return collab;\r\n    } catch (error: unknown) {\r\n      const err = error instanceof Error ? error : new Error(String(error));\r\n      logger.error(`Error updating unavailable days for collaboration ${collabId}`, err);\r\n      throw new RepositoryError(\r\n        \"Error updating unavailable days\",\r\n        StatusCodes.INTERNAL_SERVER_ERROR,\r\n        err\r\n      );\r\n    }\r\n  }\r\n\r\n  public updateTemporarySlotChanges = async (\r\n    collabId: string,\r\n    updateData: {\r\n      datesAndNewSlots: { date: Date; newTimeSlots: string[] }[];\r\n      requestedBy: \"user\" | \"mentor\";\r\n      requesterId: string;\r\n      approvedById: string;\r\n      isApproved: \"pending\" | \"approved\" | \"rejected\";\r\n    }\r\n  ): Promise<ICollaboration | null> => {\r\n    try {\r\n      logger.debug(`Updating temporary slot changes for collaboration: ${collabId}`);\r\n      const collab = await this.findByIdAndUpdate(\r\n        collabId,\r\n        {\r\n          $push: {\r\n            temporarySlotChanges: {\r\n              datesAndNewSlots: updateData.datesAndNewSlots,\r\n              requestedBy: updateData.requestedBy,\r\n              requesterId: this.toObjectId(updateData.requesterId),\r\n              approvedById: this.toObjectId(updateData.approvedById),\r\n              isApproved: updateData.isApproved,\r\n            },\r\n          },\r\n        },\r\n        { new: true }\r\n      );\r\n      if (!collab) {\r\n        logger.warn(`Collaboration not found for temporary slot changes update: ${collabId}`);\r\n        throw new RepositoryError(\r\n          `Collaboration not found with ID: ${collabId}`,\r\n          StatusCodes.NOT_FOUND\r\n        );\r\n      }\r\n      logger.info(`Temporary slot changes updated for collaboration: ${collabId}`);\r\n      return collab;\r\n    } catch (error: unknown) {\r\n      const err = error instanceof Error ? error : new Error(String(error));\r\n      logger.error(`Error updating temporary slot changes for collaboration ${collabId}`, err);\r\n      throw new RepositoryError(\r\n        \"Error updating temporary slot changes\",\r\n        StatusCodes.INTERNAL_SERVER_ERROR,\r\n        err\r\n      );\r\n    }\r\n  }\r\n\r\n  public updateRequestStatus = async (\r\n    collabId: string,\r\n    requestId: string,\r\n    requestType: \"unavailable\" | \"timeSlot\",\r\n    status: \"approved\" | \"rejected\",\r\n    newEndDate?: Date\r\n  ): Promise<ICollaboration | null> => {\r\n    try {\r\n      logger.debug(`Updating request status for collaboration: ${collabId}, request: ${requestId}`);\r\n      const updateField = requestType === \"unavailable\" ? \"unavailableDays\" : \"temporarySlotChanges\";\r\n      const updateQuery: Record<string, any> = {\r\n        $set: {\r\n          [`${updateField}.$.isApproved`]: status,\r\n        },\r\n      };\r\n      if (newEndDate) {\r\n        updateQuery.$set[\"endDate\"] = newEndDate;\r\n      }\r\n      const collab = await this.model\r\n        .findOneAndUpdate(\r\n          {\r\n            _id: this.toObjectId(collabId),\r\n            [`${updateField}._id`]: this.toObjectId(requestId),\r\n          },\r\n          updateQuery,\r\n          { new: true }\r\n        )\r\n        .populate({\r\n          path: \"mentorId\",\r\n          model: \"Mentor\",\r\n          populate: { path: \"userId\", model: \"User\" },\r\n        })\r\n        .populate({ path: \"userId\", model: \"User\" })\r\n        .exec();\r\n      if (!collab) {\r\n        logger.warn(`Collaboration not found for request status update: ${collabId}`);\r\n        throw new RepositoryError(\r\n          `Collaboration not found with ID: ${collabId}`,\r\n          StatusCodes.NOT_FOUND\r\n        );\r\n      }\r\n      logger.info(`Request status updated for collaboration: ${collabId}, request: ${requestId}`);\r\n      return collab;\r\n    } catch (error: unknown) {\r\n      const err = error instanceof Error ? error : new Error(String(error));\r\n      logger.error(`Error updating request status for collaboration ${collabId}`, err);\r\n      throw new RepositoryError(\r\n        \"Error updating request status\",\r\n        StatusCodes.INTERNAL_SERVER_ERROR,\r\n        err\r\n      );\r\n    }\r\n  }\r\n\r\n  public getLockedSlotsByMentorId = async (mentorId: string): Promise<LockedSlot[]> => {\r\n    try {\r\n      logger.debug(`Fetching locked slots for mentor: ${mentorId}`);\r\n      const currentDate = new Date();\r\n      const collaborations = await this.model\r\n        .find({\r\n          mentorId: this.toObjectId(mentorId),\r\n          isCancelled: false,\r\n          $or: [{ endDate: { $gt: currentDate } }, { endDate: null }],\r\n        })\r\n        .select(\"selectedSlot\")\r\n        .exec();\r\n      const mentorRequests = await this._mentorRequestModel\r\n        .find({\r\n          mentorId: this.toObjectId(mentorId),\r\n          isAccepted: \"Accepted\",\r\n        })\r\n        .select(\"selectedSlot\")\r\n        .exec();\r\n\r\n      const collabSlots: LockedSlot[] = collaborations.flatMap((collab: any) =>\r\n        collab.selectedSlot.map((slot: any) => ({\r\n          day: slot.day,\r\n          timeSlots: slot.timeSlots,\r\n        }))\r\n      );\r\n      const requestSlots: LockedSlot[] = mentorRequests\r\n        .map((request: any) => {\r\n          const selectedSlot = request.selectedSlot as { day?: string; timeSlots?: string };\r\n          if (!selectedSlot.day || !selectedSlot.timeSlots) {\r\n            logger.warn(`Invalid selectedSlot for mentorRequestId: ${request._id}`);\r\n            return null;\r\n          }\r\n          return {\r\n            day: selectedSlot.day,\r\n            timeSlots: [selectedSlot.timeSlots],\r\n          };\r\n        })\r\n        .filter((slot): slot is LockedSlot => slot !== null);\r\n\r\n      const allSlots: LockedSlot[] = [...collabSlots, ...requestSlots];\r\n      const uniqueSlots: LockedSlot[] = [];\r\n      allSlots.forEach((slot) => {\r\n        const existing = uniqueSlots.find((s) => s.day === slot.day);\r\n        if (existing) {\r\n          existing.timeSlots = Array.from(new Set([...existing.timeSlots, ...slot.timeSlots]));\r\n        } else {\r\n          uniqueSlots.push({ day: slot.day, timeSlots: slot.timeSlots });\r\n        }\r\n      });\r\n\r\n      logger.info(`Fetched ${uniqueSlots.length} locked slots for mentorId: ${mentorId}`);\r\n      return uniqueSlots;\r\n    } catch (error: unknown) {\r\n      const err = error instanceof Error ? error : new Error(String(error));\r\n      logger.error(`Error fetching locked slots for mentorId ${mentorId}`, err);\r\n      throw new RepositoryError(\r\n        \"Error fetching locked slots\",\r\n        StatusCodes.INTERNAL_SERVER_ERROR,\r\n        err\r\n      );\r\n    }\r\n  }\r\n\r\n  public findByMentorId = async (mentorId: string): Promise<ICollaboration[]> => {\r\n    try {\r\n      logger.debug(`Fetching collaborations for mentor: ${mentorId}`);\r\n      const collaborations = await this.model\r\n        .find({ mentorId: this.toObjectId(mentorId), isCancelled: false })\r\n        .populate(\"userId\", \"_id name email\")\r\n        .populate(\"mentorId\", \"userId\")\r\n        .exec();\r\n      logger.info(`Fetched ${collaborations.length} collaborations for mentorId: ${mentorId}`);\r\n      return collaborations;\r\n    } catch (error: unknown) {\r\n      const err = error instanceof Error ? error : new Error(String(error));\r\n      logger.error(`Error fetching collaborations for mentorId ${mentorId}`, err);\r\n      throw new RepositoryError(\r\n        \"Error fetching collaborations\",\r\n        StatusCodes.INTERNAL_SERVER_ERROR,\r\n        err\r\n      );\r\n    }\r\n  }\r\n\r\npublic findByDateRange = async (startDate: Date, endDate: Date): Promise<ICollaboration[]> => {\r\n    try {\r\n      logger.debug(`Fetching collaborations from ${startDate} to ${endDate}`);\r\n      const collaborations = await this.model\r\n        .find({ createdAt: { $gte: startDate, $lte: endDate }, isCancelled: false })\r\n        .populate(\"userId\")\r\n        .populate(\"mentorId\")\r\n        .exec();\r\n      logger.info(`Fetched ${collaborations.length} collaborations for date range`);\r\n      return collaborations;\r\n    } catch (error: unknown) {\r\n      const err = error instanceof Error ? error : new Error(String(error));\r\n      logger.error(`Error fetching collaborations by date range`, err);\r\n      throw new RepositoryError(\r\n        \"Error fetching collaborations\",\r\n        StatusCodes.INTERNAL_SERVER_ERROR,\r\n        err\r\n      );\r\n    }\r\n  }\r\n\r\n  public getMentorIdAndUserId = async (collaborationId: string): Promise<UserIds | null> => {\r\n      try {\r\n        logger.debug(`Fetching mentor and user IDs for collaboration: ${collaborationId}`);\r\n        const collaborationData = (await this.model.findById(this.toObjectId(collaborationId))\r\n          .populate<{ mentorId: IMentor }>({ path: \"mentorId\", select: \"userId\" })\r\n          .select(\"userId mentorId\")\r\n          .exec()) as CollaborationData | null;\r\n  \r\n        if (!collaborationData) {\r\n          logger.warn(`Collaboration not found: ${collaborationId}`);\r\n          return null;\r\n        }\r\n  \r\n        const result = {\r\n          userId: collaborationData.userId.toString(),\r\n          mentorUserId: collaborationData.mentorId?.userId?.toString() || null,\r\n        };\r\n        logger.info(`Fetched user IDs for collaboration: ${collaborationId}`);\r\n        return result;\r\n      } catch (error: unknown) {\r\n        const err = error instanceof Error ? error : new Error(String(error));\r\n        logger.error(`Error fetching collaboration IDs for collaboration ${collaborationId}`, err);\r\n        throw new RepositoryError('Error fetching collaboration IDs', StatusCodes.INTERNAL_SERVER_ERROR, err);\r\n      }\r\n    }\r\n}\r\n"]}