{"version":3,"file":"feedback-repository.js","sourceRoot":"","sources":["../../src/Repositories/feedback-repository.ts"],"names":[],"mappings":"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","sourcesContent":["import { injectable } from 'inversify';\r\nimport { Model, Types } from 'mongoose';\r\nimport { BaseRepository } from '../core/repositries/base-repositry';\r\nimport { RepositoryError } from '../core/utils/error-handler';\r\nimport logger from '../core/utils/logger';\r\nimport Feedback from '../Models/feedback-model';\r\nimport { IFeedback } from '../Interfaces/Models/i-feedback';\r\nimport { StatusCodes } from '../enums/status-code-enums';\r\nimport { IFeedbackRepository } from '../Interfaces/Repository/i-feedback-repositry';\r\n\r\n@injectable()\r\nexport class FeedbackRepository extends BaseRepository<IFeedback> implements IFeedbackRepository{\r\n  constructor() {\r\n    super(Feedback as Model<IFeedback>);\r\n  }\r\n\r\n  private toObjectId = (id?: string | Types.ObjectId): Types.ObjectId => {\r\n    if (!id) {\r\n      logger.warn('Missing ID when converting to ObjectId');\r\n      throw new RepositoryError('Invalid ID: ID is required', StatusCodes.BAD_REQUEST);\r\n    }\r\n    const idStr = typeof id === 'string' ? id : id.toString();\r\n    if (!Types.ObjectId.isValid(idStr)) {\r\n      logger.warn(`Invalid ObjectId format: ${idStr}`);\r\n      throw new RepositoryError('Invalid ID: must be a 24 character hex string', StatusCodes.BAD_REQUEST);\r\n    }\r\n    return new Types.ObjectId(idStr);\r\n  }\r\n\r\n   public createFeedback = async (feedbackData: Partial<IFeedback>): Promise<IFeedback> => {\r\n    try {\r\n      logger.debug(`Creating feedback for collaboration: ${feedbackData.collaborationId}`);\r\n      const feedback = await this.create({\r\n        ...feedbackData,\r\n        userId: feedbackData.userId ? this.toObjectId(feedbackData.userId) : undefined,\r\n        mentorId: feedbackData.mentorId ? this.toObjectId(feedbackData.mentorId) : undefined,\r\n        collaborationId: feedbackData.collaborationId ? this.toObjectId(feedbackData.collaborationId) : undefined,\r\n        createdAt: new Date(),\r\n      });\r\n      logger.info(`Feedback created: ${feedback._id}`);\r\n      return feedback;\r\n    } catch (error: unknown) {\r\n      const err = error instanceof Error ? error : new Error(String(error));\r\n      logger.error(`Error creating feedback for collaboration ${feedbackData.collaborationId}`, err);\r\n      throw new RepositoryError('Error creating feedback', StatusCodes.INTERNAL_SERVER_ERROR, err);\r\n    }\r\n  }\r\n  \r\n  public getFeedbacksByMentorId = async (mentorId: string): Promise<IFeedback[]> => {\r\n    try {\r\n      logger.debug(`Fetching feedbacks for mentor: ${mentorId}`);\r\n      const feedbacks = await this.model\r\n        .find({ mentorId: this.toObjectId(mentorId) })\r\n        .populate('userId', '_id name email profilePic')\r\n        .sort({ createdAt: -1 })\r\n        .exec();\r\n      logger.info(`Fetched ${feedbacks.length} feedbacks for mentorId: ${mentorId}`);\r\n      return feedbacks;\r\n    } catch (error: unknown) {\r\n      const err = error instanceof Error ? error : new Error(String(error));\r\n      logger.error(`Error fetching feedbacks for mentorId ${mentorId}`, err);\r\n      throw new RepositoryError('Error fetching feedbacks by mentor ID', StatusCodes.INTERNAL_SERVER_ERROR, err);\r\n    }\r\n  }\r\n\r\n  public getFeedbacksByUserId = async (userId: string): Promise<IFeedback[]> => {\r\n    try {\r\n      logger.debug(`Fetching feedbacks for user: ${userId}`);\r\n      const feedbacks = await this.model\r\n        .find({ userId: this.toObjectId(userId) })\r\n        .populate('mentorId', '_id name profilePic')\r\n        .sort({ createdAt: -1 })\r\n        .limit(10)\r\n        .exec();\r\n      logger.info(`Fetched ${feedbacks.length} feedbacks for userId: ${userId}`);\r\n      return feedbacks;\r\n    } catch (error: unknown) {\r\n      const err = error instanceof Error ? error : new Error(String(error));\r\n      logger.error(`Error fetching feedbacks for userId ${userId}`, err);\r\n      throw new RepositoryError('Error fetching feedbacks by user ID', StatusCodes.INTERNAL_SERVER_ERROR, err);\r\n    }\r\n  }\r\n\r\n  public getFeedbackByCollaborationId = async (collaborationId: string): Promise<IFeedback[]> => {\r\n    try {\r\n      logger.debug(`Fetching feedbacks for collaboration: ${collaborationId}`);\r\n      const feedbacks = await this.model\r\n        .find({ collaborationId: this.toObjectId(collaborationId) })\r\n        .populate('mentorId', '_id name email profilePic')\r\n        .populate('userId', '_id name email profilePic')\r\n        .exec();\r\n      logger.info(`Fetched ${feedbacks.length} feedbacks for collaborationId: ${collaborationId}`);\r\n      return feedbacks;\r\n    } catch (error: unknown) {\r\n      const err = error instanceof Error ? error : new Error(String(error));\r\n      logger.error(`Error fetching feedbacks for collaborationId ${collaborationId}`, err);\r\n      throw new RepositoryError('Error fetching feedbacks by collaboration ID', StatusCodes.INTERNAL_SERVER_ERROR, err);\r\n    }\r\n  }\r\n\r\n  public getMentorAverageRating = async (mentorId: string): Promise<number> => {\r\n    try {\r\n      logger.debug(`Calculating average rating for mentor: ${mentorId}`);\r\n      const result = await this.model.aggregate([\r\n        { $match: { mentorId: this.toObjectId(mentorId) } },\r\n        {\r\n          $group: {\r\n            _id: null,\r\n            averageRating: { $avg: '$rating' },\r\n            averageCommunication: { $avg: '$communication' },\r\n            averageExpertise: { $avg: '$expertise' },\r\n            averagePunctuality: { $avg: '$punctuality' },\r\n          },\r\n        },\r\n      ]);\r\n      const averageRating = result[0]?.averageRating || 0;\r\n      logger.info(`Calculated average rating for mentorId ${mentorId}: ${averageRating}`);\r\n      return averageRating;\r\n    } catch (error: unknown) {\r\n      const err = error instanceof Error ? error : new Error(String(error));\r\n      logger.error(`Error calculating average rating for mentorId ${mentorId}`, err);\r\n      throw new RepositoryError('Error calculating mentor average rating', StatusCodes.INTERNAL_SERVER_ERROR, err);\r\n    }\r\n  }\r\n\r\n  public getFeedbackForProfile = async (profileId: string, profileType: 'mentor' | 'user'): Promise<IFeedback[]> => {\r\n    try {\r\n      logger.debug(`Fetching feedbacks for profile: ${profileId}, type: ${profileType}`);\r\n      const query: Record<string, any> =\r\n        profileType === 'mentor'\r\n          ? { mentorId: this.toObjectId(profileId), isHidden: false }\r\n          : { userId: this.toObjectId(profileId), isHidden: false };\r\n\r\n      const feedbacks = await this.model\r\n        .find(query)\r\n        .populate('userId', '_id name email profilePic')\r\n        .populate({\r\n          path: 'mentorId',\r\n          populate: {\r\n            path: 'userId',\r\n            select: '_id name email profilePic',\r\n          },\r\n        })\r\n        .sort({ createdAt: -1 })\r\n        .limit(5)\r\n        .exec();\r\n      logger.info(`Fetched ${feedbacks.length} feedbacks for profileId: ${profileId}, type: ${profileType}`);\r\n      return feedbacks;\r\n    } catch (error: unknown) {\r\n      const err = error instanceof Error ? error : new Error(String(error));\r\n      logger.error(`Error fetching feedbacks for profileId ${profileId}, type ${profileType}`, err);\r\n      throw new RepositoryError('Error fetching feedbacks for profile', StatusCodes.INTERNAL_SERVER_ERROR, err);\r\n    }\r\n  }\r\n\r\n  public toggleIsHidden = async (feedbackId: string): Promise<IFeedback | null> => {\r\n    try {\r\n      logger.debug(`Toggling isHidden for feedback: ${feedbackId}`);\r\n      const feedback = await this.findById(feedbackId);\r\n      if (!feedback) {\r\n        logger.warn(`Feedback not found: ${feedbackId}`);\r\n        throw new RepositoryError(`Feedback not found with ID: ${feedbackId}`, StatusCodes.NOT_FOUND);\r\n      }\r\n      feedback.isHidden = !feedback.isHidden;\r\n      const updatedFeedback = await feedback.save();\r\n      logger.info(`isHidden toggled for feedback: ${feedbackId}, new status: ${updatedFeedback.isHidden}`);\r\n      return updatedFeedback;\r\n    } catch (error: unknown) {\r\n      const err = error instanceof Error ? error : new Error(String(error));\r\n      logger.error(`Error toggling isHidden for feedback ${feedbackId}`, err);\r\n      throw new RepositoryError('Error toggling isHidden for feedback', StatusCodes.INTERNAL_SERVER_ERROR, err);\r\n    }\r\n  }\r\n}"]}