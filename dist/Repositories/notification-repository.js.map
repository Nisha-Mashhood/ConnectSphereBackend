{"version":3,"file":"notification-repository.js","sourceRoot":"","sources":["../../src/Repositories/notification-repository.ts"],"names":[],"mappings":"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","sourcesContent":["import { injectable } from \"inversify\";\r\nimport { Model, Types } from \"mongoose\";\r\nimport { BaseRepository } from \"../core/repositries/base-repositry\";\r\nimport { RepositoryError } from \"../core/utils/error-handler\";\r\nimport logger from \"../core/utils/logger\";\r\nimport { AppNotificationModel } from \"../Models/notification-model\";\r\nimport { IAppNotification } from \"../Interfaces/Models/i-app-notification\";\r\nimport { ITask } from \"../Interfaces/Models/i-task\";\r\nimport { Task } from \"../Models/task-model\";\r\nimport { StatusCodes } from \"../enums/status-code-enums\";\r\nimport { INotificationRepository } from \"../Interfaces/Repository/i-notification-repositry\";\r\n\r\n@injectable()\r\nexport class NotificationRepository extends BaseRepository<IAppNotification> implements INotificationRepository {\r\n  constructor() {\r\n    super(AppNotificationModel as Model<IAppNotification>);\r\n  }\r\n\r\n  private toObjectId = (id?: string | Types.ObjectId): Types.ObjectId => {\r\n    if (!id) {\r\n      logger.warn('Missing ID when converting to ObjectId');\r\n      throw new RepositoryError('Invalid ID: ID is required', StatusCodes.BAD_REQUEST);\r\n    }\r\n    const idStr = typeof id === 'string' ? id : id.toString();\r\n    if (!Types.ObjectId.isValid(idStr)) {\r\n      logger.warn(`Invalid ObjectId format: ${idStr}`);\r\n      throw new RepositoryError('Invalid ID: must be a 24 character hex string', StatusCodes.BAD_REQUEST);\r\n    }\r\n    return new Types.ObjectId(idStr);\r\n  }\r\n\r\n  public getTasksForNotification = async (taskId: string): Promise<ITask | null> => {\r\n    try {\r\n      logger.debug(`Fetching task for notification: ${taskId}`);\r\n      const task = await Task.findOne({\r\n        _id: this.toObjectId(taskId),\r\n        status: { $ne: \"completed\" },\r\n        dueDate: { $gte: new Date() },\r\n        notificationDate: { $lte: new Date() },\r\n      }).exec();\r\n      logger.info(`Task ${task ? 'found' : 'not found'} for notification: ${taskId}`);\r\n      return task;\r\n    } catch (error: unknown) {\r\n      const err = error instanceof Error ? error : new Error(String(error));\r\n      logger.error(`Error fetching task for notification ${taskId}`, err);\r\n      throw new RepositoryError('Error fetching task for notification', StatusCodes.INTERNAL_SERVER_ERROR, err);\r\n    }\r\n  }\r\n\r\n  public getAllTasksForNotification = async (): Promise<ITask[]> => {\r\n    try {\r\n      logger.debug(\"Fetching all tasks for notification\");\r\n      const tasks = await Task.find({\r\n        status: { $ne: \"completed\" },\r\n        dueDate: { $gte: new Date() },\r\n        notificationDate: { $lte: new Date() },\r\n        notificationTime: { $exists: true },\r\n      }).exec();\r\n      logger.info(`Fetched ${tasks.length} tasks for notification`);\r\n      return tasks;\r\n    } catch (error: unknown) {\r\n      const err = error instanceof Error ? error : new Error(String(error));\r\n      logger.error(`Error fetching all tasks for notification`, err);\r\n      throw new RepositoryError('Error fetching all tasks for notification', StatusCodes.INTERNAL_SERVER_ERROR, err);\r\n    }\r\n  }\r\n\r\n  public findTaskNotification = async (\r\n    userId: string,\r\n    taskId: string,\r\n    notificationDate?: string,\r\n    notificationTime?: string\r\n  ): Promise<IAppNotification | null> => {\r\n    try {\r\n      logger.debug(`Finding task notification for user: ${userId}, task: ${taskId}`);\r\n      const notification = await this.model\r\n        .findOne({\r\n          userId: this.toObjectId(userId),\r\n          type: \"task_reminder\",\r\n          relatedId: taskId,\r\n          notificationDate: notificationDate ? new Date(notificationDate) : undefined,\r\n          notificationTime,\r\n        })\r\n        .exec();\r\n      logger.info(`Task notification ${notification ? 'found' : 'not found'} for user: ${userId}, task: ${taskId}`);\r\n      return notification;\r\n    } catch (error: unknown) {\r\n      const err = error instanceof Error ? error : new Error(String(error));\r\n      logger.error(`Error finding task notification for user ${userId}, task ${taskId}`, err);\r\n      throw new RepositoryError('Error finding task notification', StatusCodes.INTERNAL_SERVER_ERROR, err);\r\n    }\r\n  }\r\n\r\n  public updateNotificationStatus = async (\r\n    notificationId: string,\r\n    status: \"unread\" | \"read\"\r\n  ): Promise<IAppNotification | null> => {\r\n    try {\r\n      logger.debug(`Updating notification status: ${notificationId} to ${status}`);\r\n      const notification = await this.model\r\n        .findByIdAndUpdate(\r\n          this.toObjectId(notificationId),\r\n          { status, updatedAt: new Date() },\r\n          { new: true }\r\n        )\r\n        .exec();\r\n      if (!notification) {\r\n        logger.warn(`Notification not found: ${notificationId}`);\r\n        throw new RepositoryError(`Notification not found with ID: ${notificationId}`, StatusCodes.NOT_FOUND);\r\n      }\r\n      logger.info(`Notification status updated: ${notificationId} to ${status}`);\r\n      return notification;\r\n    } catch (error: unknown) {\r\n      const err = error instanceof Error ? error : new Error(String(error));\r\n      logger.error(`Error updating notification status for ID ${notificationId}`, err);\r\n      throw new RepositoryError('Error updating notification status', StatusCodes.INTERNAL_SERVER_ERROR, err);\r\n    }\r\n  }\r\n\r\n  public updateTaskNotifications = async (\r\n    relatedId: string,\r\n    notificationDate?: Date,\r\n    notificationTime?: string\r\n  ): Promise<{ modifiedCount: number }> => {\r\n    try {\r\n      logger.debug(`Updating task notifications for task: ${relatedId}`);\r\n      const updateData = {\r\n        ...(notificationDate && { notificationDate: new Date(notificationDate) }),\r\n        ...(notificationTime && { notificationTime }),\r\n        updatedAt: new Date(),\r\n      };\r\n      const result = await this.model\r\n        .updateMany({ relatedId, type: \"task_reminder\" }, { $set: updateData })\r\n        .exec();\r\n      logger.info(`Updated ${result.modifiedCount} task notifications for task: ${relatedId}`);\r\n      return { modifiedCount: result.modifiedCount };\r\n    } catch (error: unknown) {\r\n      const err = error instanceof Error ? error : new Error(String(error));\r\n      logger.error(`Error updating task notifications for task ${relatedId}`, err);\r\n      throw new RepositoryError('Error updating task notifications', StatusCodes.INTERNAL_SERVER_ERROR, err);\r\n    }\r\n  }\r\n\r\n  public createNotification = async (notification: Partial<IAppNotification>): Promise<IAppNotification> => {\r\n    try {\r\n      logger.debug(`Creating notification for user: ${notification.userId}`);\r\n      const newNotification = await this.create({\r\n        ...notification,\r\n        userId: notification.userId ? this.toObjectId(notification.userId) : undefined,\r\n        senderId: notification.senderId ? this.toObjectId(notification.senderId) : undefined,\r\n        createdAt: new Date(),\r\n        updatedAt: new Date(),\r\n      });\r\n      logger.info(`Notification created: ${newNotification._id}`);\r\n      return newNotification;\r\n    } catch (error: unknown) {\r\n      const err = error instanceof Error ? error : new Error(String(error));\r\n      logger.error(`Error creating notification for user ${notification.userId}`, err);\r\n      throw new RepositoryError('Error creating notification', StatusCodes.INTERNAL_SERVER_ERROR, err);\r\n    }\r\n  }\r\n\r\n  public findNotificationByUserId = async (userId: string): Promise<IAppNotification[]> => {\r\n    try {\r\n      logger.debug(`Fetching notifications for user: ${userId}`);\r\n      const notifications = await this.model\r\n        .find({ userId: this.toObjectId(userId) })\r\n        .sort({ createdAt: -1 })\r\n        .limit(50)\r\n        .exec();\r\n      logger.info(`Fetched ${notifications.length} notifications for user: ${userId}`);\r\n      return notifications;\r\n    } catch (error: unknown) {\r\n      const err = error instanceof Error ? error : new Error(String(error));\r\n      logger.error(`Error fetching notifications for user ${userId}`, err);\r\n      throw new RepositoryError('Error fetching notifications by user ID', StatusCodes.INTERNAL_SERVER_ERROR, err);\r\n    }\r\n  }\r\n\r\n  public findNotificationByCallId = async (userId: string, callId: string): Promise<IAppNotification | null> => {\r\n    try {\r\n      logger.debug(`Finding notification by call ID: ${callId} for user: ${userId}`);\r\n      const notification = await this.model\r\n        .findOne({\r\n          userId: this.toObjectId(userId),\r\n          callId,\r\n          type: \"incoming_call\",\r\n          status: \"unread\",\r\n        })\r\n        .exec();\r\n      logger.info(`Notification ${notification ? 'found' : 'not found'} for callId: ${callId}, user: ${userId}`);\r\n      return notification;\r\n    } catch (error: unknown) {\r\n      const err = error instanceof Error ? error : new Error(String(error));\r\n      logger.error(`Error finding notification by call ID ${callId} for user ${userId}`, err);\r\n      throw new RepositoryError('Error finding notification by call ID', StatusCodes.INTERNAL_SERVER_ERROR, err);\r\n    }\r\n  }\r\n\r\n  public updateNotificationToMissed = async (\r\n    userId: string,\r\n    callId: string,\r\n    content: string\r\n  ): Promise<IAppNotification | null> => {\r\n    try {\r\n      logger.debug(`Updating notification to missed call for user: ${userId}, call: ${callId}`);\r\n      const notification = await this.model\r\n        .findOneAndUpdate(\r\n          {\r\n            userId: this.toObjectId(userId),\r\n            callId,\r\n            type: \"incoming_call\",\r\n            status: \"unread\",\r\n          },\r\n          { type: \"missed_call\", content, updatedAt: new Date() },\r\n          { new: true }\r\n        )\r\n        .exec();\r\n      if (!notification) {\r\n        logger.warn(`Notification not found for callId: ${callId}, user: ${userId}`);\r\n        throw new RepositoryError(`Notification not found for callId: ${callId}`, StatusCodes.NOT_FOUND);\r\n      }\r\n      logger.info(`Notification updated to missed call: ${notification._id}`);\r\n      return notification;\r\n    } catch (error: unknown) {\r\n      const err = error instanceof Error ? error : new Error(String(error));\r\n      logger.error(`Error updating notification to missed for callId ${callId}, user ${userId}`, err);\r\n      throw new RepositoryError('Error updating notification to missed', StatusCodes.INTERNAL_SERVER_ERROR, err);\r\n    }\r\n  }\r\n\r\n  public markNotificationAsRead = async (notificationId: string): Promise<IAppNotification | null> => {\r\n    try {\r\n      logger.debug(`Marking notification as read: ${notificationId}`);\r\n      const notification = await this.model\r\n        .findByIdAndUpdate(\r\n          this.toObjectId(notificationId),\r\n          { status: \"read\", updatedAt: new Date() },\r\n          { new: true }\r\n        )\r\n        .exec();\r\n      if (!notification) {\r\n        logger.warn(`Notification not found: ${notificationId}`);\r\n        throw new RepositoryError(`Notification not found with ID: ${notificationId}`, StatusCodes.NOT_FOUND);\r\n      }\r\n      logger.info(`Notification marked as read: ${notificationId}`);\r\n      return notification;\r\n    } catch (error: unknown) {\r\n      const err = error instanceof Error ? error : new Error(String(error));\r\n      logger.error(`Error marking notification as read for ID ${notificationId}`, err);\r\n      throw new RepositoryError('Error marking notification as read', StatusCodes.INTERNAL_SERVER_ERROR, err);\r\n    }\r\n  }\r\n\r\n  public getNotificationUnreadCount = async (\r\n    userId: string,\r\n    type?: IAppNotification[\"type\"]\r\n  ): Promise<number> => {\r\n    try {\r\n      logger.debug(`Fetching unread notification count for user: ${userId}${type ? `, type: ${type}` : \"\"}`);\r\n      const query: Record<string, any> = { userId: this.toObjectId(userId), status: \"unread\" };\r\n      if (type) {\r\n        query.type = type;\r\n      }\r\n      const count = await this.model.countDocuments(query).exec();\r\n      logger.info(`Fetched unread notification count: ${count} for user: ${userId}${type ? `, type: ${type}` : \"\"}`);\r\n      return count;\r\n    } catch (error: unknown) {\r\n      const err = error instanceof Error ? error : new Error(String(error));\r\n      logger.error(`Error fetching unread notification count for user ${userId}`, err);\r\n      throw new RepositoryError('Error fetching unread notification count', StatusCodes.INTERNAL_SERVER_ERROR, err);\r\n    }\r\n  }\r\n\r\n  public findNotificationByRelatedId = async (\r\n    relatedId: string,\r\n    options: { userId: string; type: string }\r\n  ): Promise<IAppNotification | null> => {\r\n    try {\r\n      logger.debug(`Fetching notification by relatedId: ${relatedId} for user: ${options.userId}`);\r\n      const notification = await this.model\r\n        .findOne({\r\n          relatedId,\r\n          userId: this.toObjectId(options.userId),\r\n          type: options.type,\r\n        })\r\n        .exec();\r\n      logger.info(\r\n        notification\r\n          ? `Found notification with ID: ${notification._id} for relatedId: ${relatedId}`\r\n          : `No notification found for relatedId: ${relatedId}`\r\n      );\r\n      return notification;\r\n    } catch (error: unknown) {\r\n      const err = error instanceof Error ? error : new Error(String(error));\r\n      logger.error(`Error fetching notification by relatedId ${relatedId} for user ${options.userId}`, err);\r\n      throw new RepositoryError('Error fetching notification by relatedId', StatusCodes.INTERNAL_SERVER_ERROR, err);\r\n    }\r\n  }\r\n\r\n  public updateNotificationById = async (\r\n    notificationId: string,\r\n    updateData: Partial<IAppNotification>\r\n  ): Promise<IAppNotification | null> => {\r\n    try {\r\n      logger.debug(`Updating notification with ID: ${notificationId}`);\r\n      const notification = await this.model\r\n        .findByIdAndUpdate(this.toObjectId(notificationId), { $set: updateData }, { new: true })\r\n        .exec();\r\n      if (!notification) {\r\n        logger.warn(`Notification not found: ${notificationId}`);\r\n        throw new RepositoryError(`Notification not found with ID: ${notificationId}`, StatusCodes.NOT_FOUND);\r\n      }\r\n      logger.info(`Updated notification: ${notificationId}`);\r\n      return notification;\r\n    } catch (error: unknown) {\r\n      const err = error instanceof Error ? error : new Error(String(error));\r\n      logger.error(`Error updating notification with ID ${notificationId}`, err);\r\n      throw new RepositoryError('Error updating notification', StatusCodes.INTERNAL_SERVER_ERROR, err);\r\n    }\r\n  }\r\n\r\n}\r\n"]}