{"version":3,"file":"task-repository.js","sourceRoot":"","sources":["../../src/Repositories/task-repository.ts"],"names":[],"mappings":"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","sourcesContent":["import { injectable } from 'inversify';\r\nimport { Model, Types, FilterQuery } from 'mongoose';\r\nimport { BaseRepository } from '../core/repositries/base-repositry';\r\nimport { RepositoryError } from '../core/utils/error-handler';\r\nimport logger from '../core/utils/logger';\r\nimport { ITask } from '../Interfaces/Models/i-task';\r\nimport { Task } from '../Models/task-model';\r\nimport { StatusCodes } from '../enums/status-code-enums';\r\nimport { ITaskRepository } from '../Interfaces/Repository/i-task-repositry';\r\n  \r\n  @injectable()\r\n  export class TaskRepository extends BaseRepository<ITask> implements ITaskRepository{\r\n    constructor() {\r\n      super(Task as Model<ITask>);\r\n    }\r\n  \r\n    private toObjectId = (id?: string | Types.ObjectId): Types.ObjectId => {\r\n      if (!id) {\r\n        logger.warn('Missing ID when converting to ObjectId');\r\n        throw new RepositoryError('Invalid ID: ID is required', StatusCodes.BAD_REQUEST);\r\n      }\r\n      const idStr = typeof id === 'string' ? id : id.toString();\r\n      if (!Types.ObjectId.isValid(idStr)) {\r\n        logger.warn(`Invalid ObjectId format: ${idStr}`);\r\n        throw new RepositoryError('Invalid ID: must be a 24 character hex string', StatusCodes.BAD_REQUEST);\r\n      }\r\n      return new Types.ObjectId(idStr);\r\n    }\r\n  \r\n    public createTask = async (taskData: Partial<ITask>): Promise<ITask> => {\r\n      try {\r\n        logger.debug(`Creating task: ${taskData.name}`);\r\n        const task = await this.create({\r\n          ...taskData,\r\n          contextId: taskData.contextId ? this.toObjectId(taskData.contextId) : undefined,\r\n          createdBy: taskData.createdBy ? this.toObjectId(taskData.createdBy) : undefined,\r\n          assignedUsers: taskData.assignedUsers\r\n            ? taskData.assignedUsers.map((id) => this.toObjectId(id))\r\n            : [],\r\n          createdAt: new Date(),\r\n        });\r\n        logger.info(`Task created: ${task._id} (${task.name})`);\r\n        return task;\r\n      } catch (error: unknown) {\r\n        const err = error instanceof Error ? error : new Error(String(error));\r\n        logger.error(`Error creating task ${taskData.name}`, err);\r\n        throw new RepositoryError('Error creating task', StatusCodes.INTERNAL_SERVER_ERROR, err);\r\n      }\r\n    }\r\n  \r\n    public findTaskById = async (taskId: string): Promise<ITask | null> => {\r\n      try {\r\n        logger.debug(`Fetching task by ID: ${taskId}`);\r\n        const task = await this.findById(taskId);\r\n        if (!task) {\r\n          logger.warn(`Task not found: ${taskId}`);\r\n          throw new RepositoryError(`Task not found with ID: ${taskId}`, StatusCodes.NOT_FOUND);\r\n        }\r\n        logger.info(`Task fetched: ${taskId} (${task.name})`);\r\n        return task;\r\n      } catch (error: unknown) {\r\n        const err = error instanceof Error ? error : new Error(String(error));\r\n        logger.error(`Error fetching task by ID ${taskId}`, err);\r\n        throw new RepositoryError('Error fetching task by ID', StatusCodes.INTERNAL_SERVER_ERROR, err);\r\n      }\r\n    }\r\n  \r\n    public updateTask = async (taskId: string, updates: Partial<ITask>): Promise<ITask | null> => {\r\n      try {\r\n        logger.debug(\"ðŸŸ  REPO â†’ Raw incoming updates: \" + JSON.stringify({\r\n          updates,\r\n          assignedUsers: updates.assignedUsers\r\n        }));\r\n        const updateData = {\r\n          ...updates,\r\n          contextId: updates.contextId ? this.toObjectId(updates.contextId) : undefined,\r\n          createdBy: updates.createdBy ? this.toObjectId(updates.createdBy) : undefined,\r\n          assignedUsers: updates.assignedUsers !== undefined\r\n          ? updates.assignedUsers.map((id) => this.toObjectId(id))\r\n          : undefined,\r\n        };\r\n        const task = await this.findByIdAndUpdate(taskId, updateData, { new: true });\r\n        if (!task) {\r\n          logger.warn(`Task not found: ${taskId}`);\r\n          throw new RepositoryError(`Task not found with ID: ${taskId}`, StatusCodes.NOT_FOUND);\r\n        }\r\n        logger.debug(\"ðŸŸ  REPO â†’ Raw incoming updates: \" + JSON.stringify({\r\n          updates,\r\n          assignedUsers: updates.assignedUsers\r\n        }));\r\n        logger.info(`Task updated: ${taskId} (${task.name})`);\r\n        return task;\r\n      } catch (error: unknown) {\r\n        const err = error instanceof Error ? error : new Error(String(error));\r\n        logger.error(`Error updating task ${taskId}`, err);\r\n        throw new RepositoryError('Error updating task', StatusCodes.INTERNAL_SERVER_ERROR, err);\r\n      }\r\n    }\r\n  \r\n    public deleteTask = async (taskId: string): Promise<boolean | null> => {\r\n      try {\r\n        logger.debug(`Deleting task: ${taskId}`);\r\n        const task = await this.findById(taskId);\r\n        if (!task) {\r\n          logger.warn(`Task not found: ${taskId}`);\r\n          throw new RepositoryError(`Task not found with ID: ${taskId}`, StatusCodes.NOT_FOUND);\r\n        }const result = await this.delete(taskId);\r\n          if (!result) {\r\n          throw new RepositoryError('Task not found');\r\n          }\r\n        logger.info(`Task deleted: ${taskId} (${task.name})`);\r\n        return true;\r\n      } catch (error: unknown) {\r\n        const err = error instanceof Error ? error : new Error(String(error));\r\n        logger.error(`Error deleting task ${taskId}`, err);\r\n        throw new RepositoryError('Error deleting task', StatusCodes.INTERNAL_SERVER_ERROR, err);\r\n      }\r\n    }\r\n  \r\n    public findTasksByContext = async (contextType: string, contextId: string, userId: string): Promise<ITask[]> => {\r\n      try {\r\n        logger.debug(`Fetching tasks for contextType=${contextType}, contextId=${contextId}, userId=${userId}`);\r\n        let query: FilterQuery<ITask>;\r\n        let populatePaths: any[];\r\n  \r\n        if (contextType === 'user' && userId) {\r\n          query = {\r\n            contextType: 'user',\r\n            $or: [\r\n              { contextId: this.toObjectId(contextId) },\r\n              { assignedUsers: this.toObjectId(userId) },\r\n              { createdBy: this.toObjectId(userId) },\r\n            ],\r\n          };\r\n          populatePaths = [\r\n            { path: 'createdBy', model: 'User', select: '_id name email jobTitle profilePic' },\r\n            { path: 'assignedUsers', model: 'User', select: '_id name email jobTitle profilePic' },\r\n            { path: 'contextId', model: 'User', select: '_id name email jobTitle profilePic' },\r\n          ];\r\n        } else {\r\n          query = { contextType, contextId: this.toObjectId(contextId) };\r\n          populatePaths = [\r\n            { path: 'createdBy', model: 'User', select: '_id name email jobTitle profilePic' },\r\n            {\r\n              path: 'contextId',\r\n              model: contextType === 'group' ? 'Group' : 'Collaboration',\r\n              populate: contextType === 'group' ? { path: 'members.userId', model: 'User', select: '_id name email jobTitle profilePic' } : undefined,\r\n            },\r\n          ];\r\n        }\r\n  \r\n        const tasks = await this.model\r\n          .find(query)\r\n          .populate(populatePaths)\r\n          .sort({ createdAt: -1 })\r\n          .exec();\r\n  \r\n        const today = new Date();\r\n        const updatedTasks = await Promise.all(\r\n          tasks.map(async (task: ITask & { _id: Types.ObjectId }) => {\r\n            if (task.dueDate && new Date(task.dueDate) < today && task.status !== 'completed' && task.status !== 'not-completed') {\r\n              logger.debug(`Updating status to not-completed for task: ${task._id} due to past due date: ${task.dueDate}`);\r\n              const updatedTask = await this.model\r\n                .findByIdAndUpdate(task._id, { status: 'not-completed' }, { new: true })\r\n                .populate(populatePaths)\r\n                .exec();\r\n              if (!updatedTask) {\r\n                logger.warn(`Failed to update task status for task: ${task._id}`);\r\n                return null;\r\n              }\r\n              return updatedTask.toObject();\r\n            }\r\n            return task.toObject();\r\n          })\r\n        );\r\n  \r\n        const validTasks = updatedTasks.filter((task): task is ITask => {\r\n          if (task === null) {\r\n            logger.warn(`Null task encountered in findTasksByContext`);\r\n            return false;\r\n          }\r\n          return true;\r\n        });\r\n  \r\n        logger.info(`Fetched ${validTasks.length} tasks for contextType=${contextType}, contextId=${contextId}`);\r\n        return validTasks;\r\n      } catch (error: unknown) {\r\n        const err = error instanceof Error ? error : new Error(String(error));\r\n        logger.error(`Error fetching tasks for contextType=${contextType}, contextId=${contextId}`, err);\r\n        throw new RepositoryError('Error fetching tasks by context', StatusCodes.INTERNAL_SERVER_ERROR, err);\r\n      }\r\n    }\r\n  \r\n    public updateTaskPriority = async (taskId: string, priority: 'low' | 'medium' | 'high'): Promise<ITask | null> => {\r\n      try {\r\n        logger.debug(`Updating task priority: taskId=${taskId}, priority=${priority}`);\r\n        const task = await this.findByIdAndUpdate(taskId, { priority }, { new: true });\r\n        if (!task) {\r\n          logger.warn(`Task not found: ${taskId}`);\r\n          throw new RepositoryError(`Task not found with ID: ${taskId}`, StatusCodes.NOT_FOUND);\r\n        }\r\n        logger.info(`Task priority updated: ${taskId} to ${priority}`);\r\n        return task;\r\n      } catch (error: unknown) {\r\n        const err = error instanceof Error ? error : new Error(String(error));\r\n        logger.error(`Error updating task priority for task ${taskId}`, err);\r\n        throw new RepositoryError('Error updating task priority', StatusCodes.INTERNAL_SERVER_ERROR, err);\r\n      }\r\n    }\r\n  \r\n    public updateTaskStatus = async (taskId: string, status: 'pending' | 'in-progress' | 'completed' | 'not-completed'): Promise<ITask | null> => {\r\n      try {\r\n        logger.debug(`Updating task status: taskId=${taskId}, status=${status}`);\r\n        const task = await this.findByIdAndUpdate(taskId, { status }, { new: true });\r\n        if (!task) {\r\n          logger.warn(`Task not found: ${taskId}`);\r\n          throw new RepositoryError(`Task not found with ID: ${taskId}`, StatusCodes.NOT_FOUND);\r\n        }\r\n        logger.info(`Task status updated: ${taskId} to ${status}`);\r\n        return task;\r\n      } catch (error: unknown) {\r\n        const err = error instanceof Error ? error : new Error(String(error));\r\n        logger.error(`Error updating task status for task ${taskId}`, err);\r\n        throw new RepositoryError('Error updating task status', StatusCodes.INTERNAL_SERVER_ERROR, err);\r\n      }\r\n    }\r\n  \r\n    public isDuplicateTask = async (name: string, contextId: string, contextType: string): Promise<boolean> => {\r\n      try {\r\n        logger.debug(`Checking duplicate task: ${name} for contextId=${contextId}, contextType=${contextType}`);\r\n        const existingTask = await this.model\r\n          .findOne({ name, contextId: this.toObjectId(contextId), contextType })\r\n          .exec();\r\n        const isDuplicate = !!existingTask;\r\n        logger.info(`Duplicate check for task ${name} in context ${contextId} (${contextType}) - ${isDuplicate}`);\r\n        return isDuplicate;\r\n      } catch (error: unknown) {\r\n        const err = error instanceof Error ? error : new Error(String(error));\r\n        logger.error(`Error checking duplicate task ${name} for context ${contextId}`, err);\r\n        throw new RepositoryError('Error checking duplicate task', StatusCodes.INTERNAL_SERVER_ERROR, err);\r\n      }\r\n    }\r\n  }"]}