{"version":3,"file":"user-collaboration-repository.js","sourceRoot":"","sources":["../../src/Repositories/user-collaboration-repository.ts"],"names":[],"mappings":"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","sourcesContent":["import { injectable } from 'inversify';\r\nimport { Model, PipelineStage, Types } from 'mongoose';\r\nimport { BaseRepository } from '../core/repositries/base-repositry';\r\nimport { RepositoryError } from '../core/utils/error-handler';\r\nimport logger from '../core/utils/logger';\r\nimport UserConnection from '../Models/user-connection-model';\r\nimport { IUserConnection } from '../Interfaces/Models/i-user-connection';\r\nimport { StatusCodes } from '../enums/status-code-enums';\r\nimport { IUserConnectionRepository } from '../Interfaces/Repository/i-user-collaboration-repositry';\r\n\r\n@injectable()\r\nexport class UserConnectionRepository extends BaseRepository<IUserConnection> implements IUserConnectionRepository{\r\n  constructor() {\r\n    super(UserConnection as Model<IUserConnection>);\r\n  }\r\n\r\n  private toObjectId = (id?: string | Types.ObjectId): Types.ObjectId => {\r\n    if (!id) {\r\n      logger.warn('Missing ID when converting to ObjectId');\r\n      throw new RepositoryError('Invalid ID: ID is required', StatusCodes.BAD_REQUEST);\r\n    }\r\n    const idStr = typeof id === 'string' ? id : id.toString();\r\n    if (!Types.ObjectId.isValid(idStr)) {\r\n      logger.warn(`Invalid ObjectId format: ${idStr}`);\r\n      throw new RepositoryError('Invalid ID: must be a 24 character hex string', StatusCodes.BAD_REQUEST);\r\n    }\r\n    return new Types.ObjectId(idStr);\r\n  }\r\n\r\n   public createUserConnection= async(requesterId: string, recipientId: string): Promise<IUserConnection> =>{\r\n    try {\r\n      logger.debug(`Creating user connection: requester=${requesterId}, recipient=${recipientId}`);\r\n      return await this.create({\r\n        requester: this.toObjectId(requesterId),\r\n        recipient: this.toObjectId(recipientId),\r\n        requestStatus: 'Pending',\r\n        connectionStatus: 'Disconnected',\r\n        requestSentAt: new Date(),\r\n        createdAt: new Date(),\r\n        updatedAt: new Date(),\r\n      });\r\n    } catch (error: unknown) {\r\n      const err = error instanceof Error ? error : new Error(String(error));\r\n      logger.error(`Error creating user connection for requester ${requesterId}, recipient ${recipientId}`, err);\r\n      throw new RepositoryError('Error creating user connection', StatusCodes.INTERNAL_SERVER_ERROR, err);\r\n    }\r\n  }\r\n\r\n   public updateUserConnectionStatus = async (\r\n    connectionId: string,\r\n    status: 'Accepted' | 'Rejected'\r\n  ): Promise<IUserConnection | null> => {\r\n    try {\r\n      logger.debug(`Updating user connection status: connectionId=${connectionId}, status=${status}`);\r\n      const updateFields: Record<string, any> = {\r\n        requestStatus: status,\r\n        connectionStatus: status === 'Accepted' ? 'Connected' : 'Disconnected',\r\n        updatedAt: new Date(),\r\n      };\r\n      if (status === 'Accepted') {\r\n        updateFields.requestAcceptedAt = new Date();\r\n      } else if (status === 'Rejected') {\r\n        updateFields.requestRejectedAt = new Date();\r\n      }\r\n      const connection = await this.findByIdAndUpdate(connectionId, updateFields, { new: true });\r\n      if (!connection) {\r\n        logger.warn(`User connection not found: ${connectionId}`);\r\n        throw new RepositoryError(`User connection not found with ID: ${connectionId}`, StatusCodes.NOT_FOUND);\r\n      }\r\n      logger.info(`User connection status updated: ${connectionId} to ${status}`);\r\n      return connection;\r\n    } catch (error: unknown) {\r\n      const err = error instanceof Error ? error : new Error(String(error));\r\n      logger.error(`Error updating user connection status for connection ${connectionId}`, err);\r\n      throw new RepositoryError('Error updating user connection status', StatusCodes.INTERNAL_SERVER_ERROR, err);\r\n    }\r\n  }\r\n\r\n  public disconnectUserConnection = async (connectionId: string, reason: string): Promise<IUserConnection | null> => {\r\n    try {\r\n      logger.debug(`Disconnecting user connection: connectionId=${connectionId}`);\r\n      const connection = await this.findByIdAndUpdate(\r\n        connectionId,\r\n        {\r\n          connectionStatus: 'Disconnected',\r\n          disconnectedAt: new Date(),\r\n          disconnectionReason: reason,\r\n          updatedAt: new Date(),\r\n        },\r\n        { new: true }\r\n      );\r\n      if (!connection) {\r\n        logger.warn(`User connection not found: ${connectionId}`);\r\n        throw new RepositoryError(`User connection not found with ID: ${connectionId}`, StatusCodes.NOT_FOUND);\r\n      }\r\n      logger.info(`User connection disconnected: ${connectionId}`);\r\n      return connection;\r\n    } catch (error: unknown) {\r\n      const err = error instanceof Error ? error : new Error(String(error));\r\n      logger.error(`Error disconnecting user connection ${connectionId}`, err);\r\n      throw new RepositoryError('Error disconnecting user connection', StatusCodes.INTERNAL_SERVER_ERROR, err);\r\n    }\r\n  }\r\n\r\n  public getUserConnections = async (userId: string): Promise<IUserConnection[]> => {\r\n    try {\r\n      logger.debug(`Fetching connections for user: ${userId}`);\r\n      const connections = await this.model\r\n        .find({\r\n          $or: [{ requester: this.toObjectId(userId) }, { recipient: this.toObjectId(userId) }],\r\n          requestStatus: 'Accepted',\r\n        })\r\n        .populate('requester', '_id name email jobTitle profilePic')\r\n        .populate('recipient', '_id name email jobTitle profilePic')\r\n        .exec();\r\n      logger.info(`Fetched ${connections.length} connections for user ${userId}`);\r\n      return connections;\r\n    } catch (error: unknown) {\r\n      const err = error instanceof Error ? error : new Error(String(error));\r\n      logger.error(`Error fetching user connections for user ${userId}`, err);\r\n      throw new RepositoryError('Error fetching user connections', StatusCodes.INTERNAL_SERVER_ERROR, err);\r\n    }\r\n  }\r\n\r\n  public getAllUserConnections = async (\r\n  page: number = 1,\r\n  limit: number = 12,\r\n  search: string = ''\r\n): Promise<{ connections: IUserConnection[]; total: number; page: number; pages: number }> => {\r\n  try {\r\n    logger.debug(`getAllUserConnections â†’ page=${page}, limit=${limit}, search=\"${search}\"`);\r\n\r\n    const basePipeline = [\r\n      {\r\n        $lookup: {\r\n          from: 'users',\r\n          localField: 'requester',\r\n          foreignField: '_id',\r\n          as: 'requester',\r\n        },\r\n      },\r\n      { $unwind: { path: '$requester', preserveNullAndEmptyArrays: true } },\r\n\r\n      // Populate recipient\r\n      {\r\n        $lookup: {\r\n          from: 'users',\r\n          localField: 'recipient',\r\n          foreignField: '_id',\r\n          as: 'recipient',\r\n        },\r\n      },\r\n      { $unwind: { path: '$recipient', preserveNullAndEmptyArrays: true } },\r\n    ] as const;\r\n\r\n    const matchStage: any = { requestStatus: 'Accepted' };\r\n\r\n    if (search.trim()) {\r\n      const regex = { $regex: search.trim(), $options: 'i' };\r\n      matchStage.$or = [\r\n        { 'requester.name': regex },\r\n        { 'requester.email': regex },\r\n        { 'recipient.name': regex },\r\n        { 'recipient.email': regex },\r\n      ];\r\n    }\r\n\r\n    const dataPipeline = [\r\n      ...basePipeline,\r\n      { $match: matchStage },\r\n      { $sort: { requestSentAt: -1 } },\r\n      { $skip: (page - 1) * limit },\r\n      { $limit: limit },\r\n      {\r\n        $project: {\r\n          _id: 1,\r\n          connectionId: 1,\r\n          requester: 1,\r\n          recipient: 1,\r\n          requestStatus: 1,\r\n          connectionStatus: 1,\r\n          requestSentAt: 1,\r\n          requestAcceptedAt: 1,\r\n          disconnectedAt: 1,\r\n          disconnectionReason: 1,\r\n          createdAt: 1,\r\n          updatedAt: 1,\r\n        },\r\n      },\r\n    ] as PipelineStage[];\r\n\r\n    const connections = await this.model.aggregate<IUserConnection>(dataPipeline).exec();\r\n\r\n    const countPipeline = [\r\n      ...basePipeline,\r\n      { $match: matchStage },\r\n      { $count: 'total' },\r\n    ] as PipelineStage[];\r\n\r\n    const countResult = await this.model.aggregate(countPipeline).exec();\r\n    const total = countResult[0]?.total ?? 0;\r\n    const pages = Math.ceil(total / limit) || 1;\r\n\r\n    logger.info(`Fetched ${connections.length} connections | Total: ${total} | Pages: ${pages}`);\r\n\r\n    return {\r\n      connections,\r\n      total,\r\n      page,\r\n      pages,\r\n    };\r\n  } catch (error: unknown) {\r\n    const err = error instanceof Error ? error : new Error(String(error));\r\n    logger.error('Error in getAllUserConnections', err);\r\n    throw new RepositoryError(\r\n      'Error fetching user connections',\r\n      StatusCodes.INTERNAL_SERVER_ERROR,\r\n      err\r\n    );\r\n  }\r\n};\r\n\r\n  public getUserRequests = async (userId: string): Promise<{ sentRequests: IUserConnection[]; receivedRequests: IUserConnection[] }> => {\r\n    try {\r\n      logger.debug(`Fetching sent and received requests for user: ${userId}`);\r\n      const sentRequests = await this.model\r\n        .find({ requester: this.toObjectId(userId) })\r\n        .populate('recipient', '_id name email jobTitle profilePic')\r\n        .sort({ requestSentAt: -1 })\r\n        .exec();\r\n\r\n      const receivedRequests = await this.model\r\n        .find({ recipient: this.toObjectId(userId), requestStatus: 'Pending' })\r\n        .populate('requester', '_id name email jobTitle profilePic')\r\n        .sort({ requestSentAt: -1 })\r\n        .exec();\r\n\r\n      logger.info(`Fetched ${sentRequests.length} sent and ${receivedRequests.length} received requests for user ${userId}`);\r\n      return { sentRequests, receivedRequests };\r\n    } catch (error: unknown) {\r\n      const err = error instanceof Error ? error : new Error(String(error));\r\n      logger.error(`Error fetching user requests for user ${userId}`, err);\r\n      throw new RepositoryError('Error fetching user requests', StatusCodes.INTERNAL_SERVER_ERROR, err);\r\n    }\r\n  }\r\n\r\n  public getUserConnectionById = async (connectionId: string): Promise<IUserConnection | null> => {\r\n    try {\r\n      logger.debug(`Fetching user connection by ID: ${connectionId}`);\r\n      const connection = await this.model\r\n        .findById(this.toObjectId(connectionId))\r\n        .populate('requester', '_id name email jobTitle profilePic')\r\n        .populate('recipient', '_id name email jobTitle profilePic')\r\n        .exec();\r\n      if (!connection) {\r\n        logger.warn(`User connection not found: ${connectionId}`);\r\n        throw new RepositoryError(`User connection not found with ID: ${connectionId}`, StatusCodes.NOT_FOUND);\r\n      }\r\n      logger.info(`User connection fetched: ${connectionId}`);\r\n      return connection;\r\n    } catch (error: unknown) {\r\n      const err = error instanceof Error ? error : new Error(String(error));\r\n      logger.error(`Error fetching user connection by ID ${connectionId}`, err);\r\n      throw new RepositoryError('Error fetching user connection by ID', StatusCodes.INTERNAL_SERVER_ERROR, err);\r\n    }\r\n  }\r\n\r\n  public findExistingConnection = async (requesterId: string, recipientId: string): Promise<IUserConnection | null> => {\r\n    try {\r\n      logger.debug(`Checking for existing connection: requester=${requesterId}, recipient=${recipientId}`);\r\n      const connection = await this.model\r\n        .findOne({\r\n          requester: this.toObjectId(requesterId),\r\n          recipient: this.toObjectId(recipientId),\r\n          requestStatus: 'Pending',\r\n        })\r\n        .exec();\r\n      logger.info(\r\n        connection\r\n          ? `Found existing connection: ${connection._id}`\r\n          : `No existing connection found for requester ${requesterId}, recipient ${recipientId}`\r\n      );\r\n      return connection;\r\n    } catch (error: unknown) {\r\n      const err = error instanceof Error ? error : new Error(String(error));\r\n      logger.error(`Error checking existing connection for requester ${requesterId}, recipient ${recipientId}`, err);\r\n      throw new RepositoryError('Error checking existing connection', StatusCodes.INTERNAL_SERVER_ERROR, err);\r\n    }\r\n  }\r\n\r\n   public getConnectionUserIds = async (connectionId: string): Promise<{ requester: string; recipient: string } | null> => {\r\n      try {\r\n        logger.debug(`Fetching connection user IDs for connection: ${connectionId}`);\r\n        const connection = await  this.model.findById(this.toObjectId(connectionId))\r\n          .select(\"requester recipient\")\r\n          .exec();\r\n        if (!connection) {\r\n          logger.warn(`Connection not found: ${connectionId}`);\r\n          return null;\r\n        }\r\n        const result = {\r\n          requester: connection.requester.toString(),\r\n          recipient: connection.recipient.toString(),\r\n        };\r\n        logger.info(`Fetched user IDs for connection: ${connectionId}`);\r\n        return result;\r\n      } catch (error: unknown) {\r\n        const err = error instanceof Error ? error : new Error(String(error));\r\n        logger.error(`Error fetching connection user IDs for connection ${connectionId}`, err);\r\n        throw new RepositoryError('Error fetching connection user IDs', StatusCodes.INTERNAL_SERVER_ERROR, err);\r\n      }\r\n    }\r\n}"]}