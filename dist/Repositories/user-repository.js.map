{"version":3,"file":"user-repository.js","sourceRoot":"","sources":["../../src/Repositories/user-repository.ts"],"names":[],"mappings":"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","sourcesContent":["import { injectable } from \"inversify\";\r\nimport User from \"../Models/user-model\";\r\nimport { IUser } from '../Interfaces/Models/i-user';\r\nimport { BaseRepository } from \"../core/repositries/base-repositry\";\r\nimport { RepositoryError } from \"../core/utils/error-handler\";\r\nimport logger from \"../core/utils/logger\";\r\nimport { UserQuery } from \"../Utils/types/auth-types\";\r\nimport { Model, PipelineStage, Types } from \"mongoose\";\r\nimport { IUserRepository } from \"../Interfaces/Repository/i-user-repositry\";\r\nimport { StatusCodes } from \"../enums/status-code-enums\";\r\nimport { ClientSession } from \"mongoose\";\r\n\r\n@injectable()\r\nexport class UserRepository extends BaseRepository<IUser> implements IUserRepository{\r\n  constructor() {\r\n    super(User as Model<IUser>);\r\n  }\r\n\r\n  private toObjectId = (id?: string | Types.ObjectId): Types.ObjectId => {\r\n      if (!id) {\r\n        logger.warn('Missing ID when converting to ObjectId');\r\n        throw new RepositoryError('Invalid ID: ID is required', StatusCodes.BAD_REQUEST);\r\n      }\r\n      const idStr = typeof id === 'string' ? id : id.toString();\r\n      if (!Types.ObjectId.isValid(idStr)) {\r\n        logger.warn(`Invalid ObjectId format: ${idStr}`);\r\n        throw new RepositoryError('Invalid ID: must be a 24 character hex string', StatusCodes.BAD_REQUEST);\r\n      }\r\n      return new Types.ObjectId(idStr);\r\n    }\r\n\r\n  // Create a new user\r\n   public createUser=async(userData: Partial<IUser>): Promise<IUser> =>{\r\n    try {\r\n      return await this.create(userData);\r\n    } catch (error: unknown) {\r\n      const err = error instanceof Error ? error : new Error(String(error));\r\n      logger.error(`Error creating user ${userData.email}`, err);\r\n      throw new RepositoryError('Error creating user', StatusCodes.INTERNAL_SERVER_ERROR, err);\r\n    }\r\n  }\r\n\r\n  // Find a user by email\r\n   public findUserByEmail=async(email: string): Promise<IUser | null> =>{\r\n    try {\r\n      logger.debug(`Fetching user by email: ${email}`);\r\n      const user = await this.findOne({ email });\r\n      if (!user) {\r\n      logger.info(`No user found with email: ${email}`);\r\n      return null;\r\n    }\r\n      logger.info(`User fetched: ${user._id} (${email})`);\r\n      return user;\r\n    } catch (error: unknown) {\r\n      const err = error instanceof Error ? error : new Error(String(error));\r\n      logger.error(`Error fetching user by email ${email}`, err);\r\n      throw new RepositoryError('Error fetching user by email', StatusCodes.INTERNAL_SERVER_ERROR, err);\r\n    }\r\n  }\r\n\r\n  //Find a User By id\r\n   public getUserById=async(id?: string): Promise<IUser> =>{\r\n    if (!id) {\r\n      logger.warn('Missing ID for getUserById');\r\n      throw new RepositoryError('Invalid ID: ID is required', StatusCodes.BAD_REQUEST);\r\n    }\r\n    try {\r\n      const user = await this.findById(id);\r\n      if (!user) {\r\n        logger.warn(`User not found: ${id}`);\r\n        throw new RepositoryError(`User not found with ID: ${id}`, StatusCodes.NOT_FOUND);\r\n      }\r\n      logger.info(`User fetched: ${id} (${user.email})`);\r\n      return user;\r\n    } catch (error: unknown) {\r\n      const err = error instanceof Error ? error : new Error(String(error));\r\n      logger.error(`Error fetching user by ID ${id}`, err);\r\n      throw new RepositoryError('Error fetching user by ID', StatusCodes.INTERNAL_SERVER_ERROR, err);\r\n    }\r\n  }\r\n\r\n  // Find or create a user by OAuth profile\r\n   public findOrCreateUser=async(\r\n    profile: {\r\n      email: string;\r\n      displayName?: string;\r\n      id?: string;\r\n      photos?: { value: string }[];\r\n    },\r\n    provider: string\r\n  ): Promise<IUser> =>{\r\n    try {\r\n      const email = profile.email;\r\n      let user = await this.findUserByEmail(email);\r\n      if (!user) {\r\n        user = await this.create({\r\n          name: profile.displayName || \"Unknown\",\r\n          email,\r\n          provider,\r\n          providerId: profile.id,\r\n          profilePic: profile.photos?.[0]?.value || null,\r\n          role: \"user\",\r\n        });\r\n        logger.info(`Created OAuth user: ${email} via ${provider}`);\r\n      }\r\n      return user;\r\n    } catch (error: unknown) {\r\n      const err = error instanceof Error ? error : new Error(String(error));\r\n      logger.error(`Error in findOrCreateUser for ${profile.email}`, err);\r\n      throw new RepositoryError('Error finding or creating user', StatusCodes.INTERNAL_SERVER_ERROR, err);\r\n    }\r\n  }\r\n\r\n  // Update user password\r\n   public updatePassword=async(\r\n    id: string,\r\n    password: string\r\n  ): Promise<IUser | null> =>{\r\n    try {\r\n      logger.debug(`Updating password for user: ${id}`);\r\n      const user = await this.update(id, { password });\r\n      if (!user) {\r\n        logger.warn(`User not found: ${id}`);\r\n        throw new RepositoryError(`User not found with ID: ${id}`, StatusCodes.NOT_FOUND);\r\n      }\r\n      logger.info(`Password updated for user: ${id}`);\r\n      return user;\r\n    } catch (error: unknown) {\r\n      const err = error instanceof Error ? error : new Error(String(error));\r\n      logger.error(`Error updating password for user ${id}`, err);\r\n      throw new RepositoryError('Error updating password', StatusCodes.INTERNAL_SERVER_ERROR, err);\r\n    }\r\n  }\r\n\r\n  // Increment login count\r\n   public incrementLoginCount=async(userId: string): Promise<IUser | null> =>{\r\n    try {\r\n      logger.debug(`Incrementing login count for user: ${userId}`);\r\n      const user = await this.findByIdAndUpdate(userId, { $inc: { loginCount: 1 } }, { new: true });\r\n      if (!user) {\r\n        logger.warn(`User not found: ${userId}`);\r\n        throw new RepositoryError(`User not found with ID: ${userId}`, StatusCodes.NOT_FOUND);\r\n      }\r\n      logger.info(`Login count incremented for user: ${userId}`);\r\n      return user;\r\n    } catch (error: unknown) {\r\n      const err = error instanceof Error ? error : new Error(String(error));\r\n      logger.error(`Error incrementing login count for user ${userId}`, err);\r\n      throw new RepositoryError('Error incrementing login count', StatusCodes.INTERNAL_SERVER_ERROR, err);\r\n    }\r\n  }\r\n\r\n  // Update refresh token\r\n   public updateRefreshToken = async (userId: string, refreshToken: string): Promise<IUser | null> => {\r\n    try {\r\n      logger.debug(`Updating refresh token for user: ${userId}`);\r\n      const user = await this.update(userId, { refreshToken });\r\n      if (!user) {\r\n        logger.warn(`User not found: ${userId}`);\r\n        throw new RepositoryError(`User not found with ID: ${userId}`, StatusCodes.NOT_FOUND);\r\n      }\r\n      logger.info(`Refresh token updated for user: ${userId}`);\r\n      return user;\r\n    } catch (error: unknown) {\r\n      const err = error instanceof Error ? error : new Error(String(error));\r\n      logger.error(`Error updating refresh token for user ${userId}`, err);\r\n      throw new RepositoryError('Error updating refresh token', StatusCodes.INTERNAL_SERVER_ERROR, err);\r\n    }\r\n  }\r\n\r\n  // Remove refresh token\r\n   public removeRefreshToken = async (email: string): Promise<IUser | null> => {\r\n    try {\r\n      logger.debug(`Removing refresh token for user with email: ${email}`);\r\n      const user = await this.model.findOneAndUpdate({ email }, { $unset: { refreshToken: '' } }, { new: true });\r\n      if (!user) {\r\n        logger.warn(`User not found with email: ${email}`);\r\n        throw new RepositoryError(`User not found with email: ${email}`, StatusCodes.NOT_FOUND);\r\n      }\r\n      logger.info(`Refresh token removed for user: ${user._id} (${email})`);\r\n      return user;\r\n    } catch (error: unknown) {\r\n      const err = error instanceof Error ? error : new Error(String(error));\r\n      logger.error(`Error removing refresh token for email ${email}`, err);\r\n      throw new RepositoryError('Error removing refresh token', StatusCodes.INTERNAL_SERVER_ERROR, err);\r\n    }\r\n  }\r\n\r\n  // Check if profile is complete\r\n   public isProfileComplete = async (user: IUser): Promise<boolean> => {\r\n    try {\r\n      logger.debug(`Checking profile completion for user: ${user._id}`);\r\n      const requiredFields: (keyof IUser)[] = [\r\n        'phone',\r\n        'dateOfBirth',\r\n        'jobTitle',\r\n        'industry',\r\n        'reasonForJoining',\r\n      ];\r\n      for (const field of requiredFields) {\r\n        if (!user[field]) {\r\n          logger.info(`Profile incomplete for user: ${user._id} (${user.email}) - missing ${field}`);\r\n          return false;\r\n        }\r\n      }\r\n      logger.info(`Profile complete for user: ${user._id} (${user.email})`);\r\n      return true;\r\n    } catch (error: unknown) {\r\n      const err = error instanceof Error ? error : new Error(String(error));\r\n      logger.error(`Error checking profile completion for user ${user._id}`, err);\r\n      throw new RepositoryError('Error checking profile completion', StatusCodes.INTERNAL_SERVER_ERROR, err);\r\n    }\r\n  }\r\n\r\n\r\n  public getAllAdmins = async (): Promise<IUser[]> => {\r\n    try {\r\n      logger.debug(`Fetching all admin users`);\r\n      const users = await this.model.find({ role: 'admin' }).exec();\r\n      logger.info(`Fetched ${users.length} admin users`);\r\n      return users;\r\n    } catch (error: unknown) {\r\n      const err = error instanceof Error ? error : new Error(String(error));\r\n      logger.error(`Error fetching admin users`, err);\r\n      throw new RepositoryError('Error fetching admin users', StatusCodes.INTERNAL_SERVER_ERROR, err);\r\n    }\r\n  }\r\n\r\n    public fetchAllUsers = async (): Promise<IUser[]> => {\r\n    try {\r\n      logger.debug(`Fetching all users`);\r\n      const users = await this.model.find({ role: { $ne: 'admin' } }).exec();\r\n      logger.info(`Fetched ${users.length} users`);\r\n      return users;\r\n    } catch (error: unknown) {\r\n      const err = error instanceof Error ? error : new Error(String(error));\r\n      logger.error(`Error fetching users`, err);\r\n      throw new RepositoryError('Error fetching users', StatusCodes.INTERNAL_SERVER_ERROR, err);\r\n    }\r\n  }\r\n\r\n  //Fetch All User Details\r\n   public getAllUsers = async (\r\n  query: UserQuery = {}\r\n): Promise<{ users: IUser[]; total: number }> => {\r\n  try {\r\n    const { search, page = 1, limit = 10, excludeId, status } = query;\r\n\r\n    logger.debug(`Fetching users â†’ ${JSON.stringify({ search, page, limit, excludeId })}`);\r\n\r\n    const matchStage: Record<string, any> = {\r\n      role: 'user',\r\n    };\r\n\r\n    if (excludeId) {\r\n      try {\r\n        matchStage._id = { $ne: this.toObjectId(excludeId) };\r\n      } catch (err) {\r\n        logger.warn(`Invalid excludeId: ${excludeId} error ${err}`);\r\n      }\r\n    }\r\n\r\n    if (status === 'active') {\r\n      matchStage.isBlocked = false;\r\n    } else if (status === 'blocked') {\r\n      matchStage.isBlocked = true;\r\n    }\r\n\r\n    if (search?.trim()) {\r\n      const regex = { $regex: search.trim(), $options: 'i' };\r\n      matchStage.$or = [\r\n        { name: regex },\r\n        { email: regex },\r\n        { jobTitle: { $regex: `^${search.trim()}`, $options: 'i' } },\r\n        { industry: { $regex: `^${search.trim()}`, $options: 'i' } },\r\n        { reasonForJoining: { $regex: `^${search.trim()}`, $options: 'i' } },\r\n      ];\r\n    }\r\n\r\n    const pipeline: PipelineStage[] = [\r\n      { $match: matchStage },\r\n      {\r\n        $facet: {\r\n          users: [\r\n            { $skip: (page - 1) * limit },\r\n            { $limit: limit },\r\n          ],\r\n          total: [{ $count: 'count' }],\r\n        },\r\n      },\r\n    ];\r\n\r\n    const [result] = await this.model.aggregate(pipeline).exec();\r\n\r\n    const users: IUser[] = result?.users ?? [];\r\n    const total: number = result?.total?.[0]?.count ?? 0;\r\n\r\n    logger.info(`Fetched ${users.length} users (total: ${total})`);\r\n    return { users, total };\r\n  } catch (error: unknown) {\r\n    const err = error instanceof Error ? error : new Error(String(error));\r\n    logger.error('Error in getAllUsers', err);\r\n    throw new RepositoryError(\r\n      'Error fetching users',\r\n      StatusCodes.INTERNAL_SERVER_ERROR,\r\n      err\r\n    );\r\n  }\r\n};\r\n\r\n  //Update The User Profile\r\n   public updateUserProfile = async (id: string, data: Partial<IUser>): Promise<IUser | null> => {\r\n    try {\r\n      logger.debug(`Updating user profile for ID: ${id}`);\r\n      const user = await this.findByIdAndUpdate(id, data, { new: true });\r\n      if (!user) {\r\n        logger.warn(`User not found: ${id}`);\r\n        throw new RepositoryError(`User not found with ID: ${id}`, StatusCodes.NOT_FOUND);\r\n      }\r\n      logger.info(`User profile updated: ${id} (${user.email})`);\r\n      return user;\r\n    } catch (error: unknown) {\r\n      const err = error instanceof Error ? error : new Error(String(error));\r\n      logger.error(`Error updating user profile for ID ${id}`, err);\r\n      throw new RepositoryError('Error updating user profile', StatusCodes.INTERNAL_SERVER_ERROR, err);\r\n    }\r\n  }\r\n\r\n  //Block the given User\r\n   public blockUser = async (id: string): Promise<IUser | null> => {\r\n    try {\r\n      logger.debug(`Blocking user: ${id}`);\r\n      const user = await this.findByIdAndUpdate(id, { isBlocked: true }, { new: true });\r\n      if (!user) {\r\n        logger.warn(`User not found: ${id}`);\r\n        throw new RepositoryError(`User not found with ID: ${id}`, StatusCodes.NOT_FOUND);\r\n      }\r\n      logger.info(`User blocked: ${id} (${user.email})`);\r\n      return user;\r\n    } catch (error: unknown) {\r\n      const err = error instanceof Error ? error : new Error(String(error));\r\n      logger.error(`Error blocking user ${id}`, err);\r\n      throw new RepositoryError('Error blocking user', StatusCodes.INTERNAL_SERVER_ERROR, err);\r\n    }\r\n  }\r\n\r\n  //Unblock the given user\r\n   public unblockUser = async (id: string): Promise<IUser | null> => {\r\n    try {\r\n      logger.debug(`Unblocking user: ${id}`);\r\n      const user = await this.findByIdAndUpdate(id, { isBlocked: false }, { new: true });\r\n      if (!user) {\r\n        logger.warn(`User not found: ${id}`);\r\n        throw new RepositoryError(`User not found with ID: ${id}`, StatusCodes.NOT_FOUND);\r\n      }\r\n      logger.info(`User unblocked: ${id} (${user.email})`);\r\n      return user;\r\n    } catch (error: unknown) {\r\n      const err = error instanceof Error ? error : new Error(String(error));\r\n      logger.error(`Error unblocking user ${id}`, err);\r\n      throw new RepositoryError('Error unblocking user', StatusCodes.INTERNAL_SERVER_ERROR, err);\r\n    }\r\n  }\r\n\r\n  //Update The user Role\r\n   public updateUserRole = async (userId: string, role: string, options?: { session?: ClientSession }): Promise<IUser | null> => {\r\n    try {\r\n      logger.debug(`Updating role for user: ${userId} to ${role}`);\r\n      const user = await this.findByIdAndUpdate(userId, { role }, { new: true }, options?.session);\r\n      if (!user) {\r\n        logger.warn(`User not found: ${userId}`);\r\n        throw new RepositoryError(`User not found with ID: ${userId}`, StatusCodes.NOT_FOUND);\r\n      }\r\n      logger.info(`User role updated: ${userId} to ${role}`);\r\n      return user;\r\n    } catch (error: unknown) {\r\n      const err = error instanceof Error ? error : new Error(String(error));\r\n      logger.error(`Error updating role for user ${userId}`, err);\r\n      throw new RepositoryError('Error updating user role', StatusCodes.INTERNAL_SERVER_ERROR, err);\r\n    }\r\n  }\r\n}\r\n"]}