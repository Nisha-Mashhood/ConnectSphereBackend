{"version":3,"file":"chat-message-mapper.js","sourceRoot":"","sources":["../../../src/Utils/mappers/chat-message-mapper.ts"],"names":[],"mappings":"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","sourcesContent":["import { IChatMessage } from '../../Interfaces/Models/i-chat-message';\r\nimport { IChatMessageDTO } from '../../Interfaces/DTOs/i-chat-message-dto';\r\nimport { toUserDTO } from './user-mapper';\r\nimport { toCollaborationDTO } from './collaboration-mapper';\r\nimport { toUserConnectionDTO } from './user-connection-mapper';\r\nimport { toGroupDTO } from './group-mapper';\r\nimport { IUser } from '../../Interfaces/Models/i-user';\r\nimport { ICollaboration } from '../../Interfaces/Models/i-collaboration';\r\nimport { IUserConnection } from '../../Interfaces/Models/i-user-connection';\r\nimport { IGroup } from '../../Interfaces/Models/i-group';\r\nimport logger from '../../core/utils/logger';\r\nimport { Types } from 'mongoose';\r\nimport { IUserDTO } from '../../Interfaces/DTOs/i-user-dto';\r\nimport { ICollaborationDTO } from '../../Interfaces/DTOs/i-collaboration-dto';\r\nimport { IUserConnectionDTO } from '../../Interfaces/DTOs/i-user-connection-dto';\r\nimport { IGroupDTO } from '../../Interfaces/DTOs/i-group-dto';\r\n\r\nexport function toChatMessageDTO(chatMessage: IChatMessage | null): IChatMessageDTO | null {\r\n  if (!chatMessage) {\r\n    logger.warn('Attempted to map null chat message to DTO');\r\n    return null;\r\n  }\r\n\r\n  //senderId (populated IUser or just an ID)\r\n  let senderId: string;\r\n  let sender: IUserDTO | undefined;\r\n\r\n  if (chatMessage.senderId) {\r\n    if (typeof chatMessage.senderId === 'string') {\r\n      senderId = chatMessage.senderId;\r\n    } else if (chatMessage.senderId instanceof Types.ObjectId) {\r\n      senderId = chatMessage.senderId.toString();\r\n    } else {\r\n      //IUser object (populated)\r\n      senderId = (chatMessage.senderId as IUser)._id.toString();\r\n      const userDTO = toUserDTO(chatMessage.senderId as IUser);\r\n      sender = userDTO ?? undefined;\r\n    }\r\n  } else {\r\n    logger.warn(`Chat message ${chatMessage._id} has no senderId`);\r\n    senderId = '';\r\n  }\r\n\r\n  //collaborationId (populated ICollaboration or just an ID)\r\n  let collaborationId: string | undefined;\r\n  let collaboration: ICollaborationDTO | undefined;\r\n\r\n  if (chatMessage.collaborationId) {\r\n    if (typeof chatMessage.collaborationId === 'string') {\r\n      collaborationId = chatMessage.collaborationId;\r\n    } else if (chatMessage.collaborationId instanceof Types.ObjectId) {\r\n      collaborationId = chatMessage.collaborationId.toString();\r\n    } else {\r\n      //ICollaboration object (populated)\r\n      collaborationId = (chatMessage.collaborationId as ICollaboration)._id.toString();\r\n      const collaborationDTO = toCollaborationDTO(chatMessage.collaborationId as ICollaboration);\r\n      collaboration = collaborationDTO ?? undefined;\r\n    }\r\n  }\r\n\r\n  //userConnectionId (populated IUserConnection or just an ID)\r\n  let userConnectionId: string | undefined;\r\n  let userConnection: IUserConnectionDTO | undefined;\r\n\r\n  if (chatMessage.userConnectionId) {\r\n    if (typeof chatMessage.userConnectionId === 'string') {\r\n      userConnectionId = chatMessage.userConnectionId;\r\n    } else if (chatMessage.userConnectionId instanceof Types.ObjectId) {\r\n      userConnectionId = chatMessage.userConnectionId.toString();\r\n    } else {\r\n      //IUserConnection object (populated)\r\n      userConnectionId = (chatMessage.userConnectionId as IUserConnection)._id.toString();\r\n      const userConnectionDTO = toUserConnectionDTO(chatMessage.userConnectionId as IUserConnection);\r\n      userConnection = userConnectionDTO ?? undefined;\r\n    }\r\n  }\r\n\r\n  //groupId (populated IGroup or just an ID)\r\n  let groupId: string | undefined;\r\n  let group: IGroupDTO | undefined;\r\n\r\n  if (chatMessage.groupId) {\r\n    if (typeof chatMessage.groupId === 'string') {\r\n      groupId = chatMessage.groupId;\r\n    } else if (chatMessage.groupId instanceof Types.ObjectId) {\r\n      groupId = chatMessage.groupId.toString();\r\n    } else {\r\n      //IGroup object (populated)\r\n      groupId = (chatMessage.groupId as IGroup)._id.toString();\r\n      const groupDTO = toGroupDTO(chatMessage.groupId as IGroup);\r\n      group = groupDTO ?? undefined;\r\n    }\r\n  }\r\n\r\n  return {\r\n    id: chatMessage._id.toString(),\r\n    ChatId: chatMessage.ChatId,\r\n    senderId,\r\n    sender,\r\n    content: chatMessage.content,\r\n    thumbnailUrl: chatMessage.thumbnailUrl,\r\n    collaborationId,\r\n    collaboration,\r\n    userConnectionId,\r\n    userConnection,\r\n    groupId,\r\n    group,\r\n    contentType: chatMessage.contentType,\r\n    fileMetadata: chatMessage.fileMetadata,\r\n    isRead: chatMessage.isRead,\r\n    status: chatMessage.status,\r\n    timestamp: chatMessage.timestamp,\r\n  };\r\n}\r\n\r\nexport function toChatMessageDTOs(chatMessages: IChatMessage[]): IChatMessageDTO[] {\r\n  return chatMessages\r\n    .map(toChatMessageDTO)\r\n    .filter((dto): dto is IChatMessageDTO => dto !== null);\r\n}"]}