{"version":3,"file":"collaboration-mapper.js","sourceRoot":"","sources":["../../../src/Utils/mappers/collaboration-mapper.ts"],"names":[],"mappings":"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","sourcesContent":["import { ICollaboration } from '../../Interfaces/Models/i-collaboration';\r\nimport { ICollaborationDTO, SelectedSlotDTO, UnavailableDayDTO, TemporarySlotChangeDTO } from '../../Interfaces/DTOs/i-collaboration-dto';\r\nimport { toUserDTO } from './user-mapper';\r\nimport { toMentorDTO } from './mentor-mapper';\r\nimport { IMentor } from '../../Interfaces/Models/i-mentor';\r\nimport { IUser } from '../../Interfaces/Models/i-user';\r\nimport logger from '../../core/utils/logger';\r\nimport { Types } from 'mongoose';\r\nimport { IUserDTO } from '../../Interfaces/DTOs/i-user-dto';\r\nimport { IMentorDTO } from '../../Interfaces/DTOs/i-mentor-dto';\r\n\r\nfunction toSelectedSlotDTO(slot: { day: string; timeSlots: string[] }): SelectedSlotDTO {\r\n  return {\r\n    day: slot.day as SelectedSlotDTO['day'],\r\n    timeSlots: slot.timeSlots,\r\n  };\r\n}\r\n\r\nfunction toUnavailableDayDTO(day: {\r\n  _id: Types.ObjectId;\r\n  datesAndReasons: { date: Date; reason: string }[];\r\n  requestedBy: \"user\" | \"mentor\";\r\n  requesterId: Types.ObjectId;\r\n  isApproved: \"pending\" | \"approved\" | \"rejected\";\r\n  approvedById: Types.ObjectId;\r\n}): UnavailableDayDTO {\r\n  return {\r\n    id: day._id.toString(),\r\n    datesAndReasons: day.datesAndReasons,\r\n    requestedBy: day.requestedBy,\r\n    requesterId: day.requesterId.toString(),\r\n    isApproved: day.isApproved,\r\n    approvedById: day.approvedById.toString(),\r\n  };\r\n}\r\n\r\nfunction toTemporarySlotChangeDTO(change: {\r\n  _id: Types.ObjectId;\r\n  datesAndNewSlots: { date: Date; newTimeSlots: string[] }[];\r\n  requestedBy: \"user\" | \"mentor\";\r\n  requesterId: Types.ObjectId;\r\n  isApproved: \"pending\" | \"approved\" | \"rejected\";\r\n  approvedById: Types.ObjectId;\r\n}): TemporarySlotChangeDTO {\r\n  return {\r\n    id: change._id.toString(),\r\n    datesAndNewSlots: change.datesAndNewSlots,\r\n    requestedBy: change.requestedBy,\r\n    requesterId: change.requesterId.toString(),\r\n    isApproved: change.isApproved,\r\n    approvedById: change.approvedById.toString(),\r\n  };\r\n}\r\n\r\nexport function toCollaborationDTO(collaboration: ICollaboration | null): ICollaborationDTO | null {\r\n  if (!collaboration) {\r\n    logger.warn('Attempted to map null collaboration to DTO');\r\n    return null;\r\n  }\r\n\r\n  //mentorId\r\n  let mentorId: string;\r\n  let mentor: IMentorDTO | undefined;\r\n\r\n  if (collaboration.mentorId) {\r\n    if (typeof collaboration.mentorId === 'string') {\r\n      mentorId = collaboration.mentorId;\r\n    } else if (collaboration.mentorId instanceof Types.ObjectId) {\r\n      mentorId = collaboration.mentorId.toString();\r\n    } else {\r\n      // IMentor object (populated)\r\n      mentorId = (collaboration.mentorId as IMentor)._id.toString();\r\n      const mentorDTO = toMentorDTO(collaboration.mentorId as IMentor);\r\n      mentor = mentorDTO ?? undefined;\r\n    }\r\n  } else {\r\n    logger.warn(`Collaboration ${collaboration._id} has no mentorId`);\r\n    mentorId = '';\r\n  }\r\n\r\n  // HuserId\r\n  let userId: string;\r\n  let user: IUserDTO | undefined;\r\n\r\n  if (collaboration.userId) {\r\n    if (typeof collaboration.userId === 'string') {\r\n      userId = collaboration.userId;\r\n    } else if (collaboration.userId instanceof Types.ObjectId) {\r\n      userId = collaboration.userId.toString();\r\n    } else {\r\n      // IUser object (populated)\r\n      userId = (collaboration.userId as IUser)._id.toString();\r\n      const userDTO = toUserDTO(collaboration.userId as IUser);\r\n      user = userDTO ?? undefined;\r\n    }\r\n  } else {\r\n    logger.warn(`Collaboration ${collaboration._id} has no userId`);\r\n    userId = '';\r\n  }\r\n\r\n  return {\r\n    id: collaboration._id.toString(),\r\n    collaborationId: collaboration.collaborationId,\r\n    mentorId,\r\n    mentor,\r\n    userId,\r\n    user,\r\n    selectedSlot: collaboration.selectedSlot.map(toSelectedSlotDTO),\r\n    unavailableDays: collaboration.unavailableDays.map(toUnavailableDayDTO),\r\n    temporarySlotChanges: collaboration.temporarySlotChanges.map(toTemporarySlotChangeDTO),\r\n    price: collaboration.price,\r\n    payment: collaboration.payment,\r\n    paymentIntentId: collaboration.paymentIntentId,\r\n    isCancelled: collaboration.isCancelled,\r\n    isCompleted: collaboration.isCompleted,\r\n    startDate: collaboration.startDate,\r\n    endDate: collaboration.endDate,\r\n    feedbackGiven: collaboration.feedbackGiven,\r\n    createdAt: collaboration.createdAt,\r\n  };\r\n}\r\n\r\nexport function toCollaborationDTOs(collaborations: ICollaboration[]): ICollaborationDTO[] {\r\n  return collaborations\r\n    .map(toCollaborationDTO)\r\n    .filter((dto): dto is ICollaborationDTO => dto !== null);\r\n}"]}