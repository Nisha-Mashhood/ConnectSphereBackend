{"version":3,"file":"feedback-mapper.js","sourceRoot":"","sources":["../../../src/Utils/mappers/feedback-mapper.ts"],"names":[],"mappings":"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","sourcesContent":["import { IFeedback } from '../../Interfaces/Models/i-feedback';\r\nimport { toUserDTO } from './user-mapper';\r\nimport { toMentorDTO } from './mentor-mapper';\r\nimport { toCollaborationDTO } from './collaboration-mapper';\r\nimport { IUser } from '../../Interfaces/Models/i-user';\r\nimport { IMentor } from '../../Interfaces/Models/i-mentor';\r\nimport { ICollaboration } from '../../Interfaces/Models/i-collaboration';\r\nimport logger from '../../core/utils/logger';\r\nimport { Types } from 'mongoose';\r\nimport { IUserDTO } from '../../Interfaces/DTOs/i-user-dto';\r\nimport { IMentorDTO } from '../../Interfaces/DTOs/i-mentor-dto';\r\nimport { ICollaborationDTO } from '../../Interfaces/DTOs/i-collaboration-dto';\r\nimport { IFeedbackDTO } from '../../Interfaces/DTOs/i-feedback-dto';\r\n\r\nexport function toFeedbackDTO(feedback: IFeedback | null): IFeedbackDTO | null {\r\n  if (!feedback) {\r\n    logger.warn('Attempted to map null feedback to DTO');\r\n    return null;\r\n  }\r\n\r\n  //userId (populated IUser or just an ID)\r\n  let userId: string;\r\n  let user: IUserDTO | undefined;\r\n\r\n  if (feedback.userId) {\r\n    if (typeof feedback.userId === 'string') {\r\n      userId = feedback.userId;\r\n    } else if (feedback.userId instanceof Types.ObjectId) {\r\n      userId = feedback.userId.toString();\r\n    } else {\r\n      //IUser object (populated)\r\n      userId = (feedback.userId as IUser)._id.toString();\r\n      const userDTO = toUserDTO(feedback.userId as IUser);\r\n      user = userDTO ?? undefined;\r\n    }\r\n  } else {\r\n    logger.warn(`Feedback ${feedback._id} has no userId`);\r\n    userId = '';\r\n  }\r\n\r\n  //mentorId (populated IMentor or just an ID)\r\n  let mentorId: string;\r\n  let mentor: IMentorDTO | undefined;\r\n\r\n  if (feedback.mentorId) {\r\n    if (typeof feedback.mentorId === 'string') {\r\n      mentorId = feedback.mentorId;\r\n    } else if (feedback.mentorId instanceof Types.ObjectId) {\r\n      mentorId = feedback.mentorId.toString();\r\n    } else {\r\n      //IMentor object (populated)\r\n      mentorId = (feedback.mentorId as IMentor)._id.toString();\r\n      const mentorDTO = toMentorDTO(feedback.mentorId as IMentor);\r\n      mentor = mentorDTO ?? undefined;\r\n    }\r\n  } else {\r\n    logger.warn(`Feedback ${feedback._id} has no mentorId`);\r\n    mentorId = '';\r\n  }\r\n\r\n  //collaborationId (populated ICollaboration or just an ID)\r\n  let collaborationId: string;\r\n  let collaboration: ICollaborationDTO | undefined;\r\n\r\n  if (feedback.collaborationId) {\r\n    if (typeof feedback.collaborationId === 'string') {\r\n      collaborationId = feedback.collaborationId;\r\n    } else if (feedback.collaborationId instanceof Types.ObjectId) {\r\n      collaborationId = feedback.collaborationId.toString();\r\n    } else {\r\n      //ICollaboration object (populated)\r\n      collaborationId = (feedback.collaborationId as ICollaboration)._id.toString();\r\n      const collaborationDTO = toCollaborationDTO(feedback.collaborationId as ICollaboration);\r\n      collaboration = collaborationDTO ?? undefined;\r\n    }\r\n  } else {\r\n    logger.warn(`Feedback ${feedback._id} has no collaborationId`);\r\n    collaborationId = '';\r\n  }\r\n\r\n  return {\r\n    id: feedback._id.toString(),\r\n    feedbackId: feedback.feedbackId,\r\n    userId,\r\n    user,\r\n    mentorId,\r\n    mentor,\r\n    collaborationId,\r\n    collaboration,\r\n    givenBy: feedback.givenBy,\r\n    rating: feedback.rating,\r\n    communication: feedback.communication,\r\n    expertise: feedback.expertise,\r\n    punctuality: feedback.punctuality,\r\n    comments: feedback.comments,\r\n    wouldRecommend: feedback.wouldRecommend,\r\n    isHidden: feedback.isHidden,\r\n    createdAt: feedback.createdAt,\r\n  };\r\n}\r\n\r\nexport function toFeedbackDTOs(feedbacks: IFeedback[]): IFeedbackDTO[] {\r\n  return feedbacks\r\n    .map(toFeedbackDTO)\r\n    .filter((dto): dto is IFeedbackDTO => dto !== null);\r\n}"]}