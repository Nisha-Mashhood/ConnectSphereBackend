{"version":3,"file":"group-mapper.js","sourceRoot":"","sources":["../../../src/Utils/mappers/group-mapper.ts"],"names":[],"mappings":"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","sourcesContent":["import { IGroup, TimeSlot } from '../../Interfaces/Models/i-group';\r\nimport { IGroupDTO, TimeSlotDTO } from '../../Interfaces/DTOs/i-group-dto';\r\nimport { IUserDTO } from '../../Interfaces/DTOs/i-user-dto';\r\nimport { IUser } from '../../Interfaces/Models/i-user';\r\nimport logger from '../../core/utils/logger';\r\nimport { Types } from 'mongoose';\r\nimport { toUserDTO } from './user-mapper';\r\n\r\nfunction toTimeSlotDTO(slot: TimeSlot): TimeSlotDTO {\r\n  return {\r\n    day: slot.day,\r\n    timeSlots: slot.timeSlots,\r\n  };\r\n}\r\n\r\nexport function toGroupDTO(group: IGroup | null): IGroupDTO | null {\r\n  if (!group) {\r\n    logger.warn('Attempted to map null group to DTO');\r\n    return null;\r\n  }\r\n\r\n  // logger.debug(`Mapping group ${group._id}: ${JSON.stringify(group, null, 2)}`);\r\n\r\n  // Handle adminId\r\n  let adminId: string;\r\n  let admin: IUserDTO | undefined;\r\n\r\n  if (group.adminId) {\r\n    if (typeof group.adminId === 'string') {\r\n      adminId = group.adminId;\r\n    } else if (group.adminId instanceof Types.ObjectId) {\r\n      adminId = group.adminId.toString();\r\n    } else {\r\n      // Assume it's an IUser object (populated)\r\n      adminId = (group.adminId as IUser)._id?.toString() || '';\r\n      const adminDTO = toUserDTO(group.adminId as IUser);\r\n      admin = adminDTO ?? undefined;\r\n    }\r\n  } else {\r\n    logger.warn(`Group ${group._id} has no adminId`);\r\n    adminId = '';\r\n  }\r\n\r\n  const members: { userId: string; joinedAt: Date }[] = [];\r\n  const membersDetails: { user: IUserDTO; joinedAt: Date }[] = [];\r\n\r\n  if (Array.isArray(group.members) && group.members.length > 0) {\r\n    group.members.forEach((member) => {\r\n      // logger.debug(`Processing member for group ${group._id}: ${JSON.stringify(member, null, 2)}`);\r\n      let memberUserId: string;\r\n      let memberUser: IUserDTO | undefined;\r\n\r\n      if (member.userId) {\r\n        if (typeof member.userId === 'string') {\r\n          memberUserId = member.userId;\r\n        } else if (member.userId instanceof Types.ObjectId) {\r\n          memberUserId = member.userId.toString();\r\n        } else {\r\n          // Assume it's an IUser object (populated)\r\n          memberUserId = (member.userId as IUser)._id?.toString() || '';\r\n          const memberUserDTO = toUserDTO(member.userId as IUser);\r\n          memberUser = memberUserDTO ?? undefined;\r\n        }\r\n      } else {\r\n        logger.warn(`Group ${group._id} has member with no userId`);\r\n        memberUserId = '';\r\n      }\r\n\r\n      members.push({ userId: memberUserId, joinedAt: member.joinedAt || new Date() });\r\n      if (memberUser) {\r\n        membersDetails.push({ user: memberUser, joinedAt: member.joinedAt || new Date() });\r\n      }\r\n    });\r\n  } else {\r\n    logger.info(`Group ${group._id} has no members or members is not an array`);\r\n  }\r\n\r\n  return {\r\n    id: group._id.toString(),\r\n    groupId: group.groupId,\r\n    name: group.name,\r\n    bio: group.bio,\r\n    price: group.price,\r\n    maxMembers: group.maxMembers,\r\n    isFull: group.isFull,\r\n    availableSlots: group.availableSlots.map(toTimeSlotDTO),\r\n    profilePic: group.profilePic,\r\n    coverPic: group.coverPic,\r\n    startDate: group.startDate,\r\n    adminId,\r\n    admin,\r\n    members,\r\n    membersDetails,\r\n    createdAt: group.createdAt,\r\n  };\r\n}\r\n\r\nexport function toGroupDTOs(groups: IGroup[]): IGroupDTO[] {\r\n  return groups\r\n    .map(toGroupDTO)\r\n    .filter((dto): dto is IGroupDTO => dto !== null);\r\n}"]}