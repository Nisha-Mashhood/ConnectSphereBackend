{"version":3,"file":"mentor-mapper.js","sourceRoot":"","sources":["../../../src/Utils/mappers/mentor-mapper.ts"],"names":[],"mappings":";;;;;AAaA,kCAmGC;AAED,oCAcC;AAhID,uCAAiC;AAGjC,+CAA0C;AAC1C,iDAA6C;AAG7C,qEAA6C;AAM7C,SAAgB,WAAW,CAAC,MAAsB;IAChD,IAAI,CAAC,MAAM,EAAE,CAAC;QACZ,gBAAM,CAAC,IAAI,CAAC,qCAAqC,CAAC,CAAC;QACnD,OAAO,IAAI,CAAC;IACd,CAAC;IAED,aAAa;IACb,IAAI,CAAC,MAAM,CAAC,GAAG,EAAE,CAAC;QAChB,gBAAM,CAAC,KAAK,CAAC,sBAAsB,IAAI,CAAC,SAAS,CAAC,MAAM,CAAC,EAAE,CAAC,CAAC;QAC7D,OAAO,IAAI,CAAC;IACd,CAAC;IACD,MAAM,EAAE,GAAG,MAAM,CAAC,GAAG,CAAC,QAAQ,EAAE,CAAC;IACjC,gBAAM,CAAC,KAAK,CAAC,cAAc,EAAE,EAAE,CAAC,CAAC;IAEjC,gBAAgB;IAChB,IAAI,MAAM,GAAW,EAAE,CAAC;IACxB,IAAI,IAA0B,CAAC;IAE/B,IAAI,CAAC,MAAM,CAAC,MAAM,EAAE,CAAC;QACnB,gBAAM,CAAC,IAAI,CAAC,UAAU,EAAE,gBAAgB,CAAC,CAAC;IAC5C,CAAC;SAAM,IAAI,OAAO,MAAM,CAAC,MAAM,KAAK,QAAQ,EAAE,CAAC;QAC7C,MAAM,GAAG,MAAM,CAAC,MAAM,CAAC;QACvB,gBAAM,CAAC,KAAK,CAAC,UAAU,EAAE,sBAAsB,MAAM,EAAE,CAAC,CAAC;IAC3D,CAAC;SAAM,IAAI,MAAM,CAAC,MAAM,YAAY,gBAAK,CAAC,QAAQ,EAAE,CAAC;QACnD,MAAM,GAAG,MAAM,CAAC,MAAM,CAAC,QAAQ,EAAE,CAAC;QAClC,gBAAM,CAAC,KAAK,CAAC,UAAU,EAAE,wBAAwB,MAAM,EAAE,CAAC,CAAC;IAC7D,CAAC;SAAM,IAAI,OAAO,MAAM,CAAC,MAAM,KAAK,QAAQ,IAAI,KAAK,IAAI,MAAM,CAAC,MAAM,EAAE,CAAC;QACvE,yBAAyB;QACzB,MAAM,GAAI,MAAM,CAAC,MAAgB,CAAC,GAAG,CAAC,QAAQ,EAAE,CAAC;QACjD,gBAAM,CAAC,KAAK,CAAC,UAAU,EAAE,8BAA8B,MAAM,EAAE,CAAC,CAAC;QACjE,MAAM,OAAO,GAAG,IAAA,uBAAS,EAAC,MAAM,CAAC,MAAe,CAAC,CAAC;QAClD,IAAI,CAAC,OAAO,EAAE,CAAC;YACb,gBAAM,CAAC,IAAI,CAAC,4CAA4C,EAAE,EAAE,CAAC,CAAC;QAChE,CAAC;aAAM,CAAC;YACN,IAAI,GAAG,OAAO,CAAC;QACjB,CAAC;IACH,CAAC;SAAM,CAAC;QACN,gBAAM,CAAC,KAAK,CAAC,oCAAoC,EAAE,KAAK,IAAI,CAAC,SAAS,CAAC,MAAM,CAAC,MAAM,CAAC,EAAE,CAAC,CAAC;IAC3F,CAAC;IAED,gBAAgB;IAClB,IAAI,MAAM,GAAa,EAAE,CAAC;IAC1B,IAAI,aAAa,GAAgB,EAAE,CAAC;IAEpC,IAAI,CAAC,MAAM,CAAC,MAAM,EAAE,CAAC;QACnB,gBAAM,CAAC,IAAI,CAAC,UAAU,EAAE,gBAAgB,CAAC,CAAC;IAC5C,CAAC;SAAM,IACL,MAAM,CAAC,MAAM,CAAC,KAAK,CACjB,CAAC,KAAgB,EAAE,EAAE,CACnB,OAAO,KAAK,KAAK,QAAQ,IAAI,KAAK,YAAY,gBAAK,CAAC,QAAQ,CAC/D,EACD,CAAC;QACD,sDAAsD;QACtD,MAAM,GAAG,MAAM,CAAC,MAAM,EAAE,GAAG,CAAC,CAAC,CAAC,EAAE,EAAE,CAChC,OAAO,CAAC,KAAK,QAAQ,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,QAAQ,EAAE,CACzC,CAAC;QACF,gBAAM,CAAC,KAAK,CACV,UAAU,EAAE,oCAAoC,MAAM,CAAC,IAAI,CAAC,IAAI,CAAC,EAAE,CACpE,CAAC;IACJ,CAAC;SAAM,IACL,MAAM,CAAC,MAAM,CAAC,KAAK,CACjB,CAAC,KAAK,EAAE,EAAE,CAAC,OAAO,KAAK,KAAK,QAAQ,IAAI,KAAK,KAAK,IAAI,IAAI,MAAM,IAAI,KAAK,CAC1E,EACD,CAAC;QACD,2BAA2B;QAC3B,aAAa,GAAG,IAAA,0BAAW,EAAC,MAAM,CAAC,MAAkB,CAAC,CAAC;QACvD,MAAM,GAAG,aAAa,CAAC,GAAG,CAAC,CAAC,KAAK,EAAE,EAAE,CAAC,KAAK,CAAC,IAAI,CAAC,CAAC;QAClD,gBAAM,CAAC,KAAK,CACV,UAAU,EAAE,0BAA0B,MAAM,CAAC,IAAI,CAAC,IAAI,CAAC,EAAE,CAC1D,CAAC;IACJ,CAAC;SAAM,CAAC;QACN,gBAAM,CAAC,KAAK,CACV,oCAAoC,EAAE,KAAK,IAAI,CAAC,SAAS,CACvD,MAAM,CAAC,MAAM,CACd,EAAE,CACJ,CAAC;IACJ,CAAC;IAEC,MAAM,SAAS,GAAe;QAC5B,EAAE;QACF,QAAQ,EAAE,MAAM,CAAC,QAAQ;QACzB,MAAM;QACN,IAAI;QACJ,UAAU,EAAE,MAAM,CAAC,UAAU;QAC7B,eAAe,EAAE,MAAM,CAAC,eAAe;QACvC,MAAM;QACN,aAAa;QACb,cAAc,EAAE,MAAM,CAAC,cAAc,IAAI,EAAE;QAC3C,cAAc,EAAE,MAAM,CAAC,cAAc,IAAI,EAAE;QAC3C,GAAG,EAAE,MAAM,CAAC,GAAG,IAAI,EAAE;QACrB,KAAK,EAAE,MAAM,CAAC,KAAK,IAAI,CAAC;QACxB,cAAc,EAAE,MAAM,CAAC,cAAc,IAAI,EAAE;QAC3C,UAAU,EAAE,MAAM,CAAC,UAAU;QAC7B,SAAS,EAAE,MAAM,CAAC,SAAS;QAC3B,SAAS,EAAE,MAAM,CAAC,SAAS;KAC5B,CAAC;IAEF,uFAAuF;IACvF,OAAO,SAAS,CAAC;AACnB,CAAC;AAED,SAAgB,YAAY,CAAC,OAAkB;IAC7C,gBAAM,CAAC,KAAK,CAAC,WAAW,OAAO,CAAC,MAAM,kBAAkB,CAAC,CAAC;IAC1D,MAAM,IAAI,GAAG,OAAO;SACjB,GAAG,CAAC,CAAC,MAAM,EAAE,KAAK,EAAE,EAAE;QACrB,gBAAM,CAAC,KAAK,CAAC,8BAA8B,KAAK,EAAE,CAAC,CAAC;QACpD,MAAM,GAAG,GAAG,WAAW,CAAC,MAAM,CAAC,CAAC;QAChC,IAAI,CAAC,GAAG,EAAE,CAAC;YACT,gBAAM,CAAC,IAAI,CAAC,yCAAyC,KAAK,EAAE,CAAC,CAAC;QAChE,CAAC;QACD,OAAO,GAAG,CAAC;IACb,CAAC,CAAC;SACD,MAAM,CAAC,CAAC,GAAG,EAAqB,EAAE,CAAC,GAAG,KAAK,IAAI,CAAC,CAAC;IACpD,gBAAM,CAAC,IAAI,CAAC,uBAAuB,IAAI,CAAC,MAAM,cAAc,CAAC,CAAC;IAC9D,OAAO,IAAI,CAAC;AACd,CAAC","sourcesContent":["import { Types } from 'mongoose';\r\nimport { IMentor } from '../../Interfaces/Models/i-mentor';\r\nimport { IMentorDTO } from '../../Interfaces/DTOs/i-mentor-dto';\r\nimport { toUserDTO } from './user-mapper';\r\nimport { toSkillDTOs } from './skill-mapper';\r\nimport { IUser } from '../../Interfaces/Models/i-user';\r\nimport { ISkill } from '../../Interfaces/Models/i-skill';\r\nimport logger from '../../core/utils/logger';\r\nimport { IUserDTO } from '../../Interfaces/DTOs/i-user-dto';\r\nimport { ISkillDTO } from '../../Interfaces/DTOs/i-skill-dto';\r\n\r\ntype SkillType = string | Types.ObjectId | ISkill;\r\n\r\nexport function toMentorDTO(mentor: IMentor | null): IMentorDTO | null {\r\n  if (!mentor) {\r\n    logger.warn('Attempted to map null mentor to DTO');\r\n    return null;\r\n  }\r\n\r\n  // Handle _id\r\n  if (!mentor._id) {\r\n    logger.error(`Mentor has no _id: ${JSON.stringify(mentor)}`);\r\n    return null;\r\n  }\r\n  const id = mentor._id.toString();\r\n  logger.debug(`Mentor ID: ${id}`);\r\n\r\n  // Handle userId\r\n  let userId: string = '';\r\n  let user: IUserDTO | undefined;\r\n\r\n  if (!mentor.userId) {\r\n    logger.warn(`Mentor ${id} has no userId`);\r\n  } else if (typeof mentor.userId === 'string') {\r\n    userId = mentor.userId;\r\n    logger.debug(`Mentor ${id} userId is string: ${userId}`);\r\n  } else if (mentor.userId instanceof Types.ObjectId) {\r\n    userId = mentor.userId.toString();\r\n    logger.debug(`Mentor ${id} userId is ObjectId: ${userId}`);\r\n  } else if (typeof mentor.userId === 'object' && '_id' in mentor.userId) {\r\n    // Populated IUser object\r\n    userId = (mentor.userId as IUser)._id.toString();\r\n    logger.debug(`Mentor ${id} userId is populated, _id: ${userId}`);\r\n    const userDTO = toUserDTO(mentor.userId as IUser);\r\n    if (!userDTO) {\r\n      logger.warn(`Failed to convert user to DTO for mentor ${id}`);\r\n    } else {\r\n      user = userDTO;\r\n    }\r\n  } else {\r\n    logger.error(`Invalid userId format for mentor ${id}: ${JSON.stringify(mentor.userId)}`);\r\n  }\r\n\r\n  // Handle skills\r\nlet skills: string[] = [];\r\nlet skillsDetails: ISkillDTO[] = [];\r\n\r\nif (!mentor.skills) {\r\n  logger.warn(`Mentor ${id} has no skills`);\r\n} else if (\r\n  mentor.skills.every(\r\n    (skill: SkillType) =>\r\n      typeof skill === \"string\" || skill instanceof Types.ObjectId\r\n  )\r\n) {\r\n  // Non-populated skills: array of ObjectIds or strings\r\n  skills = mentor.skills?.map((s) =>\r\n    typeof s === \"string\" ? s : s.toString()\r\n  );\r\n  logger.debug(\r\n    `Mentor ${id} has non-populated skills (IDs): ${skills.join(\", \")}`\r\n  );\r\n} else if (\r\n  mentor.skills.every(\r\n    (skill) => typeof skill === \"object\" && skill !== null && \"name\" in skill\r\n  )\r\n) {\r\n  // Populated ISkill objects\r\n  skillsDetails = toSkillDTOs(mentor.skills as ISkill[]);\r\n  skills = skillsDetails.map((skill) => skill.name);\r\n  logger.debug(\r\n    `Mentor ${id} has populated skills: ${skills.join(\", \")}`\r\n  );\r\n} else {\r\n  logger.error(\r\n    `Invalid skills format for mentor ${id}: ${JSON.stringify(\r\n      mentor.skills\r\n    )}`\r\n  );\r\n}\r\n\r\n  const mentorDTO: IMentorDTO = {\r\n    id,\r\n    mentorId: mentor.mentorId,\r\n    userId,\r\n    user,\r\n    isApproved: mentor.isApproved,\r\n    rejectionReason: mentor.rejectionReason,\r\n    skills,\r\n    skillsDetails,\r\n    certifications: mentor.certifications || [],\r\n    specialization: mentor.specialization || '',\r\n    bio: mentor.bio || '',\r\n    price: mentor.price || 0,\r\n    availableSlots: mentor.availableSlots || [],\r\n    timePeriod: mentor.timePeriod,\r\n    createdAt: mentor.createdAt,\r\n    updatedAt: mentor.updatedAt,\r\n  };\r\n\r\n  // logger.debug(`Mentor DTO created for ${id}: ${JSON.stringify(mentorDTO, null, 2)}`);\r\n  return mentorDTO;\r\n}\r\n\r\nexport function toMentorDTOs(mentors: IMentor[]): IMentorDTO[] {\r\n  logger.debug(`Mapping ${mentors.length} mentors to DTOs`);\r\n  const dtos = mentors\r\n    .map((mentor, index) => {\r\n      logger.debug(`Processing mentor at index ${index}`);\r\n      const dto = toMentorDTO(mentor);\r\n      if (!dto) {\r\n        logger.warn(`Skipping null DTO for mentor at index ${index}`);\r\n      }\r\n      return dto;\r\n    })\r\n    .filter((dto): dto is IMentorDTO => dto !== null);\r\n  logger.info(`Successfully mapped ${dtos.length} mentor DTOs`);\r\n  return dtos;\r\n}"]}