{"version":3,"file":"notification-mapper.js","sourceRoot":"","sources":["../../../src/Utils/mappers/notification-mapper.ts"],"names":[],"mappings":"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","sourcesContent":["import { IAppNotification } from '../../Interfaces/Models/i-app-notification';\r\nimport { IAppNotificationDTO } from '../../Interfaces/DTOs/i-app-notification-dto';\r\nimport { toUserDTO } from './user-mapper';\r\nimport { IUser } from '../../Interfaces/Models/i-user';\r\nimport logger from '../../core/utils/logger';\r\nimport { Types } from 'mongoose';\r\nimport { IUserDTO } from '../../Interfaces/DTOs/i-user-dto';\r\n\r\nexport function toNotificationDTO(notification: IAppNotification | null): IAppNotificationDTO | null {\r\n  if (!notification) {\r\n    logger.warn('Attempted to map null notification to DTO');\r\n    return null;\r\n  }\r\n\r\n  //userId (populated IUser or just an ID)\r\n  let userId: string;\r\n  let user: IUserDTO | undefined;\r\n\r\n  if (notification.userId) {\r\n    if (typeof notification.userId === 'string') {\r\n      userId = notification.userId;\r\n    } else if (notification.userId instanceof Types.ObjectId) {\r\n      userId = notification.userId.toString();\r\n    } else {\r\n      //IUser object (populated)\r\n      userId = (notification.userId as IUser)._id.toString();\r\n      const userDTO = toUserDTO(notification.userId as IUser);\r\n      user = userDTO ?? undefined;\r\n    }\r\n  } else {\r\n    logger.warn(`Notification ${notification._id} has no userId`);\r\n    userId = '';\r\n  }\r\n\r\n  //senderId (populated IUser or just an ID)\r\n  let senderId: string;\r\n  let sender: IUserDTO | undefined;\r\n\r\n  if (notification.senderId) {\r\n    if (typeof notification.senderId === 'string') {\r\n      senderId = notification.senderId;\r\n    } else if (notification.senderId instanceof Types.ObjectId) {\r\n      senderId = notification.senderId.toString();\r\n    } else {\r\n      //IUser object (populated)\r\n      senderId = (notification.senderId as IUser)._id.toString();\r\n      const senderDTO = toUserDTO(notification.senderId as IUser);\r\n      sender = senderDTO ?? undefined;\r\n    }\r\n  } else {\r\n    logger.warn(`Notification ${notification._id} has no senderId`);\r\n    senderId = '';\r\n  }\r\n\r\n  return {\r\n    id: notification._id.toString(),\r\n    AppNotificationId: notification.AppNotificationId,\r\n    userId,\r\n    user,\r\n    type: notification.type,\r\n    content: notification.content,\r\n    relatedId: notification.relatedId,\r\n    senderId,\r\n    sender,\r\n    status: notification.status,\r\n    callId: notification.callId,\r\n    callType: notification.callType,\r\n    notificationDate: notification.notificationDate?.toISOString().split('T')[0],\r\n    notificationTime: notification.notificationTime,\r\n    createdAt: notification.createdAt,\r\n    updatedAt: notification.updatedAt,\r\n    taskContext: notification.taskContext\r\n      ? {\r\n          contextType: notification.taskContext.contextType,\r\n          contextId: notification.taskContext.contextId,\r\n        }\r\n      : undefined,\r\n  };\r\n}\r\n\r\nexport function toNotificationDTOs(notifications: IAppNotification[]): IAppNotificationDTO[] {\r\n  return notifications\r\n    .map(toNotificationDTO)\r\n    .filter((dto): dto is IAppNotificationDTO => dto !== null);\r\n}"]}