{"version":3,"file":"task-mapper.js","sourceRoot":"","sources":["../../../src/Utils/mappers/task-mapper.ts"],"names":[],"mappings":";;;;;AAcA,8BA6FC;AAED,gCAIC;AA/GD,+CAA0C;AAC1C,iDAA4C;AAI5C,qEAA6C;AAC7C,uCAAiC;AAIjC,iEAA4D;AAE5D,SAAgB,SAAS,CAAC,IAAkB;IAC1C,IAAI,CAAC,IAAI,EAAE,CAAC;QACV,gBAAM,CAAC,IAAI,CAAC,mCAAmC,CAAC,CAAC;QACjD,OAAO,IAAI,CAAC;IACd,CAAC;IAED,2CAA2C;IAC3C,IAAI,SAAiB,CAAC;IACtB,IAAI,gBAAsC,CAAC;IAE3C,IAAI,IAAI,CAAC,SAAS,EAAE,CAAC;QACnB,IAAI,OAAO,IAAI,CAAC,SAAS,KAAK,QAAQ,EAAE,CAAC;YACvC,SAAS,GAAG,IAAI,CAAC,SAAS,CAAC;QAC7B,CAAC;aAAM,IAAI,IAAI,CAAC,SAAS,YAAY,gBAAK,CAAC,QAAQ,EAAE,CAAC;YACpD,SAAS,GAAG,IAAI,CAAC,SAAS,CAAC,QAAQ,EAAE,CAAC;QACxC,CAAC;aAAM,CAAC;YACN,SAAS,GAAI,IAAI,CAAC,SAAmB,CAAC,GAAG,CAAC,QAAQ,EAAE,CAAC;YACrD,MAAM,OAAO,GAAG,IAAA,uBAAS,EAAC,IAAI,CAAC,SAAkB,CAAC,CAAC;YACnD,gBAAgB,GAAG,OAAO,IAAI,SAAS,CAAC;QAC1C,CAAC;IACH,CAAC;SAAM,CAAC;QACN,gBAAM,CAAC,IAAI,CAAC,QAAQ,IAAI,CAAC,GAAG,mBAAmB,CAAC,CAAC;QACjD,SAAS,GAAG,EAAE,CAAC;IACjB,CAAC;IAED,yDAAyD;IACzD,MAAM,aAAa,GAAa,IAAI,CAAC,aAAa;QAChD,CAAC,CAAC,IAAI,CAAC,aAAa,CAAC,GAAG,CAAC,CAAC,IAAI,EAAE,EAAE,CAC9B,OAAO,IAAI,KAAK,QAAQ;YACtB,CAAC,CAAC,IAAI;YACN,CAAC,CAAC,IAAI,YAAY,gBAAK,CAAC,QAAQ;gBAChC,CAAC,CAAC,IAAI,CAAC,QAAQ,EAAE;gBACjB,CAAC,CAAE,IAAc,CAAC,GAAG,CAAC,QAAQ,EAAE,CACnC;QACH,CAAC,CAAC,EAAE,CAAC;IACP,MAAM,oBAAoB,GAA2B,IAAI,CAAC,aAAa;QACrE,CAAC,CAAC,IAAI,CAAC,aAAa;aACf,GAAG,CAAC,CAAC,IAAI,EAAE,EAAE,CACZ,OAAO,IAAI,KAAK,QAAQ,IAAI,IAAI,YAAY,gBAAK,CAAC,QAAQ;YACxD,CAAC,CAAC,IAAI;YACN,CAAC,CAAC,IAAA,uBAAS,EAAC,IAAa,CAAC,CAC7B;aACA,MAAM,CAAC,CAAC,GAAG,EAAmB,EAAE,CAAC,GAAG,KAAK,IAAI,CAAC;QACnD,CAAC,CAAC,SAAS,CAAC;IAEd,mEAAmE;IACnE,IAAI,SAAiB,CAAC;IACtB,IAAI,OAA6D,CAAC;IAElE,IAAI,IAAI,CAAC,SAAS,EAAE,CAAC;QACnB,IAAI,OAAO,IAAI,CAAC,SAAS,KAAK,QAAQ,EAAE,CAAC;YACvC,SAAS,GAAG,IAAI,CAAC,SAAS,CAAC;QAC7B,CAAC;aAAM,IAAI,IAAI,CAAC,SAAS,YAAY,gBAAK,CAAC,QAAQ,EAAE,CAAC;YACpD,SAAS,GAAG,IAAI,CAAC,SAAS,CAAC,QAAQ,EAAE,CAAC;QACxC,CAAC;aAAM,CAAC;YACN,SAAS,GAAI,IAAI,CAAC,SAAiB,CAAC,GAAG,CAAC,QAAQ,EAAE,CAAC;YACnD,IAAI,IAAI,CAAC,WAAW,KAAK,MAAM,EAAE,CAAC;gBAChC,MAAM,OAAO,GAAG,IAAA,uBAAS,EAAC,IAAI,CAAC,SAAkB,CAAC,CAAC;gBACnD,OAAO,GAAG,OAAO,IAAI,SAAS,CAAC;YACjC,CAAC;iBAAM,IAAI,IAAI,CAAC,WAAW,KAAK,OAAO,EAAE,CAAC;gBACxC,MAAM,QAAQ,GAAG,IAAA,yBAAU,EAAC,IAAI,CAAC,SAAmB,CAAC,CAAC;gBACtD,OAAO,GAAG,QAAQ,IAAI,SAAS,CAAC;YAClC,CAAC;iBAAM,IAAI,IAAI,CAAC,WAAW,KAAK,eAAe,EAAE,CAAC;gBAChD,MAAM,gBAAgB,GAAG,IAAA,yCAAkB,EAAC,IAAI,CAAC,SAA2B,CAAC,CAAC;gBAC9E,OAAO,GAAG,gBAAgB,IAAI,SAAS,CAAC;YAC1C,CAAC;QACH,CAAC;IACH,CAAC;SAAM,CAAC;QACN,gBAAM,CAAC,IAAI,CAAC,QAAQ,IAAI,CAAC,GAAG,mBAAmB,CAAC,CAAC;QACjD,SAAS,GAAG,EAAE,CAAC;IACjB,CAAC;IAED,OAAO;QACL,EAAE,EAAE,IAAI,CAAC,GAAG,CAAC,QAAQ,EAAE;QACvB,MAAM,EAAE,IAAI,CAAC,MAAM;QACnB,IAAI,EAAE,IAAI,CAAC,IAAI;QACf,WAAW,EAAE,IAAI,CAAC,WAAW;QAC7B,KAAK,EAAE,IAAI,CAAC,KAAK;QACjB,QAAQ,EAAE,IAAI,CAAC,QAAQ;QACvB,MAAM,EAAE,IAAI,CAAC,MAAM;QACnB,SAAS,EAAE,IAAI,CAAC,SAAS;QACzB,OAAO,EAAE,IAAI,CAAC,OAAO;QACrB,gBAAgB,EAAE,IAAI,CAAC,gBAAgB;QACvC,gBAAgB,EAAE,IAAI,CAAC,gBAAgB;QACvC,WAAW,EAAE,IAAI,CAAC,WAAW;QAC7B,SAAS;QACT,OAAO;QACP,aAAa;QACb,oBAAoB,EAAE,oBAAoB,EAAE,MAAM,CAAC,CAAC,CAAC,oBAAoB,CAAC,CAAC,CAAC,SAAS;QACrF,SAAS;QACT,gBAAgB;QAChB,SAAS,EAAE,IAAI,CAAC,SAAS;KAC1B,CAAC;AACJ,CAAC;AAED,SAAgB,UAAU,CAAC,KAAc;IACvC,OAAO,KAAK;SACT,GAAG,CAAC,SAAS,CAAC;SACd,MAAM,CAAC,CAAC,GAAG,EAAmB,EAAE,CAAC,GAAG,KAAK,IAAI,CAAC,CAAC;AACpD,CAAC","sourcesContent":["import { ITask } from '../../Interfaces/Models/i-task';\r\nimport { ITaskDTO } from '../../Interfaces/DTOs/i-task-dto';\r\nimport { toUserDTO } from './user-mapper';\r\nimport { toGroupDTO } from './group-mapper';\r\nimport { IUser } from '../../Interfaces/Models/i-user';\r\nimport { IGroup } from '../../Interfaces/Models/i-group';\r\nimport { ICollaboration } from '../../Interfaces/Models/i-collaboration';\r\nimport logger from '../../core/utils/logger';\r\nimport { Types } from 'mongoose';\r\nimport { IUserDTO } from '../../Interfaces/DTOs/i-user-dto';\r\nimport { IGroupDTO } from '../../Interfaces/DTOs/i-group-dto';\r\nimport { ICollaborationDTO } from '../../Interfaces/DTOs/i-collaboration-dto';\r\nimport { toCollaborationDTO } from './collaboration-mapper';\r\n\r\nexport function toTaskDTO(task: ITask | null): ITaskDTO | null {\r\n  if (!task) {\r\n    logger.warn('Attempted to map null task to DTO');\r\n    return null;\r\n  }\r\n\r\n  //createdBy (populated IUser or just an ID)\r\n  let createdBy: string;\r\n  let createdByDetails: IUserDTO | undefined;\r\n\r\n  if (task.createdBy) {\r\n    if (typeof task.createdBy === 'string') {\r\n      createdBy = task.createdBy;\r\n    } else if (task.createdBy instanceof Types.ObjectId) {\r\n      createdBy = task.createdBy.toString();\r\n    } else {\r\n      createdBy = (task.createdBy as IUser)._id.toString();\r\n      const userDTO = toUserDTO(task.createdBy as IUser);\r\n      createdByDetails = userDTO ?? undefined;\r\n    }\r\n  } else {\r\n    logger.warn(`Task ${task._id} has no createdBy`);\r\n    createdBy = '';\r\n  }\r\n\r\n  //assignedUsers (array of IDs or populated IUser objects)\r\n  const assignedUsers: string[] = task.assignedUsers\r\n    ? task.assignedUsers.map((user) =>\r\n        typeof user === 'string'\r\n          ? user\r\n          : user instanceof Types.ObjectId\r\n          ? user.toString()\r\n          : (user as IUser)._id.toString()\r\n      )\r\n    : [];\r\n  const assignedUsersDetails: IUserDTO[] | undefined = task.assignedUsers\r\n    ? task.assignedUsers\r\n        .map((user) =>\r\n          typeof user === 'string' || user instanceof Types.ObjectId\r\n            ? null\r\n            : toUserDTO(user as IUser)\r\n        )\r\n        .filter((dto): dto is IUserDTO => dto !== null)\r\n    : undefined;\r\n\r\n  //contextId (populated IUser, IGroup, ICollaboration or just an ID)\r\n  let contextId: string;\r\n  let context: IUserDTO | IGroupDTO | ICollaborationDTO | undefined;\r\n\r\n  if (task.contextId) {\r\n    if (typeof task.contextId === 'string') {\r\n      contextId = task.contextId;\r\n    } else if (task.contextId instanceof Types.ObjectId) {\r\n      contextId = task.contextId.toString();\r\n    } else {\r\n      contextId = (task.contextId as any)._id.toString();\r\n      if (task.contextType === 'user') {\r\n        const userDTO = toUserDTO(task.contextId as IUser);\r\n        context = userDTO ?? undefined;\r\n      } else if (task.contextType === 'group') {\r\n        const groupDTO = toGroupDTO(task.contextId as IGroup);\r\n        context = groupDTO ?? undefined;\r\n      } else if (task.contextType === 'collaboration') {\r\n        const collaborationDTO = toCollaborationDTO(task.contextId as ICollaboration);\r\n        context = collaborationDTO ?? undefined;\r\n      }\r\n    }\r\n  } else {\r\n    logger.warn(`Task ${task._id} has no contextId`);\r\n    contextId = '';\r\n  }\r\n\r\n  return {\r\n    id: task._id.toString(),\r\n    taskId: task.taskId,\r\n    name: task.name,\r\n    description: task.description,\r\n    image: task.image,\r\n    priority: task.priority,\r\n    status: task.status,\r\n    startDate: task.startDate,\r\n    dueDate: task.dueDate,\r\n    notificationDate: task.notificationDate,\r\n    notificationTime: task.notificationTime,\r\n    contextType: task.contextType,\r\n    contextId,\r\n    context,\r\n    assignedUsers,\r\n    assignedUsersDetails: assignedUsersDetails?.length ? assignedUsersDetails : undefined,\r\n    createdBy,\r\n    createdByDetails,\r\n    createdAt: task.createdAt,\r\n  };\r\n}\r\n\r\nexport function toTaskDTOs(tasks: ITask[]): ITaskDTO[] {\r\n  return tasks\r\n    .map(toTaskDTO)\r\n    .filter((dto): dto is ITaskDTO => dto !== null);\r\n}"]}