{"version":3,"file":"user-connection-mapper.js","sourceRoot":"","sources":["../../../src/Utils/mappers/user-connection-mapper.ts"],"names":[],"mappings":"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","sourcesContent":["import { IUserConnection } from '../../Interfaces/Models/i-user-connection';\r\nimport { IUserConnectionDTO } from '../../Interfaces/DTOs/i-user-connection-dto';\r\nimport { toUserDTO } from './user-mapper';\r\nimport { IUser } from '../../Interfaces/Models/i-user';\r\nimport logger from '../../core/utils/logger';\r\nimport { Types } from 'mongoose';\r\nimport { IUserDTO } from '../../Interfaces/DTOs/i-user-dto';\r\n\r\nexport function toUserConnectionDTO(connection: IUserConnection | null): IUserConnectionDTO | null {\r\n  if (!connection) {\r\n    logger.warn('Attempted to map null user connection to DTO');\r\n    return null;\r\n  }\r\n\r\n  //requester (populated IUser or just an ID)\r\n  let requesterId: string;\r\n  let requester: IUserDTO | undefined;\r\n\r\n  if (connection.requester) {\r\n    if (typeof connection.requester === 'string') {\r\n      requesterId = connection.requester;\r\n    } else if (connection.requester instanceof Types.ObjectId) {\r\n      requesterId = connection.requester.toString();\r\n    } else {\r\n      // Assume it's an IUser object (populated)\r\n      requesterId = (connection.requester as IUser)._id.toString();\r\n      const requesterDTO = toUserDTO(connection.requester as IUser);\r\n      requester = requesterDTO ?? undefined;\r\n    }\r\n  } else {\r\n    logger.warn(`User connection ${connection._id} has no requester`);\r\n    requesterId = '';\r\n  }\r\n\r\n  //recipient (populated IUser or just an ID)\r\n  let recipientId: string;\r\n  let recipient: IUserDTO | undefined;\r\n\r\n  if (connection.recipient) {\r\n    if (typeof connection.recipient === 'string') {\r\n      recipientId = connection.recipient;\r\n    } else if (connection.recipient instanceof Types.ObjectId) {\r\n      recipientId = connection.recipient.toString();\r\n    } else {\r\n      //IUser object (populated)\r\n      recipientId = (connection.recipient as IUser)._id.toString();\r\n      const recipientDTO = toUserDTO(connection.recipient as IUser);\r\n      recipient = recipientDTO ?? undefined;\r\n    }\r\n  } else {\r\n    logger.warn(`User connection ${connection._id} has no recipient`);\r\n    recipientId = '';\r\n  }\r\n\r\n  return {\r\n    id: connection._id.toString(),\r\n    connectionId: connection.connectionId,\r\n    requesterId,\r\n    requester,\r\n    recipientId,\r\n    recipient,\r\n    requestStatus: connection.requestStatus,\r\n    connectionStatus: connection.connectionStatus,\r\n    requestSentAt: connection.requestSentAt,\r\n    requestAcceptedAt: connection.requestAcceptedAt,\r\n    disconnectedAt: connection.disconnectedAt,\r\n    disconnectionReason: connection.disconnectionReason,\r\n    createdAt: connection.createdAt,\r\n    updatedAt: connection.updatedAt,\r\n  };\r\n}\r\n\r\nexport function toUserConnectionDTOs(connections: IUserConnection[]): IUserConnectionDTO[] {\r\n  return connections\r\n    .map(toUserConnectionDTO)\r\n    .filter((dto): dto is IUserConnectionDTO => dto !== null);\r\n}"]}