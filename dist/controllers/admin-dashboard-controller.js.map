{"version":3,"file":"admin-dashboard-controller.js","sourceRoot":"","sources":["../../src/controllers/admin-dashboard-controller.ts"],"names":[],"mappings":"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","sourcesContent":["import { Request, Response, NextFunction } from \"express\";\r\nimport { inject, injectable } from \"inversify\";\r\nimport logger from \"../core/utils/logger\";\r\nimport { IAdminController } from \"../Interfaces/Controller/i-admin-controller\";\r\nimport { BaseController } from \"../core/controller/base-controller\";\r\nimport { IAdminService } from \"../Interfaces/Services/i-admin-service\";\r\nimport { ADMIN_MESSAGES, AUTH_MESSAGES } from \"../constants/messages\";\r\nimport { ERROR_MESSAGES } from \"../constants/error-messages\";\r\nimport { StatusCodes } from \"../enums/status-code-enums\";\r\nimport { HttpError } from \"../core/utils/error-handler\";\r\nimport { UpdateProfileRequestBody } from \"../Utils/types/auth-types\";\r\n\r\n@injectable()\r\nexport class AdminController extends BaseController implements IAdminController {\r\n  private _adminService: IAdminService;\r\n    \r\n  constructor(@inject('IAdminService') adminService : IAdminService) {\r\n    super();\r\n    this._adminService = adminService;\r\n  }\r\n\r\n  \r\n  getTotalUsersCount = async (_req: Request, res: Response, next: NextFunction): Promise<void> => {\r\n    try {\r\n      const count = await this._adminService.getTotalUsersCount();\r\n      this.sendSuccess(res, { totalUsers: count }, ADMIN_MESSAGES.TOTAL_USERS);\r\n    } catch (error: any) {\r\n      logger.info(error);\r\n      next(error);\r\n    }\r\n  };\r\n\r\n  getTotalMentorsCount = async (_req: Request, res: Response, next: NextFunction): Promise<void> => {\r\n    try {\r\n      const count = await this._adminService.getTotalMentorsCount();\r\n      this.sendSuccess(res, { totalMentors: count }, ADMIN_MESSAGES.TOTAL_MENTORS);\r\n    } catch (error: any) {\r\n      logger.info(error);\r\n      next(error);\r\n    }\r\n  };\r\n\r\n  getTotalRevenue = async (_req: Request, res: Response, next: NextFunction): Promise<void> => {\r\n    try {\r\n      const revenue = await this._adminService.getTotalRevenue();\r\n      this.sendSuccess(res, revenue, ADMIN_MESSAGES.TOTAL_REVENUE);\r\n    } catch (error: any) {\r\n      logger.info(error);\r\n      next(error);\r\n    }\r\n  };\r\n\r\n  getPendingMentorRequestsCount = async (_req: Request, res: Response, next: NextFunction): Promise<void> => {\r\n    try {\r\n      const count = await this._adminService.getPendingMentorRequestsCount();\r\n      this.sendSuccess(res, { pendingMentorRequests: count }, ADMIN_MESSAGES.PENDING_MENTOR_REQUESTS);\r\n    } catch (error: any) {\r\n      logger.info(error);\r\n      next(error);\r\n    }\r\n  };\r\n\r\n  getActiveCollaborationsCount = async (_req: Request, res: Response, next: NextFunction): Promise<void> => {\r\n    try {\r\n      const count = await this._adminService.getActiveCollaborationsCount();\r\n      this.sendSuccess(res, { activeCollaborations: count }, ADMIN_MESSAGES.ACTIVE_COLLABORATIONS);\r\n    } catch (error: any) {\r\n      logger.info(error);\r\n      next(error);\r\n    }\r\n  };\r\n\r\n  getRevenueTrends = async (req: Request, res: Response, next: NextFunction): Promise<void> => {\r\n    try {\r\n      const { timeFormat, days } = req.query;\r\n      const trends = await this._adminService.getRevenueTrends(timeFormat as string, Number(days));\r\n      this.sendSuccess(res, trends, ADMIN_MESSAGES.REVENUE_TRENDS);\r\n    } catch (error: any) {\r\n      logger.info(error);\r\n      next(error);\r\n    }\r\n  };\r\n\r\n  getUserGrowth = async (req: Request, res: Response, next: NextFunction): Promise<void> => {\r\n    try {\r\n      const { timeFormat, days } = req.query;\r\n      const growth = await this._adminService.getUserGrowth(timeFormat as string, Number(days));\r\n      this.sendSuccess(res, growth, ADMIN_MESSAGES.USER_GROWTH);\r\n    } catch (error: any) {\r\n      logger.info(error);\r\n      next(error);\r\n    }\r\n  };\r\n\r\n  getPendingMentorRequests = async (req: Request, res: Response, next: NextFunction): Promise<void> => {\r\n    try {\r\n      const { limit } = req.query;\r\n      const requests = await this._adminService.getPendingMentorRequests(Number(limit));\r\n      this.sendSuccess(res, requests, ADMIN_MESSAGES.PENDING_REQUESTS);\r\n    } catch (error: any) {\r\n      logger.info(error);\r\n      next(error);\r\n    }\r\n  };\r\n\r\n  getTopMentors = async (req: Request, res: Response, next: NextFunction): Promise<void> => {\r\n    try {\r\n      const { limit } = req.query;\r\n      const mentors = await this._adminService.getTopMentors(Number(limit));\r\n      this.sendSuccess(res, mentors, ADMIN_MESSAGES.TOP_MENTORS);\r\n    } catch (error: any) {\r\n      logger.info(error);\r\n      next(error);\r\n    }\r\n  };\r\n\r\n  getRecentCollaborations = async (req: Request, res: Response, next: NextFunction): Promise<void> => {\r\n    try {\r\n      const { limit } = req.query;\r\n      const collaborations = await this._adminService.getRecentCollaborations(Number(limit));\r\n      this.sendSuccess(res, collaborations, ADMIN_MESSAGES.RECENT_COLLABORATIONS);\r\n    } catch (error: any) {\r\n      logger.info(error);\r\n      next(error);\r\n    }\r\n  };\r\n\r\n    // Get Admin profile details\r\n    getAdminProfileDetails = async (req: Request<{ id: string }>, res: Response, next: NextFunction): Promise<void> => {\r\n      try {\r\n        const userId = req.params.id;\r\n        logger.debug(`Fetching profile details for userId: ${userId}`);\r\n        if (!userId) {\r\n          throw new HttpError(ERROR_MESSAGES.REQUIRED_USER_ID, StatusCodes.BAD_REQUEST);\r\n        }\r\n        const userDetails = await this._adminService.AdminprofileDetails(userId);\r\n        if (!userDetails) {\r\n          this.sendSuccess(res, { userDetails: null }, AUTH_MESSAGES.NO_USER_FOUND);\r\n          logger.info(`No user found for ID: ${userId}`);\r\n          return;\r\n        }\r\n        this.sendSuccess(res, { userDetails }, AUTH_MESSAGES.PROFILE_FETCHED);\r\n        logger.info(`Profile details fetched for userId: ${userId}`);\r\n      } catch (error) {\r\n        logger.error(`Error fetching profile details for userId ${req.params.id || \"unknown\"}: ${error}`);\r\n        next(error);\r\n      }\r\n    };\r\n  \r\n    // Update Admin profile\r\n    updateAdminDetails = async (\r\n      req: Request<{ id: string }, {}, UpdateProfileRequestBody>,\r\n      res: Response,\r\n      next: NextFunction\r\n    ): Promise<void> => {\r\n      try {\r\n        const userId = req.params.id;\r\n        logger.debug(`Updating profile for userId: ${userId}`);\r\n        if (!userId) {\r\n          throw new HttpError(ERROR_MESSAGES.REQUIRED_USER_ID, StatusCodes.BAD_REQUEST);\r\n        }\r\n        const data: UpdateProfileRequestBody = req.body;\r\n        const profilePicFile = req.files?.[\"profilePic\"]?.[0];\r\n        if (profilePicFile) data.profilePicFile = profilePicFile;\r\n        const updatedUser = await this._adminService.updateAdminProfile(userId, data);\r\n        this.sendSuccess(res, { user: updatedUser }, AUTH_MESSAGES.PROFILE_UPDATED);\r\n        logger.info(`Profile updated for userId: ${userId}`);\r\n      } catch (error) {\r\n        logger.error(`Error updating profile for userId ${req.params.id || \"unknown\"}: ${error}`);\r\n        next(error);\r\n      }\r\n    };\r\n}\r\n"]}