{"version":3,"file":"category-controller.js","sourceRoot":"","sources":["../../src/controllers/category-controller.ts"],"names":[],"mappings":"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","sourcesContent":["import { Request, Response, NextFunction } from \"express\";\r\nimport { inject, injectable } from \"inversify\";\r\nimport { BaseController } from \"../core/controller/base-controller\";\r\nimport logger from \"../core/utils/logger\";\r\nimport { CategoryRequest } from \"../Utils/types/category-types\";\r\nimport { ICategoryController } from \"../Interfaces/Controller/i-category-controller\";\r\nimport { HttpError } from \"../core/utils/error-handler\";\r\nimport { StatusCodes } from \"../enums/status-code-enums\";\r\nimport { ICategoryService } from \"../Interfaces/Services/i-category-service\";\r\nimport { CATEGORY_MESSAGES } from \"../constants/messages\";\r\nimport { ERROR_MESSAGES } from \"../constants/error-messages\";\r\n\r\n@injectable()\r\nexport class CategoryController extends BaseController implements ICategoryController {\r\n  private _categoryService: ICategoryService;\r\n\r\n  constructor(@inject('ICategoryService') categoryService : ICategoryService) {\r\n    super();\r\n    this._categoryService = categoryService;\r\n  }\r\n\r\n  createCategory = async (req: CategoryRequest, res: Response, next: NextFunction): Promise<void> => {\r\n    try {\r\n      logger.debug(`Creating category: ${req.body.name}`);\r\n      if (!req.body.name) {\r\n        throw new HttpError(ERROR_MESSAGES.REQUIRED_CATEGORY_NAME, StatusCodes.BAD_REQUEST);\r\n      }\r\n      const isDuplicate = await this._categoryService.isDuplicateCategoryName(req.body.name);\r\n      if (isDuplicate) {\r\n        throw new HttpError(ERROR_MESSAGES.DUPLICATE_CATEGORY_NAME, StatusCodes.BAD_REQUEST);\r\n      }\r\n      const imagePath = req.file?.path;\r\n      const fileSize = req.file?.size;\r\n      const category = await this._categoryService.createCategory(req.body, imagePath, fileSize);\r\n      this.sendCreated(res, category, CATEGORY_MESSAGES.CATEGORY_CREATED);\r\n    } catch (error) {\r\n      next(error);\r\n    }\r\n  };\r\n\r\n  getAllCategories = async (req: Request, res: Response, next: NextFunction): Promise<void> => {\r\n    try {\r\n      const { search, page, limit } = req.query;\r\n      const query: any = {};\r\n\r\n      if (search) query.search = search as string;\r\n      if (page) query.page = parseInt(page as string, 10);\r\n      if (limit) query.limit = parseInt(limit as string, 10);\r\n\r\n      logger.debug(`Fetching categories with query: ${JSON.stringify(query)}`);\r\n\r\n      const result = await this._categoryService.getAllCategories(query);\r\n\r\n      if (!search) {\r\n        if (result.categories.length === 0) {\r\n          this.sendSuccess(res, { categories: [], \r\n          total: result.total,\r\n          page: query.page || 1,\r\n          limit: query.limit || 10, \r\n        }, CATEGORY_MESSAGES.NO_CATEGORIES_FOUND);\r\n          logger.info(\"No categories found\");\r\n          return;\r\n        }\r\n        this.sendSuccess(res, { \r\n          categories: result.categories, \r\n          total: result.total,\r\n          page: query.page || 1,\r\n          limit: query.limit || 10, \r\n        }, CATEGORY_MESSAGES.CATEGORIES_FETCHED);\r\n        logger.info(`Fetched ${result.categories.length} categories`);\r\n        return;\r\n      }\r\n\r\n      if (result.categories.length === 0) {\r\n        this.sendSuccess(\r\n          res,\r\n          {\r\n            categories: [],\r\n            total: 0,\r\n            page: query.page || 1,\r\n            limit: query.limit || 10,\r\n          },\r\n          query.search ? CATEGORY_MESSAGES.NO_CATEGORIES_FOUND_FOR_SEARCH : CATEGORY_MESSAGES.NO_CATEGORIES_FOUND\r\n        );\r\n        logger.info(`No categories found for query: ${JSON.stringify(query)}`);\r\n        return;\r\n      }\r\n\r\n      this.sendSuccess(\r\n        res,\r\n        {\r\n          categories: result.categories,\r\n          total: result.total,\r\n          page: query.page || 1,\r\n          limit: query.limit || 10,\r\n        },\r\n        CATEGORY_MESSAGES.CATEGORIES_FETCHED\r\n      );\r\n    } catch (error) {\r\n      logger.error(`Error fetching categories: ${error}`);\r\n      next(error);\r\n    }\r\n  };\r\n\r\n  fetchAllCategories = async (_req: Request, res: Response, next: NextFunction): Promise<void> => {\r\n    try {\r\n      const result = await this._categoryService.fetchAllCategories();\r\n\r\n        if (result.categories.length === 0) {\r\n          this.sendSuccess(res, { categories: [] }, CATEGORY_MESSAGES.NO_CATEGORIES_FOUND);\r\n          logger.info(\"No categories found\");\r\n          return;\r\n        }\r\n        this.sendSuccess(res, { categories: result.categories }, CATEGORY_MESSAGES.CATEGORIES_FETCHED);\r\n        logger.info(`Fetched ${result.categories.length} categories`);\r\n        return;\r\n    } catch (error) {\r\n      logger.error(`Error fetching categories: ${error}`);\r\n      next(error);\r\n    }\r\n  };\r\n\r\n  getCategoryById = async (req: CategoryRequest, res: Response, next: NextFunction): Promise<void> => {\r\n    try {\r\n      logger.debug(`Fetching category: ${req.params.id}`);\r\n      const category = await this._categoryService.getCategoryById(req.params.id!);\r\n      if (!category) {\r\n        this.sendSuccess(res, { category: null }, CATEGORY_MESSAGES.NO_CATEGORY_FOUND);\r\n        logger.info(`No category found for ID: ${req.params.id}`);\r\n        return;\r\n      }\r\n      this.sendSuccess(res, category, CATEGORY_MESSAGES.CATEGORY_FETCHED);\r\n    } catch (error) {\r\n      next(error);\r\n    }\r\n  };\r\n\r\n  updateCategory = async (req: CategoryRequest, res: Response, next: NextFunction): Promise<void> => {\r\n    try {\r\n      logger.debug(`Updating category: ${req.params.id}`);\r\n      if (!req.body.name) {\r\n        throw new HttpError(ERROR_MESSAGES.REQUIRED_CATEGORY_NAME, StatusCodes.BAD_REQUEST);\r\n      }\r\n      const isDuplicate = await this._categoryService.isDuplicateCategoryName(req.body.name, req.params.id);\r\n      if (isDuplicate) {\r\n        throw new HttpError(ERROR_MESSAGES.DUPLICATE_CATEGORY_NAME, StatusCodes.BAD_REQUEST);\r\n      }\r\n      const imagePath = req.file?.path;\r\n      const fileSize = req.file?.size;\r\n      const updatedCategory = await this._categoryService.updateCategory(req.params.id!, req.body, imagePath, fileSize);\r\n      if (!updatedCategory) {\r\n        this.sendSuccess(res, { updatedCategory: null }, CATEGORY_MESSAGES.NO_CATEGORY_FOUND);\r\n        logger.info(`No category found for ID: ${req.params.id}`);\r\n        return;\r\n      }\r\n      this.sendSuccess(res, updatedCategory, CATEGORY_MESSAGES.CATEGORY_UPDATED);\r\n    } catch (error) {\r\n      next(error);\r\n    }\r\n  };\r\n\r\n  deleteCategory = async (req: CategoryRequest, res: Response, next: NextFunction): Promise<void> => {\r\n    try {\r\n      logger.debug(`Deleting category: ${req.params.id}`);\r\n      const deletedCategory = await this._categoryService.deleteCategory(req.params.id!);\r\n      if (!deletedCategory) {\r\n        this.sendSuccess(res, { deletedCategory: null }, CATEGORY_MESSAGES.NO_CATEGORY_FOUND);\r\n        logger.info(`No category found for ID: ${req.params.id}`);\r\n        return;\r\n      }\r\n      this.sendNoContent(res, CATEGORY_MESSAGES.CATEGORY_DELETED);\r\n    } catch (error) {\r\n      next(error);\r\n    }\r\n  };\r\n}\r\n"]}