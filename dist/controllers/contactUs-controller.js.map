{"version":3,"file":"contactUs-controller.js","sourceRoot":"","sources":["../../src/controllers/contactUs-controller.ts"],"names":[],"mappings":"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","sourcesContent":["import { NextFunction, Request, Response } from 'express';\r\nimport { inject, injectable } from 'inversify';\r\nimport logger from '../core/utils/logger';\r\nimport { IContactMessageController } from '../Interfaces/Controller/i-contact-us-controller';\r\nimport { HttpError } from '../core/utils/error-handler';\r\nimport { StatusCodes } from \"../enums/status-code-enums\";\r\nimport { BaseController } from '../core/controller/base-controller';\r\nimport { IContactMessageService } from '../Interfaces/Services/i-contact-message-service';\r\nimport { ERROR_MESSAGES } from '../constants/error-messages';\r\nimport { CONTACT_MESSAGE_MESSAGES } from '../constants/messages';\r\n\r\n@injectable()\r\nexport class ContactMessageController extends BaseController implements IContactMessageController{\r\n  private _contactMessageService: IContactMessageService;\r\n\r\n  constructor(@inject('IContactMessageService') contactMessageService : IContactMessageService) {\r\n    super();\r\n    this._contactMessageService = contactMessageService;\r\n  }\r\n\r\n   createContactMessage = async (req: Request, res: Response, next: NextFunction): Promise<void> => {\r\n    try {\r\n      const { name, email, message } = req.body;\r\n      logger.debug(`Creating contact message from: ${email}`);\r\n      if (!name || !email || !message) {\r\n        logger.error(\"Missing required fields: name, email, or message\");\r\n        throw new HttpError(ERROR_MESSAGES.REQUIRED_CONTACT_MESSAGE_FIELDS, StatusCodes.BAD_REQUEST);\r\n      }\r\n      const contactMessage = await this._contactMessageService.createContactMessage({ name, email, message });\r\n      this.sendCreated(res, { contactMessage }, CONTACT_MESSAGE_MESSAGES.CONTACT_MESSAGE_CREATED);\r\n      logger.info(`Contact message created by: ${email}`);\r\n    } catch (error: any) {\r\n      logger.error(`Error creating contact message: ${error.message}`);\r\n      next(error);\r\n    }\r\n  };\r\n\r\n  getAllContactMessages = async (\r\n  req: Request,\r\n  res: Response,\r\n  next: NextFunction\r\n): Promise<void> => {\r\n  try {\r\n    logger.debug(\"Controller: Fetching contact messages\");\r\n\r\n    const {\r\n      page = \"1\",\r\n      limit = \"10\",\r\n      search = \"\",\r\n      dateFilter = \"all\",\r\n    } = req.query;\r\n\r\n    const result = await this._contactMessageService.getAllContactMessages({\r\n      page: Number(page),\r\n      limit: Number(limit),\r\n      search: String(search),\r\n      dateFilter: dateFilter as \"today\" | \"7days\" | \"30days\" | \"all\",\r\n    });\r\n\r\n    this.sendSuccess(\r\n      res,\r\n      result,\r\n      CONTACT_MESSAGE_MESSAGES.CONTACT_MESSAGES_FETCHED\r\n    );\r\n  } catch (error: any) {\r\n    logger.error(`Error fetching contact messages: ${error.message}`);\r\n    next(error);\r\n  }\r\n};\r\n\r\n\r\n  sendReply = async (req: Request, res: Response, next: NextFunction): Promise<void> => {\r\n    try {\r\n      const { contactMessageId } = req.params;\r\n      const { email, replyMessage } = req.body;\r\n      logger.debug(`Sending reply for contact message: ${contactMessageId}`);\r\n      if (!email || !replyMessage) {\r\n        logger.error(\"Missing required fields: email or replyMessage\");\r\n        throw new HttpError(ERROR_MESSAGES.REQUIRED_EMAIL_REPLY_MESSAGE, StatusCodes.BAD_REQUEST);\r\n      }\r\n      const updatedMessage = await this._contactMessageService.sendReply(contactMessageId, { email, replyMessage });\r\n      this.sendSuccess(res, { updatedMessage }, CONTACT_MESSAGE_MESSAGES.REPLY_SENT);\r\n      logger.info(`Reply sent for contact message: ${contactMessageId}`);\r\n    } catch (error: any) {\r\n      logger.error(`Error sending reply: ${error.message}`);\r\n      next(error);\r\n    }\r\n  };\r\n}"]}