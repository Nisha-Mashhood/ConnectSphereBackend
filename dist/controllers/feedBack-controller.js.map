{"version":3,"file":"feedBack-controller.js","sourceRoot":"","sources":["../../src/controllers/feedBack-controller.ts"],"names":[],"mappings":"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","sourcesContent":["import { Request, Response, NextFunction } from 'express';\r\nimport { inject, injectable } from 'inversify';\r\nimport logger from '../core/utils/logger';\r\nimport { IFeedback } from '../Interfaces/Models/i-feedback';\r\nimport { IFeedbackController } from '../Interfaces/Controller/i-feedBack-controller';\r\nimport { HttpError } from '../core/utils/error-handler';\r\nimport { StatusCodes } from \"../enums/status-code-enums\";\r\nimport { BaseController } from '../core/controller/base-controller';\r\nimport { IFeedbackService } from '../Interfaces/Services/i-feedback-service';\r\nimport { FEEDBACK_MESSAGES } from '../constants/messages';\r\nimport { ERROR_MESSAGES } from '../constants/error-messages';\r\n\r\n@injectable()\r\nexport class FeedbackController extends BaseController implements IFeedbackController{\r\n  private _feedbackService: IFeedbackService;\r\n\r\n  constructor(@inject('IFeedbackService') feedbackService : IFeedbackService) {\r\n    super();\r\n    this._feedbackService = feedbackService;\r\n  }\r\n\r\n    createFeedback = async (req: Request, res: Response, next: NextFunction): Promise<void> => {\r\n    try {\r\n      const feedbackData: Partial<IFeedback> = {\r\n        userId: req.body.userId,\r\n        mentorId: req.body.mentorId,\r\n        collaborationId: req.body.collaborationId,\r\n        rating: req.body.rating,\r\n        communication: req.body.communication,\r\n        expertise: req.body.expertise,\r\n        punctuality: req.body.punctuality,\r\n        comments: req.body.comments,\r\n        wouldRecommend: req.body.wouldRecommend,\r\n        givenBy: req.body.role,\r\n      };\r\n      logger.debug(`Creating feedback for collaboration: ${feedbackData.collaborationId}`);\r\n      if (!feedbackData.userId || !feedbackData.mentorId || !feedbackData.collaborationId || !feedbackData.rating) {\r\n        logger.error(\"Missing required fields\");\r\n        throw new HttpError(ERROR_MESSAGES.REQUIRED_FEEDBACK_FIELDS, StatusCodes.BAD_REQUEST);\r\n      }\r\n      const feedback = await this._feedbackService.createFeedback(feedbackData);\r\n      this.sendCreated(res, { feedback }, FEEDBACK_MESSAGES.FEEDBACK_CREATED);\r\n      logger.info(\"Feedback created successfully\");\r\n    } catch (error: any) {\r\n      logger.error(`Error creating feedback: ${error.message}`);\r\n      next(error);\r\n    }\r\n  };\r\n\r\n  getMentorFeedbacks = async (req: Request, res: Response, next: NextFunction): Promise<void> => {\r\n    try {\r\n      const { mentorId } = req.params;\r\n      logger.debug(`Fetching feedbacks for mentor: ${mentorId}`);\r\n      const feedbackData = await this._feedbackService.getMentorFeedbacks(mentorId);\r\n      if (feedbackData.feedbacks.length === 0) {\r\n        this.sendSuccess(res, { feedbacks: [], averageRating: 0, totalFeedbacks: 0 }, FEEDBACK_MESSAGES.NO_FEEDBACKS_FOUND);\r\n        return;\r\n      }\r\n\r\n      this.sendSuccess(res, feedbackData, FEEDBACK_MESSAGES.MENTOR_FEEDBACKS_FETCHED);\r\n      logger.info(\"Mentor feedbacks fetched successfully\");\r\n    } catch (error: any) {\r\n      logger.error(`Error fetching mentor feedbacks: ${error.message}`);\r\n      next(error);\r\n    }\r\n  };\r\n\r\n  getUserFeedbacks = async (req: Request, res: Response, next: NextFunction): Promise<void> => {\r\n    try {\r\n      const { userId } = req.params;\r\n      logger.debug(`Fetching feedbacks for user: ${userId}`);\r\n      const feedbacks = await this._feedbackService.getUserFeedbacks(userId);\r\n      if (feedbacks.length === 0) {\r\n        this.sendSuccess(res, { feedbacks: [] }, FEEDBACK_MESSAGES.NO_FEEDBACKS_FOUND);\r\n        return;\r\n      }\r\n\r\n      this.sendSuccess(res, { feedbacks }, FEEDBACK_MESSAGES.USER_FEEDBACKS_FETCHED);\r\n      logger.info(\"User feedbacks fetched successfully\");\r\n    } catch (error: any) {\r\n      logger.error(`Error fetching user feedbacks: ${error.message}`);\r\n      next(error);\r\n    }\r\n  };\r\n\r\n  getFeedbackForProfile = async (req: Request, res: Response, next: NextFunction): Promise<void> => {\r\n    try {\r\n      const { profileId, profileType } = req.params;\r\n      logger.debug(`Fetching feedbacks for profile: ${profileId}, type: ${profileType}`);\r\n      if (![\"mentor\", \"user\"].includes(profileType)) {\r\n        logger.error(`Invalid profile type: ${profileType}`);\r\n        throw new HttpError(ERROR_MESSAGES.INVALID_PROFILE_TYPE, StatusCodes.BAD_REQUEST);\r\n      }\r\n      const feedbackData = await this._feedbackService.getFeedbackForProfile(profileId, profileType as \"mentor\" | \"user\");\r\n      if (feedbackData.feedbacks.length === 0) {\r\n        this.sendSuccess(res, { feedbacks: [], totalFeedbacks: 0 }, FEEDBACK_MESSAGES.NO_FEEDBACKS_FOUND);\r\n        return;\r\n      }\r\n\r\n      this.sendSuccess(res, feedbackData, FEEDBACK_MESSAGES.PROFILE_FEEDBACKS_FETCHED);\r\n      logger.info(\"Profile feedbacks fetched successfully\");\r\n    } catch (error: any) {\r\n      logger.error(`Error fetching profile feedbacks: ${error.message}`);\r\n      next(error);\r\n    }\r\n  };\r\n\r\n  getFeedbackByCollaborationId = async (req: Request, res: Response, next: NextFunction): Promise<void> => {\r\n    try {\r\n      const { collabId } = req.params;\r\n      logger.debug(`Fetching feedbacks for collaboration: ${collabId}`);\r\n      const feedbacks = await this._feedbackService.getFeedbackByCollaborationId(collabId);\r\n      if (feedbacks.length === 0) {\r\n        this.sendSuccess(res, { feedbacks: [] }, FEEDBACK_MESSAGES.NO_FEEDBACKS_FOUND);\r\n        return;\r\n      }\r\n\r\n      this.sendSuccess(res, { feedbacks }, FEEDBACK_MESSAGES.COLLABORATION_FEEDBACKS_FETCHED);\r\n      logger.info(\"Collaboration feedbacks fetched successfully\");\r\n    } catch (error: any) {\r\n      logger.error(`Error fetching collaboration feedbacks: ${error.message}`);\r\n      next(error);\r\n    }\r\n  };\r\n\r\n  toggleFeedback = async (req: Request, res: Response, next: NextFunction): Promise<void> => {\r\n    try {\r\n      const { feedbackId } = req.params;\r\n      logger.debug(`Toggling feedback visibility: ${feedbackId}`);\r\n      const feedback = await this._feedbackService.toggleFeedback(feedbackId);\r\n      this.sendSuccess(res, { feedback }, FEEDBACK_MESSAGES.FEEDBACK_VISIBILITY_TOGGLED);\r\n      logger.info(`Feedback visibility toggled for: ${feedbackId}`);\r\n    } catch (error: any) {\r\n      logger.error(`Error toggling feedback visibility: ${error.message}`);\r\n      next(error);\r\n    }\r\n  };\r\n\r\n  getFeedbackByMentorId = async (req: Request, res: Response, next: NextFunction): Promise<void> => {\r\n    try {\r\n      const { mentorId } = req.params;\r\n      logger.debug(`Fetching feedbacks by mentor ID: ${mentorId}`);\r\n      const feedbacks = await this._feedbackService.getFeedbackByMentorId(mentorId);\r\n      if (feedbacks.length === 0) {\r\n        this.sendSuccess(res, { feedbacks: [] }, FEEDBACK_MESSAGES.NO_FEEDBACKS_FOUND);\r\n        return;\r\n      }\r\n\r\n      this.sendSuccess(res, { feedbacks }, FEEDBACK_MESSAGES.FEEDBACKS_BY_MENTOR_FETCHED);\r\n      logger.info(\"Feedbacks fetched successfully\");\r\n    } catch (error: any) {\r\n      logger.error(`Error fetching feedbacks by mentor ID: ${error.message}`);\r\n      next(error);\r\n    }\r\n  };\r\n}"]}