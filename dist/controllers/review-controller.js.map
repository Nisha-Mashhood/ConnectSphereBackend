{"version":3,"file":"review-controller.js","sourceRoot":"","sources":["../../src/controllers/review-controller.ts"],"names":[],"mappings":"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","sourcesContent":["import { NextFunction, Request, Response } from 'express';\r\nimport { inject, injectable } from 'inversify';\r\nimport logger from '../core/utils/logger';\r\nimport { IReviewController } from '../Interfaces/Controller/i-review-controller';\r\nimport { HttpError } from '../core/utils/error-handler';\r\nimport { StatusCodes } from \"../enums/status-code-enums\";\r\nimport { BaseController } from '../core/controller/base-controller';\r\nimport { IReviewService } from '../Interfaces/Services/i-review-service';\r\nimport { REVIEW_MESSAGES } from '../constants/messages';\r\nimport { ERROR_MESSAGES } from '../constants/error-messages';\r\n\r\n@injectable()\r\nexport class ReviewController extends BaseController implements IReviewController{\r\n  private _reviewService: IReviewService;\r\n\r\n  constructor(@inject('IReviewService') reviewService : IReviewService) {\r\n    super();\r\n    this._reviewService = reviewService;\r\n  }\r\n\r\n   submitReview = async (req: Request, res: Response, next: NextFunction): Promise<void> => {\r\n    try {\r\n      const { userId, rating, comment } = req.body;\r\n      logger.debug(`Submitting review for user: ${userId}`);\r\n      if (!userId || !rating || !comment) {\r\n        logger.error(\"Missing required fields: userId, rating, or comment\");\r\n        throw new HttpError(ERROR_MESSAGES.REQUIRED_REVIEW_FIELDS, StatusCodes.BAD_REQUEST);\r\n      }\r\n      const review = await this._reviewService.submitReview(userId, rating, comment);\r\n      this.sendCreated(res, review, REVIEW_MESSAGES.REVIEW_SUBMITTED);\r\n    } catch (error: any) {\r\n      logger.error(`Error submitting review: ${error.message}`);\r\n      next(error);\r\n    }\r\n  };\r\n\r\n  skipReview = async (req: Request, res: Response, next: NextFunction): Promise<void> => {\r\n    try {\r\n      const { userId } = req.body;\r\n      logger.debug(`Skipping review for user: ${userId}`);\r\n      if (!userId) {\r\n        logger.error(\"Missing userId\");\r\n        throw new HttpError(ERROR_MESSAGES.REQUIRED_USER_ID, StatusCodes.BAD_REQUEST);\r\n      }\r\n      await this._reviewService.skipReview(userId);\r\n      this.sendSuccess(res, null, REVIEW_MESSAGES.REVIEW_SKIPPED);\r\n    } catch (error: any) {\r\n      logger.error(`Error skipping review: ${error.message}`);\r\n      next(error);\r\n    }\r\n  };\r\n\r\n  getAllReviews = async (req: Request, res: Response, next: NextFunction): Promise<void> => {\r\n  try {\r\n    const page = Number(req.query.page) || 1;\r\n    const limit = Number(req.query.limit) || 10;\r\n    const search = (req.query.search as string) || \"\";\r\n\r\n    logger.debug(\r\n      `Controller: fetching reviews (page=${page}, limit=${limit}, search=${search})`\r\n    );\r\n\r\n    const result = await this._reviewService.getAllReviews({\r\n      page,\r\n      limit,\r\n      search,\r\n    });\r\n\r\n    this.sendSuccess(res, result, REVIEW_MESSAGES.REVIEWS_FETCHED);\r\n  } catch (error: any) {\r\n    logger.error(`Error fetching paginated reviews: ${error.message}`);\r\n    next(error);\r\n  }\r\n};\r\n\r\n  approveReview = async (req: Request, res: Response, next: NextFunction): Promise<void> => {\r\n    try {\r\n      const { reviewId } = req.params;\r\n      logger.debug(`Approving review: ${reviewId}`);\r\n      const review = await this._reviewService.approveReview(reviewId);\r\n      this.sendSuccess(res, review, REVIEW_MESSAGES.REVIEW_APPROVED);\r\n    } catch (error: any) {\r\n      logger.error(`Error approving review: ${error.message}`);\r\n      next(error);\r\n    }\r\n  };\r\n\r\n  selectReview = async (req: Request, res: Response, next: NextFunction): Promise<void> => {\r\n    try {\r\n      const { reviewId } = req.params;\r\n      logger.debug(`Selecting review: ${reviewId}`);\r\n      const review = await this._reviewService.selectReview(reviewId);\r\n      this.sendSuccess(res, review, REVIEW_MESSAGES.REVIEW_SELECTED);\r\n    } catch (error: any) {\r\n      logger.error(`Error selecting review: ${error.message}`);\r\n      next(error);\r\n    }\r\n  };\r\n\r\n  cancelApproval = async (req: Request, res: Response, next: NextFunction): Promise<void> => {\r\n    try {\r\n      const { reviewId } = req.params;\r\n      logger.debug(`Canceling approval for review: ${reviewId}`);\r\n      const review = await this._reviewService.cancelApproval(reviewId);\r\n      this.sendSuccess(res, review, REVIEW_MESSAGES.REVIEW_APPROVAL_CANCELED);\r\n    } catch (error: any) {\r\n      logger.error(`Error canceling approval: ${error.message}`);\r\n      next(error);\r\n    }\r\n  };\r\n\r\n  deselectReview = async (req: Request, res: Response, next: NextFunction): Promise<void> => {\r\n    try {\r\n      const { reviewId } = req.params;\r\n      logger.debug(`Deselecting review: ${reviewId}`);\r\n      const review = await this._reviewService.deselectReview(reviewId);\r\n      this.sendSuccess(res, review, REVIEW_MESSAGES.REVIEW_DESELECTED);\r\n    } catch (error: any) {\r\n      logger.error(`Error deselecting review: ${error.message}`);\r\n      next(error);\r\n    }\r\n  };\r\n\r\n  getSelectedReviews = async (_req: Request, res: Response, next: NextFunction): Promise<void> => {\r\n    try {\r\n      logger.debug(\"Fetching selected reviews\");\r\n      const reviews = await this._reviewService.getSelectedReviews();\r\n      const data = reviews.length === 0 ? [] : reviews;\r\n      const message = reviews.length === 0 ? REVIEW_MESSAGES.NO_REVIEWS_FOUND : REVIEW_MESSAGES.SELECTED_REVIEWS_FETCHED;\r\n\r\n      this.sendSuccess(res, data, message);\r\n    } catch (error: any) {\r\n      logger.error(`Error fetching selected reviews: ${error.message}`);\r\n      next(error);\r\n    }\r\n  };\r\n}"]}