{"version":3,"file":"skills-controller.js","sourceRoot":"","sources":["../../src/controllers/skills-controller.ts"],"names":[],"mappings":"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","sourcesContent":["import { NextFunction, Request, Response } from 'express';\r\nimport { inject, injectable } from 'inversify';\r\nimport { BaseController } from '../core/controller/base-controller';\r\nimport logger from \"../core/utils/logger\";\r\nimport { ISkillsController } from '../Interfaces/Controller/i-skills-controller';\r\nimport { HttpError } from '../core/utils/error-handler';\r\nimport { ISkillsService } from '../Interfaces/Services/i-skills-service';\r\nimport { ISkill } from \"../Interfaces/Models/i-skill\";\r\nimport { SKILL_MESSAGES } from '../constants/messages';\r\nimport { ERROR_MESSAGES } from '../constants/error-messages';\r\nimport { StatusCodes } from '../enums/status-code-enums';\r\n\r\nexport interface SkillRequest extends Request {\r\n  body: Partial<ISkill>;\r\n  params: { id?: string; subcategoryId?: string };\r\n}\r\n\r\n@injectable()\r\nexport class SkillsController extends BaseController implements ISkillsController{\r\n  private _skillsService: ISkillsService;\r\n\r\n  constructor(\r\n    @inject('ISkillsService') skillService : ISkillsService,\r\n  ) {\r\n    super();\r\n    this._skillsService = skillService;\r\n  }\r\n\r\n   createSkill = async (req: SkillRequest, res: Response, next: NextFunction): Promise<void> => {\r\n    try {\r\n      logger.debug(`Creating skill: ${req.body.name}`);\r\n      const imagePath = req.file?.path;\r\n      const fileSize = req.file?.size;\r\n      const skill = await this._skillsService.createSkill(req.body, imagePath, fileSize);\r\n      this.sendCreated(res, skill, SKILL_MESSAGES.SKILL_CREATED);\r\n    } catch (error) {\r\n      next(error);\r\n    }\r\n  };\r\n\r\n  getAllSkills = async (req: Request, res: Response, next: NextFunction): Promise<void> => {\r\n    try {\r\n      const { subcategoryId } = req.params;\r\n      const { search, page, limit } = req.query;\r\n\r\n      const query: any = {};\r\n      if (search) query.search = search as string;\r\n      if (page) query.page = parseInt(page as string, 10);\r\n      if (limit) query.limit = parseInt(limit as string, 10);\r\n\r\n      const result = await this._skillsService.getAllSkills(subcategoryId!, query);\r\n\r\n      if (result.skills.length === 0) {\r\n        this.sendSuccess(\r\n          res,\r\n          { skills: [], total: 0, page: query.page || 1, limit: query.limit || 10 },\r\n          query.search\r\n            ? SKILL_MESSAGES.NO_SKILLS_FOUND\r\n            : SKILL_MESSAGES.NO_SKILLS_FOUND_FOR_SUBCATEGORY\r\n        );\r\n        return;\r\n      }\r\n\r\n      this.sendSuccess(res, {\r\n        skills: result.skills,\r\n        total: result.total,\r\n        page: query.page || 1,\r\n        limit: query.limit || 10,\r\n      }, SKILL_MESSAGES.SKILLS_FETCHED);\r\n    } catch (error) {\r\n      next(error);\r\n    }\r\n  };\r\n\r\n\r\n  getSkillById = async (req: SkillRequest, res: Response, next: NextFunction): Promise<void> => {\r\n    try {\r\n      logger.debug(`Fetching skill: ${req.params.id}`);\r\n      const skill = await this._skillsService.getSkillById(req.params.id!);\r\n      if (!skill) {\r\n        this.sendSuccess(res, \"\", SKILL_MESSAGES.NO_SKILLS_FOUND);\r\n        logger.info(\"No skills found\");\r\n        return;\r\n      }\r\n      this.sendSuccess(res, skill, SKILL_MESSAGES.SKILL_FETCHED);\r\n    } catch (error) {\r\n      next(error);\r\n    }\r\n  };\r\n\r\n  updateSkill = async (req: SkillRequest, res: Response, next: NextFunction): Promise<void> => {\r\n    try {\r\n      logger.debug(`Updating skill: ${req.params.id}`);\r\n      const imagePath = req.file?.path;\r\n      const fileSize = req.file?.size;\r\n      const updatedSkill = await this._skillsService.updateSkill(req.params.id!, req.body, imagePath, fileSize);\r\n      if (!updatedSkill) {\r\n        throw new HttpError(ERROR_MESSAGES.SKILL_NOT_FOUND, StatusCodes.NOT_FOUND);\r\n      }\r\n      this.sendSuccess(res, updatedSkill, SKILL_MESSAGES.SKILL_UPDATED);\r\n    } catch (error) {\r\n      next(error);\r\n    }\r\n  };\r\n\r\n  deleteSkill = async (req: SkillRequest, res: Response, next: NextFunction): Promise<void> => {\r\n    try {\r\n      logger.debug(`Deleting skill: ${req.params.id}`);\r\n      const deletedSkill = await this._skillsService.deleteSkill(req.params.id!);\r\n      if (!deletedSkill) {\r\n        throw new HttpError(ERROR_MESSAGES.SKILL_NOT_FOUND, StatusCodes.NOT_FOUND);\r\n      }\r\n      this.sendNoContent(res, SKILL_MESSAGES.SKILL_DELETED);\r\n    } catch (error) {\r\n      next(error);\r\n    }\r\n  };\r\n\r\n  getSkills = async (_req: Request, res: Response, next: NextFunction): Promise<void> => {\r\n    try {\r\n      logger.debug(\"Fetching all skills (name and ID only)\");\r\n      const skills = await this._skillsService.getSkills();\r\n      if (skills.length === 0) {\r\n        this.sendSuccess(res, [], SKILL_MESSAGES.NO_SKILLS_FOUND);\r\n        logger.info(\"No skills found\");\r\n        return;\r\n      }\r\n      this.sendSuccess(res, skills, SKILL_MESSAGES.SKILLS_FETCHED);\r\n    } catch (error) {\r\n      logger.error(`Error fetching skills: ${error}`);\r\n      next(error);\r\n    }\r\n  };\r\n}"]}