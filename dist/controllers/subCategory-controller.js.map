{"version":3,"file":"subCategory-controller.js","sourceRoot":"","sources":["../../src/controllers/subCategory-controller.ts"],"names":[],"mappings":"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","sourcesContent":["import { NextFunction, Request, Response } from 'express';\r\nimport { inject, injectable } from 'inversify';\r\nimport { ISubcategory } from \"../Interfaces/Models/i-sub-category\";\r\nimport { BaseController } from '../core/controller/base-controller';\r\nimport logger from \"../core/utils/logger\";\r\nimport { ISubcategoryController } from '../Interfaces/Controller/i-sub-category-controller';\r\nimport { HttpError } from '../core/utils/error-handler';\r\nimport { ISubcategoryService } from '../Interfaces/Services/i-sub-category-service';\r\nimport { SUBCATEGORY_MESSAGES } from '../constants/messages';\r\nimport { ERROR_MESSAGES } from '../constants/error-messages';\r\nimport { StatusCodes } from '../enums/status-code-enums';\r\n\r\n\r\ninterface SubcategoryRequest extends Request {\r\n  body: Partial<ISubcategory>;\r\n  params: { id?: string; categoryId?: string };\r\n}\r\n\r\n@injectable()\r\nexport class SubcategoryController extends BaseController implements ISubcategoryController{\r\n  private _subcategoryService: ISubcategoryService;\r\n\r\n  constructor(\r\n    @inject('ISubCategoryService') subCategoryService : ISubcategoryService,\r\n) {\r\n    super();\r\n    this._subcategoryService = subCategoryService;\r\n  }\r\n\r\n   createSubcategory = async (req: SubcategoryRequest, res: Response, next: NextFunction): Promise<void> => {\r\n    try {\r\n      logger.debug(`Creating subcategory: ${req.body.name}`);\r\n      const imagePath = req.file?.path;\r\n      const fileSize = req.file?.size;\r\n      const subcategory = await this._subcategoryService.createSubcategory(req.body, imagePath, fileSize);\r\n      this.sendCreated(res, subcategory, SUBCATEGORY_MESSAGES.SUBCATEGORY_CREATED);\r\n    } catch (error) {\r\n      next(error);\r\n    }\r\n  };\r\n\r\n  getAllSubcategories = async (req: SubcategoryRequest, res: Response, next: NextFunction): Promise<void> => {\r\n    logger.debug(`Fetching subcategories for category: ${req.params.categoryId}`);\r\n    try {\r\n          const { categoryId } = req.params;\r\n          const { search, page, limit } = req.query;\r\n          const query: any = {};\r\n    \r\n          if (search) query.search = search as string;\r\n          if (page) query.page = parseInt(page as string, 10);\r\n          if (limit) query.limit = parseInt(limit as string, 10);\r\n    \r\n          logger.debug(`Fetching sub-categories with query: ${JSON.stringify(query)}`);\r\n    \r\n          const result = await this._subcategoryService.getAllSubcategories(categoryId!, query);\r\n    \r\n          if (!search) {\r\n            if (result.subcategories.length === 0) {\r\n              this.sendSuccess(res, { subcategories: [], \r\n              total: result.total,\r\n              page: query.page || 1,\r\n              limit: query.limit || 10, \r\n            }, SUBCATEGORY_MESSAGES.NO_SUBCATEGORIES_FOUND);\r\n              logger.info(\"No sub-categories found\");\r\n              return;\r\n            }\r\n            this.sendSuccess(res, { \r\n              subcategories: result.subcategories, \r\n              total: result.total,\r\n              page: query.page || 1,\r\n              limit: query.limit || 10, \r\n            }, SUBCATEGORY_MESSAGES.SUBCATEGORIES_FETCHED);\r\n            logger.info(`Fetched ${result.subcategories.length} sub-categories`);\r\n            return;\r\n          }\r\n    \r\n          if (result.subcategories.length === 0) {\r\n            this.sendSuccess(\r\n              res,\r\n              {\r\n                subcategories: [],\r\n                total: 0,\r\n                page: query.page || 1,\r\n                limit: query.limit || 10,\r\n              },\r\n              query.search ? SUBCATEGORY_MESSAGES.NO_SUBCATEGORIES_FOUND : SUBCATEGORY_MESSAGES.NO_SUBCATEGORIES_FOUND\r\n            );\r\n            logger.info(`No categories found for query: ${JSON.stringify(query)}`);\r\n            return;\r\n          }\r\n    \r\n          this.sendSuccess(\r\n            res,\r\n            {\r\n              subcategories: result.subcategories,\r\n              total: result.total,\r\n              page: query.page || 1,\r\n              limit: query.limit || 10,\r\n            },\r\n            SUBCATEGORY_MESSAGES.SUBCATEGORIES_FETCHED\r\n          );\r\n        } catch (error) {\r\n          logger.error(`Error fetching sub-categories: ${error}`);\r\n          next(error);\r\n        }\r\n  };\r\n\r\n  getSubcategoryById = async (req: SubcategoryRequest, res: Response, next: NextFunction): Promise<void> => {\r\n    try {\r\n      logger.debug(`Fetching subcategory: ${req.params.id}`);\r\n      const subcategory = await this._subcategoryService.getSubcategoryById(req.params.id!);\r\n      if (!subcategory) {\r\n        throw new HttpError(ERROR_MESSAGES.SUBCATEGORY_NOT_FOUND, StatusCodes.NOT_FOUND);\r\n      }\r\n      this.sendSuccess(res, subcategory, SUBCATEGORY_MESSAGES.SUBCATEGORY_FETCHED);\r\n    } catch (error) {\r\n      next(error);\r\n    }\r\n  };\r\n\r\n  updateSubcategory = async (req: SubcategoryRequest, res: Response, next: NextFunction): Promise<void> => {\r\n    try {\r\n      logger.debug(`Updating subcategory: ${req.params.id}`);\r\n      const imagePath = req.file?.path;\r\n      const fileSize = req.file?.size;\r\n      const updatedSubcategory = await this._subcategoryService.updateSubcategory(req.params.id!, req.body, imagePath, fileSize);\r\n      if (!updatedSubcategory) {\r\n        throw new HttpError(ERROR_MESSAGES.SUBCATEGORY_NOT_FOUND, StatusCodes.NOT_FOUND);\r\n      }\r\n      this.sendSuccess(res, updatedSubcategory, SUBCATEGORY_MESSAGES.SUBCATEGORY_UPDATED);\r\n    } catch (error) {\r\n      next(error);\r\n    }\r\n  };\r\n\r\n  deleteSubcategory = async (req: SubcategoryRequest, res: Response, next: NextFunction): Promise<void> => {\r\n    try {\r\n      logger.debug(`Deleting subcategory: ${req.params.id}`);\r\n      const deletedSubcategory = await this._subcategoryService.deleteSubcategory(req.params.id!);\r\n      if (!deletedSubcategory) {\r\n        throw new HttpError(ERROR_MESSAGES.SUBCATEGORY_NOT_FOUND, StatusCodes.NOT_FOUND);\r\n      }\r\n      this.sendNoContent(res, SUBCATEGORY_MESSAGES.SUBCATEGORY_DELETED);\r\n    } catch (error) {\r\n      next(error);\r\n    }\r\n  };\r\n}"]}