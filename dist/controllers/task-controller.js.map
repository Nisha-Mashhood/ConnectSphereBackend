{"version":3,"file":"task-controller.js","sourceRoot":"","sources":["../../src/controllers/task-controller.ts"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;AACA,yCAA+C;AAC/C,kEAA0C;AAE1C,uCAAiC;AAEjC,+DAAwD;AACxD,kEAAyD;AACzD,wEAAoE;AAEpE,oDAAsD;AACtD,gEAA6D;AAGtD,IAAM,cAAc,GAApB,MAAM,cAAe,SAAQ,gCAAc;IAGhD,YAAoC,WAA0B;QAC5D,KAAK,EAAE,CAAC;QAgBT,eAAU,GAAG,KAAK,EAAE,GAAY,EAAE,GAAa,EAAE,IAAkB,EAAiB,EAAE;YACrF,IAAI,CAAC;gBACH,MAAM,EAAE,EAAE,EAAE,GAAG,GAAG,CAAC,MAAM,CAAC;gBAC1B,MAAM,SAAS,GAAG,GAAG,CAAC,IAAI,EAAE,IAAI,CAAC;gBACjC,MAAM,QAAQ,GAAG,GAAG,CAAC,IAAI,EAAE,IAAI,CAAC;gBAChC,MAAM,QAAQ,GAAmB,GAAG,CAAC,IAAI,CAAC,QAAQ,CAAC,CAAC,CAAC,IAAI,CAAC,KAAK,CAAC,GAAG,CAAC,IAAI,CAAC,QAAQ,CAAC,CAAC,CAAC,CAAC,GAAG,CAAC,IAAI,CAAC;gBAC9F,QAAQ,CAAC,SAAS,GAAG,IAAI,CAAC,UAAU,CAAC,EAAE,CAAC,CAAC;gBACzC,gBAAM,CAAC,KAAK,CAAC,2BAA2B,EAAE,WAAW,QAAQ,CAAC,IAAI,EAAE,CAAC,CAAC;gBACtE,MAAM,OAAO,GAAG,MAAM,IAAI,CAAC,YAAY,CAAC,UAAU,CAAC,QAAQ,EAAE,SAAS,EAAE,QAAQ,CAAC,CAAC;gBAClF,IAAI,CAAC,WAAW,CAAC,GAAG,EAAE,OAAO,EAAE,wBAAa,CAAC,YAAY,CAAC,CAAC;YAC7D,CAAC;YAAC,OAAO,KAAU,EAAE,CAAC;gBACpB,gBAAM,CAAC,KAAK,CAAC,wBAAwB,KAAK,CAAC,OAAO,EAAE,CAAC,CAAC;gBACtD,IAAI,CAAC,KAAK,CAAC,CAAC;YACd,CAAC;QACH,CAAC,CAAC;QAEF,sBAAiB,GAAG,KAAK,EAAE,GAAY,EAAE,GAAa,EAAE,IAAkB,EAAiB,EAAE;YAC3F,IAAI,CAAC;gBACH,MAAM,EAAE,WAAW,EAAE,SAAS,EAAE,MAAM,EAAE,GAAG,GAAG,CAAC,MAAM,CAAC;gBACtD,gBAAM,CAAC,KAAK,CAAC,kCAAkC,WAAW,eAAe,SAAS,YAAY,MAAM,EAAE,CAAC,CAAC;gBACxG,MAAM,KAAK,GAAG,MAAM,IAAI,CAAC,YAAY,CAAC,iBAAiB,CAAC,WAAW,EAAE,SAAS,EAAE,MAAM,CAAC,CAAC;gBAExF,MAAM,IAAI,GAAG,KAAK,CAAC,MAAM,KAAK,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,KAAK,CAAC;gBAC7C,MAAM,OAAO,GAAG,KAAK,CAAC,MAAM,KAAK,CAAC,CAAC,CAAC,CAAC,wBAAa,CAAC,cAAc,CAAC,CAAC,CAAC,wBAAa,CAAC,aAAa,CAAC;gBAChG,IAAI,CAAC,WAAW,CAAC,GAAG,EAAE,IAAI,EAAE,OAAO,CAAC,CAAC;YACvC,CAAC;YAAC,OAAO,KAAU,EAAE,CAAC;gBACpB,gBAAM,CAAC,KAAK,CAAC,yBAAyB,KAAK,CAAC,OAAO,EAAE,CAAC,CAAC;gBACvD,IAAI,CAAC,KAAK,CAAC,CAAC;YACd,CAAC;QACH,CAAC,CAAC;QAEF,uBAAkB,GAAG,KAAK,EAAE,GAAY,EAAE,GAAa,EAAE,IAAkB,EAAiB,EAAE;YAC5F,IAAI,CAAC;gBACH,MAAM,EAAE,MAAM,EAAE,GAAG,GAAG,CAAC,MAAM,CAAC;gBAC9B,MAAM,EAAE,QAAQ,EAAE,GAAG,GAAG,CAAC,IAAI,CAAC;gBAC9B,gBAAM,CAAC,KAAK,CAAC,kCAAkC,MAAM,cAAc,QAAQ,EAAE,CAAC,CAAC;gBAC/E,MAAM,WAAW,GAAG,MAAM,IAAI,CAAC,YAAY,CAAC,kBAAkB,CAAC,MAAM,EAAE,QAAQ,CAAC,CAAC;gBACjF,IAAI,CAAC,WAAW,EAAE,CAAC;oBACjB,MAAM,IAAI,yBAAS,CAAC,+BAAc,CAAC,cAAc,EAAE,+BAAW,CAAC,SAAS,CAAC,CAAC;gBAC5E,CAAC;gBACD,IAAI,CAAC,WAAW,CAAC,GAAG,EAAE,WAAW,EAAE,wBAAa,CAAC,qBAAqB,CAAC,CAAC;YAC1E,CAAC;YAAC,OAAO,KAAU,EAAE,CAAC;gBACpB,gBAAM,CAAC,KAAK,CAAC,iCAAiC,KAAK,CAAC,OAAO,EAAE,CAAC,CAAC;gBAC/D,IAAI,CAAC,KAAK,CAAC,CAAC;YACd,CAAC;QACH,CAAC,CAAC;QAEF,qBAAgB,GAAG,KAAK,EAAE,GAAY,EAAE,GAAa,EAAE,IAAkB,EAAiB,EAAE;YAC1F,IAAI,CAAC;gBACH,MAAM,EAAE,MAAM,EAAE,GAAG,GAAG,CAAC,MAAM,CAAC;gBAC9B,MAAM,EAAE,MAAM,EAAE,GAAG,GAAG,CAAC,IAAI,CAAC;gBAC5B,gBAAM,CAAC,KAAK,CAAC,gCAAgC,MAAM,YAAY,MAAM,EAAE,CAAC,CAAC;gBACzE,MAAM,WAAW,GAAG,MAAM,IAAI,CAAC,YAAY,CAAC,gBAAgB,CAAC,MAAM,EAAE,MAAM,CAAC,CAAC;gBAC7E,IAAI,CAAC,WAAW,EAAE,CAAC;oBACjB,MAAM,IAAI,yBAAS,CAAC,+BAAc,CAAC,cAAc,EAAE,+BAAW,CAAC,SAAS,CAAC,CAAC;gBAC5E,CAAC;gBACD,IAAI,CAAC,WAAW,CAAC,GAAG,EAAE,WAAW,EAAE,wBAAa,CAAC,mBAAmB,CAAC,CAAC;YACxE,CAAC;YAAC,OAAO,KAAU,EAAE,CAAC;gBACpB,gBAAM,CAAC,KAAK,CAAC,+BAA+B,KAAK,CAAC,OAAO,EAAE,CAAC,CAAC;gBAC7D,IAAI,CAAC,KAAK,CAAC,CAAC;YACd,CAAC;QACH,CAAC,CAAC;QAEF,aAAQ,GAAG,KAAK,EAAE,GAAY,EAAE,GAAa,EAAE,IAAkB,EAAiB,EAAE;YAClF,IAAI,CAAC;gBACH,MAAM,EAAE,MAAM,EAAE,GAAG,GAAG,CAAC,MAAM,CAAC;gBAC9B,MAAM,OAAO,GACb,GAAG,CAAC,IAAI,CAAC,QAAQ,CAAC,CAAC,CAAC,IAAI,CAAC,KAAK,CAAC,GAAG,CAAC,IAAI,CAAC,QAAQ,CAAC,CAAC,CAAC,CAAC,GAAG,CAAC,IAAI,CAAC;gBAE7D,gBAAM,CAAC,KAAK,CAAC,wCAAwC,GAAG,IAAI,CAAC,SAAS,CAAC;oBACrE,MAAM;oBACN,OAAO;oBACP,aAAa,EAAE,OAAO,EAAE,aAAa;iBACtC,CAAC,CAAC,CAAC;gBACJ,gBAAM,CAAC,KAAK,CAAC,wBAAwB,MAAM,EAAE,CAAC,CAAC;gBAC/C,MAAM,WAAW,GAAG,MAAM,IAAI,CAAC,YAAY,CAAC,QAAQ,CAAC,MAAM,EAAE,OAAO,CAAC,CAAC;gBACtE,IAAI,CAAC,WAAW,EAAE,CAAC;oBACjB,MAAM,IAAI,yBAAS,CAAC,+BAAc,CAAC,cAAc,EAAE,+BAAW,CAAC,SAAS,CAAC,CAAC;gBAC5E,CAAC;gBACD,IAAI,CAAC,WAAW,CAAC,GAAG,EAAE,WAAW,EAAE,wBAAa,CAAC,YAAY,CAAC,CAAC;YACjE,CAAC;YAAC,OAAO,KAAU,EAAE,CAAC;gBACpB,gBAAM,CAAC,KAAK,CAAC,uBAAuB,KAAK,CAAC,OAAO,EAAE,CAAC,CAAC;gBACrD,IAAI,CAAC,KAAK,CAAC,CAAC;YACd,CAAC;QACH,CAAC,CAAC;QAEF,eAAU,GAAG,KAAK,EAAE,GAAY,EAAE,GAAa,EAAE,IAAkB,EAAiB,EAAE;YACpF,IAAI,CAAC;gBACH,MAAM,EAAE,MAAM,EAAE,GAAG,GAAG,CAAC,MAAM,CAAC;gBAC9B,gBAAM,CAAC,KAAK,CAAC,kBAAkB,MAAM,EAAE,CAAC,CAAC;gBACzC,MAAM,IAAI,CAAC,YAAY,CAAC,UAAU,CAAC,MAAM,CAAC,CAAC;gBAC3C,IAAI,CAAC,WAAW,CAAC,GAAG,EAAE,IAAI,EAAE,wBAAa,CAAC,YAAY,CAAC,CAAC;YAC1D,CAAC;YAAC,OAAO,KAAU,EAAE,CAAC;gBACpB,gBAAM,CAAC,KAAK,CAAC,wBAAwB,KAAK,CAAC,OAAO,EAAE,CAAC,CAAC;gBACtD,IAAI,CAAC,KAAK,CAAC,CAAC;YACd,CAAC;QACH,CAAC,CAAC;QA/GA,IAAI,CAAC,YAAY,GAAG,WAAW,CAAC;IAClC,CAAC;IAEO,UAAU,CAAC,EAAU;QAC3B,IAAI,CAAC,EAAE,EAAE,CAAC;YACR,gBAAM,CAAC,KAAK,CAAC,YAAY,CAAC,CAAC;YAC3B,MAAM,IAAI,yBAAS,CAAC,4BAA4B,EAAE,+BAAW,CAAC,WAAW,CAAC,CAAC;QAC7E,CAAC;QACD,IAAI,CAAC,gBAAK,CAAC,QAAQ,CAAC,OAAO,CAAC,EAAE,CAAC,EAAE,CAAC;YAChC,gBAAM,CAAC,KAAK,CAAC,eAAe,EAAE,EAAE,CAAC,CAAC;YAClC,MAAM,IAAI,yBAAS,CAAC,+CAA+C,EAAE,+BAAW,CAAC,WAAW,CAAC,CAAC;QAChG,CAAC;QACD,OAAO,IAAI,gBAAK,CAAC,QAAQ,CAAC,EAAE,CAAC,CAAC;IAChC,CAAC;CAmGF,CAAA;AArHY,wCAAc;yBAAd,cAAc;IAD1B,IAAA,sBAAU,GAAE;IAIE,WAAA,IAAA,kBAAM,EAAC,cAAc,CAAC,CAAA;;GAHxB,cAAc,CAqH1B","sourcesContent":["import { NextFunction, Request, Response } from 'express';\r\nimport { inject, injectable } from 'inversify';\r\nimport logger from '../core/utils/logger';\r\nimport { ITask } from '../Interfaces/Models/i-task';\r\nimport { Types } from 'mongoose';\r\nimport { ITaskController } from '../Interfaces/Controller/i-task-controller';\r\nimport { HttpError } from '../core/utils/error-handler';\r\nimport { StatusCodes } from \"../enums/status-code-enums\";\r\nimport { BaseController } from '../core/controller/base-controller';\r\nimport { ITaskService } from '../Interfaces/Services/i-task-service';\r\nimport { TASK_MESSAGES } from '../constants/messages';\r\nimport { ERROR_MESSAGES } from '../constants/error-messages';\r\n\r\n@injectable()\r\nexport class TaskController extends BaseController implements ITaskController{\r\n  private _taskService: ITaskService;\r\n\r\n  constructor(@inject('ITaskService') taskService : ITaskService) {\r\n    super();\r\n    this._taskService = taskService;\r\n  }\r\n\r\n  private toObjectId(id: string): Types.ObjectId {\r\n    if (!id) {\r\n      logger.error('Missing ID');\r\n      throw new HttpError('Invalid ID: ID is required', StatusCodes.BAD_REQUEST);\r\n    }\r\n    if (!Types.ObjectId.isValid(id)) {\r\n      logger.error(`Invalid ID: ${id}`);\r\n      throw new HttpError('Invalid ID: must be a 24 character hex string', StatusCodes.BAD_REQUEST);\r\n    }\r\n    return new Types.ObjectId(id);\r\n  }\r\n\r\n   createTask = async (req: Request, res: Response, next: NextFunction): Promise<void> => {\r\n    try {\r\n      const { id } = req.params;\r\n      const imagePath = req.file?.path;\r\n      const fileSize = req.file?.size;\r\n      const taskData: Partial<ITask> = req.body.taskData ? JSON.parse(req.body.taskData) : req.body;\r\n      taskData.createdBy = this.toObjectId(id);\r\n      logger.debug(`Creating task for user: ${id}, task: ${taskData.name}`);\r\n      const newTask = await this._taskService.createTask(taskData, imagePath, fileSize);\r\n      this.sendCreated(res, newTask, TASK_MESSAGES.TASK_CREATED);\r\n    } catch (error: any) {\r\n      logger.error(`Error creating task: ${error.message}`);\r\n      next(error);\r\n    }\r\n  };\r\n\r\n  getTasksByContext = async (req: Request, res: Response, next: NextFunction): Promise<void> => {\r\n    try {\r\n      const { contextType, contextId, userId } = req.params;\r\n      logger.debug(`Fetching tasks for contextType=${contextType}, contextId=${contextId}, userId=${userId}`);\r\n      const tasks = await this._taskService.getTasksByContext(contextType, contextId, userId);\r\n\r\n      const data = tasks.length === 0 ? [] : tasks;\r\n      const message = tasks.length === 0 ? TASK_MESSAGES.NO_TASKS_FOUND : TASK_MESSAGES.TASKS_FETCHED;\r\n      this.sendSuccess(res, data, message);\r\n    } catch (error: any) {\r\n      logger.error(`Error fetching tasks: ${error.message}`);\r\n      next(error);\r\n    }\r\n  };\r\n\r\n  updateTaskPriority = async (req: Request, res: Response, next: NextFunction): Promise<void> => {\r\n    try {\r\n      const { taskId } = req.params;\r\n      const { priority } = req.body;\r\n      logger.debug(`Updating task priority: taskId=${taskId}, priority=${priority}`);\r\n      const updatedTask = await this._taskService.changeTaskPriority(taskId, priority);\r\n      if (!updatedTask) {\r\n        throw new HttpError(ERROR_MESSAGES.TASK_NOT_FOUND, StatusCodes.NOT_FOUND);\r\n      }\r\n      this.sendSuccess(res, updatedTask, TASK_MESSAGES.TASK_PRIORITY_UPDATED);\r\n    } catch (error: any) {\r\n      logger.error(`Error updating task priority: ${error.message}`);\r\n      next(error);\r\n    }\r\n  };\r\n\r\n  updateTaskStatus = async (req: Request, res: Response, next: NextFunction): Promise<void> => {\r\n    try {\r\n      const { taskId } = req.params;\r\n      const { status } = req.body;\r\n      logger.debug(`Updating task status: taskId=${taskId}, status=${status}`);\r\n      const updatedTask = await this._taskService.changeTaskStatus(taskId, status);\r\n      if (!updatedTask) {\r\n        throw new HttpError(ERROR_MESSAGES.TASK_NOT_FOUND, StatusCodes.NOT_FOUND);\r\n      }\r\n      this.sendSuccess(res, updatedTask, TASK_MESSAGES.TASK_STATUS_UPDATED);\r\n    } catch (error: any) {\r\n      logger.error(`Error updating task status: ${error.message}`);\r\n      next(error);\r\n    }\r\n  };\r\n\r\n  editTask = async (req: Request, res: Response, next: NextFunction): Promise<void> => {\r\n    try {\r\n      const { taskId } = req.params;\r\n      const updates: Partial<ITask> =\r\n      req.body.taskData ? JSON.parse(req.body.taskData) : req.body;\r\n\r\n      logger.debug(\"ðŸ”µ CONTROLLER â†’ Received task update: \" + JSON.stringify({\r\n        taskId,\r\n        updates,\r\n        assignedUsers: updates?.assignedUsers\r\n      }));\r\n      logger.debug(`Editing task: taskId=${taskId}`);\r\n      const updatedTask = await this._taskService.editTask(taskId, updates);\r\n      if (!updatedTask) {\r\n        throw new HttpError(ERROR_MESSAGES.TASK_NOT_FOUND, StatusCodes.NOT_FOUND);\r\n      }\r\n      this.sendSuccess(res, updatedTask, TASK_MESSAGES.TASK_UPDATED);\r\n    } catch (error: any) {\r\n      logger.error(`Error editing task: ${error.message}`);\r\n      next(error);\r\n    }\r\n  };\r\n\r\n  deleteTask = async (req: Request, res: Response, next: NextFunction): Promise<void> => {\r\n    try {\r\n      const { taskId } = req.params;\r\n      logger.debug(`Deleting task: ${taskId}`);\r\n      await this._taskService.deleteTask(taskId);\r\n      this.sendSuccess(res, null, TASK_MESSAGES.TASK_DELETED);\r\n    } catch (error: any) {\r\n      logger.error(`Error deleting task: ${error.message}`);\r\n      next(error);\r\n    }\r\n  };\r\n}"]}