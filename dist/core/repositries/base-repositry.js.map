{"version":3,"file":"base-repositry.js","sourceRoot":"","sources":["../../../src/core/repositries/base-repositry.ts"],"names":[],"mappings":"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","sourcesContent":["import { Model, Document, FilterQuery, UpdateQuery, ClientSession } from 'mongoose';\r\nimport { IBaseRepository } from '../interfaces/Ibase-repositry';\r\nimport logger from '../utils/logger';\r\nimport { RepositoryError } from '../utils/error-handler';\r\nimport { ERROR_MESSAGES } from '../../constants/error-messages';\r\n\r\n// Base class for Basic DataBase Operations\r\nexport abstract class BaseRepository<T extends Document> implements IBaseRepository<T> {\r\n  protected model: Model<T>;\r\n\r\n  // Constructor for Initializing the Model\r\n  constructor(model: Model<T>) {\r\n    this.model = model;\r\n    logger.debug(`Initialized repository for model: ${model.modelName}`);\r\n  }\r\n\r\n  // Create a new entity\r\n  create = async (data: Partial<T>, session?: ClientSession): Promise<T> => {\r\n    try {\r\n    const entity = new this.model(data);\r\n    const result = session\r\n      ? await entity.save({ session })\r\n      : await entity.save();\r\n\r\n    logger.info(`Created entity in ${this.model.modelName}: ${result._id}`);\r\n    return result;\r\n  } catch (error: any) {\r\n    logger.error(`Error creating entity in ${this.model.modelName}: ${error.message}`);\r\n    throw new RepositoryError(\r\n      `${ERROR_MESSAGES.FAILED_TO_CREATE_ENTITY} in ${this.model.modelName}`\r\n    );\r\n  }\r\n  }\r\n\r\n  // Find an entity by ID\r\n  findById = async (id?: string): Promise<T | null> => {\r\n    try {\r\n      const result = await this.model.findById(id).exec();\r\n      logger.debug(`Found entity in ${this.model.modelName} by ID: ${id}`);\r\n      return result;\r\n    } catch (error: any) {\r\n      logger.error(`Error finding entity in ${this.model.modelName} by ID ${id}: ${error.message}`);\r\n      throw new RepositoryError(`${ERROR_MESSAGES.FAILED_TO_FIND_ENTITY_BY_ID} ${id} in ${this.model.modelName}`);\r\n    }\r\n  }\r\n\r\n  // Find one entity matching the query\r\n  findOne = async (query: FilterQuery<T>): Promise<T | null> => {\r\n    try {\r\n      const result = await this.model.findOne(query).exec();\r\n      logger.debug(`Found entity in ${this.model.modelName} with query: ${JSON.stringify(query)}`);\r\n      return result;\r\n    } catch (error: any) {\r\n      logger.error(`Error finding entity in ${this.model.modelName} with query ${JSON.stringify(query)}: ${error.message}`);\r\n      throw new RepositoryError(`${ERROR_MESSAGES.FAILED_TO_FIND_ENTITY} in ${this.model.modelName}`);\r\n    }\r\n  }\r\n\r\n  // Find all entities\r\n  findAll = async (): Promise<T[]> => {\r\n    try {\r\n      const result = await this.model.find().exec();\r\n      logger.debug(`Retrieved ${result.length} entities from ${this.model.modelName}`);\r\n      return result;\r\n    } catch (error: any) {\r\n      logger.error(`Error retrieving entities from ${this.model.modelName}: ${error.message}`);\r\n      throw new RepositoryError(`${ERROR_MESSAGES.FAILED_TO_RETRIEVE_ENTITIES} from ${this.model.modelName}`);\r\n    }\r\n  }\r\n\r\n  // Update an entity by ID\r\n  update = async ( id: string, data: Partial<T>, session?: ClientSession ): Promise<T | null> => {\r\n    try {\r\n      const result = await this.model\r\n        .findByIdAndUpdate(id, data, { new: true, session })\r\n        .exec();\r\n      logger.info(`Updated entity in ${this.model.modelName}: ${id}`);\r\n      return result;\r\n    } catch (error: any) {\r\n      logger.error(\r\n        `Error updating entity in ${this.model.modelName} with ID ${id}: ${error.message}`\r\n      );\r\n      throw new RepositoryError(\r\n        `${ERROR_MESSAGES.FAILED_TO_UPDATE_ENTITY} with ID ${id} in ${this.model.modelName}`\r\n      );\r\n    }\r\n  };\r\n\r\n  // Delete an entity by ID\r\n  delete = async (id: string, session?: ClientSession): Promise<boolean> => {\r\n    try {\r\n      const result = await this.model\r\n        .findByIdAndDelete(id, { session })\r\n        .exec();\r\n      logger.info(`Deleted entity in ${this.model.modelName}: ${id}`);\r\n      return !!result;\r\n    } catch (error: any) {\r\n      logger.error(\r\n        `Error deleting entity in ${this.model.modelName} with ID ${id}: ${error.message}`\r\n      );\r\n      throw new RepositoryError(\r\n        `${ERROR_MESSAGES.FAILED_TO_DELETE_ENTITY} with ID ${id} in ${this.model.modelName}`\r\n      );\r\n    }\r\n  };\r\n\r\n  // Update an entity by ID\r\n  findByIdAndUpdate = async ( id: string, update: UpdateQuery<T>, options: { new?: boolean } = { new: true }, session?: ClientSession ): Promise<T | null> => {\r\n    try {\r\n      const result = await this.model\r\n        .findByIdAndUpdate(id, update, { ...options, session })\r\n        .exec();\r\n      logger.info(`Updated entity in ${this.model.modelName} with ID ${id}`);\r\n      return result;\r\n    } catch (error: any) {\r\n      logger.error(\r\n        `Error updating entity in ${this.model.modelName} with ID ${id}: ${error.message}`\r\n      );\r\n      throw new RepositoryError(\r\n        `${ERROR_MESSAGES.FAILED_TO_UPDATE_ENTITY} with ID ${id} in ${this.model.modelName}`\r\n      );\r\n    }\r\n  };\r\n\r\n  // Delete an entity by ID\r\n  findByIdAndDelete = async ( id: string, session?: ClientSession ): Promise<T | null> => {\r\n    try {\r\n      const result = await this.model\r\n        .findByIdAndDelete(id, { session })\r\n        .exec();\r\n      logger.info(`Deleted entity in ${this.model.modelName}: ${id}`);\r\n      return result;\r\n    } catch (error: any) {\r\n      logger.error(\r\n        `Error deleting entity in ${this.model.modelName} with ID ${id}: ${error.message}`\r\n      );\r\n      throw new RepositoryError(\r\n        `${ERROR_MESSAGES.FAILED_TO_DELETE_ENTITY} with ID ${id} in ${this.model.modelName}`\r\n      );\r\n    }\r\n  };\r\n}"]}