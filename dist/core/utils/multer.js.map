{"version":3,"file":"multer.js","sourceRoot":"","sources":["../../../src/core/utils/multer.ts"],"names":[],"mappings":"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","sourcesContent":["import multer from \"multer\";\r\nimport path from \"path\";\r\nimport { Request, Response, NextFunction } from \"express\";\r\n\r\n// Define storage for multer\r\nconst storage = multer.diskStorage({\r\n  destination: (_req, _file, cb) => {\r\n    cb(null, \"uploads/\");\r\n  },\r\n  filename: (_req, file, cb) => {\r\n    cb(null, `${Date.now()}-${file.originalname}`);\r\n  },\r\n});\r\n\r\n// File type validation\r\nconst fileFilter = (_req: any, file: any, cb: any) => {\r\n  const allowedFileTypes = [\r\n    \"image/jpeg\",\r\n    \"image/jpg\",\r\n    \"image/png\",\r\n    \"video/mp4\",\r\n    \"application/pdf\",\r\n    \"application/msword\", // .doc\r\n    \"application/vnd.openxmlformats-officedocument.wordprocessingml.document\", // DOCX\r\n  ];\r\n\r\n  const mimetype = allowedFileTypes.includes(file.mimetype);\r\n  const extname = allowedFileTypes.some(type =>\r\n    path.extname(file.originalname).toLowerCase() === `.${type.split(\"/\")[1]}`\r\n  );\r\n\r\n  if (mimetype && extname) {\r\n    cb(null, true);\r\n  } else {\r\n    cb(new Error(\"Invalid file type. Only JPEG, JPG, PNG, MP4, PDF, DOC, and DOCX are allowed.\"), false);\r\n  }\r\n};\r\n\r\n// Multer configuration\r\nconst multerInstance = multer({\r\n  storage,\r\n  fileFilter,\r\n  limits: { fileSize: 50 * 1024 * 1024 }, // 50MB limit\r\n});\r\n\r\n// Custom error-handling wrapper for Multer\r\nconst createMulterMiddleware = (multerMethod: any) => {\r\n  return (req: Request, res: Response, next: NextFunction) => {\r\n    multerMethod(req, res, (err: Error |  multer.MulterError) => {\r\n      if (err instanceof multer.MulterError) {\r\n        return res.status(400).json({\r\n          success: false,\r\n          message: err.message || \"File upload error\",\r\n          data: '',\r\n        });\r\n      } else if (err) {\r\n        return res.status(400).json({\r\n          success: false,\r\n          message: err.message || \"An error occurred during file upload\",\r\n          data: '',\r\n        });\r\n      }\r\n      return next();\r\n    });\r\n  };\r\n};\r\n\r\n// Export wrapped Multer methods to match original usage in routes\r\nexport const upload = {\r\n  fields: (fields: { name: string; maxCount?: number }[]) =>\r\n    createMulterMiddleware(multerInstance.fields(fields)),\r\n  single: (fieldName: string) => createMulterMiddleware(multerInstance.single(fieldName)),\r\n  array: (fieldName: string, maxCount?: number) =>\r\n    createMulterMiddleware(multerInstance.array(fieldName, maxCount)),\r\n  any: () => createMulterMiddleware(multerInstance.any()),\r\n};"]}