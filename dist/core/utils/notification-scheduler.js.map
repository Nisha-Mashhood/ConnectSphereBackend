{"version":3,"file":"notification-scheduler.js","sourceRoot":"","sources":["../../../src/core/utils/notification-scheduler.ts"],"names":[],"mappings":";;;;;;AAAA,0DAA6B;AAC7B,sDAA8B;AAC9B,mDAAkD;AAClD,0EAAsE;AAEtE,MAAa,gBAAgB;IAG3B;QACE,IAAI,CAAC,WAAW,GAAG,IAAI,sCAAiB,EAAE,CAAC;IAC7C,CAAC;IAEM,KAAK,CAAC,KAAK;QAChB,gBAAM,CAAC,IAAI,CAAC,8BAA8B,CAAC,CAAC;QAE5C,+CAA+C;QAC/C,MAAM,IAAI,CAAC,UAAU,EAAE,CAAC;QAExB,qCAAqC;QACrC,mBAAI,CAAC,QAAQ,CAAC,WAAW,EAAE,GAAG,EAAE;YAC9B,IAAI,CAAC,UAAU,EAAE,CAAC;QACpB,CAAC,CAAC,CAAC;IACL,CAAC;IAEO,KAAK,CAAC,UAAU;QACtB,gBAAM,CAAC,IAAI,CAAC,0CAA0C,CAAC,CAAC;QACxD,IAAI,CAAC;YACH,MAAM,cAAc,GAAG,IAAI,IAAI,EAAE,CAAC;YAClC,cAAc,CAAC,OAAO,CAAC,cAAc,CAAC,OAAO,EAAE,GAAG,EAAE,CAAC,CAAC;YAEtD,MAAM,oBAAoB,GAAG,MAAM,IAAI,CAAC,WAAW,CAAC,sBAAsB,CAAC,cAAc,CAAC,CAAC;YAC3F,MAAM,qBAAqB,GAAG,MAAM,IAAI,CAAC,WAAW,CAAC,uBAAuB,CAAC,cAAc,CAAC,CAAC;YAE7F,gBAAM,CAAC,IAAI,CAAC,8BAA8B,oBAAoB,oBAAoB,qBAAqB,kBAAkB,CAAC,CAAC;QAC7H,CAAC;QAAC,OAAO,KAAU,EAAE,CAAC;YACpB,gBAAM,CAAC,KAAK,CAAC,0BAA0B,KAAK,CAAC,OAAO,EAAE,CAAC,CAAC;YACxD,MAAM,IAAI,+BAAe,CAAC,wBAAwB,KAAK,CAAC,OAAO,EAAE,CAAC,CAAC;QACrE,CAAC;IACH,CAAC;CACF;AAlCD,4CAkCC","sourcesContent":["import cron from 'node-cron';\r\nimport logger from './logger';\r\nimport { RepositoryError } from './error-handler';\r\nimport { CleanupRepository } from '../repositries/clean-up-repositry';\r\n\r\nexport class CleanupScheduler {\r\n  private cleanupRepo: CleanupRepository;\r\n\r\n  constructor() {\r\n    this.cleanupRepo = new CleanupRepository();\r\n  }\r\n\r\n  public async start(): Promise<void> {\r\n    logger.info(\"‚úÖ Cleanup scheduler started.\");\r\n\r\n    // Run cleanup once immediately at server start\r\n    await this.runCleanup();\r\n\r\n    // Schedule daily cleanup at midnight\r\n    cron.schedule('0 0 * * *', () => {\r\n      this.runCleanup();\r\n    });\r\n  }\r\n\r\n  private async runCleanup(): Promise<void> {\r\n    logger.info('üßπ Running cleanup task for old requests');\r\n    try {\r\n      const fifteenDaysAgo = new Date();\r\n      fifteenDaysAgo.setDate(fifteenDaysAgo.getDate() - 15);\r\n\r\n      const deletedGroupRequests = await this.cleanupRepo.deleteOldGroupRequests(fifteenDaysAgo);\r\n      const deletedMentorRequests = await this.cleanupRepo.deleteOldMentorRequests(fifteenDaysAgo);\r\n\r\n      logger.info(`‚úÖ Cleanup Summary: Deleted ${deletedGroupRequests} group requests, ${deletedMentorRequests} mentor requests`);\r\n    } catch (error: any) {\r\n      logger.error(`‚ùå Cleanup task failed: ${error.message}`);\r\n      throw new RepositoryError(`Cleanup task failed: ${error.message}`);\r\n    }\r\n  }\r\n}\r\n"]}