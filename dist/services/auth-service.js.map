{"version":3,"file":"auth-service.js","sourceRoot":"","sources":["../../src/services/auth-service.ts"],"names":[],"mappings":"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","sourcesContent":["import { inject, injectable } from \"inversify\";\r\nimport { ServiceError } from \"../core/utils/error-handler\";\r\nimport { IUser } from \"../Interfaces/Models/i-user\";\r\nimport bcrypt from \"bcryptjs\";\r\nimport { sendOtpAndStore } from \"../Utils/utils/auth-utils/o-t-p\";\r\nimport config from \"../config/env-config\";\r\nimport { OAuth2Client } from \"../Utils/utils/auth-utils/google-config\";\r\nimport axios from \"axios\";\r\nimport logger from \"../core/utils/logger\";\r\nimport { OtpPurpose, ProfileUpdateData,  SignupData,\r\n  UserQuery,\r\n  VerifyOtpResult,\r\n} from \"../Utils/types/auth-types\";\r\nimport { IAuthService } from \"../Interfaces/Services/i-user-service\";\r\nimport { StatusCodes } from \"../enums/status-code-enums\";\r\nimport { IUserAdminDTO, IUserDTO } from \"../Interfaces/DTOs/i-user-dto\";\r\nimport { toUserAdminDTOs, toUserDTO, toUserDTOs } from \"../Utils/mappers/user-mapper\";\r\nimport { IUserRepository } from \"../Interfaces/Repository/i-user-repositry\";\r\nimport { INotificationService } from \"../Interfaces/Services/i-notification-service\";\r\nimport { IJWTService } from \"../Interfaces/Services/i-jwt-service\";\r\nimport { uploadMedia } from \"../core/utils/cloudinary\";\r\nimport { verifyOtpFromRedis } from \"../Utils/utils/auth-utils/otp-redis-helper\";\r\n\r\n@injectable()\r\nexport class AuthService implements IAuthService {\r\n  private _userRepository: IUserRepository;\r\n  private _notificationService: INotificationService;\r\n  private _jwtService: IJWTService;\r\n\r\n  constructor(\r\n    @inject('IUserRepository') userRepository :IUserRepository,\r\n    @inject('INotificationService') notificationservice : INotificationService,\r\n    @inject('IJWTService') jwtService :IJWTService\r\n  ) {\r\n    this._userRepository =  userRepository;\r\n    this._notificationService = notificationservice;\r\n    this._jwtService = jwtService;\r\n  }\r\n\r\n  //Notify admin for New User\r\n  private notifyAdminsOfNewUser = async (user: IUser): Promise<void> => {\r\n    try {\r\n      // Find all admin users\r\n      const admins = await this._userRepository.getAllAdmins();\r\n      if (admins.length === 0) {\r\n        logger.info(\"No admins found to notify for new user registration\");\r\n        return;\r\n      }\r\n      logger.info(admins);\r\n      // Create new_user notifications for each admin\r\n      for (const admin of admins) {\r\n        const notification = await this._notificationService.sendNotification(\r\n          admin._id.toString(),\r\n          \"new_user\",\r\n          user._id.toString(),\r\n          user._id.toString(),\r\n          \"user\"\r\n        );\r\n        logger.info(\r\n          `Created new_user notification for admin ${admin._id}: ${notification.id}`\r\n        );\r\n      }\r\n      logger.info(`Created new_user notifications for ${admins.length} admins`);\r\n    } catch (error: unknown) {\r\n      const err = error instanceof Error ? error : new Error(String(error));\r\n      logger.error(\r\n        `Error notifying admins of new user ${user._id}: ${err.message}`\r\n      );\r\n      throw new ServiceError(\r\n        `Failed to notify admins`,\r\n        StatusCodes.INTERNAL_SERVER_ERROR,\r\n        err\r\n      );\r\n    }\r\n  };\r\n\r\n  public signup = async (data: SignupData): Promise<{user:IUserDTO, otpId:string}> => {\r\n    try {\r\n      const { name, email, password } = data;\r\n      const normalizedEmail = email.toLowerCase().trim();\r\n      const userExists = await this._userRepository.findUserByEmail(email);\r\n      if (userExists) {\r\n        throw new ServiceError(\"User already exists\", StatusCodes.BAD_REQUEST);\r\n      }\r\n      const hashedPassword = await bcrypt.hash(password, 10);\r\n      const user = await this._userRepository.createUser({\r\n        name,\r\n        email,\r\n        password: hashedPassword,\r\n      });\r\n\r\n      logger.info(`User created successfully: ${user._id}`);\r\n\r\n      // Notify admins of new user\r\n      await this.notifyAdminsOfNewUser(user);\r\n\r\n      // Generate & send OTP for email verification\r\n      const otpId: string = await sendOtpAndStore({\r\n      email: normalizedEmail,\r\n      purpose: \"signup\",\r\n      emailSubject: \"Verify your email - ConnectSphere\",\r\n      emailBody: (otp: string) =>\r\n        `Your verification OTP for signing up on ConnectSphere is: ${otp}. It will expire shortly.`,\r\n    });\r\n\r\n      return {\r\n      user: toUserDTO(user)!,\r\n      otpId,\r\n    }; \r\n    } catch (error: unknown) {\r\n      const err = error instanceof Error ? error : new Error(String(error));\r\n      logger.error(`Error in signup for email ${data.email}: ${err.message}`);\r\n      throw error instanceof ServiceError\r\n        ? error\r\n        : new ServiceError(\r\n            \"Failed to signup user\",\r\n            StatusCodes.INTERNAL_SERVER_ERROR,\r\n            err\r\n          );\r\n    }\r\n  };\r\n\r\n  public login = async (\r\n    email: string,\r\n    password: string\r\n  ): Promise<{\r\n    user: IUserDTO;\r\n    otpId:string,\r\n  }> => {\r\n    const normalizedEmail = email.toLowerCase().trim();\r\n    try {\r\n      const user = await this._userRepository.findUserByEmail(email);\r\n      if (!user) {\r\n        throw new ServiceError(\"User not found\", StatusCodes.NOT_FOUND);\r\n      }\r\n      if (user.isBlocked) {\r\n        throw new ServiceError(\"Blocked\", StatusCodes.FORBIDDEN);\r\n      }\r\n      if (!user.password) {\r\n        throw new ServiceError(\r\n          \"This account is registered using a third-party provider. Please log in with your provider\",\r\n          StatusCodes.BAD_REQUEST\r\n        );\r\n      }\r\n      const isMatch = await bcrypt.compare(password, user.password);\r\n      if (!isMatch) {\r\n        throw new ServiceError(\"Invalid credentials\", StatusCodes.BAD_REQUEST);\r\n      }\r\n      const otpId: string = await sendOtpAndStore({\r\n      email: normalizedEmail,\r\n      purpose: \"login\",\r\n      emailSubject: \"Verify your email - ConnectSphere\",\r\n      emailBody: (otp: string) =>\r\n        `Your verification OTP for Login on ConnectSphere is: ${otp}. It will expire shortly.`,\r\n    });\r\n      return {\r\n        user: toUserDTO(user)!,\r\n        otpId,\r\n      };\r\n    } catch (error: unknown) {\r\n      const err = error instanceof Error ? error : new Error(String(error));\r\n      logger.error(`Error in login for email ${email}: ${err.message}`);\r\n      throw error instanceof ServiceError\r\n        ? error\r\n        : new ServiceError(\r\n            \"Failed to login user\",\r\n            StatusCodes.INTERNAL_SERVER_ERROR,\r\n            err\r\n          );\r\n    }\r\n  };\r\n\r\n  public googleSignup = async (code: string): Promise<{user:IUserDTO, otpId:string}> => {\r\n    try {\r\n      const { tokens } = await OAuth2Client.getToken(code);\r\n      OAuth2Client.setCredentials(tokens);\r\n      const userRes = await axios.get(\r\n        `https://www.googleapis.com/oauth2/v1/userinfo?alt=json&access_token=${tokens.access_token}`\r\n      );\r\n      const { email, name, picture } = userRes.data;\r\n      const normalizedEmail = email.toLowerCase().trim();\r\n      const existingUser = await this._userRepository.findUserByEmail(email);\r\n      if (existingUser) {\r\n        throw new ServiceError(\r\n          \"Email already registered\",\r\n          StatusCodes.BAD_REQUEST\r\n        );\r\n      }\r\n      const otpId: string = await sendOtpAndStore({\r\n      email: normalizedEmail,\r\n      purpose: \"signup\",\r\n      emailSubject: \"Verify your email - ConnectSphere\",\r\n      emailBody: (otp: string) =>\r\n        `Your verification OTP for signing up on ConnectSphere is: ${otp}. It will expire shortly.`,\r\n    });\r\n      const user = await this._userRepository.createUser({\r\n        name,\r\n        email,\r\n        provider: \"google\",\r\n        providerId: tokens.id_token,\r\n        profilePic: picture,\r\n        password: null,\r\n      });\r\n\r\n      logger.info(`User created successfully: ${user._id}`);\r\n\r\n      // Notify admins of new user\r\n      await this.notifyAdminsOfNewUser(user);\r\n\r\n      return {\r\n      user: toUserDTO(user)!,\r\n      otpId,\r\n    }; \r\n    } catch (error: unknown) {\r\n      const err = error instanceof Error ? error : new Error(String(error));\r\n      logger.error(`Error in Google signup: ${err.message}`);\r\n      throw error instanceof ServiceError\r\n        ? error\r\n        : new ServiceError(\r\n            \"Google signup failed\",\r\n            StatusCodes.INTERNAL_SERVER_ERROR,\r\n            err\r\n          );\r\n    }\r\n  };\r\n\r\n  public googleLogin = async (\r\n    code: string\r\n  ): Promise<{\r\n    user: IUserDTO;\r\n    otpId:string,\r\n  }> => {\r\n    try {\r\n      const { tokens } = await OAuth2Client.getToken(code);\r\n      OAuth2Client.setCredentials(tokens);\r\n      const userRes = await axios.get(\r\n        `https://www.googleapis.com/oauth2/v1/userinfo?alt=json&access_token=${tokens.access_token}`\r\n      );\r\n      const { email } = userRes.data;\r\n      const normalizedEmail = email.toLowerCase().trim();\r\n      const existingUser = await this._userRepository.findUserByEmail(email);\r\n      if (!existingUser) {\r\n        throw new ServiceError(\"Email not registered\", StatusCodes.NOT_FOUND);\r\n      }\r\n      const otpId: string = await sendOtpAndStore({\r\n      email: normalizedEmail,\r\n      purpose: \"login\",\r\n      emailSubject: \"Verify your email - ConnectSphere\",\r\n      emailBody: (otp: string) =>\r\n        `Your verification OTP for Login on ConnectSphere is: ${otp}. It will expire shortly.`,\r\n    });\r\n      return {\r\n        user: toUserDTO(existingUser)!,\r\n        otpId,\r\n      };\r\n    } catch (error: unknown) {\r\n      const err = error instanceof Error ? error : new Error(String(error));\r\n      logger.error(`Error in Google login: ${err.message}`);\r\n      throw error instanceof ServiceError\r\n        ? error\r\n        : new ServiceError(\r\n            \"Google login failed\",\r\n            StatusCodes.INTERNAL_SERVER_ERROR,\r\n            err\r\n          );\r\n    }\r\n  };\r\n\r\n  public githubSignup = async (code: string): Promise<{user:IUserDTO, otpId:string}> => {\r\n    try {\r\n      const tokenResponse = await axios.post(\r\n        \"https://github.com/login/oauth/access_token\",\r\n        {\r\n          client_id: config.githubclientid,\r\n          client_secret: config.githubclientsecret,\r\n          code,\r\n        },\r\n        { headers: { Accept: \"application/json\" } }\r\n      );\r\n      const { access_token } = tokenResponse.data;\r\n      const userResponse = await axios.get(\"https://api.github.com/user\", {\r\n        headers: { Authorization: `Bearer ${access_token}` },\r\n      });\r\n      let email = userResponse.data.email;\r\n      if (!email) {\r\n        const emailsResponse = await axios.get(\r\n          \"https://api.github.com/user/emails\",\r\n          {\r\n            headers: { Authorization: `Bearer ${access_token}` },\r\n          }\r\n        );\r\n        const primaryEmail = emailsResponse.data.find((e: any) => e.primary);\r\n        if (!primaryEmail) {\r\n          throw new ServiceError(\r\n            \"Email not found for GitHub user\",\r\n            StatusCodes.BAD_REQUEST\r\n          );\r\n        }\r\n        email = primaryEmail.email;\r\n      }\r\n      const normalizedEmail = email.toLowerCase().trim();\r\n      const existingUser = await this._userRepository.findUserByEmail(email);\r\n      if (existingUser) {\r\n        throw new ServiceError(\r\n          \"Email already registered\",\r\n          StatusCodes.BAD_REQUEST\r\n        );\r\n      }\r\n      const otpId: string = await sendOtpAndStore({\r\n      email: normalizedEmail,\r\n      purpose: \"signup\",\r\n      emailSubject: \"Verify your email - ConnectSphere\",\r\n      emailBody: (otp: string) =>\r\n        `Your verification OTP for signing up on ConnectSphere is: ${otp}. It will expire shortly.`,\r\n    });\r\n      const user = await this._userRepository.createUser({\r\n        name: userResponse.data.name || userResponse.data.login,\r\n        email,\r\n        provider: \"github\",\r\n        providerId: userResponse.data.login,\r\n        profilePic: userResponse.data.avatar_url,\r\n        password: null,\r\n      });\r\n\r\n      logger.info(`User created successfully: ${user._id}`);\r\n\r\n      // Notify admins of new user\r\n      await this.notifyAdminsOfNewUser(user);\r\n\r\n      return {\r\n      user: toUserDTO(user)!,\r\n      otpId,\r\n    }; \r\n    } catch (error: unknown) {\r\n      const err = error instanceof Error ? error : new Error(String(error));\r\n      logger.error(`Error in GitHub signup: ${err.message}`);\r\n      throw error instanceof ServiceError\r\n        ? error\r\n        : new ServiceError(\r\n            \"GitHub signup failed\",\r\n            StatusCodes.INTERNAL_SERVER_ERROR,\r\n            err\r\n          );\r\n    }\r\n  };\r\n\r\n  public githubLogin = async (\r\n    code: string\r\n  ): Promise<{\r\n    user: IUserDTO;\r\n    otpId:string,\r\n  }> => {\r\n    try {\r\n      const tokenResponse = await axios.post(\r\n        \"https://github.com/login/oauth/access_token\",\r\n        {\r\n          client_id: config.githubclientid,\r\n          client_secret: config.githubclientsecret,\r\n          code,\r\n        },\r\n        { headers: { Accept: \"application/json\" } }\r\n      );\r\n      const { access_token } = tokenResponse.data;\r\n      const userResponse = await axios.get(\"https://api.github.com/user\", {\r\n        headers: { Authorization: `Bearer ${access_token}` },\r\n      });\r\n      let email = userResponse.data.email;\r\n      if (!email) {\r\n        const emailsResponse = await axios.get(\r\n          \"https://api.github.com/user/emails\",\r\n          {\r\n            headers: { Authorization: `Bearer ${access_token}` },\r\n          }\r\n        );\r\n        const primaryEmail = emailsResponse.data.find((e: any) => e.primary);\r\n        if (!primaryEmail) {\r\n          throw new ServiceError(\r\n            \"Email not found for GitHub user\",\r\n            StatusCodes.BAD_REQUEST\r\n          );\r\n        }\r\n        email = primaryEmail.email;\r\n      }\r\n      const normalizedEmail = email.toLowerCase().trim();\r\n      const existingUser = await this._userRepository.findUserByEmail(email);\r\n      if (!existingUser) {\r\n        throw new ServiceError(\"Email not registered\", StatusCodes.NOT_FOUND);\r\n      }\r\n      const otpId: string = await sendOtpAndStore({\r\n      email: normalizedEmail,\r\n      purpose: \"login\",\r\n      emailSubject: \"Verify your email - ConnectSphere\",\r\n      emailBody: (otp: string) =>\r\n        `Your verification OTP for Login on ConnectSphere is: ${otp}. It will expire shortly.`,\r\n    });\r\n      return {\r\n        user: toUserDTO(existingUser)!,\r\n        otpId,\r\n      };\r\n    } catch (error: unknown) {\r\n      const err = error instanceof Error ? error : new Error(String(error));\r\n      logger.error(`Error in GitHub login: ${err.message}`);\r\n      throw error instanceof ServiceError\r\n        ? error\r\n        : new ServiceError(\r\n            \"GitHub login failed\",\r\n            StatusCodes.INTERNAL_SERVER_ERROR,\r\n            err\r\n          );\r\n    }\r\n  };\r\n\r\n  public refreshToken = async (\r\n    refreshToken: string\r\n  ): Promise<{ newAccessToken: string }> => {\r\n    try {\r\n      const decoded = this._jwtService.verifyRefreshToken(refreshToken);\r\n      const newAccessToken = this._jwtService.generateAccessToken({\r\n        userId: decoded.userId,\r\n      });\r\n      logger.info(`Refreshed access token for userId: ${decoded.userId}`);\r\n      return { newAccessToken };\r\n    } catch (error: unknown) {\r\n      const err = error instanceof Error ? error : new Error(String(error));\r\n      logger.error(`Error refreshing token: ${err.message}`);\r\n      throw new ServiceError(\r\n        \"Invalid or expired refresh token\",\r\n        StatusCodes.BAD_REQUEST,\r\n        err\r\n      );\r\n    }\r\n  };\r\n\r\n  public forgotPassword = async (email: string): Promise<string> => {\r\n    try {\r\n      const normalizedEmail = email.toLowerCase().trim();\r\n      const user = await this._userRepository.findUserByEmail(normalizedEmail);\r\n      if (!user) {\r\n        throw new ServiceError(\"User not found\", StatusCodes.NOT_FOUND);\r\n      }\r\n      const otpId: string = await sendOtpAndStore({\r\n      email: normalizedEmail,\r\n      purpose: \"forgot_password\",\r\n      emailSubject: \"Verify your email - ConnectSphere\",\r\n      emailBody: (otp: string) =>\r\n        `Your verification OTP for Resetting Your password on ConnectSphere is: ${otp}. It will expire shortly.`,\r\n    });\r\n      return otpId;\r\n    } catch (error: unknown) {\r\n      const err = error instanceof Error ? error : new Error(String(error));\r\n      logger.error(`Error in forgot password for ${email}: ${err.message}`);\r\n      throw error instanceof ServiceError\r\n        ? error\r\n        : new ServiceError(\"Failed to send OTP\", StatusCodes.INTERNAL_SERVER_ERROR, err);\r\n    }\r\n  };\r\n\r\n  public verifyOTP = async (purpose:OtpPurpose, email:string, otpId: string, otp: string): Promise<VerifyOtpResult> => {\r\n    const normalizedEmail = email.toLowerCase().trim();\r\n      try {\r\n      const result = await verifyOtpFromRedis(\r\n        purpose,\r\n        normalizedEmail,\r\n        otpId,\r\n        otp\r\n      );\r\n      // Only LOGIN creates tokens\r\n      if (purpose === \"login\") {\r\n        const user = await this._userRepository.findUserByEmail(normalizedEmail);\r\n        if (!user) {\r\n          throw new ServiceError(\"User not found\", StatusCodes.NOT_FOUND);\r\n        }\r\n        await this._userRepository.incrementLoginCount(user._id.toString());\r\n\r\n        const updatedUser = await this._userRepository.findById(user._id.toString());\r\n        if (!updatedUser) {\r\n          throw new ServiceError(\"User not updated\", StatusCodes.NOT_MODIFIED);\r\n        }\r\n        const accessToken = this._jwtService.generateAccessToken({\r\n          userId: user._id,\r\n          userRole: user.role,\r\n        });\r\n        const refreshToken = this._jwtService.generateRefreshToken({\r\n          userId: user._id,\r\n          userRole: user.role,\r\n        });\r\n        await this._userRepository.updateRefreshToken(\r\n          user._id.toString(),\r\n          refreshToken\r\n        );\r\n        const needsReviewPrompt = updatedUser.loginCount >= 5 && !updatedUser.hasReviewed;\r\n            return {\r\n              purpose: \"login\",\r\n              user: toUserDTO(updatedUser)!,\r\n              accessToken,\r\n              refreshToken,\r\n              needsReviewPrompt,\r\n            };\r\n        }\r\n        return {\r\n          purpose,\r\n          email: result.email,\r\n        };\r\n\r\n      } catch (error: unknown) {\r\n        const err = error instanceof Error ? error : new Error(String(error));\r\n        logger.error(`Error verifying OTP : ${err.message}`);\r\n        throw error instanceof ServiceError\r\n          ? error\r\n          : new ServiceError(\"Failed to verify OTP\", StatusCodes.INTERNAL_SERVER_ERROR, err);\r\n      }\r\n  };\r\n\r\n  public resendOtp = async ( email: string, purpose: OtpPurpose ): Promise<{ otpId: string }> => {\r\n    const normalizedEmail = email.toLowerCase().trim();\r\n    const otpId = await sendOtpAndStore({\r\n      email: normalizedEmail,\r\n      purpose,\r\n      emailSubject: \"Your OTP - ConnectSphere\",\r\n      emailBody: (otp: string) =>\r\n      `Your OTP for ${purpose.replace(\"_\", \" \")} is: ${otp}. It will expire shortly.`,\r\n    });\r\n    return { otpId };\r\n  };\r\n\r\n  public resetPassword = async (\r\n    email: string,\r\n    newPassword: string\r\n  ): Promise<void> => {\r\n    try {\r\n      const user = await this._userRepository.findUserByEmail(email);\r\n      if (!user) {\r\n        throw new ServiceError(\"User not found\", StatusCodes.NOT_FOUND);\r\n      }\r\n      if (user.password && (await bcrypt.compare(newPassword, user.password))) {\r\n        throw new ServiceError(\r\n          \"New password cannot be the same as the old password\",\r\n          StatusCodes.BAD_REQUEST\r\n        );\r\n      }\r\n      const hashedPassword = await bcrypt.hash(newPassword, 10);\r\n      await this._userRepository.updatePassword(\r\n        user._id.toString(),\r\n        hashedPassword\r\n      );\r\n      logger.info(`Password reset for ${email}`);\r\n    } catch (error: unknown) {\r\n      const err = error instanceof Error ? error : new Error(String(error));\r\n      logger.error(`Error resetting password for ${email}: ${err.message}`);\r\n      throw error instanceof ServiceError\r\n        ? error\r\n        : new ServiceError(\r\n            \"Failed to reset password\",\r\n            StatusCodes.INTERNAL_SERVER_ERROR,\r\n            err\r\n          );\r\n    }\r\n  };\r\n\r\n  public logout = async (email: string): Promise<void> => {\r\n    try {\r\n      await this._userRepository.removeRefreshToken(email);\r\n      logger.info(`User ${email} logged out`);\r\n    } catch (error: unknown) {\r\n      const err = error instanceof Error ? error : new Error(String(error));\r\n      logger.error(`Error logging out user ${email}: ${err.message}`);\r\n      throw new ServiceError(\r\n        \"Failed to logout user\",\r\n        StatusCodes.INTERNAL_SERVER_ERROR,\r\n        err\r\n      );\r\n    }\r\n  };\r\n\r\n  public verifyAdminPasskey = async (passkey: string): Promise<boolean> => {\r\n    logger.info(\r\n      `AdminPasskey from Server :${config.adminpasscode} and passkey from front end : ${passkey}`\r\n    );\r\n    try {\r\n      if (passkey !== config.adminpasscode) {\r\n        throw new ServiceError(\r\n          \"Invalid admin passkey\",\r\n          StatusCodes.BAD_REQUEST\r\n        );\r\n      }\r\n      logger.info(`Admin passkey verified`);\r\n      return true;\r\n    } catch (error: unknown) {\r\n      const err = error instanceof Error ? error : new Error(String(error));\r\n      logger.error(`Error verifying admin passkey: ${err.message}`);\r\n      throw error instanceof ServiceError\r\n        ? error\r\n        : new ServiceError(\r\n            \"Failed to verify admin passkey\",\r\n            StatusCodes.INTERNAL_SERVER_ERROR,\r\n            err\r\n          );\r\n    }\r\n  };\r\n\r\n  public checkProfileCompletion = async (userId: string): Promise<boolean> => {\r\n    try {\r\n      const user = await this._userRepository.findById(userId);\r\n      if (!user) {\r\n        throw new ServiceError(\"User not found\", StatusCodes.NOT_FOUND);\r\n      }\r\n      const isComplete = await this._userRepository.isProfileComplete(user);\r\n      logger.info(\r\n        `Profile completion checked for user ${userId}: ${isComplete}`\r\n      );\r\n      return isComplete;\r\n    } catch (error: unknown) {\r\n      const err = error instanceof Error ? error : new Error(String(error));\r\n      logger.error(\r\n        `Error checking profile completion for user ${userId}: ${err.message}`\r\n      );\r\n      throw error instanceof ServiceError\r\n        ? error\r\n        : new ServiceError(\r\n            \"Failed to check profile completion\",\r\n            StatusCodes.INTERNAL_SERVER_ERROR,\r\n            err\r\n          );\r\n    }\r\n  };\r\n\r\n  public profileDetails = async (userId: string): Promise<IUserDTO | null> => {\r\n    try {\r\n      const user = await this._userRepository.findById(userId);\r\n      logger.info(`Fetched profile details for user ${userId}`);\r\n      return toUserDTO(user);\r\n    } catch (error: unknown) {\r\n      const err = error instanceof Error ? error : new Error(String(error));\r\n      logger.error(\r\n        `Error fetching profile details for user ${userId}: ${err.message}`\r\n      );\r\n      throw error instanceof ServiceError\r\n        ? error\r\n        : new ServiceError(\r\n            \"Failed to fetch profile details\",\r\n            StatusCodes.INTERNAL_SERVER_ERROR,\r\n            err\r\n          );\r\n    }\r\n  };\r\n\r\n  updateUserProfile = async (\r\n    userId: string,\r\n    data: ProfileUpdateData\r\n  ): Promise<IUserDTO> => {\r\n    try {\r\n      const user = await this._userRepository.findById(userId);\r\n      if (!user) {\r\n        throw new ServiceError(\"User not found\", StatusCodes.NOT_FOUND);\r\n      }\r\n      let profilePic = user.profilePic ?? undefined;\r\n      let coverPic = user.coverPic ?? undefined;\r\n      if (data.profilePicFile) {\r\n        const { url } = await uploadMedia(\r\n          data.profilePicFile.path,\r\n          \"profiles\",\r\n          data.profilePicFile.size\r\n        );\r\n        profilePic = url;\r\n      }\r\n      if (data.coverPicFile) {\r\n        const { url } = await uploadMedia(\r\n          data.coverPicFile.path,\r\n          \"covers\",\r\n          data.coverPicFile.size\r\n        );\r\n        coverPic = url\r\n      }\r\n      const updatedData: Partial<IUser> = {\r\n        name: data.name ?? user.name,\r\n        email: data.email ?? user.email,\r\n        phone: data.phone ?? user.phone,\r\n        dateOfBirth: data.dateOfBirth\r\n          ? new Date(data.dateOfBirth)\r\n          : user.dateOfBirth,\r\n        jobTitle: data.jobTitle ?? user.jobTitle,\r\n        industry: data.industry ?? user.industry,\r\n        reasonForJoining: data.reasonForJoining ?? user.reasonForJoining,\r\n        profilePic,\r\n        coverPic,\r\n      };\r\n      const updatedUser = await this._userRepository.update(userId, updatedData);\r\n      if (!updatedUser) {\r\n        throw new ServiceError(\r\n          \"Failed to update user profile\",\r\n          StatusCodes.INTERNAL_SERVER_ERROR\r\n        );\r\n      }\r\n      logger.info(`Updated profile for user ${userId}`);\r\n      return toUserDTO(updatedUser)!;\r\n    } catch (error: unknown) {\r\n      const err = error instanceof Error ? error : new Error(String(error));\r\n      logger.error(`Error updating profile for user ${userId}: ${err.message}`);\r\n      throw error instanceof ServiceError\r\n        ? error\r\n        : new ServiceError(\r\n            \"Failed to update user profile\",\r\n            StatusCodes.INTERNAL_SERVER_ERROR,\r\n            err\r\n          );\r\n    }\r\n  };\r\n\r\n  updatePassword = async (\r\n    userId: string,\r\n    currentPassword: string,\r\n    newPassword: string\r\n  ): Promise<IUserDTO> => {\r\n    try {\r\n      const user = await this._userRepository.findById(userId);\r\n      if (!user) {\r\n        throw new ServiceError(\"Cannot Update password\", StatusCodes.NOT_FOUND);\r\n      }\r\n      if (!user.password) {\r\n        throw new ServiceError(\r\n          \"Cannot update Password\",\r\n          StatusCodes.BAD_REQUEST\r\n        );\r\n      }\r\n\r\n      // Verify current password\r\n      const isMatch = await bcrypt.compare(currentPassword, user.password);\r\n      if (!isMatch) {\r\n        throw new ServiceError(\r\n          \"Current password is incorrect\",\r\n          StatusCodes.BAD_REQUEST\r\n        );\r\n      }\r\n\r\n      // Hash new password\r\n      const hashedPassword = await bcrypt.hash(newPassword, 10);\r\n      const updatedUser = await this._userRepository.update(userId, {\r\n        password: hashedPassword,\r\n      });\r\n      if (!updatedUser) {\r\n        throw new ServiceError(\r\n          \"Failed to update password\",\r\n          StatusCodes.INTERNAL_SERVER_ERROR\r\n        );\r\n      }\r\n\r\n      logger.info(`Updated password for user ${userId}`);\r\n      return toUserDTO(updatedUser)!;\r\n    } catch (error: unknown) {\r\n      const err = error instanceof Error ? error : new Error(String(error));\r\n      logger.error(\r\n        `Error updating password for user ${userId}: ${err.message}`\r\n      );\r\n      throw error instanceof ServiceError\r\n        ? error\r\n        : new ServiceError(\r\n            \"Failed to update password\",\r\n            StatusCodes.INTERNAL_SERVER_ERROR,\r\n            err\r\n          );\r\n    }\r\n  };\r\n\r\n  fetchAllUsers = async (): Promise<IUserDTO[]> => {\r\n    try {\r\n      const users =  await this._userRepository.fetchAllUsers();\r\n      return toUserDTOs(users)!;\r\n    } catch (error: unknown) {\r\n      const err = error instanceof Error ? error : new Error(String(error));\r\n      logger.error(`Error in fetchAllUsers: ${err.message}`);\r\n      throw new ServiceError(\r\n        \"Failed to fetch all users\",\r\n        StatusCodes.INTERNAL_SERVER_ERROR,\r\n        err\r\n      );\r\n    }\r\n  };\r\n\r\n  getAllUsers = async (\r\n    query: UserQuery = {}\r\n  ): Promise<{ users: IUserDTO[]; total: number }> => {\r\n    try {\r\n      logger.debug(`Fetching all users with query: ${JSON.stringify(query)}`);\r\n      const { users, total } = await this._userRepository.getAllUsers(query);\r\n      return { users: toUserDTOs(users), total };\r\n    } catch (error: unknown) {\r\n      const err = error instanceof Error ? error : new Error(String(error));\r\n      logger.error(`Error fetching all users: ${err.message}`);\r\n      throw error instanceof ServiceError\r\n        ? error\r\n        : new ServiceError(\r\n            \"Failed to fetch all users\",\r\n            StatusCodes.INTERNAL_SERVER_ERROR,\r\n            err\r\n          );\r\n    }\r\n  };\r\n\r\n  blockUser = async (id: string): Promise<void> => {\r\n    try {\r\n      const user = await this._userRepository.getUserById(id);\r\n      if (!user) {\r\n        throw new ServiceError(\"User not found\", StatusCodes.NOT_FOUND);\r\n      }\r\n      await this._userRepository.blockUser(id);\r\n      logger.info(`Blocked user: ${id}`);\r\n    } catch (error: unknown) {\r\n      const err = error instanceof Error ? error : new Error(String(error));\r\n      logger.error(`Error blocking user ${id}: ${err.message}`);\r\n      throw error instanceof ServiceError\r\n        ? error\r\n        : new ServiceError(\r\n            `Failed to block user ${id}`,\r\n            StatusCodes.INTERNAL_SERVER_ERROR,\r\n            err\r\n          );\r\n    }\r\n  };\r\n\r\n  unblockUser = async (id: string): Promise<void> => {\r\n    try {\r\n      const user = await this._userRepository.getUserById(id);\r\n      if (!user) {\r\n        throw new ServiceError(\"User not found\", StatusCodes.NOT_FOUND);\r\n      }\r\n      await this._userRepository.unblockUser(id);\r\n      logger.info(`Unblocked user: ${id}`);\r\n    } catch (error: unknown) {\r\n      const err = error instanceof Error ? error : new Error(String(error));\r\n      logger.error(`Error unblocking user ${id}: ${err.message}`);\r\n      throw error instanceof ServiceError\r\n        ? error\r\n        : new ServiceError(\r\n            `Failed to unblock user ${id}`,\r\n            StatusCodes.INTERNAL_SERVER_ERROR,\r\n            err\r\n          );\r\n    }\r\n  };\r\n\r\n  changeRole = async (userId: string, role: string): Promise<IUserDTO | null> => {\r\n    try {\r\n      const user = await this._userRepository.getUserById(userId);\r\n      if (!user) {\r\n        throw new ServiceError(\"User not found\", StatusCodes.NOT_FOUND);\r\n      }\r\n      const updatedUser = await this._userRepository.updateUserRole(\r\n        userId,\r\n        role\r\n      );\r\n      if (!updatedUser) {\r\n        throw new ServiceError(\r\n          \"Failed to update user role\",\r\n          StatusCodes.INTERNAL_SERVER_ERROR\r\n        );\r\n      }\r\n      logger.info(`Updated role for user ${userId} to ${role}`);\r\n      return toUserDTO(updatedUser)!;\r\n    } catch (error: unknown) {\r\n      const err = error instanceof Error ? error : new Error(String(error));\r\n      logger.error(`Error updating role for user ${userId}: ${err.message}`);\r\n      throw error instanceof ServiceError\r\n        ? error\r\n        : new ServiceError(\r\n            `Failed to update role for user ${userId}`,\r\n            StatusCodes.INTERNAL_SERVER_ERROR,\r\n            err\r\n          );\r\n    }\r\n  }\r\n\r\n  public getAllUsersAdmin = async (\r\n  query: UserQuery = {}\r\n): Promise<{ users: IUserAdminDTO[]; total: number }> => {\r\n  try {\r\n    logger.debug(`Fetching all users for admin with query: ${JSON.stringify(query)}`);\r\n    const { users, total } = await this._userRepository.getAllUsers(query);\r\n    return { users: toUserAdminDTOs(users), total };\r\n  } catch (error: unknown) {\r\n    const err = error instanceof Error ? error : new Error(String(error));\r\n    logger.error(`Error fetching all users for admin: ${err.message}`);\r\n    throw error instanceof ServiceError\r\n      ? error\r\n      : new ServiceError(\r\n          'Failed to fetch all users for admin',\r\n          StatusCodes.INTERNAL_SERVER_ERROR,\r\n          err\r\n        );\r\n  }\r\n};\r\n}\r\n"]}