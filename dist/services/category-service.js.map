{"version":3,"file":"category-service.js","sourceRoot":"","sources":["../../src/services/category-service.ts"],"names":[],"mappings":"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","sourcesContent":["import { inject, injectable } from \"inversify\";\r\nimport { ICategoryRepository } from \"../Interfaces/Repository/i-category-repositry\";\r\nimport { ISubcategoryRepository } from \"../Interfaces/Repository/i-sub-category-repositry\";\r\nimport { ISkillsRepository } from \"../Interfaces/Repository/i-skills-repositry\";\r\nimport { ICategory } from \"../Interfaces/Models/i-category\";\r\nimport logger from \"../core/utils/logger\";\r\nimport { uploadMedia } from \"../core/utils/cloudinary\";\r\nimport { ServiceError } from \"../core/utils/error-handler\";\r\nimport { ICategoryService } from \"../Interfaces/Services/i-category-service\";\r\nimport { StatusCodes } from \"../enums/status-code-enums\";\r\nimport { toCategoryDTO, toCategoryDTOs } from \"../Utils/mappers/category-mapper\";\r\nimport { ICategoryDTO } from \"../Interfaces/DTOs/i-category-dto\";\r\n\r\n@injectable()\r\nexport class CategoryService implements ICategoryService {\r\n  private categoryRepo: ICategoryRepository;\r\n  private subcategoryRepo: ISubcategoryRepository;\r\n  private skillsRepo: ISkillsRepository;\r\n\r\n  constructor(\r\n    @inject('ICategoryRepository') categoryRepository : ICategoryRepository,\r\n    @inject('ISubCategoryRepository') subcategoryRepository : ISubcategoryRepository,\r\n    @inject('ISkillsRepository') skillsRepository : ISkillsRepository\r\n  ) {\r\n    this.categoryRepo = categoryRepository;\r\n    this.subcategoryRepo = subcategoryRepository;\r\n    this.skillsRepo = skillsRepository;\r\n  }\r\n\r\n  isDuplicateCategoryName = async (\r\n    name?: string,\r\n    excludeId?: string\r\n  ): Promise<boolean> => {\r\n    try {\r\n      logger.debug(`Checking duplicate category name: ${name}`);\r\n      const isDuplicate = await this.categoryRepo.isDuplicateCategoryName(\r\n        name,\r\n        excludeId\r\n      );\r\n      return isDuplicate;\r\n    } catch (error: unknown) {\r\n      const err = error instanceof Error ? error : new Error(String(error));\r\n      logger.error(\r\n        `Error checking duplicate category name ${name}: ${err.message}`\r\n      );\r\n      throw new ServiceError(\r\n        \"Failed to check duplicate category name\",\r\n        StatusCodes.INTERNAL_SERVER_ERROR,\r\n        err\r\n      );\r\n    }\r\n  };\r\n\r\n  createCategory = async (\r\n    data: Partial<ICategory>,\r\n    imagePath?: string,\r\n    fileSize?: number\r\n  ): Promise<ICategoryDTO> => {\r\n    try {\r\n      logger.debug(`Creating category with name: ${data.name}`);\r\n      let imageUrl: string = '';\r\n      if (imagePath) {\r\n        const folder = \"categories\";\r\n        const { url } = await uploadMedia(imagePath, folder, fileSize);\r\n        imageUrl = url;\r\n        logger.info(`Uploaded image for category: ${imageUrl}`);\r\n      }\r\n      const category = await this.categoryRepo.createCategory({\r\n        ...data,\r\n        imageUrl,\r\n      });\r\n      const categoryDTO = toCategoryDTO(category);\r\n      if (!categoryDTO) {\r\n        logger.error(`Failed to map category ${category._id} to DTO`);\r\n        throw new ServiceError(\r\n          \"Failed to map category to DTO\",\r\n          StatusCodes.INTERNAL_SERVER_ERROR\r\n        );\r\n      }\r\n      logger.info(`Category created: ${category._id} (${category.name})`);\r\n      return categoryDTO;\r\n    } catch (error: unknown) {\r\n      const err = error instanceof Error ? error : new Error(String(error));\r\n      logger.error(`Error creating category: ${err.message}`);\r\n      throw new ServiceError(\r\n        \"Failed to create category\",\r\n        StatusCodes.INTERNAL_SERVER_ERROR,\r\n        err\r\n      );\r\n    }\r\n  };\r\n\r\n  getAllCategories = async (\r\n    query: {\r\n      search?: string;\r\n      page?: number;\r\n      limit?: number;\r\n    } = {}\r\n  ): Promise<{ categories: ICategoryDTO[]; total: number }> => {\r\n    try {\r\n      logger.debug(\r\n        `Fetching all categories with query: ${JSON.stringify(query)}`\r\n      );\r\n      const result = await this.categoryRepo.getAllCategories(query);\r\n      const categoriesDTO = toCategoryDTOs(result.categories);;\r\n      logger.info(`Fetched categories with total ${result.total}`);\r\n      return { categories: categoriesDTO, total: result.total };\r\n    } catch (error: unknown) {\r\n      const err = error instanceof Error ? error : new Error(String(error));\r\n      logger.error(`Error fetching categories: ${err.message}`);\r\n      throw new ServiceError(\r\n        \"Failed to fetch categories\",\r\n        StatusCodes.INTERNAL_SERVER_ERROR,\r\n        err\r\n      );\r\n    }\r\n  };\r\n\r\n  fetchAllCategories = async (): Promise<{ categories: ICategoryDTO[]}> => {\r\n    try {\r\n      logger.debug(`Fetching all categories`);\r\n      const result = await this.categoryRepo.fetchAllCategories();\r\n      const categoriesDTO = toCategoryDTOs(result.categories);;\r\n      return { categories: categoriesDTO };\r\n    } catch (error: unknown) {\r\n      const err = error instanceof Error ? error : new Error(String(error));\r\n      logger.error(`Error fetching categories: ${err.message}`);\r\n      throw new ServiceError(\r\n        \"Failed to fetch categories\",\r\n        StatusCodes.INTERNAL_SERVER_ERROR,\r\n        err\r\n      );\r\n    }\r\n  };\r\n\r\n  getCategoryById = async (id: string): Promise<ICategoryDTO | null> => {\r\n    try {\r\n      logger.debug(`Fetching category: ${id}`);\r\n      const category = await this.categoryRepo.getCategoryById(id);\r\n      if (!category) {\r\n        logger.warn(`Category not found: ${id}`);\r\n        throw new ServiceError(\"Category not found\", StatusCodes.NOT_FOUND);\r\n      }\r\n      const categoryDTO = toCategoryDTO(category);\r\n      if (!categoryDTO) {\r\n        logger.error(`Failed to map category ${id} to DTO`);\r\n        throw new ServiceError(\r\n          \"Failed to map category to DTO\",\r\n          StatusCodes.INTERNAL_SERVER_ERROR\r\n        );\r\n      }\r\n      logger.info(`Category fetched: ${id} (${category.name})`);\r\n      return categoryDTO;\r\n    } catch (error: unknown) {\r\n      const err = error instanceof Error ? error : new Error(String(error));\r\n      logger.error(`Error fetching category ${id}: ${err.message}`);\r\n      throw error instanceof ServiceError\r\n        ? error\r\n        : new ServiceError(\r\n            \"Failed to fetch category\",\r\n            StatusCodes.INTERNAL_SERVER_ERROR,\r\n            err\r\n          );\r\n    }\r\n  };\r\n\r\n  updateCategory = async (\r\n    id: string,\r\n    data: Partial<ICategory>,\r\n    imagePath?: string,\r\n    fileSize?: number\r\n  ): Promise<ICategoryDTO | null> => {\r\n    try {\r\n      logger.debug(`Updating category: ${id}`);\r\n      let imageId: string | null = null;\r\n      if (imagePath) {\r\n        const folder = \"categories\";\r\n        const { url } = await uploadMedia(imagePath, folder, fileSize);\r\n        imageId = url;\r\n        logger.info(`Uploaded image for category: ${imageId}`);\r\n      }\r\n      const category = await this.categoryRepo.updateCategory(id, {\r\n        ...data,\r\n        ...(imageId && { imageId }),\r\n      });\r\n      if (!category) {\r\n        logger.warn(`Category not found for update: ${id}`);\r\n        throw new ServiceError(\"Category not found\", StatusCodes.NOT_FOUND);\r\n      }\r\n      const categoryDTO = toCategoryDTO(category);\r\n      if (!categoryDTO) {\r\n        logger.error(`Failed to map category ${id} to DTO`);\r\n        throw new ServiceError(\r\n          \"Failed to map category to DTO\",\r\n          StatusCodes.INTERNAL_SERVER_ERROR\r\n        );\r\n      }\r\n      logger.info(`Category updated: ${id} (${category.name})`);\r\n      return categoryDTO;\r\n    } catch (error: unknown) {\r\n      const err = error instanceof Error ? error : new Error(String(error));\r\n      logger.error(`Error updating category ${id}: ${err.message}`);\r\n      throw error instanceof ServiceError\r\n        ? error\r\n        : new ServiceError(\r\n            \"Failed to update category\",\r\n            StatusCodes.INTERNAL_SERVER_ERROR,\r\n            err\r\n          );\r\n    }\r\n  };\r\n\r\n  deleteCategory = async (id: string): Promise<ICategoryDTO | null> => {\r\n    try {\r\n      logger.debug(`Deleting category: ${id}`);\r\n      await this.subcategoryRepo.deleteManySubcategories(id);\r\n      logger.info(`Deleted subcategories for category: ${id}`);\r\n      await this.skillsRepo.deleteManySkills(id);\r\n      logger.info(`Deleted skills for category: ${id}`);\r\n      const category = await this.categoryRepo.deleteCategory(id);\r\n      if (!category) {\r\n        logger.warn(`Category not found for deletion: ${id}`);\r\n        throw new ServiceError(\"Category not found\", StatusCodes.NOT_FOUND);\r\n      }\r\n      const categoryDTO = toCategoryDTO(category);\r\n      if (!categoryDTO) {\r\n        logger.error(`Failed to map category ${id} to DTO`);\r\n        throw new ServiceError(\r\n          \"Failed to map category to DTO\",\r\n          StatusCodes.INTERNAL_SERVER_ERROR\r\n        );\r\n      }\r\n      logger.info(`Category deleted: ${id} (${category.name})`);\r\n      return categoryDTO;\r\n    } catch (error: unknown) {\r\n      const err = error instanceof Error ? error : new Error(String(error));\r\n      logger.error(`Error deleting category ${id}: ${err.message}`);\r\n      throw error instanceof ServiceError\r\n        ? error\r\n        : new ServiceError(\r\n            \"Failed to delete category and related data\",\r\n            StatusCodes.INTERNAL_SERVER_ERROR,\r\n            err\r\n          );\r\n    }\r\n  };\r\n}\r\n"]}