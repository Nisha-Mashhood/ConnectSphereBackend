{"version":3,"file":"feedback-service.js","sourceRoot":"","sources":["../../src/services/feedback-service.ts"],"names":[],"mappings":"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","sourcesContent":["import { inject, injectable } from \"inversify\";\r\nimport { ServiceError } from '../core/utils/error-handler';\r\nimport logger from '../core/utils/logger';\r\nimport { IFeedback } from '../Interfaces/Models/i-feedback';\r\nimport { StatusCodes } from '../enums/status-code-enums';\r\nimport { IFeedbackService } from '../Interfaces/Services/i-feedback-service';\r\nimport { IFeedbackRepository } from \"../Interfaces/Repository/i-feedback-repositry\";\r\nimport { ICollaborationRepository } from \"../Interfaces/Repository/i-collaboration-repositry\";\r\nimport { IFeedbackDTO } from \"../Interfaces/DTOs/i-feedback-dto\";\r\nimport { toFeedbackDTO, toFeedbackDTOs } from \"../Utils/mappers/feedback-mapper\";\r\n\r\n@injectable()\r\nexport class FeedbackService implements IFeedbackService{\r\n  private _feedbackRepository: IFeedbackRepository;\r\n  private _collabRepository: ICollaborationRepository;\r\n\r\n  constructor(\r\n    @inject('IFeedbackRepository') feedbackRepository : IFeedbackRepository,\r\n    @inject('ICollaborationRepository') collaborationrepository : ICollaborationRepository\r\n  ) {\r\n    this._feedbackRepository = feedbackRepository;\r\n    this._collabRepository = collaborationrepository;\r\n  }\r\n\r\n   public createFeedback = async (feedbackData: Partial<IFeedback>): Promise<IFeedbackDTO> => {\r\n    try {\r\n      logger.debug(`Creating feedback for collaboration: ${feedbackData.collaborationId}`);\r\n\r\n      const collabId = feedbackData.collaborationId?.toString();\r\n      if (!collabId ) {\r\n        logger.error(\" missing collaboration ID\");\r\n        throw new ServiceError(\r\n          \"Collaboration ID is required\",\r\n          StatusCodes.BAD_REQUEST\r\n        );\r\n      }\r\n\r\n      const collabDetails = await this._collabRepository.findById(collabId);\r\n      if (!collabDetails) {\r\n        logger.error(`Collaboration not found: ${collabId}`);\r\n        throw new ServiceError(\"Collaboration not found\", StatusCodes.NOT_FOUND);\r\n      }\r\n\r\n      const today = new Date();\r\n      if (collabDetails.endDate && new Date(collabDetails.endDate) <= today) {\r\n        logger.debug(`Updating collaboration feedback status: ${collabId}`);\r\n        await this._collabRepository.updateCollabFeedback(collabId);\r\n      }\r\n\r\n      const feedback = await this._feedbackRepository.createFeedback(feedbackData);\r\n      const feedbackDTO = toFeedbackDTO(feedback);\r\n      if (!feedbackDTO) {\r\n        logger.error(`Failed to map feedback ${feedback._id} to DTO`);\r\n        throw new ServiceError(\"Failed to map feedback to DTO\", StatusCodes.INTERNAL_SERVER_ERROR);\r\n      }\r\n\r\n      logger.info(`Feedback created: ${feedback._id}`);\r\n      return feedbackDTO;\r\n    } catch (error: unknown) {\r\n      const err = error instanceof Error ? error : new Error(String(error));\r\n      logger.error(`Error creating feedback for collaboration ${feedbackData.collaborationId}: ${err.message}`);\r\n      throw error instanceof ServiceError\r\n        ? error\r\n        : new ServiceError(\r\n            \"Failed to create feedback\",\r\n            StatusCodes.INTERNAL_SERVER_ERROR,\r\n            err\r\n          );\r\n    }\r\n  };\r\n\r\n  public getMentorFeedbacks = async (\r\n    mentorId: string\r\n  ): Promise<{ feedbacks: IFeedbackDTO[]; averageRating: number; totalFeedbacks: number }> => {\r\n    try {\r\n      logger.debug(`Fetching feedbacks for mentor: ${mentorId}`);\r\n      const feedbacks = await this._feedbackRepository.getFeedbacksByMentorId(mentorId);\r\n      const feedbacksDTO = toFeedbackDTOs(feedbacks);\r\n      const averageRating = await this._feedbackRepository.getMentorAverageRating(mentorId);\r\n\r\n      logger.info(`Fetched ${feedbacksDTO.length} feedbacks for mentor: ${mentorId}`);\r\n      return {\r\n        feedbacks: feedbacksDTO,\r\n        averageRating,\r\n        totalFeedbacks: feedbacksDTO.length,\r\n      };\r\n    } catch (error: unknown) {\r\n      const err = error instanceof Error ? error : new Error(String(error));\r\n      logger.error(`Error fetching mentor feedbacks for mentor ${mentorId}: ${err.message}`);\r\n      throw error instanceof ServiceError\r\n        ? error\r\n        : new ServiceError(\r\n            \"Failed to fetch mentor feedbacks\",\r\n            StatusCodes.INTERNAL_SERVER_ERROR,\r\n            err\r\n          );\r\n    }\r\n  };\r\n\r\n  public getUserFeedbacks = async (userId: string): Promise<IFeedbackDTO[]> => {\r\n    try {\r\n      logger.debug(`Fetching feedbacks for user: ${userId}`);\r\n      const feedbacks = await this._feedbackRepository.getFeedbacksByUserId(userId);\r\n      const feedbacksDTO = toFeedbackDTOs(feedbacks);\r\n      logger.info(`Fetched ${feedbacksDTO.length} feedbacks for user: ${userId}`);\r\n      return feedbacksDTO;\r\n    } catch (error: unknown) {\r\n      const err = error instanceof Error ? error : new Error(String(error));\r\n      logger.error(`Error fetching user feedbacks for user ${userId}: ${err.message}`);\r\n      throw error instanceof ServiceError\r\n        ? error\r\n        : new ServiceError(\r\n            \"Failed to fetch user feedbacks\",\r\n            StatusCodes.INTERNAL_SERVER_ERROR,\r\n            err\r\n          );\r\n    }\r\n  };\r\n\r\n  public getFeedbackForProfile = async (\r\n    profileId: string,\r\n    profileType: \"mentor\" | \"user\"\r\n  ): Promise<{ feedbacks: IFeedbackDTO[]; totalFeedbacks: number }> => {\r\n    try {\r\n      logger.debug(`Fetching feedbacks for profile: ${profileId}, type: ${profileType}`);\r\n      if (![\"mentor\", \"user\"].includes(profileType)) {\r\n        logger.error(`Invalid profile type: ${profileType}`);\r\n        throw new ServiceError(\"Invalid profile type\", StatusCodes.BAD_REQUEST);\r\n      }\r\n\r\n      const feedbacks = await this._feedbackRepository.getFeedbackForProfile(profileId, profileType);\r\n      const feedbacksDTO = toFeedbackDTOs(feedbacks);\r\n      logger.info(`Fetched ${feedbacksDTO.length} feedbacks for profile: ${profileId}`);\r\n      return {\r\n        feedbacks: feedbacksDTO,\r\n        totalFeedbacks: feedbacksDTO.length,\r\n      };\r\n    } catch (error: unknown) {\r\n      const err = error instanceof Error ? error : new Error(String(error));\r\n      logger.error(`Error fetching feedbacks for profile ${profileId}: ${err.message}`);\r\n      throw error instanceof ServiceError\r\n        ? error\r\n        : new ServiceError(\r\n            \"Failed to fetch feedbacks for profile\",\r\n            StatusCodes.INTERNAL_SERVER_ERROR,\r\n            err\r\n          );\r\n    }\r\n  };\r\n\r\n  public getFeedbackByCollaborationId = async (collabId: string): Promise<IFeedbackDTO[]> => {\r\n    try {\r\n      logger.debug(`Fetching feedbacks for collaboration: ${collabId}`);\r\n      const feedbacks = await this._feedbackRepository.getFeedbackByCollaborationId(collabId);\r\n      const feedbacksDTO = toFeedbackDTOs(feedbacks);\r\n      logger.info(`Fetched ${feedbacksDTO.length} feedbacks for collaboration: ${collabId}`);\r\n      return feedbacksDTO;\r\n    } catch (error: unknown) {\r\n      const err = error instanceof Error ? error : new Error(String(error));\r\n      logger.error(`Error fetching feedbacks by collaboration ID ${collabId}: ${err.message}`);\r\n      throw error instanceof ServiceError\r\n        ? error\r\n        : new ServiceError(\r\n            \"Failed to fetch feedbacks by collaboration ID\",\r\n            StatusCodes.INTERNAL_SERVER_ERROR,\r\n            err\r\n          );\r\n    }\r\n  };\r\n\r\n  public toggleFeedback = async (feedbackId: string): Promise<IFeedbackDTO> => {\r\n    try {\r\n      logger.debug(`Toggling feedback visibility: ${feedbackId}`);\r\n      const feedback = await this._feedbackRepository.toggleIsHidden(feedbackId);\r\n      if (!feedback) {\r\n        logger.error(`Feedback not found: ${feedbackId}`);\r\n        throw new ServiceError(\"Feedback not found\", StatusCodes.NOT_FOUND);\r\n      }\r\n\r\n      const feedbackDTO = toFeedbackDTO(feedback);\r\n      if (!feedbackDTO) {\r\n        logger.error(`Failed to map feedback ${feedback._id} to DTO`);\r\n        throw new ServiceError(\"Failed to map feedback to DTO\", StatusCodes.INTERNAL_SERVER_ERROR);\r\n      }\r\n\r\n      logger.info(`Toggled feedback visibility: ${feedbackId}`);\r\n      return feedbackDTO;\r\n    } catch (error: unknown) {\r\n      const err = error instanceof Error ? error : new Error(String(error));\r\n      logger.error(`Error toggling feedback visibility for feedback ${feedbackId}: ${err.message}`);\r\n      throw error instanceof ServiceError\r\n        ? error\r\n        : new ServiceError(\r\n            \"Failed to toggle feedback visibility\",\r\n            StatusCodes.INTERNAL_SERVER_ERROR,\r\n            err\r\n          );\r\n    }\r\n  };\r\n\r\n  public getFeedbackByMentorId = async (mentorId: string): Promise<IFeedbackDTO[]> => {\r\n    try {\r\n      logger.debug(`Fetching feedbacks by mentor ID: ${mentorId}`);\r\n      const feedbacks = await this._feedbackRepository.getFeedbacksByMentorId(mentorId);\r\n      const feedbacksDTO = toFeedbackDTOs(feedbacks);\r\n      logger.info(`Fetched ${feedbacksDTO.length} feedbacks for mentor: ${mentorId}`);\r\n      return feedbacksDTO;\r\n    } catch (error: unknown) {\r\n      const err = error instanceof Error ? error : new Error(String(error));\r\n      logger.error(`Error fetching feedbacks by mentor ID ${mentorId}: ${err.message}`);\r\n      throw error instanceof ServiceError\r\n        ? error\r\n        : new ServiceError(\r\n            \"Failed to fetch feedbacks by mentor ID\",\r\n            StatusCodes.INTERNAL_SERVER_ERROR,\r\n            err\r\n          );\r\n    }\r\n  }\r\n}"]}