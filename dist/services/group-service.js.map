{"version":3,"file":"group-service.js","sourceRoot":"","sources":["../../src/services/group-service.ts"],"names":[],"mappings":"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","sourcesContent":["import { inject, injectable } from \"inversify\";\r\nimport { sendEmail } from \"../core/utils/email\";\r\nimport stripe from \"../core/utils/stripe\";\r\nimport { v4 as uuid } from \"uuid\";\r\nimport logger from \"../core/utils/logger\";\r\nimport { ServiceError } from \"../core/utils/error-handler\";\r\nimport { GroupFormData, GroupQuery } from \"../Utils/types/group-types\";\r\nimport { Types } from \"mongoose\";\r\nimport { IGroupService } from \"../Interfaces/Services/i-group-service\";\r\nimport { StatusCodes } from \"../enums/status-code-enums\";\r\nimport { IGroupRepository } from \"../Interfaces/Repository/i-group-repositry\";\r\nimport { IContactRepository } from \"../Interfaces/Repository/i-contact-repositry\";\r\nimport { IUserRepository } from \"../Interfaces/Repository/i-user-repositry\";\r\nimport { IGroupDTO } from \"../Interfaces/DTOs/i-group-dto\";\r\nimport { IGroupRequestDTO } from \"../Interfaces/DTOs/i-group-request-dto\";\r\nimport { toGroupDTO, toGroupDTOs } from \"../Utils/mappers/group-mapper\";\r\nimport { toGroupRequestDTO, toGroupRequestDTOs } from \"../Utils/mappers/group-request-mapper\";\r\n\r\n@injectable()\r\nexport class GroupService implements IGroupService {\r\n  private _groupRepository: IGroupRepository;\r\n  private _contactRepository: IContactRepository;\r\n  private _userRepository: IUserRepository;\r\n\r\n  constructor(\r\n    @inject('IGroupRepository') groupRepository : IGroupRepository,\r\n    @inject('IContactRepository') contactRepository :IContactRepository,\r\n    @inject('IUserRepository') userRepository : IUserRepository\r\n  ) {\r\n    this._groupRepository = groupRepository;\r\n    this._contactRepository = contactRepository;\r\n    this._userRepository = userRepository;\r\n  }\r\n\r\n  public createGroup = async (groupData: GroupFormData): Promise<IGroupDTO | null> => {\r\n    try {\r\n      logger.debug(`Creating group: ${groupData.name}`);\r\n\r\n      if (\r\n        !groupData.name ||\r\n        !groupData.bio ||\r\n        !groupData.adminId ||\r\n        !groupData.startDate\r\n      ) {\r\n        logger.error(\r\n          \"Missing required fields: name, bio, adminId, or startDate\"\r\n        );\r\n        throw new ServiceError(\r\n          \"Group name, bio, adminId, and startDate are required\",\r\n          StatusCodes.BAD_REQUEST\r\n        );\r\n      }\r\n\r\n      if (!Types.ObjectId.isValid(groupData.adminId)) {\r\n        logger.error(\"Invalid adminId\");\r\n        throw new ServiceError(\r\n          \"Admin ID must be a valid ObjectId\",\r\n          StatusCodes.BAD_REQUEST\r\n        );\r\n      }\r\n\r\n      if (!groupData.availableSlots || groupData.availableSlots.length === 0) {\r\n        logger.error(\"No available slots provided\");\r\n        throw new ServiceError(\r\n          \"At least one available slot is required\",\r\n          StatusCodes.BAD_REQUEST\r\n        );\r\n      }\r\n\r\n      if (groupData.maxMembers > 4) {\r\n        logger.error(\"Maximum members exceeded\");\r\n        throw new ServiceError(\r\n          \"Maximum members cannot exceed 4\",\r\n          StatusCodes.BAD_REQUEST\r\n        );\r\n      }\r\n\r\n      if (\r\n        groupData.members &&\r\n        groupData.members.some((id) => !Types.ObjectId.isValid(id))\r\n      ) {\r\n        logger.error(\"Invalid member ID in members array\");\r\n        throw new ServiceError(\r\n          \"All member IDs must be valid ObjectIds\",\r\n          StatusCodes.BAD_REQUEST\r\n        );\r\n      }\r\n\r\n      const newGroup = await this._groupRepository.createGroup({\r\n        ...groupData,\r\n        members: groupData.members || [],\r\n      });\r\n      logger.info(`Created group: ${newGroup._id} (${newGroup.name})`);\r\n\r\n      await this._contactRepository.createContact({\r\n        userId: groupData.adminId,\r\n        groupId: newGroup._id.toString(),\r\n        type: \"group\",\r\n      });\r\n      logger.info(\r\n        `Contact created for admin ${groupData.adminId} in group ${newGroup._id}`\r\n      );\r\n\r\n      return toGroupDTO(newGroup);\r\n    } catch (error: unknown) {\r\n      const err = error instanceof Error ? error : new Error(String(error));\r\n      logger.error(`Error creating group ${groupData.name}: ${err.message}`);\r\n      throw error instanceof ServiceError\r\n        ? error\r\n        : new ServiceError(\r\n            \"Failed to create group\",\r\n            StatusCodes.INTERNAL_SERVER_ERROR,\r\n            err\r\n          );\r\n    }\r\n  };\r\n\r\n  public getGroupDetails = async (adminId: string): Promise<IGroupDTO[]> => {\r\n    try {\r\n      logger.debug(`Fetching groups for admin: ${adminId}`);\r\n\r\n      if (!Types.ObjectId.isValid(adminId)) {\r\n        logger.error(\"Invalid admin ID\");\r\n        throw new ServiceError(\r\n          \"Admin ID must be a valid ObjectId\",\r\n          StatusCodes.BAD_REQUEST\r\n        );\r\n      }\r\n\r\n      const groups = await this._groupRepository.getGroupsByAdminId(adminId);\r\n      logger.info(`Fetched ${groups.length} groups for admin: ${adminId}`);\r\n      return toGroupDTOs(groups);\r\n    } catch (error: unknown) {\r\n      const err = error instanceof Error ? error : new Error(String(error));\r\n      logger.error(\r\n        `Error fetching groups for admin ${adminId}: ${err.message}`\r\n      );\r\n      throw error instanceof ServiceError\r\n        ? error\r\n        : new ServiceError(\r\n            \"Failed to fetch groups for admin\",\r\n            StatusCodes.INTERNAL_SERVER_ERROR,\r\n            err\r\n          );\r\n    }\r\n  };\r\n\r\n  public getGroupById = async (groupId: string): Promise<IGroupDTO | null> => {\r\n    try {\r\n      logger.debug(`Fetching group by ID: ${groupId}`);\r\n\r\n      if (!Types.ObjectId.isValid(groupId)) {\r\n        logger.error(\"Invalid group ID\");\r\n        throw new ServiceError(\r\n          \"Group ID must be a valid ObjectId\",\r\n          StatusCodes.BAD_REQUEST\r\n        );\r\n      }\r\n\r\n      const group = await this._groupRepository.getGroupById(groupId);\r\n      if (!group) {\r\n        logger.warn(`Group not found: ${groupId}`);\r\n        throw new ServiceError(\"Group not found\", StatusCodes.NOT_FOUND);\r\n      }\r\n\r\n      logger.info(`Fetched group: ${groupId} (${group.name})`);\r\n      return toGroupDTO(group);\r\n    } catch (error: unknown) {\r\n      const err = error instanceof Error ? error : new Error(String(error));\r\n      logger.error(`Error fetching group ${groupId}: ${err.message}`);\r\n      throw error instanceof ServiceError\r\n        ? error\r\n        : new ServiceError(\r\n            \"Failed to fetch group\",\r\n            StatusCodes.INTERNAL_SERVER_ERROR,\r\n            err\r\n          );\r\n    }\r\n  };\r\n\r\n  public getAllGroups = async (\r\n    query: GroupQuery = {}\r\n  ): Promise<{ groups: IGroupDTO[]; total: number }> => {\r\n    try {\r\n      logger.debug(`Fetching all groups with query: ${JSON.stringify(query)}`);\r\n      const result = await this._groupRepository.getAllGroups(query);\r\n      // logger.debug(`Raw group data from repository: ${JSON.stringify(result.groups, null, 2)}`);\r\n      logger.info(\r\n        `Fetched ${result.groups} groups, total: ${result.total}`\r\n      );\r\n      return {\r\n        groups: toGroupDTOs(result.groups),\r\n        total:result.total\r\n      };\r\n    } catch (error: unknown) {\r\n      const err = error instanceof Error ? error : new Error(String(error));\r\n      logger.error(`Error fetching all groups: ${err.message}`);\r\n      throw error instanceof ServiceError\r\n        ? error\r\n        : new ServiceError(\r\n            \"Failed to fetch all groups\",\r\n            StatusCodes.INTERNAL_SERVER_ERROR,\r\n            err\r\n          );\r\n    }\r\n  };\r\n\r\n  public requestToJoinGroup = async (\r\n    groupId: string,\r\n    userId: string\r\n  ): Promise<IGroupRequestDTO> => {\r\n    try {\r\n      logger.debug(\r\n        `Creating group request for group: ${groupId}, user: ${userId}`\r\n      );\r\n\r\n      if (!Types.ObjectId.isValid(groupId) || !Types.ObjectId.isValid(userId)) {\r\n        logger.error(\"Invalid group ID or user ID\");\r\n        throw new ServiceError(\r\n          \"Group ID and User ID must be valid ObjectIds\",\r\n          StatusCodes.BAD_REQUEST\r\n        );\r\n      }\r\n\r\n      const group = await this._groupRepository.getGroupById(groupId);\r\n      if (!group) {\r\n        logger.error(`Group not found: ${groupId}`);\r\n        throw new ServiceError(\"Group not found\", StatusCodes.NOT_FOUND);\r\n      }\r\n\r\n      const request = await this._groupRepository.createGroupRequest({\r\n        groupId,\r\n        userId,\r\n      });\r\n      logger.info(\r\n        `Group request created: ${request._id} for group ${groupId}, user ${userId}`\r\n      );\r\n      return toGroupRequestDTO(request)!;\r\n    } catch (error: unknown) {\r\n      const err = error instanceof Error ? error : new Error(String(error));\r\n      logger.error(\r\n        `Error creating group request for group ${groupId}, user ${userId}: ${err.message}`\r\n      );\r\n      throw error instanceof ServiceError\r\n        ? error\r\n        : new ServiceError(\r\n            \"Failed to create group request\",\r\n            StatusCodes.INTERNAL_SERVER_ERROR,\r\n            err\r\n          );\r\n    }\r\n  };\r\n\r\n  public getGroupRequestsByGroupId = async (\r\n    groupId: string\r\n  ): Promise<IGroupRequestDTO[]> => {\r\n    try {\r\n      logger.debug(`Fetching group requests for group: ${groupId}`);\r\n\r\n      if (!Types.ObjectId.isValid(groupId)) {\r\n        logger.error(\"Invalid group ID\");\r\n        throw new ServiceError(\r\n          \"Group ID must be a valid ObjectId\",\r\n          StatusCodes.BAD_REQUEST\r\n        );\r\n      }\r\n\r\n      const requests = await this._groupRepository.getGroupRequestsByGroupId(groupId);\r\n      logger.info(\r\n        `Fetched ${requests.length} group requests for group: ${groupId}`\r\n      );\r\n      return toGroupRequestDTOs(requests);\r\n    } catch (error: unknown) {\r\n      const err = error instanceof Error ? error : new Error(String(error));\r\n      logger.error(\r\n        `Error fetching group requests for group ${groupId}: ${err.message}`\r\n      );\r\n      throw error instanceof ServiceError\r\n        ? error\r\n        : new ServiceError(\r\n            \"Failed to fetch group requests\",\r\n            StatusCodes.INTERNAL_SERVER_ERROR,\r\n            err\r\n          );\r\n    }\r\n  };\r\n\r\n  public getGroupRequestsByAdminId = async (\r\n    adminId: string\r\n  ): Promise<IGroupRequestDTO[]> => {\r\n    try {\r\n      logger.debug(`Fetching group requests for admin: ${adminId}`);\r\n\r\n      if (!Types.ObjectId.isValid(adminId)) {\r\n        logger.error(\"Invalid admin ID\");\r\n        throw new ServiceError(\r\n          \"Admin ID must be a valid ObjectId\",\r\n          StatusCodes.BAD_REQUEST\r\n        );\r\n      }\r\n\r\n      const requests = await this._groupRepository.getGroupRequestsByAdminId(adminId);\r\n      logger.info(\r\n        `Fetched ${requests.length} group requests for admin: ${adminId}`\r\n      );\r\n      return toGroupRequestDTOs(requests);\r\n    } catch (error: unknown) {\r\n      const err = error instanceof Error ? error : new Error(String(error));\r\n      logger.error(\r\n        `Error fetching group requests for admin ${adminId}: ${err.message}`\r\n      );\r\n      throw error instanceof ServiceError\r\n        ? error\r\n        : new ServiceError(\r\n            \"Failed to fetch group requests for admin\",\r\n            StatusCodes.INTERNAL_SERVER_ERROR,\r\n            err\r\n          );\r\n    }\r\n  };\r\n\r\n  public getGroupRequestsByUserId = async (\r\n    userId: string\r\n  ): Promise<IGroupRequestDTO[]> => {\r\n    try {\r\n      logger.debug(`Fetching group requests for user: ${userId}`);\r\n\r\n      if (!Types.ObjectId.isValid(userId)) {\r\n        logger.error(\"Invalid user ID\");\r\n        throw new ServiceError(\r\n          \"User ID must be a valid ObjectId\",\r\n          StatusCodes.BAD_REQUEST\r\n        );\r\n      }\r\n\r\n      const requests = await this._groupRepository.getGroupRequestsByUserId(userId);\r\n      logger.info(\r\n        `Fetched ${requests.length} group requests for user: ${userId}`\r\n      );\r\n      return toGroupRequestDTOs(requests);\r\n    } catch (error: unknown) {\r\n      const err = error instanceof Error ? error : new Error(String(error));\r\n      logger.error(\r\n        `Error fetching group requests for user ${userId}: ${err.message}`\r\n      );\r\n      throw error instanceof ServiceError\r\n        ? error\r\n        : new ServiceError(\r\n            \"Failed to fetch group requests for user\",\r\n            StatusCodes.INTERNAL_SERVER_ERROR,\r\n            err\r\n          );\r\n    }\r\n  };\r\n\r\n  public getGroupRequestById = async (\r\n    requestId: string\r\n  ): Promise<IGroupRequestDTO | null> => {\r\n    try {\r\n      logger.debug(`Fetching group request by ID: ${requestId}`);\r\n\r\n      if (!Types.ObjectId.isValid(requestId)) {\r\n        logger.error(\"Invalid request ID\");\r\n        throw new ServiceError(\r\n          \"Request ID must be a valid ObjectId\",\r\n          StatusCodes.BAD_REQUEST\r\n        );\r\n      }\r\n\r\n      const request = await this._groupRepository.findGroupRequestById(requestId);\r\n      if (!request) {\r\n        logger.warn(`Group request not found: ${requestId}`);\r\n        throw new ServiceError(\r\n          \"Group request not found\",\r\n          StatusCodes.NOT_FOUND\r\n        );\r\n      }\r\n\r\n      logger.info(`Fetched group request: ${requestId}`);\r\n      return toGroupRequestDTO(request);\r\n    } catch (error: unknown) {\r\n      const err = error instanceof Error ? error : new Error(String(error));\r\n      logger.error(`Error fetching group request ${requestId}: ${err.message}`);\r\n      throw error instanceof ServiceError\r\n        ? error\r\n        : new ServiceError(\r\n            \"Failed to fetch group request\",\r\n            StatusCodes.INTERNAL_SERVER_ERROR,\r\n            err\r\n          );\r\n    }\r\n  };\r\n\r\n  //Accept the Request or Reject the request\r\n  public modifyGroupRequestStatus = async (\r\n    requestId: string,\r\n    status: \"Accepted\" | \"Rejected\"\r\n  ): Promise<{\r\n    message: string;\r\n    requiresPayment?: boolean;\r\n    groupPrice?: number;\r\n    groupId?: string;\r\n  }> => {\r\n    try {\r\n      logger.debug(`Modifying group request status: ${requestId} to ${status}`);\r\n\r\n      if (!Types.ObjectId.isValid(requestId)) {\r\n        logger.error(\"Invalid request ID\");\r\n        throw new ServiceError(\r\n          \"Request ID must be a valid ObjectId\",\r\n          StatusCodes.BAD_REQUEST\r\n        );\r\n      }\r\n\r\n      const validStatuses = [\"Accepted\", \"Rejected\"];\r\n      if (!validStatuses.includes(status)) {\r\n        logger.error(`Invalid status: ${status}`);\r\n        throw new ServiceError(\r\n          `Status must be one of: ${validStatuses.join(\", \")}`,\r\n          StatusCodes.BAD_REQUEST\r\n        );\r\n      }\r\n\r\n      const request = await this._groupRepository.findGroupRequestById(requestId);\r\n      if (!request) {\r\n        logger.error(`Group request not found: ${requestId}`);\r\n        throw new ServiceError(\r\n          \"Group request not found\",\r\n          StatusCodes.NOT_FOUND\r\n        );\r\n      }\r\n\r\n      if (!request.groupId?._id) {\r\n        logger.error(`Group ID not found in request: ${requestId}`);\r\n        throw new ServiceError(\r\n          \"Group ID not found in request\",\r\n          StatusCodes.BAD_REQUEST\r\n        );\r\n      }\r\n\r\n      if (!request.userId?._id) {\r\n        logger.error(`User ID not found in request: ${requestId}`);\r\n        throw new ServiceError(\r\n          \"User ID not found in request\",\r\n          StatusCodes.BAD_REQUEST\r\n        );\r\n      }\r\n\r\n      const group = await this._groupRepository.getGroupById(\r\n        request.groupId._id.toString()\r\n      );\r\n      if (!group) {\r\n        logger.error(`Group not found: ${request.groupId._id}`);\r\n        throw new ServiceError(\"Group not found\", StatusCodes.NOT_FOUND);\r\n      }\r\n\r\n      if (status === \"Accepted\") {\r\n        if (group.isFull || group.members.length >= group.maxMembers) {\r\n          logger.error(\r\n            `Cannot accept request for group ${group._id}: Group is full`\r\n          );\r\n          throw new ServiceError(\r\n            \"Cannot accept request. Group is full (maximum 4 members)\",\r\n            StatusCodes.BAD_REQUEST\r\n          );\r\n        }\r\n\r\n        await this._groupRepository.updateGroupRequestStatus(requestId, \"Accepted\");\r\n\r\n        if (group.price > 0) {\r\n          logger.info(`Group ${group._id} requires payment: ${group.price}`);\r\n          return {\r\n            message: \"Request accepted. Awaiting payment\",\r\n            requiresPayment: true,\r\n            groupPrice: group.price,\r\n            groupId: group._id.toString(),\r\n          };\r\n        } else {\r\n          await this._groupRepository.addMemberToGroup(\r\n            group._id.toString(),\r\n            request.userId._id.toString()\r\n          );\r\n          await this._contactRepository.createContact({\r\n            userId: request.userId._id.toString(),\r\n            groupId: group._id.toString(),\r\n            type: \"group\",\r\n          });\r\n          await this._groupRepository.deleteGroupRequest(requestId);\r\n\r\n          const updatedGroup = await this._groupRepository.getGroupById(\r\n            group._id.toString()\r\n          );\r\n          if (!updatedGroup) {\r\n            logger.error(\r\n              `Failed to fetch updated group ${group._id} after adding member`\r\n            );\r\n            throw new ServiceError(\r\n              \"Failed to fetch updated group\",\r\n              StatusCodes.INTERNAL_SERVER_ERROR\r\n            );\r\n          }\r\n\r\n          const userInGroup = updatedGroup.members.some((m) =>\r\n            m.userId instanceof Types.ObjectId\r\n              ? m.userId.toString() === request.userId._id.toString()\r\n              : (m.userId as any)?._id?.toString() ===\r\n                request.userId._id.toString()\r\n          );\r\n\r\n          if (!userInGroup) {\r\n            logger.error(\r\n              `User ${request.userId._id} not found in group ${group._id} members after addition`\r\n            );\r\n            throw new ServiceError(\r\n              \"Failed to add member to group\",\r\n              StatusCodes.INTERNAL_SERVER_ERROR\r\n            );\r\n          }\r\n\r\n          logger.info(`User ${request.userId._id} added to group ${group._id}`);\r\n          return { message: \"User added to group successfully\" };\r\n        }\r\n      } else {\r\n        await this._groupRepository.updateGroupRequestStatus(requestId, \"Rejected\");\r\n        logger.info(`Group request ${requestId} rejected`);\r\n        return { message: \"Request rejected successfully\" };\r\n      }\r\n    } catch (error: unknown) {\r\n      const err = error instanceof Error ? error : new Error(String(error));\r\n      logger.error(\r\n        `Error modifying group request ${requestId}: ${err.message}`\r\n      );\r\n      throw error instanceof ServiceError\r\n        ? error\r\n        : new ServiceError(\r\n            \"Failed to modify group request\",\r\n            StatusCodes.INTERNAL_SERVER_ERROR,\r\n            err\r\n          );\r\n    }\r\n  };\r\n\r\n  public processGroupPayment = async (\r\n    paymentMethodId: string | { id: string },\r\n    amount: number,\r\n    requestId: string,\r\n    email: string,\r\n    groupRequestData: { groupId: string; userId: string },\r\n    returnUrl: string\r\n  ): Promise<{ paymentIntent: any }> => {\r\n    try {\r\n      logger.debug(`Processing payment for group request: ${requestId}`);\r\n\r\n      if (\r\n        !Types.ObjectId.isValid(requestId) ||\r\n        !Types.ObjectId.isValid(groupRequestData.groupId) ||\r\n        !Types.ObjectId.isValid(groupRequestData.userId)\r\n      ) {\r\n        logger.error(\"Invalid request ID, group ID, or user ID\");\r\n        throw new ServiceError(\r\n          \"Request ID, Group ID, and User ID must be valid ObjectIds\",\r\n          StatusCodes.BAD_REQUEST\r\n        );\r\n      }\r\n\r\n      if (amount <= 0) {\r\n        logger.error(\"Invalid payment amount\");\r\n        throw new ServiceError(\r\n          \"Payment amount must be greater than 0\",\r\n          StatusCodes.BAD_REQUEST\r\n        );\r\n      }\r\n\r\n      const request = await this._groupRepository.findGroupRequestById(requestId);\r\n      if (!request) {\r\n        logger.error(`Group request not found: ${requestId}`);\r\n        throw new ServiceError(\r\n          \"Group request not found\",\r\n          StatusCodes.NOT_FOUND\r\n        );\r\n      }\r\n\r\n      const group = await this._groupRepository.getGroupById(groupRequestData.groupId);\r\n      if (!group) {\r\n        logger.error(`Group not found: ${groupRequestData.groupId}`);\r\n        throw new ServiceError(\"Group not found\", StatusCodes.NOT_FOUND);\r\n      }\r\n\r\n      if (group.isFull || group.members.length >= group.maxMembers) {\r\n        logger.error(\r\n          `Cannot complete payment for group ${group._id}: Group is full`\r\n        );\r\n        throw new ServiceError(\r\n          \"Cannot complete payment. Group is full (maximum 4 members)\",\r\n          StatusCodes.BAD_REQUEST\r\n        );\r\n      }\r\n\r\n      const paymentMethodIdString =\r\n        typeof paymentMethodId === \"string\"\r\n          ? paymentMethodId\r\n          : paymentMethodId.id;\r\n      if (!paymentMethodIdString) {\r\n        logger.error(\"Invalid paymentMethodId\");\r\n        throw new ServiceError(\r\n          \"Invalid paymentMethodId\",\r\n          StatusCodes.BAD_REQUEST\r\n        );\r\n      }\r\n\r\n      const idempotencyKey = uuid();\r\n      let customers = await stripe.customers.list({ email, limit: 1 });\r\n      let customer = customers.data.length > 0 ? customers.data[0] : null;\r\n\r\n      if (!customer) {\r\n        customer = await stripe.customers.create({\r\n          email,\r\n          payment_method: paymentMethodIdString,\r\n          invoice_settings: { default_payment_method: paymentMethodIdString },\r\n        });\r\n        logger.info(`Created new Stripe customer for email: ${email}`);\r\n      }\r\n\r\n      const paymentIntent = await stripe.paymentIntents.create(\r\n        {\r\n          amount,\r\n          currency: \"inr\",\r\n          customer: customer.id,\r\n          payment_method: paymentMethodIdString,\r\n          confirm: true,\r\n          description: `Payment for Group Request ID: ${requestId}`,\r\n          receipt_email: email,\r\n          metadata: {\r\n            requestId,\r\n            groupId: groupRequestData.groupId,\r\n            userId: groupRequestData.userId,\r\n          },\r\n          return_url: `${returnUrl}?payment_status=success&request_id=${requestId}`,\r\n        },\r\n        { idempotencyKey }\r\n      );\r\n\r\n      if (paymentIntent.status === \"succeeded\") {\r\n        await this._groupRepository.updateGroupPaymentStatus(requestId, amount / 100);\r\n        await this._groupRepository.addMemberToGroup(\r\n          groupRequestData.groupId,\r\n          groupRequestData.userId\r\n        );\r\n        await this._contactRepository.createContact({\r\n          userId: groupRequestData.userId,\r\n          groupId: groupRequestData.groupId,\r\n          type: \"group\",\r\n        });\r\n        await this._groupRepository.deleteGroupRequest(requestId);\r\n        logger.info(\r\n          `Payment processed and user ${groupRequestData.userId} added to group ${groupRequestData.groupId}`\r\n        );\r\n      }\r\n\r\n      return { paymentIntent };\r\n    } catch (error: unknown) {\r\n      const err = error instanceof Error ? error : new Error(String(error));\r\n      logger.error(\r\n        `Error processing payment for group request ${requestId}: ${err.message}`\r\n      );\r\n      throw error instanceof ServiceError\r\n        ? error\r\n        : new ServiceError(\r\n            \"Failed to process group payment\",\r\n            StatusCodes.INTERNAL_SERVER_ERROR,\r\n            err\r\n          );\r\n    }\r\n  };\r\n\r\n  public removeGroupMember = async (\r\n    groupId: string,\r\n    userId: string\r\n  ): Promise<IGroupDTO | null> => {\r\n    try {\r\n      logger.debug(`Removing user ${userId} from group ${groupId}`);\r\n\r\n      if (!Types.ObjectId.isValid(groupId) || !Types.ObjectId.isValid(userId)) {\r\n        logger.error(\"Invalid group ID or user ID\");\r\n        throw new ServiceError(\r\n          \"Group ID and User ID must be valid ObjectIds\",\r\n          StatusCodes.BAD_REQUEST\r\n        );\r\n      }\r\n\r\n      const group = await this._groupRepository.getGroupById(groupId);\r\n      if (!group) {\r\n        logger.error(`Group not found: ${groupId}`);\r\n        throw new ServiceError(\"Group not found\", StatusCodes.NOT_FOUND);\r\n      }\r\n\r\n      const user = await this._userRepository.findById(userId);\r\n      if (!user) {\r\n        logger.error(`User not found: ${userId}`);\r\n        throw new ServiceError(\"User not found\", StatusCodes.NOT_FOUND);\r\n      }\r\n\r\n      const userInGroup = group.members.some((m) =>\r\n        m.userId instanceof Types.ObjectId\r\n          ? m.userId.toString() === userId\r\n          : (m.userId as any)?._id?.toString() === userId\r\n      );\r\n\r\n      if (!userInGroup) {\r\n        logger.error(`User ${userId} not found in group ${groupId}`);\r\n        throw new ServiceError(\r\n          \"User not found in group\",\r\n          StatusCodes.BAD_REQUEST\r\n        );\r\n      }\r\n\r\n      await this._groupRepository.removeGroupMember(groupId, userId);\r\n      await this._contactRepository.deleteContact(groupId, \"group\", userId);\r\n\r\n      const updatedGroup = await this._groupRepository.getGroupById(groupId);\r\n      if (!updatedGroup) {\r\n        logger.error(\r\n          `Failed to fetch updated group ${groupId} after removing member`\r\n        );\r\n        throw new ServiceError(\r\n          \"Failed to fetch updated group\",\r\n          StatusCodes.INTERNAL_SERVER_ERROR\r\n        );\r\n      }\r\n\r\n      const userStillInGroup = updatedGroup.members.some((m) =>\r\n        m.userId instanceof Types.ObjectId\r\n          ? m.userId.toString() === userId\r\n          : (m.userId as any)?._id?.toString() === userId\r\n      );\r\n\r\n      if (userStillInGroup) {\r\n        logger.error(`Failed to remove user ${userId} from group ${groupId}`);\r\n        throw new ServiceError(\r\n          \"Failed to remove user from group\",\r\n          StatusCodes.INTERNAL_SERVER_ERROR\r\n        );\r\n      }\r\n\r\n      const subject = `You have been removed from the group \"${group.name}\"`;\r\n      const text = `Hi ${user.name},\\n\\nWe wanted to inform you that you have been removed from the group \"${group.name}\" on ConnectSphere.\\n\\nIf you believe this was a mistake or have any questions, feel free to reach out to our support team.\\n\\nBest regards,\\nConnectSphere Team`;\r\n      await sendEmail(user.email, subject, text);\r\n      logger.info(`Removal email sent to: ${user.email}`);\r\n\r\n      logger.info(\r\n        `User ${userId} removed from group ${groupId} and contact deleted`\r\n      );\r\n      return toGroupDTO(updatedGroup);\r\n    } catch (error: unknown) {\r\n      const err = error instanceof Error ? error : new Error(String(error));\r\n      logger.error(\r\n        `Error removing user ${userId} from group ${groupId}: ${err.message}`\r\n      );\r\n      throw error instanceof ServiceError\r\n        ? error\r\n        : new ServiceError(\r\n            \"Failed to remove group member\",\r\n            StatusCodes.INTERNAL_SERVER_ERROR,\r\n            err\r\n          );\r\n    }\r\n  };\r\n\r\n  public deleteGroup = async (groupId: string): Promise<IGroupDTO | null> => {\r\n    try {\r\n      logger.debug(`Deleting group: ${groupId}`);\r\n\r\n      if (!Types.ObjectId.isValid(groupId)) {\r\n        logger.error(\"Invalid group ID\");\r\n        throw new ServiceError(\r\n          \"Group ID must be a valid ObjectId\",\r\n          StatusCodes.BAD_REQUEST\r\n        );\r\n      }\r\n\r\n      const group = await this._groupRepository.getGroupById(groupId);\r\n      if (!group) {\r\n        logger.error(`Group not found: ${groupId}`);\r\n        throw new ServiceError(\"Group not found\", StatusCodes.NOT_FOUND);\r\n      }\r\n\r\n      await this._groupRepository.deleteGroupRequestsByGroupId(groupId);\r\n      await this._contactRepository.deleteContact(groupId, \"group\");\r\n      const deletedGroup = await this._groupRepository.deleteGroupById(groupId);\r\n\r\n      logger.info(\r\n        `Group ${groupId} deleted and associated contacts and requests removed`\r\n      );\r\n      const deletedGroupDTO = toGroupDTO(deletedGroup);\r\n      return deletedGroupDTO;\r\n    } catch (error: unknown) {\r\n      const err = error instanceof Error ? error : new Error(String(error));\r\n      logger.error(`Error deleting group ${groupId}: ${err.message}`);\r\n      throw error instanceof ServiceError\r\n        ? error\r\n        : new ServiceError(\r\n            \"Failed to delete group\",\r\n            StatusCodes.INTERNAL_SERVER_ERROR,\r\n            err\r\n          );\r\n    }\r\n  };\r\n\r\n  public updateGroupImage = async (\r\n    groupId: string,\r\n    profilePic?: string,\r\n    coverPic?: string\r\n  ): Promise<IGroupDTO | null> => {\r\n    try {\r\n      logger.debug(`Updating group image for group: ${groupId}`);\r\n\r\n      if (!Types.ObjectId.isValid(groupId)) {\r\n        logger.error(\"Invalid group ID\");\r\n        throw new ServiceError(\r\n          \"Group ID must be a valid ObjectId\",\r\n          StatusCodes.BAD_REQUEST\r\n        );\r\n      }\r\n\r\n      const updateData: { profilePic?: string; coverPic?: string } = {};\r\n      if (profilePic) updateData.profilePic = profilePic;\r\n      if (coverPic) updateData.coverPic = coverPic;\r\n\r\n      if (Object.keys(updateData).length === 0) {\r\n        logger.error(\"No image data provided\");\r\n        throw new ServiceError(\r\n          \"No image data provided\",\r\n          StatusCodes.BAD_REQUEST\r\n        );\r\n      }\r\n\r\n      const updatedGroup = await this._groupRepository.updateGroupImage(\r\n        groupId,\r\n        updateData\r\n      );\r\n      if (!updatedGroup) {\r\n        logger.warn(`Group not found: ${groupId}`);\r\n        throw new ServiceError(\"Group not found\", StatusCodes.NOT_FOUND);\r\n      }\r\n\r\n      logger.info(`Group image updated for group: ${groupId}`);\r\n      return toGroupDTO(updatedGroup);\r\n    } catch (error: unknown) {\r\n      const err = error instanceof Error ? error : new Error(String(error));\r\n      logger.error(\r\n        `Error updating group image for group ${groupId}: ${err.message}`\r\n      );\r\n      throw error instanceof ServiceError\r\n        ? error\r\n        : new ServiceError(\r\n            \"Failed to update group image\",\r\n            StatusCodes.INTERNAL_SERVER_ERROR,\r\n            err\r\n          );\r\n    }\r\n  };\r\n\r\n  public getGroupDetailsForMembers = async (\r\n    userId: string\r\n  ): Promise<IGroupDTO[]> => {\r\n    try {\r\n      logger.debug(`Fetching group details for member: ${userId}`);\r\n\r\n      if (!Types.ObjectId.isValid(userId)) {\r\n        logger.error(\"Invalid user ID\");\r\n        throw new ServiceError(\r\n          \"User ID must be a valid ObjectId\",\r\n          StatusCodes.BAD_REQUEST\r\n        );\r\n      }\r\n\r\n      const groups = await this._groupRepository.getGroupDetailsByUserId(userId);\r\n      logger.info(`Fetched ${groups.length} groups for member: ${userId}`);\r\n      return toGroupDTOs(groups);\r\n    } catch (error: unknown) {\r\n      const err = error instanceof Error ? error : new Error(String(error));\r\n      logger.error(\r\n        `Error fetching group details for member ${userId}: ${err.message}`\r\n      );\r\n      throw error instanceof ServiceError\r\n        ? error\r\n        : new ServiceError(\r\n            \"Failed to fetch group details for member\",\r\n            StatusCodes.INTERNAL_SERVER_ERROR,\r\n            err\r\n          );\r\n    }\r\n  };\r\n\r\n  public getAllGroupRequests = async (\r\n  search: string = \"\",\r\n  page: number = 1,\r\n  limit: number = 10\r\n): Promise<{ requests: IGroupRequestDTO[]; total: number }> => {\r\n  try {\r\n    logger.debug(`Service: fetching group requests (search=\"${search}\")`);\r\n    const result = await this._groupRepository.getAllGroupRequests(search, page, limit);\r\n\r\n    const requests = toGroupRequestDTOs(result);\r\n    const total = (result as any).total || requests.length;\r\n\r\n    logger.info(`Service: fetched ${requests.length} group requests`);\r\n    return { requests, total };\r\n  } catch (error: unknown) {\r\n    const err = error instanceof Error ? error : new Error(String(error));\r\n    logger.error(`Service error in getAllGroupRequests: ${err.message}`);\r\n    throw new ServiceError(\r\n      \"Failed to fetch group requests\",\r\n      StatusCodes.INTERNAL_SERVER_ERROR,\r\n      err\r\n    );\r\n  }\r\n};\r\n}\r\n"]}