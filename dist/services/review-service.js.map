{"version":3,"file":"review-service.js","sourceRoot":"","sources":["../../src/services/review-service.ts"],"names":[],"mappings":"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","sourcesContent":["import { inject, injectable } from \"inversify\";\r\nimport { ServiceError } from '../core/utils/error-handler';\r\nimport logger from '../core/utils/logger';\r\nimport { IReviewService } from '../Interfaces/Services/i-review-service';\r\nimport { StatusCodes } from '../enums/status-code-enums';\r\nimport { IReviewRepository } from \"../Interfaces/Repository/i-review-repositry\";\r\nimport { IUserRepository } from \"../Interfaces/Repository/i-user-repositry\";\r\nimport { toReviewDTO, toReviewDTOs } from \"../Utils/mappers/review-mapper\";\r\nimport { IReviewDTO } from \"../Interfaces/DTOs/i-review-dto\";\r\n\r\n@injectable()\r\nexport class ReviewService implements IReviewService{\r\n  private _reviewRepository: IReviewRepository;\r\n  private _userRepository: IUserRepository;\r\n\r\n  constructor(\r\n    @inject('IReviewRepository') reviewRepository : IReviewRepository,\r\n    @inject('IUserRepository') userRepository : IUserRepository,\r\n  ) {\r\n    this._reviewRepository = reviewRepository;\r\n    this._userRepository = userRepository;\r\n  }\r\n\r\n   public submitReview = async (userId: string, rating: number, comment: string): Promise<IReviewDTO> => {\r\n    try {\r\n      logger.debug(`Submitting review for user: ${userId}`);\r\n      if (rating < 1 || rating > 5) {\r\n        logger.error(`Invalid rating: ${rating}`);\r\n        throw new ServiceError(\"Rating must be between 1 and 5\", StatusCodes.BAD_REQUEST);\r\n      }\r\n\r\n      if (!comment || comment.trim() === \"\") {\r\n        logger.error(\"Comment is required\");\r\n        throw new ServiceError(\"Comment is required\", StatusCodes.BAD_REQUEST);\r\n      }\r\n\r\n      const user = await this._userRepository.findById(userId);\r\n      if (!user) {\r\n        logger.error(`User not found: ${userId}`);\r\n        throw new ServiceError(\"User not found\", StatusCodes.NOT_FOUND);\r\n      }\r\n\r\n      if (user.hasReviewed) {\r\n        logger.error(`User has already submitted a review: ${userId}`);\r\n        throw new ServiceError(\"User has already submitted a review\", StatusCodes.BAD_REQUEST);\r\n      }\r\n\r\n      const review = await this._reviewRepository.createReview({ userId, rating, comment });\r\n      const reviewDTO = toReviewDTO(review);\r\n      if (!reviewDTO) {\r\n        logger.error(`Failed to map review ${review._id} to DTO`);\r\n        throw new ServiceError(\"Failed to map review to DTO\", StatusCodes.INTERNAL_SERVER_ERROR);\r\n      }\r\n\r\n      await this._userRepository.update(userId, { hasReviewed: true, loginCount: 0 });\r\n      logger.info(`Review submitted for user: ${userId}, review ID: ${review._id}`);\r\n      return reviewDTO;\r\n    } catch (error: unknown) {\r\n      const err = error instanceof Error ? error : new Error(String(error));\r\n      logger.error(`Error submitting review for user ${userId}: ${err.message}`);\r\n      throw error instanceof ServiceError\r\n        ? error\r\n        : new ServiceError(\r\n            \"Failed to submit review\",\r\n            StatusCodes.INTERNAL_SERVER_ERROR,\r\n            err\r\n          );\r\n    }\r\n  };\r\n\r\n  public skipReview = async (userId: string): Promise<void> => {\r\n    try {\r\n      logger.debug(`Skipping review for user: ${userId}`);\r\n      const user = await this._userRepository.findById(userId);\r\n      if (!user) {\r\n        logger.error(`User not found: ${userId}`);\r\n        throw new ServiceError(\"User not found\", StatusCodes.NOT_FOUND);\r\n      }\r\n\r\n      await this._userRepository.update(userId, { loginCount: 0 });\r\n      logger.info(`Review skipped for user: ${userId}`);\r\n    } catch (error: unknown) {\r\n      const err = error instanceof Error ? error : new Error(String(error));\r\n      logger.error(`Error skipping review for user ${userId}: ${err.message}`);\r\n      throw error instanceof ServiceError\r\n        ? error\r\n        : new ServiceError(\r\n            \"Failed to skip review\",\r\n            StatusCodes.INTERNAL_SERVER_ERROR,\r\n            err\r\n          );\r\n    }\r\n  };\r\n\r\n  public getAllReviews = async ({\r\n  page = 1,\r\n  limit = 10,\r\n  search = \"\",\r\n}: {\r\n  page?: number;\r\n  limit?: number;\r\n  search?: string;\r\n}): Promise<{\r\n  reviews: IReviewDTO[];\r\n  total: number;\r\n  page: number;\r\n  pages: number;\r\n}> => {\r\n  try {\r\n    logger.debug(\r\n      `Fetching paginated reviews from service (page=${page}, limit=${limit}, search=${search})`\r\n    );\r\n\r\n    const result = await this._reviewRepository.getAllReviews({\r\n      page,\r\n      limit,\r\n      search,\r\n    });\r\n\r\n    const reviewsDTO = toReviewDTOs(result.reviews);\r\n\r\n    return {\r\n      reviews: reviewsDTO,\r\n      total: result.total,\r\n      page: result.page,\r\n      pages: result.pages,\r\n    };\r\n  } catch (error: any) {\r\n    logger.error(`Error fetching paginated reviews: ${error.message}`);\r\n\r\n    throw error instanceof ServiceError\r\n      ? error\r\n      : new ServiceError(\r\n          \"Failed to fetch paginated reviews\",\r\n          StatusCodes.INTERNAL_SERVER_ERROR,\r\n          error\r\n        );\r\n  }\r\n};\r\n\r\n  public approveReview = async (reviewId: string): Promise<IReviewDTO | null> => {\r\n    try {\r\n      logger.debug(`Approving review: ${reviewId}`);\r\n      const review = await this._reviewRepository.findReviewById(reviewId);\r\n      if (!review) {\r\n        logger.error(`Review not found: ${reviewId}`);\r\n        throw new ServiceError(\"Review not found\", StatusCodes.NOT_FOUND);\r\n      }\r\n\r\n      const updatedReview = await this._reviewRepository.updateReview(reviewId, { isApproved: true });\r\n      if (!updatedReview) {\r\n        logger.error(`Failed to update review: ${reviewId}`);\r\n        throw new ServiceError(\"Failed to update review\", StatusCodes.INTERNAL_SERVER_ERROR);\r\n      }\r\n      const reviewDTO = toReviewDTO(updatedReview);\r\n      if (!reviewDTO) {\r\n        logger.error(`Failed to map review ${updatedReview._id} to DTO`);\r\n        throw new ServiceError(\"Failed to map review to DTO\", StatusCodes.INTERNAL_SERVER_ERROR);\r\n      }\r\n\r\n      logger.info(`Review approved: ${reviewId}`);\r\n      return reviewDTO;\r\n    } catch (error: unknown) {\r\n      const err = error instanceof Error ? error : new Error(String(error));\r\n      logger.error(`Error approving review ${reviewId}: ${err.message}`);\r\n      throw error instanceof ServiceError\r\n        ? error\r\n        : new ServiceError(\r\n            \"Failed to approve review\",\r\n            StatusCodes.INTERNAL_SERVER_ERROR,\r\n            err\r\n          );\r\n    }\r\n  };\r\n\r\n  public selectReview = async (reviewId: string): Promise<IReviewDTO | null> => {\r\n    try {\r\n      logger.debug(`Selecting review: ${reviewId}`);\r\n      const review = await this._reviewRepository.findReviewById(reviewId);\r\n      if (!review) {\r\n        logger.error(`Review not found: ${reviewId}`);\r\n        throw new ServiceError(\"Review not found\", StatusCodes.NOT_FOUND);\r\n      }\r\n\r\n      if (!review.isApproved) {\r\n        logger.error(`Review not approved: ${reviewId}`);\r\n        throw new ServiceError(\r\n          \"Review must be approved before selecting\",\r\n          StatusCodes.BAD_REQUEST\r\n        );\r\n      }\r\n\r\n      const updatedReview = await this._reviewRepository.updateReview(reviewId, { isSelect: true });\r\n      if (!updatedReview) {\r\n        logger.error(`Failed to update review: ${reviewId}`);\r\n        throw new ServiceError(\"Failed to update review\", StatusCodes.INTERNAL_SERVER_ERROR);\r\n      }\r\n\r\n      const reviewDTO = toReviewDTO(updatedReview);\r\n      if (!reviewDTO) {\r\n        logger.error(`Failed to map review ${updatedReview._id} to DTO`);\r\n        throw new ServiceError(\"Failed to map review to DTO\", StatusCodes.INTERNAL_SERVER_ERROR);\r\n      }\r\n\r\n      logger.info(`Review selected: ${reviewId}`);\r\n      return reviewDTO;\r\n    } catch (error: unknown) {\r\n      const err = error instanceof Error ? error : new Error(String(error));\r\n      logger.error(`Error selecting review ${reviewId}: ${err.message}`);\r\n      throw error instanceof ServiceError\r\n        ? error\r\n        : new ServiceError(\r\n            \"Failed to select review\",\r\n            StatusCodes.INTERNAL_SERVER_ERROR,\r\n            err\r\n          );\r\n    }\r\n  };\r\n\r\n  public cancelApproval = async (reviewId: string): Promise<IReviewDTO | null> => {\r\n    try {\r\n      logger.debug(`Canceling approval for review: ${reviewId}`);\r\n      const review = await this._reviewRepository.findReviewById(reviewId);\r\n      if (!review) {\r\n        logger.error(`Review not found: ${reviewId}`);\r\n        throw new ServiceError(\"Review not found\", StatusCodes.NOT_FOUND);\r\n      }\r\n\r\n      const updatedReview = await this._reviewRepository.updateReview(reviewId, {\r\n        isApproved: false,\r\n        isSelect: false,\r\n      });\r\n      if (!updatedReview) {\r\n        logger.error(`Failed to update review: ${reviewId}`);\r\n        throw new ServiceError(\"Failed to update review\", StatusCodes.INTERNAL_SERVER_ERROR);\r\n      }\r\n\r\n      const reviewDTO = toReviewDTO(updatedReview);\r\n      if (!reviewDTO) {\r\n        logger.error(`Failed to map review ${updatedReview._id} to DTO`);\r\n        throw new ServiceError(\"Failed to map review to DTO\", StatusCodes.INTERNAL_SERVER_ERROR);\r\n      }\r\n\r\n      logger.info(`Approval canceled for review: ${reviewId}`);\r\n      return reviewDTO;\r\n    } catch (error: unknown) {\r\n      const err = error instanceof Error ? error : new Error(String(error));\r\n      logger.error(`Error canceling approval for review ${reviewId}: ${err.message}`);\r\n      throw error instanceof ServiceError\r\n        ? error\r\n        : new ServiceError(\r\n            \"Failed to cancel approval\",\r\n            StatusCodes.INTERNAL_SERVER_ERROR,\r\n            err\r\n          );\r\n    }\r\n  };\r\n\r\n  public deselectReview = async (reviewId: string): Promise<IReviewDTO | null> => {\r\n    try {\r\n      logger.debug(`Deselecting review: ${reviewId}`);\r\n\r\n      const review = await this._reviewRepository.findReviewById(reviewId);\r\n      if (!review) {\r\n        logger.error(`Review not found: ${reviewId}`);\r\n        throw new ServiceError(\"Review not found\", StatusCodes.NOT_FOUND);\r\n      }\r\n\r\n      if (!review.isSelect) {\r\n        logger.error(`Review not selected: ${reviewId}`);\r\n        throw new ServiceError(\"Review not selected\", StatusCodes.BAD_REQUEST);\r\n      }\r\n\r\n      const updatedReview = await this._reviewRepository.updateReview(reviewId, { isSelect: false });\r\n      if (!updatedReview) {\r\n        logger.error(`Failed to update review: ${reviewId}`);\r\n        throw new ServiceError(\"Failed to update review\", StatusCodes.INTERNAL_SERVER_ERROR);\r\n      }\r\n\r\n      const reviewDTO = toReviewDTO(updatedReview);\r\n      if (!reviewDTO) {\r\n        logger.error(`Failed to map review ${updatedReview._id} to DTO`);\r\n        throw new ServiceError(\"Failed to map review to DTO\", StatusCodes.INTERNAL_SERVER_ERROR);\r\n      }\r\n\r\n      logger.info(`Review deselected: ${reviewId}`);\r\n      return reviewDTO;\r\n    } catch (error: unknown) {\r\n      const err = error instanceof Error ? error : new Error(String(error));\r\n      logger.error(`Error deselecting review ${reviewId}: ${err.message}`);\r\n      throw error instanceof ServiceError\r\n        ? error\r\n        : new ServiceError(\r\n            \"Failed to deselect review\",\r\n            StatusCodes.INTERNAL_SERVER_ERROR,\r\n            err\r\n          );\r\n    }\r\n  };\r\n\r\n  public getSelectedReviews = async (): Promise<IReviewDTO[]> => {\r\n    try {\r\n      logger.debug(\"Fetching selected reviews\");\r\n      const reviews = await this._reviewRepository.getSelectedReviews();\r\n      const reviewDTOs = toReviewDTOs(reviews);\r\n      logger.info(`Fetched ${reviewDTOs.length} selected reviews`);\r\n      return reviewDTOs;\r\n    } catch (error: unknown) {\r\n      const err = error instanceof Error ? error : new Error(String(error));\r\n      logger.error(`Error fetching selected reviews: ${err.message}`);\r\n      throw error instanceof ServiceError\r\n        ? error\r\n        : new ServiceError(\r\n            \"Failed to fetch selected reviews\",\r\n            StatusCodes.INTERNAL_SERVER_ERROR,\r\n            err\r\n          );\r\n    }\r\n  }\r\n}"]}