{"version":3,"file":"skill-service.js","sourceRoot":"","sources":["../../src/services/skill-service.ts"],"names":[],"mappings":"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","sourcesContent":["import { inject, injectable } from \"inversify\";\r\nimport { ISkill } from \"../Interfaces/Models/i-skill\";\r\nimport logger from \"../core/utils/logger\";\r\nimport { uploadMedia } from \"../core/utils/cloudinary\";\r\nimport { ServiceError } from \"../core/utils/error-handler\";\r\nimport { ISkillsService } from \"../Interfaces/Services/i-skills-service\";\r\nimport { StatusCodes } from \"../enums/status-code-enums\";\r\nimport { ISkillsRepository } from \"../Interfaces/Repository/i-skills-repositry\";\r\nimport { ISkillDTO } from \"../Interfaces/DTOs/i-skill-dto\";\r\nimport { toSkillDTO, toSkillDTOs } from \"../Utils/mappers/skill-mapper\";\r\n\r\n@injectable()\r\nexport class SkillsService implements ISkillsService {\r\n  private _skillsRepository: ISkillsRepository;\r\n\r\n  constructor(@inject('ISkillsRepository') skillRepository : ISkillsRepository) {\r\n    this._skillsRepository = skillRepository;\r\n  }\r\n\r\n  createSkill = async (data: Partial<ISkill>, imagePath?: string, fileSize?: number): Promise<ISkillDTO> => {\r\n    try {\r\n      logger.debug(`Creating skill: ${data.name} for subcategory ${data.subcategoryId}`);\r\n\r\n      if (!data.name || !data.subcategoryId) {\r\n        logger.error(\"Missing required fields: name or subcategoryId\");\r\n        throw new ServiceError(\r\n          \"Skill name and subcategory ID are required\",\r\n          StatusCodes.BAD_REQUEST\r\n        );\r\n      }\r\n\r\n      const isDuplicate = await this._skillsRepository.isDuplicateSkill(data.name, data.subcategoryId.toString());\r\n      if (isDuplicate) {\r\n        logger.warn(`Skill name '${data.name}' already exists in subcategory ${data.subcategoryId}`);\r\n        throw new ServiceError(\r\n          \"Skill name already exists in this subcategory\",\r\n          StatusCodes.BAD_REQUEST\r\n        );\r\n      }\r\n\r\n      let imageUrl: string | null = null;\r\n      if (imagePath) {\r\n        const folder = \"skills\";\r\n        const { url } = await uploadMedia(imagePath, folder, fileSize);\r\n        imageUrl = url;\r\n        logger.info(`Uploaded image for skill: ${imageUrl}`);\r\n      }\r\n\r\n      const skill = await this._skillsRepository.createSkill({ ...data, imageUrl });\r\n      const skillDTO = toSkillDTO(skill);\r\n      if (!skillDTO) {\r\n        logger.error(`Failed to map skill ${skill._id} to DTO`);\r\n        throw new ServiceError(\r\n          \"Failed to map skill to DTO\",\r\n          StatusCodes.INTERNAL_SERVER_ERROR\r\n        );\r\n      }\r\n      logger.info(`Skill created: ${skill._id} (${skill.name})`);\r\n      return skillDTO;\r\n    } catch (error: unknown) {\r\n      const err = error instanceof Error ? error : new Error(String(error));\r\n      logger.error(`Error creating skill ${data.name}: ${err.message}`);\r\n      throw error instanceof ServiceError\r\n        ? error\r\n        : new ServiceError(\r\n            \"Failed to create skill\",\r\n            StatusCodes.INTERNAL_SERVER_ERROR,\r\n            err\r\n          );\r\n    }\r\n  };\r\n\r\n  public getAllSkills = async (\r\n    subcategoryId: string,\r\n    query: { search?: string; page?: number; limit?: number } = {}\r\n  ): Promise<{ skills: ISkillDTO[]; total: number }> => {\r\n    try {\r\n      logger.debug(`Service: Fetching skills for subcategory: ${subcategoryId}`);\r\n      const result = await this._skillsRepository.getAllSkills(subcategoryId, query);\r\n      const skillsDTO = toSkillDTOs(result.skills);\r\n      return { skills: skillsDTO, total: result.total };\r\n    } catch (error: unknown) {\r\n      const err = error instanceof Error ? error : new Error(String(error));\r\n      logger.error(`Error in SkillService: ${err.message}`);\r\n      throw new ServiceError(\r\n        \"Failed to fetch skills\",\r\n        StatusCodes.INTERNAL_SERVER_ERROR,\r\n        err\r\n      );\r\n    }\r\n  };\r\n\r\n  getSkillById = async (id: string): Promise<ISkillDTO | null> => {\r\n    try {\r\n      logger.debug(`Fetching skill: ${id}`);\r\n      const skill = await this._skillsRepository.getSkillById(id);\r\n      if (!skill) {\r\n        logger.warn(`Skill not found: ${id}`);\r\n        throw new ServiceError(\"Skill not found\", StatusCodes.NOT_FOUND);\r\n      }\r\n\r\n      const skillDTO = toSkillDTO(skill);\r\n      if (!skillDTO) {\r\n        logger.error(`Failed to map skill ${id} to DTO`);\r\n        throw new ServiceError(\r\n          \"Failed to map skill to DTO\",\r\n          StatusCodes.INTERNAL_SERVER_ERROR\r\n        );\r\n      }\r\n      logger.info(`Skill fetched: ${id} (${skill.name})`);\r\n      return skillDTO;\r\n    } catch (error: unknown) {\r\n      const err = error instanceof Error ? error : new Error(String(error));\r\n      logger.error(`Error fetching skill ${id}: ${err.message}`);\r\n      throw error instanceof ServiceError\r\n        ? error\r\n        : new ServiceError(\r\n            \"Failed to fetch skill\",\r\n            StatusCodes.INTERNAL_SERVER_ERROR,\r\n            err\r\n          );\r\n    }\r\n  };\r\n\r\n  updateSkill = async (\r\n    id: string,\r\n    data: Partial<ISkill>,\r\n    imagePath?: string,\r\n    fileSize?: number\r\n  ): Promise<ISkillDTO | null> => {\r\n    try {\r\n      logger.debug(`Updating skill: ${id}`);\r\n      if (data.name) {\r\n        const existingSkill = await this._skillsRepository.getSkillById(id);\r\n        if (!existingSkill) {\r\n          logger.warn(`Skill not found for update: ${id}`);\r\n          throw new ServiceError(\"Skill not found\", StatusCodes.NOT_FOUND);\r\n        }\r\n        const isDuplicate = await this._skillsRepository.isDuplicateSkill(\r\n          data.name,\r\n          existingSkill.subcategoryId._id.toString(),\r\n          id\r\n        );\r\n        if (isDuplicate) {\r\n          logger.warn(`Skill name '${data.name}' already exists in subcategory ${existingSkill.subcategoryId}`);\r\n          throw new ServiceError(\r\n            \"Skill name already exists in this subcategory\",\r\n            StatusCodes.BAD_REQUEST\r\n          );\r\n        }\r\n      }\r\n      let imageUrl: string | null = null;\r\n      if (imagePath) {\r\n        const folder = \"skills\";\r\n        const { url } = await uploadMedia(imagePath, folder, fileSize);\r\n        imageUrl = url;\r\n        logger.info(`Uploaded image for skill: ${imageUrl}`);\r\n      }\r\n\r\n      const skill = await this._skillsRepository.updateSkill(id, { ...data, ...(imageUrl && { imageUrl }) });\r\n      if (!skill) {\r\n        logger.warn(`Skill not found for update: ${id}`);\r\n        throw new ServiceError(\"Skill not found\", StatusCodes.NOT_FOUND);\r\n      }\r\n\r\n      const skillDTO = toSkillDTO(skill);\r\n      if (!skillDTO) {\r\n        logger.error(`Failed to map skill ${id} to DTO`);\r\n        throw new ServiceError(\r\n          \"Failed to map skill to DTO\",\r\n          StatusCodes.INTERNAL_SERVER_ERROR\r\n        );\r\n      }\r\n      logger.info(`Skill updated: ${id} (${skill.name})`);\r\n      return skillDTO;\r\n    } catch (error: unknown) {\r\n      const err = error instanceof Error ? error : new Error(String(error));\r\n      logger.error(`Error updating skill ${id}: ${err.message}`);\r\n      throw error instanceof ServiceError\r\n        ? error\r\n        : new ServiceError(\r\n            \"Failed to update skill\",\r\n            StatusCodes.INTERNAL_SERVER_ERROR,\r\n            err\r\n          );\r\n    }\r\n  };\r\n\r\n  deleteSkill = async (id: string): Promise<ISkillDTO | null> => {\r\n    try {\r\n      logger.debug(`Deleting skill: ${id}`);\r\n\r\n      const skill = await this._skillsRepository.deleteSkill(id);\r\n      if (!skill) {\r\n        logger.warn(`Skill not found for deletion: ${id}`);\r\n        throw new ServiceError(\"Skill not found\", StatusCodes.NOT_FOUND);\r\n      }\r\n\r\n      const skillDTO = toSkillDTO(skill);\r\n      if (!skillDTO) {\r\n        logger.error(`Failed to map skill ${id} to DTO`);\r\n        throw new ServiceError(\r\n          \"Failed to map skill to DTO\",\r\n          StatusCodes.INTERNAL_SERVER_ERROR\r\n        );\r\n      }\r\n      logger.info(`Skill deleted: ${id} (${skill.name})`);\r\n      return skillDTO;\r\n    } catch (error: unknown) {\r\n      const err = error instanceof Error ? error : new Error(String(error));\r\n      logger.error(`Error deleting skill ${id}: ${err.message}`);\r\n      throw error instanceof ServiceError\r\n        ? error\r\n        : new ServiceError(\r\n            \"Failed to delete skill\",\r\n            StatusCodes.INTERNAL_SERVER_ERROR,\r\n            err\r\n          )\r\n    }\r\n  }\r\n\r\n  getSkills = async (): Promise<{ _id: string; name: string }[]> => {\r\n    try {\r\n      logger.debug(\"Fetching all skills (name and ID only)\");\r\n      const skills = await this._skillsRepository.getSkills();\r\n      logger.info(`Fetched ${skills.length} skills`);\r\n      return skills;\r\n    } catch (error: unknown) {\r\n      const err = error instanceof Error ? error : new Error(String(error));\r\n      logger.error(`Error fetching skills: ${err.message}`);\r\n      throw error instanceof ServiceError\r\n        ? error\r\n        : new ServiceError(\r\n            \"Failed to fetch skills\",\r\n            StatusCodes.INTERNAL_SERVER_ERROR,\r\n            err\r\n          );\r\n    }\r\n  }\r\n}"]}