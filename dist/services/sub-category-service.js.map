{"version":3,"file":"sub-category-service.js","sourceRoot":"","sources":["../../src/services/sub-category-service.ts"],"names":[],"mappings":"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","sourcesContent":["import { inject, injectable } from \"inversify\";\r\nimport { ISubcategory } from \"../Interfaces/Models/i-sub-category\";\r\nimport logger from \"../core/utils/logger\";\r\nimport { uploadMedia } from \"../core/utils/cloudinary\";\r\nimport { ServiceError } from \"../core/utils/error-handler\";\r\nimport { StatusCodes } from \"../enums/status-code-enums\";\r\nimport { ISubcategoryRepository } from \"../Interfaces/Repository/i-sub-category-repositry\";\r\nimport { ISkillsRepository } from \"../Interfaces/Repository/i-skills-repositry\";\r\nimport { ISubcategoryDTO } from \"../Interfaces/DTOs/i-sub-category-dto\";\r\nimport { ISubcategoryService } from \"../Interfaces/Services/i-sub-category-service\";\r\nimport { toSubcategoryDTO, toSubcategoryDTOs } from \"../Utils/mappers/subcategory-mapper\";\r\n\r\n@injectable()\r\nexport class SubcategoryService  implements ISubcategoryService{\r\n  private _subcategoryRepository: ISubcategoryRepository;\r\n  private _skillsRepository: ISkillsRepository;\r\n\r\n  constructor(\r\n    @inject('ISubCategoryRepository') subcategoryRepository : ISubcategoryRepository,\r\n    @inject('ISkillsRepository') skillsRepository : ISkillsRepository\r\n  ) {\r\n    this._subcategoryRepository = subcategoryRepository;\r\n    this._skillsRepository = skillsRepository;\r\n  }\r\n\r\n   public createSubcategory = async (data: Partial<ISubcategory>, imagePath?: string, fileSize?: number): Promise<ISubcategoryDTO> => {\r\n    try {\r\n      logger.debug(`Creating subcategory: ${data.name} for category ${data.categoryId}`);\r\n\r\n      if (!data.name || !data.categoryId) {\r\n        logger.error(\"Missing required fields: name or categoryId\");\r\n        throw new ServiceError(\r\n          \"Subcategory name and category ID are required\",\r\n          StatusCodes.BAD_REQUEST\r\n        );\r\n      }\r\n\r\n      const isDuplicate = await this._subcategoryRepository.isDuplicateSubcategory(data.name, data.categoryId.toString());\r\n      if (isDuplicate) {\r\n        logger.warn(`Subcategory name '${data.name}' already exists in category ${data.categoryId}`);\r\n        throw new ServiceError(\r\n          \"Subcategory name already exists in this category\",\r\n          StatusCodes.BAD_REQUEST\r\n        );\r\n      }\r\n\r\n      let imageUrl: string | null = null;\r\n      if (imagePath) {\r\n        const folder = \"sub-categories\";\r\n        const { url } = await uploadMedia(imagePath, folder, fileSize);\r\n        imageUrl = url;\r\n        logger.info(`Uploaded image for subcategory: ${imageUrl}`);\r\n      }\r\n\r\n      const subcategory = await this._subcategoryRepository.createSubcategory({ ...data, imageUrl });\r\n      const subcategoryDTO = toSubcategoryDTO(subcategory);\r\n      if (!subcategoryDTO) {\r\n        logger.error(`Failed to map subcategory ${subcategory._id} to DTO`);\r\n        throw new ServiceError(\r\n          \"Failed to map subcategory to DTO\",\r\n          StatusCodes.INTERNAL_SERVER_ERROR\r\n        );\r\n      }\r\n      logger.info(`Subcategory created: ${subcategory._id} (${subcategory.name})`);\r\n      return subcategoryDTO;\r\n    } catch (error: unknown) {\r\n      const err = error instanceof Error ? error : new Error(String(error));\r\n      logger.error(`Error creating subcategory ${data.name}: ${err.message}`);\r\n      throw error instanceof ServiceError\r\n        ? error\r\n        : new ServiceError(\r\n            \"Failed to create subcategory\",\r\n            StatusCodes.INTERNAL_SERVER_ERROR,\r\n            err\r\n          );\r\n    }\r\n  };\r\n\r\n  public getAllSubcategories = async (\r\n    categoryId: string,\r\n    query: { search?: string; page?: number; limit?: number }\r\n  ): Promise<{ subcategories: ISubcategoryDTO[]; total: number }> => {\r\n    try {\r\n      logger.debug(`Service: Fetching subcategories for category: ${categoryId}`);\r\n      const result = await this._subcategoryRepository.getAllSubcategories(categoryId, query);\r\n      const subcategoriesDTO = toSubcategoryDTOs(result.subcategories);\r\n      return { subcategories: subcategoriesDTO, total: result.total };\r\n    } catch (error: unknown) {\r\n      const err = error instanceof Error ? error : new Error(String(error));\r\n      logger.error(`Error in SubcategoryService: ${err.message}`);\r\n      throw new ServiceError(\r\n        \"Failed to fetch subcategories\",\r\n        StatusCodes.INTERNAL_SERVER_ERROR,\r\n        err\r\n      );\r\n    }\r\n  };\r\n\r\n  public getSubcategoryById = async (id: string): Promise<ISubcategoryDTO> => {\r\n    try {\r\n      logger.debug(`Fetching subcategory: ${id}`);\r\n      const subcategory = await this._subcategoryRepository.getSubcategoryById(id);\r\n      if (!subcategory) {\r\n        logger.warn(`Subcategory not found: ${id}`);\r\n        throw new ServiceError(\"Subcategory not found\", StatusCodes.NOT_FOUND);\r\n      }\r\n      const subcategoryDTO = toSubcategoryDTO(subcategory);\r\n      if (!subcategoryDTO) {\r\n        logger.error(`Failed to map subcategory ${id} to DTO`);\r\n        throw new ServiceError(\r\n          \"Failed to map subcategory to DTO\",\r\n          StatusCodes.INTERNAL_SERVER_ERROR\r\n        );\r\n      }\r\n      logger.info(`Subcategory fetched: ${id} (${subcategory.name})`);\r\n      return subcategoryDTO;\r\n    } catch (error: unknown) {\r\n      const err = error instanceof Error ? error : new Error(String(error));\r\n      logger.error(`Error fetching subcategory ${id}: ${err.message}`);\r\n      throw error instanceof ServiceError\r\n        ? error\r\n        : new ServiceError(\r\n            \"Failed to fetch subcategory\",\r\n            StatusCodes.INTERNAL_SERVER_ERROR,\r\n            err\r\n          );\r\n    }\r\n  };\r\n\r\n  public updateSubcategory = async (\r\n    id: string,\r\n    data: Partial<ISubcategory>,\r\n    imagePath?: string,\r\n    fileSize?: number\r\n  ): Promise<ISubcategoryDTO> => {\r\n    try {\r\n      logger.debug(`Updating subcategory: ${id}`);\r\n      if (data.name) {\r\n        const existingSubcategory = await this._subcategoryRepository.getSubcategoryById(id);\r\n        if (!existingSubcategory) {\r\n          logger.warn(`Subcategory not found for update: ${id}`);\r\n          throw new ServiceError(\"Subcategory not found\", StatusCodes.NOT_FOUND);\r\n        }\r\n        const isDuplicate = await this._subcategoryRepository.isDuplicateSubcategory(\r\n          data.name,\r\n          existingSubcategory.categoryId._id.toString(),\r\n          id\r\n        );\r\n        if (isDuplicate) {\r\n          logger.warn(`Subcategory name '${data.name}' already exists in category ${existingSubcategory.categoryId}`);\r\n          throw new ServiceError(\r\n            \"Subcategory name already exists in this category\",\r\n            StatusCodes.BAD_REQUEST\r\n          );\r\n        }\r\n      }\r\n\r\n      let imageUrl: string | null = null;\r\n      if (imagePath) {\r\n        const folder = \"sub-categories\";\r\n        const { url } = await uploadMedia(imagePath, folder, fileSize);\r\n        imageUrl = url;\r\n        logger.info(`Uploaded image for subcategory: ${imageUrl}`);\r\n      }\r\n\r\n      const subcategory = await this._subcategoryRepository.updateSubcategory(id, {\r\n        ...data,\r\n        ...(imageUrl && { imageUrl }),\r\n      });\r\n      if (!subcategory) {\r\n        logger.warn(`Subcategory not found for update: ${id}`);\r\n        throw new ServiceError(\"Subcategory not found\", StatusCodes.NOT_FOUND);\r\n      }\r\n\r\n      const subcategoryDTO = toSubcategoryDTO(subcategory);\r\n      if (!subcategoryDTO) {\r\n        logger.error(`Failed to map subcategory ${id} to DTO`);\r\n        throw new ServiceError(\r\n          \"Failed to map subcategory to DTO\",\r\n          StatusCodes.INTERNAL_SERVER_ERROR\r\n        );\r\n      }\r\n      logger.info(`Subcategory updated: ${id} (${subcategory.name})`);\r\n      return subcategoryDTO;\r\n    } catch (error: unknown) {\r\n      const err = error instanceof Error ? error : new Error(String(error));\r\n      logger.error(`Error updating subcategory ${id}: ${err.message}`);\r\n      throw error instanceof ServiceError\r\n        ? error\r\n        : new ServiceError(\r\n            \"Failed to update subcategory\",\r\n            StatusCodes.INTERNAL_SERVER_ERROR,\r\n            err\r\n          );\r\n    }\r\n  };\r\n\r\n  public deleteSubcategory = async (id: string): Promise<ISubcategoryDTO> => {\r\n    try {\r\n      logger.debug(`Deleting subcategory: ${id}`);\r\n      await this._skillsRepository.deleteManySkillsBySubcategoryId(id);\r\n      logger.info(`Deleted skills for subcategory: ${id}`);\r\n\r\n      const subcategory = await this._subcategoryRepository.deleteSubcategory(id);\r\n      if (!subcategory) {\r\n        logger.warn(`Subcategory not found for deletion: ${id}`);\r\n        throw new ServiceError(\"Subcategory not found\", StatusCodes.NOT_FOUND);\r\n      }\r\n\r\n      const subcategoryDTO = toSubcategoryDTO(subcategory);\r\n      if (!subcategoryDTO) {\r\n        logger.error(`Failed to map subcategory ${id} to DTO`);\r\n        throw new ServiceError(\r\n          \"Failed to map subcategory to DTO\",\r\n          StatusCodes.INTERNAL_SERVER_ERROR\r\n        );\r\n      }\r\n      logger.info(`Subcategory deleted: ${id} (${subcategory.name})`);\r\n      return subcategoryDTO;\r\n    } catch (error: unknown) {\r\n      const err = error instanceof Error ? error : new Error(String(error));\r\n      logger.error(`Error deleting subcategory ${id}: ${err.message}`);\r\n      throw error instanceof ServiceError\r\n        ? error\r\n        : new ServiceError(\r\n            \"Failed to delete subcategory and related data\",\r\n            StatusCodes.INTERNAL_SERVER_ERROR,\r\n            err\r\n          );\r\n    }\r\n  };\r\n}"]}