{"version":3,"file":"task-service.js","sourceRoot":"","sources":["../../src/services/task-service.ts"],"names":[],"mappings":"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","sourcesContent":["import { inject, injectable } from \"inversify\";\r\nimport { ServiceError } from \"../core/utils/error-handler\";\r\nimport logger from \"../core/utils/logger\";\r\nimport { ITask } from \"../Interfaces/Models/i-task\";\r\nimport { uploadMedia } from \"../core/utils/cloudinary\";\r\nimport { StatusCodes } from \"../enums/status-code-enums\";\r\nimport { ITaskRepository } from \"../Interfaces/Repository/i-task-repositry\";\r\nimport { INotificationRepository } from \"../Interfaces/Repository/i-notification-repositry\";\r\nimport { ITaskService } from \"../Interfaces/Services/i-task-service\";\r\nimport { ITaskDTO } from \"../Interfaces/DTOs/i-task-dto\";\r\nimport { toTaskDTO, toTaskDTOs } from \"../Utils/mappers/task-mapper\";\r\n\r\n@injectable()\r\nexport class TaskService  implements ITaskService{\r\n  private _taskRepository: ITaskRepository;\r\n  private _notificationRepository: INotificationRepository;\r\n\r\n  constructor(\r\n    @inject('ITaskRepository') taskRepository : ITaskRepository,\r\n    @inject('INotificationRepository') notificationRepository : INotificationRepository\r\n  ) {\r\n    this._taskRepository = taskRepository;\r\n    this._notificationRepository = notificationRepository;\r\n  }\r\n\r\n  public createTask = async (taskData: Partial<ITask>, imagePath?: string, fileSize?: number): Promise<ITaskDTO> => {\r\n    try {\r\n      logger.debug(`Creating task: ${taskData.name}`);\r\n\r\n      if (!taskData.name || !taskData.createdBy || !taskData.contextType || !taskData.contextId) {\r\n        logger.error(\"Missing required fields: name, createdBy, contextType, or contextId\");\r\n        throw new ServiceError(\r\n          \"Task name, createdBy, contextType, and contextId are required\",\r\n          StatusCodes.BAD_REQUEST\r\n        );\r\n      }\r\n      const validContextTypes = [\"collaboration\", \"group\", \"user\"];\r\n      if (!validContextTypes.includes(taskData.contextType)) {\r\n        logger.error(`Invalid contextType: ${taskData.contextType}`);\r\n        throw new ServiceError(\r\n          `contextType must be one of: ${validContextTypes.join(\", \")}`,\r\n          StatusCodes.BAD_REQUEST\r\n        );\r\n      }\r\n\r\n      let image: string | undefined;\r\n      if (imagePath) {\r\n        logger.debug(`Uploading image for task: ${taskData.name}`);\r\n        const { url } = await uploadMedia(imagePath, \"tasks\", fileSize);\r\n        image = url;\r\n        logger.info(`Uploaded image for task: ${image}`);\r\n      }\r\n\r\n      const createdTask = await this._taskRepository.createTask({ ...taskData, image });\r\n      const taskDTO = toTaskDTO(createdTask);\r\n      if (!taskDTO) {\r\n        logger.error(`Failed to map task ${createdTask._id} to DTO`);\r\n        throw new ServiceError(\"Failed to map task to DTO\", StatusCodes.INTERNAL_SERVER_ERROR);\r\n      }\r\n      logger.info(`Task created: ${createdTask._id} (${createdTask.name})`);\r\n      return taskDTO;\r\n    } catch (error: unknown) {\r\n      const err = error instanceof Error ? error : new Error(String(error));\r\n      logger.error(`Error creating task ${taskData.name}: ${err.message}`);\r\n      throw error instanceof ServiceError\r\n        ? error\r\n        : new ServiceError(\r\n            \"Failed to create task\",\r\n            StatusCodes.INTERNAL_SERVER_ERROR,\r\n            err\r\n          );\r\n    }\r\n  };\r\n\r\n  public getTasksByContext = async (contextType: string, contextId: string, userId: string): Promise<ITaskDTO[]> => {\r\n    try {\r\n      logger.debug(`Fetching tasks for contextType=${contextType}, contextId=${contextId}, userId=${userId}`);\r\n      const validContextTypes = [\"collaboration\", \"group\", \"user\"];\r\n      if (!validContextTypes.includes(contextType)) {\r\n        logger.error(`Invalid contextType: ${contextType}`);\r\n        throw new ServiceError(\r\n          `contextType must be one of: ${validContextTypes.join(\", \")}`,\r\n          StatusCodes.BAD_REQUEST\r\n        );\r\n      }\r\n\r\n      const tasks = await this._taskRepository.findTasksByContext(contextType, contextId, userId);\r\n      const taskDTOs = toTaskDTOs(tasks);\r\n      logger.info(`Fetched ${taskDTOs.length} tasks for context: ${contextType}/${contextId}`);\r\n      return taskDTOs;\r\n    } catch (error: unknown) {\r\n      const err = error instanceof Error ? error : new Error(String(error));\r\n      logger.error(`Error fetching tasks for context ${contextType}/${contextId}: ${err.message}`);\r\n      throw error instanceof ServiceError\r\n        ? error\r\n        : new ServiceError(\r\n            \"Failed to fetch tasks by context\",\r\n            StatusCodes.INTERNAL_SERVER_ERROR,\r\n            err\r\n          );\r\n    }\r\n  };\r\n\r\n  public changeTaskPriority = async (taskId: string, priority: \"low\" | \"medium\" | \"high\"): Promise<ITaskDTO | null> => {\r\n    try {\r\n      logger.debug(`Changing task priority: taskId=${taskId}, priority=${priority}`);\r\n      const validPriorities = [\"low\", \"medium\", \"high\"];\r\n      if (!validPriorities.includes(priority)) {\r\n        logger.error(`Invalid priority: ${priority}`);\r\n        throw new ServiceError(\r\n          `Priority must be one of: ${validPriorities.join(\", \")}`,\r\n          StatusCodes.BAD_REQUEST\r\n        );\r\n      }\r\n\r\n      const task = await this._taskRepository.updateTaskPriority(taskId, priority);\r\n      if (!task) {\r\n        logger.warn(`Task not found: ${taskId}`);\r\n        throw new ServiceError(\"Task not found\", StatusCodes.NOT_FOUND);\r\n      }\r\n\r\n      const taskDTO = toTaskDTO(task);\r\n      if (!taskDTO) {\r\n        logger.error(`Failed to map task ${task._id} to DTO`);\r\n        throw new ServiceError(\"Failed to map task to DTO\", StatusCodes.INTERNAL_SERVER_ERROR);\r\n      }\r\n      logger.info(`Task priority changed: ${taskId} to ${priority}`);\r\n      return taskDTO;\r\n    } catch (error: unknown) {\r\n      const err = error instanceof Error ? error : new Error(String(error));\r\n      logger.error(`Error changing task priority for task ${taskId}: ${err.message}`);\r\n      throw error instanceof ServiceError\r\n        ? error\r\n        : new ServiceError(\r\n            \"Failed to change task priority\",\r\n            StatusCodes.INTERNAL_SERVER_ERROR,\r\n            err\r\n          );\r\n    }\r\n  };\r\n\r\n  public changeTaskStatus = async (\r\n    taskId: string,\r\n    status: \"pending\" | \"in-progress\" | \"completed\" | \"not-completed\"\r\n  ): Promise<ITaskDTO | null> => {\r\n    try {\r\n      logger.debug(`Changing task status: taskId=${taskId}, status=${status}`);\r\n      const validStatuses = [\"pending\", \"in-progress\", \"completed\", \"not-completed\"];\r\n      if (!validStatuses.includes(status)) {\r\n        logger.error(`Invalid status: ${status}`);\r\n        throw new ServiceError(\r\n          `Status must be one of: ${validStatuses.join(\", \")}`,\r\n          StatusCodes.BAD_REQUEST\r\n        );\r\n      }\r\n\r\n      const task = await this._taskRepository.updateTaskStatus(taskId, status);\r\n      if (!task) {\r\n        logger.warn(`Task not found: ${taskId}`);\r\n        throw new ServiceError(\"Task not found\", StatusCodes.NOT_FOUND);\r\n      }\r\n\r\n      const taskDTO = toTaskDTO(task);\r\n      if (!taskDTO) {\r\n        logger.error(`Failed to map task ${task._id} to DTO`);\r\n        throw new ServiceError(\"Failed to map task to DTO\", StatusCodes.INTERNAL_SERVER_ERROR);\r\n      }\r\n      logger.info(`Task status changed: ${taskId} to ${status}`);\r\n      return taskDTO;\r\n    } catch (error: unknown) {\r\n      const err = error instanceof Error ? error : new Error(String(error));\r\n      logger.error(`Error changing task status for task ${taskId}: ${err.message}`);\r\n      throw error instanceof ServiceError\r\n        ? error\r\n        : new ServiceError(\r\n            \"Failed to change task status\",\r\n            StatusCodes.INTERNAL_SERVER_ERROR,\r\n            err\r\n          );\r\n    }\r\n  };\r\n\r\n  public editTask = async (taskId: string, updates: Partial<ITask>): Promise<ITaskDTO | null> => {\r\n    try {\r\n      logger.debug(`Editing task: taskId=${taskId}`);\r\n\r\n      const task = await this._taskRepository.updateTask(taskId, updates);\r\n      if (!task) {\r\n        logger.warn(`Task not found: ${taskId}`);\r\n        throw new ServiceError(\"Task not found\", StatusCodes.NOT_FOUND);\r\n      }\r\n\r\n      const taskDTO = toTaskDTO(task);\r\n      if (!taskDTO) {\r\n        logger.error(`Failed to map task ${task._id} to DTO`);\r\n        throw new ServiceError(\"Failed to map task to DTO\", StatusCodes.INTERNAL_SERVER_ERROR);\r\n      }\r\n\r\n      if (updates.notificationDate || updates.notificationTime) {\r\n        logger.debug(`Updating notifications for task: ${taskId}`);\r\n        await this._notificationRepository.updateTaskNotifications(\r\n          taskId,\r\n          updates.notificationDate,\r\n          updates.notificationTime\r\n        );\r\n        logger.info(`Updated notifications for task: ${taskId}`);\r\n      }\r\n\r\n      logger.info(`Task updated: ${taskId} (${task.name})`);\r\n      return taskDTO;\r\n    } catch (error: unknown) {\r\n      const err = error instanceof Error ? error : new Error(String(error));\r\n      logger.error(`Error editing task ${taskId}: ${err.message}`);\r\n      throw error instanceof ServiceError\r\n        ? error\r\n        : new ServiceError(\r\n            \"Failed to edit task\",\r\n            StatusCodes.INTERNAL_SERVER_ERROR,\r\n            err\r\n          );\r\n    }\r\n  };\r\n\r\n  public deleteTask = async (taskId: string): Promise<void> => {\r\n    try {\r\n      logger.debug(`Deleting task: ${taskId}`);\r\n\r\n      const task = await this._taskRepository.deleteTask(taskId);\r\n      if (!task) {\r\n        logger.warn(`Task not found: ${taskId}`);\r\n        throw new ServiceError(\"Task not found\", StatusCodes.NOT_FOUND);\r\n      }\r\n\r\n      logger.info(`Task deleted: ${taskId}`);\r\n    } catch (error: unknown) {\r\n      const err = error instanceof Error ? error : new Error(String(error));\r\n      logger.error(`Error deleting task ${taskId}: ${err.message}`);\r\n      throw error instanceof ServiceError\r\n        ? error\r\n        : new ServiceError(\r\n            \"Failed to delete task\",\r\n            StatusCodes.INTERNAL_SERVER_ERROR,\r\n            err\r\n          );\r\n    }\r\n  }\r\n}\r\n"]}